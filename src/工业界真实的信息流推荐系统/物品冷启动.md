# 物品冷启动

<!-- toc -->

# 优化目标&评价指标

物品冷启动指的是如何对新发布的物品做分发。优化物品冷启动在小红书这样的 User-Generated Content (UGC) 平台尤为重要，这是因为新物品数量巨大，内容质量良莠不齐，分发非常困难。  
  
UGC 平台的物品冷启动有三个目标：  
1. 精准推荐：克服冷启的困难，把新物品推荐给合适的用户，不引起用户反感。  
2. 激励发布：流量向低曝光新物品倾斜，激励发布。  
3. 挖掘高潜：通过初期小流量的试探，找到高质量的物品，给与流量倾斜。  
  
UGC 平台的物品冷启动主要考察三种指标：  
1. 作者侧指标，包括发布渗透率、人均发布量。  
2. 用户侧指标，包括大盘消费指标和新物品消费指标。  
3. 内容侧指标，比如高热物品占比。

UGC平台什么时候需要物品冷启动？

- 小红书上用户新发布的笔记。
- B站上用户新上传的视频。
- 今日头条上作者新发布的文章。

主要研究UGC的物品冷启动，UGC冷启动难度高于PGC。
## 新笔记冷启动

为什么要特殊对待新笔记？

- 新笔记缺少与用户的交互，导致推荐的难度大、效果差。
- 扶持新发布、低曝光的笔记，可以增强作者发布意愿。

## 优化冷启的目标

1. 精准推荐：克服冷启的困难，把新笔记推荐给合适的用户，不引起用户反感。
2. 激励发布：流量向低曝光新笔记倾斜；激励作者发布
3. 挖掘高潜：通过初期小流量的试探，找到高质量的笔记，给与流量倾斜。

## 评价指标

作者侧指标：发布渗透率、人均发布量。

用户侧指标：
- 新笔记指标：新笔记的点击率、交互率。
- 大盘指标：消费时长、日活、月活。

内容侧指标：高热笔记占比。
### 作者侧指标

发布渗透率（penetration rate）=当日发布人数／日活人数

发布一篇或以上，就算一个发布人数。

例：当日发布人数=100万，日活人数=2000万，发布渗透率= 100 ／ 2000 = 5%

人均发布量=当日发布笔记数／日活人数

例：每日发布笔记数=200万，日活人数=2000万，人均发布量=200／ 2000=0.1

### 作者侧指标

发布渗透率、人均发布量反映出作者的发布积极性。

冷启的重要优化目标是促进发布，增大内容池。

新笔记获得的曝光越多，首次曝光和交互出现得越早，作者发布积极性越高。

**新笔记的消费指标

- 新笔记的点击率、交互率。问题：曝光的基尼系数很大。少数头部新笔记占据了大部分的曝光。
- 分别考察高曝光、低曝光新笔记。高曝光：比如>1000次曝光。低曝光：比如<1000次曝光°

高曝光的笔记无需冷启动处理，也能得到精准推荐。我们应该重点关注低曝光的笔记。

**用户侧指标大盘消费指标**：大盘的消费时长、日活、月活。

大力扶持低曝光新笔记会发生什么？
- 作者侧发布指标变好。
- 用户侧大盘消费指标变差。

### 内容侧指标

高热笔记占比

高热笔记：前30天获得1000+次点击。

高热笔记占比越高，说明冷启阶段挖掘优质笔记的能力越强。

## 总结

作者侧指标：发布渗透率、人均发布量。

用户侧指标：新笔记消费指标、大盘消费指标。

内容侧指标：高热笔记占比

冷启动的优化点：
- 优化全链路（包括召回和排序）
- 流量调控 (流量怎么在新物品、老物品中分配）


# 简单的召回通道

这节课的内容是物品冷启动 (item cold start) 中的召回。冷启动召回的难点是缺少用户交互，还没学好笔记 ID embedding，导致双塔模型效果不好。而且缺少用户交互会导致 ItemCF 不适用。  
  
这节课介绍两种简单的召回通道：  
1. 改造双塔模型，使得它适用于冷启动。  
2. 类目召回。

## 召回的依据

- √自带图片、文字、地点。
- √算法或人工标注的标签。
- ×没有用户点击、点赞等信息。
- × 没有笔记 ID embedding。

## 冷启召回的困难

- 缺少用户交互，还没学好笔记ID embedding，导致双塔模型效果不好。
- 缺少用户交互，导致ItemCF不适用。

为什么ItemCF不适用于物品冷启动？

## 召回通道

- ItemCF召回 (不适用）
- 双塔模型（改造后适用）
- 类目、关键词召回（适用）
- 聚类召回（适用）
- Look-Alike召回（适用）

### 双塔模型

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225103322.png)

改进ID Embedding来改造双塔模型。

改进方案 1：新笔记使用 default embedding。

- 物品塔做ID embedding 时，让所有新笔记共享一个 ID，而不是用自己真正的ID。
- Default embedding：共享的 ID 对应的 embedding 向量。
- 到下次模型训练的时候，新笔记才有自己的ID embedding 向量。

改进方案 2：利用相似笔记 embedding 向量。
- 查找top K内容最相似的高曝笔记。
- 把k个高曝笔记的 embedding 向量取平均，作为新笔记的embedding。

在实践中，通常使用多个向量召回池。

- 多个召回池，让新笔记有更多曝光机会。可以有1小时新笔记，6小时新笔记，24小时新笔记，30天笔记。
- 共享同一个双塔模型，那么多个召回池不增加训练的代价。

### 类目召回和关键词召回

用户画像

感兴趣的类目：美食、科技数码、电影····

感兴趣的关键词：纽约、职场、搞笑、程序员、大学······

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225103715.png)

**基于类目的召回**
- 系统维护类目索引：类目→笔记列表 (按时间倒排)
- 用类目索引做召回：用户画像→类目→笔记列表
- 取回笔记列表上前k篇笔记（即最新的k篇）

**基于关键词的召回**

系统维护关键词索引：关键词→ 笔记列表（按时间倒排）

根据用户画像上的关键词做召回。

**缺点**：

缺点1：只对刚刚发布的新笔记有效。

- 取回某类目/关键词下最新的k篇笔记。
- 发布几小时之后，就再没有机会被召回。

缺点2：弱个性化，不够精准。

优点：类目召回和关键词召回能让笔记立即获得曝光，有助于提升作者的发布积极性。


# 聚类召回

这节课继续讲解物品冷启的召回。聚类召回是基于物品内容的召回通道。它假设如果用户喜欢一个物品，那么用户会喜欢内容相似的其他物品。使用聚类召回，需要事先训练一个多模态神经网络，将笔记图文表征为向量，并对向量做聚类，然后建索引。

## 聚类召回基本思想

如果用户喜欢一篇笔记，那么他会喜欢内容相似的笔记。

事先训练一个神经网络，基于笔记的类目和图文内容，把笔记映射到向量。

对笔记向量做聚类，划分为1000 cluster，记录每个 cluster 的中心方向。(k-means 聚类，用余弦相似度。）

## 聚类索引

一篇新笔记发布之后，用神经网络把它映射到一个特征向量。

从1000个向量（对应1000个cluster）中找到最相似的向量，作为新笔记的 cluster 。

索引：cluster → 笔记ID列表（按时间倒排）

### 线上召回

给定用户ID，找到他的 last-n 交互的笔记列表，把这些笔记作为种子笔记。

把每篇种子笔记映射到向量，寻找最相似的cluster。（知道了用户对哪些 cluster 感兴趣。）

从每个 cluster 的笔记列表中，取回最新的 m 篇笔记。

最多取回 m\*n 篇新笔记。

## 内容相似度模型

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225104304.png)

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225104338.png)

### 模型的训练

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225104416.png)

基本想法：鼓励cos(a,b+)大于cos(a,b-)

常用损失函数：

- Triplet hinge loss
- Triplet logistic loss

$$\textbf{Triplet hinge loss:} L(a, b^+, b^-) = \max\left( 0, \cos(a, b^-) + m - \cos(a, b^+) \right). $$

$$\textbf{Triplet logistic loss:} \\
L(a, b^+, b^-) = \log\left(1 + \exp\left(\cos(a, b^-) - \cos(a, b^+)\right)\right).$$

### <种子笔记，正样本>

方法一：人工标注二元组的相似度，人工标注代价太大，不划算。

方法二：算法自动选正样本

筛选条件：
- 只用高曝光笔记作为二元组（因为有充足的用户交互信息）。
- 两篇笔记有相同的二级类目，比如都是“菜谱教程”。

用 ItemCF 的物品相似度选正样本。

### <种子笔记， 负样本>

从全体笔记中随机选出满足条件的：
- 字数较多（神经网络提取的文本信息有效）。
- 笔记质量高，避免图文无关。

## 聚类召回总结

基本思想：根据用户的点赞、收藏、转发记录，推荐内容相似的笔记。

线下训练：多模态神经网络把图文内容映射成向量。

线上服务：用户喜欢的笔记 → 特征向量 → 最近的Cluster → 新笔记
# Look-Alike召回

这节课继续介绍物品冷启动。Look-Alike 是一种召回通道，对冷启很有效。Look-Alike 适用于发布一段时间、但是点击次数不高的物品。物品从发布到热门，主要的透出渠道会经历三个阶段：  
1. 类目召回、聚类召回。它们是基于内容的召回通道，适用于刚刚发布的物品。  
2. Look-Alike 召回。它适用于有点击，但是点击次数不高的物品。  
3. 双塔、ItemCF、Swing 等等。它们是基于用户行为的召回通道，适用于点击次数较高的物品。

## 用于互联网广告

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225104916.png)

Look-Alike用于互联网广告

如何计算两个用户的相似度？
- UserCF：两个用户有共同的兴趣点。
- Embedding：两个用户向量的cosine较大。

## Look-Alike人群扩散召回

点击、点赞、收藏、转发——用户对笔记可能感兴趣

把有交互的用户作为新笔记的种子用户。

用look-alike 在相似用户中扩散。

## Look-Alike用于新笔记召回

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250302112702.png)

- 近线更新特征向量
- 特征向量是有交互的用户的向量的平均。
- 每当有用户交互该物品，更新笔记的特征向量。

近线更新指近期更新，不用实时更新。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250302112910.png)

# 流量调控

流量调控是物品冷启动最重要的一环，直接影响作者发布指标。流量调控的发展通常会经历这几个阶段：  
1. 在推荐结果中强插新笔记。  
2. 对新笔记做提权（boost）。  
3. 通过提权，对新笔记做保量。  
4. 差异化保量。

## 扶持新笔记的目的

目的1：促进发布，增大内容池。

- 新笔记获得的曝光越多，作者创作积极性越高。
- 反映在发布渗透率、人均发布量。

目的2：挖掘优质笔记。

- 做探索，让每篇新笔记都能获得足够曝光。
- 挖掘的能力反映在高热笔记占比。

## 工业界的做法

- 假设推荐系统只分发年龄<30 天的笔记。
- 假设采用自然分发，新笔记（年龄<24小时) 的曝光占比为 1/30。
- 扶持新笔记，让新笔记的曝光占比远大于1/30。

## 流量调控技术的发展

1. 在推荐结果中强插新笔记。
2. 对新笔记的排序分数做提权（boost）。
3. 通过提权，对新笔记做保量。 
4. 差异化保量。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225112523.png)

### 新笔记提权

目标：让新笔记有更多机会曝光。

如果做自然分发，24小时新笔记占比为 1/30。做人为干涉，让新笔记占比大幅提升。

干涉粗排、重排环节，给新笔记提权（方法是给新笔记分数乘以一个大于1的常数，然后和老笔记自由竞争）。

优点：容易实现，投入产出比好。

缺点：
- 曝光量对提权系数很敏感。
- 很难精确控制曝光量，容易过度曝光和不充分曝光。

### 新笔记保量

保量：无论笔记质量高低，都保证24小时获得100次曝光。

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225112746.png)

**动态提权保量**

用下面四个值计算提权系数
- 目标时间：比如24小时。
- 目标曝光：比如100次。
- 发布时间：比如笔记已经发布12小时。
- 已有曝光：比如笔记已经获得20次曝光。

$提权系数 = f(\frac{发布时间}{目标时间}, \frac{已有曝光}{目标曝光})= f(0.5, 0.2)$

**保量的难点**

保量成功率远低于 100%。很多笔记在24小时达不到100次曝光。原因：
- 召回、排序存在不足。
- 提权系数调得不好。

线上环境变化会导致保量失败。

- 线上环境变化：新增召回通道、升级排序模型、改变重排打散规则····
- 线上环境变化后，需要调整提权系数。

**思考题**

给所有新笔记一个很大的提权系数（比如4倍）直到达成 100 次曝光为止。这样的保量成功率很高。

为什么不用这种方法呢？效果不好！

给新笔记分数 boost 越多，对新笔记越有利？

好处：分数提升越多，曝光次数越多。

坏处：把笔记推荐给不太合适的受众。

- 点击率、点赞率等指标会偏低。
- 长期会受推荐系统打压，难以成长为热门笔记。

## 差异化保量

保量：不论新笔记质量高低，都做扶持，在前24小时给100次曝光。

差异化保量：不同笔记有不同保量目标，普通笔记保100次曝光，内容优质的笔记保100~500次曝光。

- 基础保量：24小时100 次曝光。
- 内容质量：用模型评价内容质量高低，给予额外保量目标，上限是加200次曝光。
- 作者质量：根据作者历史上的笔记质量，给予额外保量目标，上限是加200次曝光。
- 一篇笔记最少有100次保量，最多有500次保量。

## 总结

流量调控：流量怎么在新老笔记之间分配。

扶持新笔记：单独的召回通道、在排序阶段提权。

保量：帮助新笔记在前 24小时获得100 次曝光。

差异化保量：根据内容质量、作者质量，决定保量目标。

# 冷启的AB测试

这节课的内容是物品冷启动的AB测试，内容很烧脑，不建议初学者观看。推荐系统常用的AB测试只考察用户侧消费指标，而推荐系统的AB测试还需要额外考察作者侧发布指标。后者远比前者复杂，而且所有已知的实验方案都存在缺陷。

## 新笔记冷启的AB测试

作者侧指标：发布渗透率、人均发布量。

用户侧指标：对新笔记的点击率、交互率。大盘指标：消费时长、日活、月活

标准的AB测试通常指管制大盘指标：消费时长、日活、月活。实验比较好做。

## 用户侧实验


![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225113623.png)

缺点
- 限定：保量100次曝光。
- 假设：新笔记曝光越多，用户使用APP时长越低。
- 新策略：把新笔记排序时的权重增大两倍。
- 结果（只看用户消费指标）：AB测试的diff是负数（实验组不如对照组）。如果推全，diff会缩小（比如一2%→一1%）。
## 作者侧实验

### 方案一

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225113758.png)

方案一缺点：新笔记之间会抢流量

设定：
- 新老笔记走各自队列，没有竞争。
- 重排分给新笔记1/3流量，分给老笔记 2/3流量

新策略：把新笔记的权重增大两倍。

结果（只看作者发布指标）：AB 测试的 diff 是正数（实验组优于对照组）。如果推全，diff 会消失（比如 2% →0）。

方案一缺点：新笔记和老笔记抢流量

设定：新老笔记自由竞争。

新策略：把新笔记排序时的权重增大两倍。

AB测试时，50% 新笔记（带策略）跟100%老笔记抢流量。

推全后，100%新笔记（带策略）跟100%老笔记抢流量。

AB 测试结果与推全结果有差异。

### 方案二

![](https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225114043.png)

方案二比方案一的优缺点

优点：新笔记的两个桶不抢流量，实验结果更可信。

相同：新笔记和老笔记抢流量，AB 测试结果与推全结果有差异。

缺点：新笔记池减小一半，对用户体验造成负面影响。

### 方案三：把老笔记也分为实验组和对照组

缺点：这种方式相当于把一个APP拆分为两个APP，不划算

## 总结

冷启的AB测试需要观测作者发布指标和用户消费指标。

各种AB测试的方案都有缺点。（小红书有更好的方案，但也不完美。）

设计方案的时候，问自己几个问题：

- 实验组、对照组新笔记会不会抢流量？
- 新笔记、老笔记怎么抢流量？
- 同时隔离笔记、用户，会不会让内容池变小？
- 如果对新笔记做保量，会发生什么？