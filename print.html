<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>推荐系统</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">推荐系统</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="chapter-1"><a class="header" href="#chapter-1">Chapter 1</a></h1>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="推荐系统实践"><a class="header" href="#推荐系统实践">推荐系统实践</a></h1>
<h2 id="内容提要"><a class="header" href="#内容提要">内容提要</a></h2>
<p>本书通过大量代码和图表全面系统地阐述了和推荐系统有关的理论基础，介绍了评价推荐系统优劣的各种标准（比如覆盖率、满意度）和方法（比如AB测试），总结了当今互联网领域中各种和推荐有关的产品和服务。另外，本书为有兴趣开发推荐系统的读者给出了设计和实现推荐系统的方法与技巧，并解答了在真实场景中应用推荐技术时最常遇到的一些问题。</p>
<p>本书适合对推荐技术感兴趣的读者学习参考。</p>
<p>在大家一起讨论的过程中，项亮经常提到另外一本非常流行的书，即《集体智慧编程》。项亮非常希望他写的书能像《集体智慧编程》那样简明实用，帮助那些对推荐技术或数据挖掘原理完全不了解的读者快速实现自己的推荐系统。出于这个目的，本书尽可能地用代码和图表与读者交流，尽可能地用直观的讨论代替数学公式，这对于大多数工程技术人员来说应该是更为喜闻乐见的形式。另一方面，可能是因为数据资源的限制，大多数学术论文都把推荐问题看做评分预测问题，而实际应用中最常见的是TopN推荐，虽然TopN推荐问题可以归纳成评分问题，但并不是每种评分预测算法都能直接用来解决TopN推荐问题。本书大部分篇幅都在讨论TopN推荐问题，这样的安排对实际应用的实现应该帮助会更大一点。</p>
<p>一般认为，推荐系统这个研究领域源于协同过滤算法的提出。这么说来，推荐系统诞生快20年了。这期间，很多学者和公司对推荐系统的发展起到了重要的推动作用，各种各样的推荐算法也层出不穷。本书希望将这20年间诞生的典型方法进行总结。但由于方法太多，这些方法的归类有很多不同的方式。比如，可以按照数据分成协同过滤、内容过滤、社会化过滤，也可以按照算法分成基于邻域的算法、基于图的算法、基于矩阵分解或者概率模型的算法。为了方便读者入门，本书基本采用数据分类的方法，每一章都介绍了一种可以用于推荐系统设计的、新类型的用户数据，然后介绍如何通过各种方法利用该数据，最后在公开数据集上评测这些方法。当然，不是所有数据都有公开的数据集，并且不是所有算法都可以进行离线评测。因此，在遇到没有数据集或无法进行离线评测的问题时，本书引用了一些著名学者的实验结果来说明各种方法的效果。</p>
<h2 id="后记"><a class="header" href="#后记">后记</a></h2>
<p>本书着重介绍了推荐系统的各种算法设计和系统设计的方法，并且利用一些公开的数据集离线评测了各种算法。对于无法通过离线评测知道算法性能的情况，本书引用了很多著名的用户调查实验来比较不同的算法。</p>
<p>首先需要申明，本书的很多离线实验都是在一两个数据集上完成的，所以本书得到的所有结论都不是定论，可能换一个数据集就会得到完全相反的结论。这主要是因为不同网站中的用户行为有很大的差异，所以推荐系统很难有放之四海而皆准的结论。因此本书非常鼓励读者在自己的数据集上重复本书的实验，再得到适合自己具体情况的结论。这也是本书书名中“实践”一词希望达到的效果。</p>
<p>最后，我想引用2009年ACM推荐系统大会上Strand研究人员做的一个报告“推荐系统十堂课”，在这个报告中Strand的研究人员总结了他们设计推荐系统的经验，提出了10条在设计推荐系统中学习到的经验和教训。</p>
<p>(1) 确定你真的需要推荐系统。推荐系统只有在用户遇到信息过载时才必要。如果你的网站物品不太多，或者用户兴趣都比较单一，那么也许并不需要推荐系统。所以不要纠结于推荐系统这个词，不要为了做推荐系统而做推荐系统，而是应该从用户的角度出发，设计出能够真正帮助用户发现内容的系统，无论这个系统算法是否复杂，只要能够真正帮助用户，就是一个好的系统。</p>
<p>(2) 确定商业目标和用户满意度之间的关系。对用户好的推荐系统不代表商业上有用的推荐系统，因此要首先确定用户满意的推荐系统和商业上需求的差距。一般来说，有些时候用户满意和商业需求并不吻合。但是一般情况下，用户满意度总是符合企业的长期利益，因此这一条的主要观点是要平衡企业的长期利益和短期利益之间的关系。</p>
<p>(3) 选择合适的开发人员。一般来说，如果是一家大公司，应该雇用自己的开发人员来专门进行推荐系统的开发。</p>
<p>(4) 忘记冷启动的问题。不断地创新，互联网上有任何你想要的数据。只要用户喜欢你的产品，他们就会不断贡献新的数据。</p>
<p>(5) 平衡数据和算法之间的关系。使用正确的用户数据对推荐系统至关重要。对用户行为数据的深刻理解是设计好推荐系统的必要条件，因此分析数据是设计系统中最重要的部分。数据分析决定了如何设计模型，而算法只是决定了最终如何优化模型。</p>
<p>(6) 找到相关的物品很容易，但是何时以何种方式将它们展现给用户是很困难的。不要为了推荐而推荐。</p>
<p>(7) 不要浪费时间计算相似兴趣的用户，可以直接利用社会网络数据。</p>
<p>(8) 需要不断地提升算法的扩展性。</p>
<p>(9) 选择合适的用户反馈方式。</p>
<p>(10) 设计合理的评测系统，时刻关注推荐系统各方面的性能</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="好的推荐系统"><a class="header" href="#好的推荐系统">好的推荐系统</a></h1>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E4%BB%80%E4%B9%88%E6%98%AF%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F">什么是推荐系统</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E4%B8%AA%E6%80%A7%E5%8C%96%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BA%94%E7%94%A8">个性化推荐系统的应用</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E7%94%B5%E5%AD%90%E5%95%86%E5%8A%A1">电子商务</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E7%94%B5%E5%BD%B1%E5%92%8C%E8%A7%86%E9%A2%91%E7%BD%91%E7%AB%99">电影和视频网站</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E4%B8%AA%E6%80%A7%E5%8C%96%E9%9F%B3%E4%B9%90%E7%BD%91%E7%BB%9C%E7%94%B5%E5%8F%B0">个性化音乐网络电台</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C">社交网络</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E4%B8%AA%E6%80%A7%E5%8C%96%E9%98%85%E8%AF%BB">个性化阅读</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E5%9F%BA%E4%BA%8E%E4%BD%8D%E7%BD%AE%E7%9A%84%E6%9C%8D%E5%8A%A1">基于位置的服务</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E4%B8%AA%E6%80%A7%E5%8C%96%E9%82%AE%E4%BB%B6">个性化邮件</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E4%B8%AA%E6%80%A7%E5%8C%96%E5%B9%BF%E5%91%8A">个性化广告</a></li>
</ul>
</li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E8%AF%84%E6%B5%8B">推荐系统评测</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E9%AA%8C%E6%96%B9%E6%B3%95">推荐系统实验方法</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E8%AF%84%E6%B5%8B%E6%8C%87%E6%A0%87">评测指标</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%A5%BD%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E8%AF%84%E6%B5%8B%E7%BB%B4%E5%BA%A6">评测维度</a></li>
</ul>
</li>
</ul>
<p>在研究如何设计推荐系统前，了解什么是好的推荐系统至关重要。只有了解了优秀推荐系统的特征，我们才能在设计推荐系统时根据实际情况进行取舍。本章分3个步骤来回答这个问题：首先，本章将介绍什么是推荐系统、推荐系统的主要任务、推荐系统和分类目录以及搜索引擎的区别等；然后，本章将按照不同领域分门别类地介绍目前业界常见的个性化推荐应用；最后，本章将介绍推荐系统的评测，通过介绍评测指标给出“好”的定义，从而最终解答“什么是好的推荐系统”这个问题。</p>
<h2 id="什么是推荐系统"><a class="header" href="#什么是推荐系统">什么是推荐系统</a></h2>
<p>随着信息技术和互联网的发展，人们逐渐从信息匮乏的时代走入了信息过载（information overload）的时代。在这个时代，无论是信息消费者还是信息生产者都遇到了很大的挑战：作为信息消费者，如何从大量信息中找到自己感兴趣的信息是一件非常困难的事情；作为信息生产者，如何让自己生产的信息脱颖而出，受到广大用户的关注，也是一件非常困难的事情。推荐系统就是解决这一矛盾的重要工具。推荐系统的任务就是联系用户和信息，一方面帮助用户发现对自己有价值的信息，另一方面让信息能够展现在对它感兴趣的用户面前，从而实现信息消费者和信息生产者的双赢。（本书后面将信息统称为“物品”，即可以供用户消费的东西。）</p>
<p>推荐系统的基本任务是联系用户和物品，解决信息过载的问题。</p>
<p>众所周知，为了解决信息过载的问题，已经有无数科学家和工程师提出了很多天才的解决方案，其中代表性的解决方案是分类目录和搜索引擎。而这两种解决方案分别催生了互联网领域的两家著名公司——雅虎和谷歌。著名的互联网公司雅虎凭借分类目录起家，而现在比较著名的分类目录网站还有国外的DMOZ、国内的Hao123等。这些目录将著名的网站分门别类，从而方便用户根据类别查找网站。但是随着互联网规模的不断扩大，分类目录网站也只能覆盖少量的热门网站，越来越不能满足用户的需求。因此，搜索引擎诞生了。以谷歌为代表的搜索引擎可以让用户通过搜索关键词找到自己需要的信息。但是，搜索引擎需要用户主动提供准确的关键词来寻找信息，因此不能解决用户的很多其他需求，比如当用户无法找到准确描述自己需求的关键词时，搜索引擎就无能为力了。和搜索引擎一样，推荐系统也是一种帮助用户快速发现有用信息的工具。和搜索引擎不同的是，推荐系统不需要用户提供明确的需求，而是通过分析用户的历史行为给用户的兴趣建模，从而主动给用户推荐能够满足他们兴趣和需求的信息。因此，从某种意义上说，推荐系统和搜索引擎对于用户来说是两个互补的工具。搜索引擎满足了用户有明确目的时的主动查找需求，而推荐系统能够在用户没有明确目的的时候帮助他们发现感兴趣的新内容。</p>
<p>从物品的角度出发，推荐系统可以更好地发掘物品的长尾（long tail）。美国《连线》杂志主编Chris Anderson在2004年发表了“The Long Tail”（长尾）一文并于2006年出版了《长尾理论》一书。该书指出，传统的80/20原则（80%的销售额来自于20%的热门品牌）在互联网的加入下会受到挑战。互联网条件下，由于货架成本极端低廉，电子商务网站往往能出售比传统零售店更多的商品。虽然这些商品绝大多数都不热门，但与传统零售业相比，这些不热门的商品数量极其庞大，因此这些长尾商品的总销售额将是一个不可小觑的数字，也许会超过热门商品（即主流商品）带来的销售额。主流商品往往代表了绝大多数用户的需求，而长尾商品往往代表了一小部分用户的个性化需求。因此，如果要通过发掘长尾提高销售额，就必须充分研究用户的兴趣，而这正是个性化推荐系统主要解决的问题。推荐系统通过发掘用户的行为，找到用户的个性化需求，从而将长尾商品准确地推荐给需要它的用户，帮助用户发现那些他们感兴趣但很难发现的商品。</p>
<p>要了解推荐系统是如何工作的，可以先回顾一下现实社会中用户面对很多选择时做决定的过程。仍然以看电影为例，一般来说，我们可能用如下方式决定最终看什么电影。</p>
<ul>
<li>向朋友咨询。我们也许会打开聊天工具，找几个经常看电影的好朋友，问问他们有没有什么电影可以推荐。甚至，我们可以打开微博，发表一句“我要看电影”，然后等待热心人推荐电影。这种方式在推荐系统中称为社会化推荐（social  recommendation），即让好友给自己推荐物品。</li>
<li>我们一般都有喜欢的演员和导演，有些人可能会打开搜索引擎，输入自己喜欢的演员名，然后看看返回结果中还有什么电影是自己没有看过的。比如我非常喜欢周星驰的电影，于是就去豆瓣搜索周星驰，发现他早年的一部电影我还没看过，于是就会看一看。这种方式是寻找和自己之前看过的电影在内容上相似的电影。推荐系统可以将上述过程自动化，通过分析用户曾经看过的电影找到用户喜欢的演员和导演，然后给用户推荐这些演员或者导演的其他电影。这种推荐方式在推荐系统中称为基于内容的推荐（content-based filtering）。</li>
<li>我们还可能查看排行榜，比如著名的IMDB电影排行榜，看看别人都在看什么电影，别人都喜欢什么电影，然后找一部广受好评的电影观看。这种方式可以进一步扩展：如果能找到和自己历史兴趣相似的一群用户，看看他们最近在看什么电影，那么结果可能比宽泛的热门排行榜更能符合自己的兴趣。这种方式称为基于协同过滤（collaborative filtering）的推荐。</li>
</ul>
<p>从上面3种方法可以看出，推荐算法的本质是通过一定的方式将用户和物品联系起来，而不同的推荐系统利用了不同的方式。联系用户和物品的常用方式包括利用好友、用户的历史兴趣记录以及用户的注册信息等。</p>
<p>通过这一节的讨论，我们可以发现推荐系统就是自动联系用户和物品的一种工具，它能够在信息过载的环境中帮助用户发现令他们感兴趣的信息，也能将信息推送给对它们感兴趣的用户。下一节将通过推荐系统的实际例子让大家加深对推荐系统的了解。</p>
<h2 id="个性化推荐系统的应用"><a class="header" href="#个性化推荐系统的应用">个性化推荐系统的应用</a></h2>
<p>和搜索引擎不同，个性化推荐系统需要依赖用户的行为数据，因此一般都是作为一个应用存在于不同网站之中。在互联网的各类网站中都可以看到推荐系统的应用，而个性化推荐系统在这些网站中的主要作用是通过分析大量用户行为日志，给不同用户提供不同的个性化页面展示，来提高网站的点击率和转化率。广泛利用推荐系统的领域包括电子商务、电影和视频、音乐、社交网络、阅读、基于位置的服务、个性化邮件和广告等。尽管不同的网站使用不同的推荐系统技术，但总地来说，几乎所有的推荐系统应用都是由前台的展示页面、后台的日志系统以及推荐算法系统3部分构成的。因此，本节在介绍不同的个性化推荐系统应用时，都尽量围绕这3个不同的部分进行。</p>
<h3 id="电子商务"><a class="header" href="#电子商务">电子商务</a></h3>
<h3 id="电影和视频网站"><a class="header" href="#电影和视频网站">电影和视频网站</a></h3>
<h3 id="个性化音乐网络电台"><a class="header" href="#个性化音乐网络电台">个性化音乐网络电台</a></h3>
<h3 id="社交网络"><a class="header" href="#社交网络">社交网络</a></h3>
<h3 id="个性化阅读"><a class="header" href="#个性化阅读">个性化阅读</a></h3>
<h3 id="基于位置的服务"><a class="header" href="#基于位置的服务">基于位置的服务</a></h3>
<h3 id="个性化邮件"><a class="header" href="#个性化邮件">个性化邮件</a></h3>
<h3 id="个性化广告"><a class="header" href="#个性化广告">个性化广告</a></h3>
<p>广告是互联网公司生存的根本。很多互联网公司的盈利模式都是基于广告的，而广告的CPC、CPM直接决定了很多互联网公司的收入。目前，很多广告都是随机投放的，即每次用户来了，随机选择一个广告投放给他。这种投放的效率显然很低，比如给男性投放化妆品广告或者给女性投放西装广告多半都是一种浪费。因此，很多公司都致力于广告定向投放（Ad Targeting）的研究，即如何将广告投放给它的潜在客户群。个性化广告投放目前已经成为了一门独立的学科——计算广告学——但该学科和推荐系统在很多基础理论和方法上是相通的，比如它们的目的都是联系用户和物品，只是在个性化广告中，物品就是广告。</p>
<p>个性化广告投放和狭义个性化推荐的区别是，个性化推荐着重于帮助用户找到可能令他们感兴趣的物品，而广告推荐着重于帮助广告找到可能对它们感兴趣的用户，即一个是以用户为核心，而另一个以广告为核心。目前的个性化广告投放技术主要分为3种。</p>
<ul>
<li>上下文广告 通过分析用户正在浏览的网页内容，投放和网页内容相关的广告。代表系统是谷歌的Adsense。</li>
<li>搜索广告 通过分析用户在当前会话中的搜索记录，判断用户的搜索目的，投放和用户目的相关的广告。</li>
<li>个性化展示广告 我们经常在很多网站看到大量展示广告（就是那些大的横幅图片），它们是根据用户的兴趣，对不同用户投放不同的展示广告。雅虎是这方面研究的代表。</li>
</ul>
<p>广告的个性化定向投放是很多互联网公司的核心技术，很多公司都秘而不宣。不过，雅虎公司是个例外，它发表了大量个性化广告方面的论文。在个性化广告方面最容易获得成功的无疑是Facebook，因为它拥有大量的用户个人资料，可以很容易地获取用户的兴趣，让广告商选择自己希望对其投放广告的用户。图1-21展示了Facebook的广告系统界面，该界面允许广告商选择自己希望的用户群，然后Facebook会根据广告商的选择告诉他们这些限制条件下广告将会覆盖的用户数量。</p>
<h2 id="推荐系统评测"><a class="header" href="#推荐系统评测">推荐系统评测</a></h2>
<p>什么才是好的推荐系统？这是推荐系统评测需要解决的首要问题。一个完整的推荐系统一般存在3个参与方（如图1-22所示）：用户、物品提供者和提供推荐系统的网站。以图书推荐为例，首先，推荐系统需要满足用户的需求，给用户推荐那些令他们感兴趣的图书。其次，推荐系统要让各出版社的书都能够被推荐给对其感兴趣的用户，而不是只推荐几个大型出版社的书。最后，好的推荐系统设计，能够让推荐系统本身收集到高质量的用户反馈，不断完善推荐的质量，增加用户和网站的交互，提高网站的收入。因此在评测一个推荐算法时，需要同时考虑三方的利益，一个好的推荐系统是能够令三方共赢的系统。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250202180538.png" alt="" /></p>
<p>在推荐系统的早期研究中，很多人将好的推荐系统定义为能够作出准确预测的推荐系统。比如，一个图书推荐系统预测一个用户将来会购买《C++ Primer中文版》这本书，而用户后来确实购买了，那么这就被看做一次准确的预测。预测准确度是推荐系统领域的重要指标（没有之一）。这个指标的好处是，它可以比较容易地通过离线方式计算出来，从而方便研究人员快速评价和选择不同的推荐算法。但是，很多研究表明，准确的预测并不代表好的推荐。比如说，该用户早就准备买《C++ Primer中文版》了，无论是否给他推荐，他都准备购买，那么这个推荐结果显然是不好的，因为它并未使用户购买更多的书，而仅仅是方便用户购买一本他本来就准备买的书。那么，对于用户来说，他会觉得这个推荐结果很不新颖，不能令他惊喜。同时，对于《C++ Primer中文版》的出版社来说，这个推荐也没能增加这本书的潜在购买人数。所以，这是一个看上去很好，但其实却很失败的推荐。举一个更极端的例子，某推测系统预测明天太阳将从东方升起，虽然预测准确率是100%，却是一种没有意义的预测。</p>
<p>所以，好的推荐系统不仅仅能够准确预测用户的行为，而且能够扩展用户的视野，帮助用户发现那些他们可能会感兴趣，但却不那么容易发现的东西。同时，推荐系统还要能够帮助商家将那些被埋没在长尾中的好商品介绍给可能会对它们感兴趣的用户。这也正是《长尾理论》的作者在书中不遗余力介绍推荐系统的原因。</p>
<p>为了全面评测推荐系统对三方利益的影响，本章将从不同角度出发，提出不同的指标。这些指标包括准确度、覆盖度、新颖度、惊喜度、信任度、透明度等。这些指标中，有些可以离线计算，有些只有在线才能计算，有些只能通过用户问卷获得。下面各节将会依次介绍这些指标的出发点、含义，以及一些指标的计算方法。</p>
<h3 id="推荐系统实验方法"><a class="header" href="#推荐系统实验方法">推荐系统实验方法</a></h3>
<p>在介绍推荐系统的指标之前，首先看一下计算和获得这些指标的主要实验方法。在推荐系统中，主要有3种评测推荐效果的实验方法，即离线实验（offline experiment）、用户调查（user study）和在线实验（online experiment）。下面将分别介绍这3种实验方法的优缺点。</p>
<ol>
<li>离线实验</li>
</ol>
<p>离线实验的方法一般由如下几个步骤构成：(1) 通过日志系统获得用户行为数据，并按照一定格式生成一个标准的数据集；(2) 将数据集按照一定的规则分成训练集和测试集；(3) 在训练集上训练用户兴趣模型，在测试集上进行预测；(4) 通过事先定义的离线指标评测算法在测试集上的预测结果。</p>
<p>从上面的步骤可以看到，推荐系统的离线实验都是在数据集上完成的，也就是说它不需要一个实际的系统来供它实验，而只要有一个从实际系统日志中提取的数据集即可。这种实验方法的好处是不需要真实用户参与，可以直接快速地计算出来，从而方便、快速地测试大量不同的算法。</p>
<p>它的主要缺点是无法获得很多商业上关注的指标，如点击率、转化率等，而找到和商业指标非常相关的离线指标也是很困难的事情。表1-2简单总结了离线实验的优缺点。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250202210056.png" alt="" /></p>
<ol start="2">
<li>用户调查</li>
</ol>
<p>注意，离线实验的指标和实际的商业指标存在差距，比如预测准确率和用户满意度之间就存在很大差别，高预测准确率不等于高用户满意度。因此，如果要准确评测一个算法，需要相对比较真实的环境。最好的方法就是将算法直接上线测试，但在对算法会不会降低用户满意度不太有把握的情况下，上线测试具有较高的风险，所以在上线测试前一般需要做一次称为用户调查的测试。</p>
<p>用户调查需要有一些真实用户，让他们在需要测试的推荐系统上完成一些任务。在他们完成任务时，我们需要观察和记录他们的行为，并让他们回答一些问题。最后，我们需要通过分析他们的行为和答案了解测试系统的性能。</p>
<p>用户调查是推荐系统评测的一个重要工具，很多离线时没有办法评测的与用户主观感受有关的指标都可以通过用户调查获得。比如，如果我们想知道推荐结果是否很令用户惊喜，那我们最好直接询问用户。但是，用户调查也有一些缺点。首先，用户调查成本很高，需要用户花大量时间完成一个个任务，并回答相关的问题。有些时候，还需要花钱雇用测试用户。因此，大多数情况下很难进行大规模的用户调查，而对于参加人数较少的用户调查，得出的很多结论往往没有统计意义。因此，我们在做用户调查时，一方面要控制成本，另一方面又要保证结果的统计意义。</p>
<p>此外，测试用户也不是随便选择的。需要尽量保证测试用户的分布和真实用户的分布相同，比如男女各半，以及年龄、活跃度的分布都和真实用户分布尽量相同。此外，用户调查要尽量保证是双盲实验，不要让实验人员和用户事先知道测试的目标，以免用户的回答和实验人员的测试受主观成分的影响。</p>
<p>用户调查的优缺点也很明显。它的优点是可以获得很多体现用户主观感受的指标，相对在线实验风险很低，出现错误后很容易弥补。缺点是招募测试用户代价较大，很难组织大规模的测试用户，因此会使测试结果的统计意义不足。此外，在很多时候设计双盲实验非常困难，而且用户在测试环境下的行为和真实环境下的行为可能有所不同，因而在测试环境下收集的测试指标可能在真实环境下无法重现。</p>
<ol start="3">
<li>在线实验</li>
</ol>
<p>在完成离线实验和必要的用户调查后，可以将推荐系统上线做AB测试，将它和旧的算法进行比较。</p>
<p>AB测试是一种很常用的在线评测算法的实验方法。它通过一定的规则将用户随机分成几组，并对不同组的用户采用不同的算法，然后通过统计不同组用户的各种不同的评测指标比较不同算法，比如可以统计不同组用户的点击率，通过点击率比较不同算法的性能。对AB测试感兴趣的读者可以浏览一下网站http://www.abtests.com/，该网站给出了很多通过实际AB测试提高网站用户满意度的例子，从中我们可以学习到如何进行合理的AB测试。</p>
<p>AB测试的优点是可以公平获得不同算法实际在线时的性能指标，包括商业上关注的指标。AB测试的缺点主要是周期比较长，必须进行长期的实验才能得到可靠的结果。因此一般不会用AB测试测试所有的算法，而只是用它测试那些在离线实验和用户调查中表现很好的算法。其次，一个大型网站的AB测试系统的设计也是一项复杂的工程。一个大型网站的架构分前端和后端，从前端展示给用户的界面到最后端的算法，中间往往经过了很多层，这些层往往由不同的团队控制，而且都有可能做AB测试。如果为不同的层分别设计AB测试系统，那么不同的AB测试之间往往会互相干扰。比如，当我们进行一个后台推荐算法的AB测试，同时网页团队在做推荐页面的界面AB测试，最终的结果就是你不知道测试结果是自己算法的改变，还是推荐界面的改变造成的。因此，切分流量是AB测试中的关键，不同的层以及控制这些层的团队需要从一个统一的地方获得自己AB测试的流量，而不同层之间的流量应该是正交的。</p>
<p>图1-23是一个简单的AB测试系统。用户进入网站后，流量分配系统决定用户是否需要被进行AB测试，如果需要的话，流量分配系统会给用户打上在测试中属于什么分组的标签。然后用户浏览网页，而用户在浏览网页时的行为都会被通过日志系统发回后台的日志数据库。此时，如果用户有测试分组的标签，那么该标签也会被发回后台数据库。在后台，实验人员的工作首先是配置流量分配系统，决定满足什么条件的用户参加什么样的测试。其次，实验人员需要统计日志数据库中的数据，通过评测系统生成不同分组用户的实验报告，并比较和评测实验结果。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250202210656.png" alt="" /></p>
<p>一般来说，一个新的推荐算法最终上线，需要完成上面所说的3个实验。</p>
<p>首先，需要通过离线实验证明它在很多离线指标上优于现有的算法。</p>
<p>然后，需要通过用户调查确定它的用户满意度不低于现有的算法。</p>
<p>最后，通过在线的AB测试确定它在我们关心的指标上优于现有的算法。</p>
<p>介绍完3种主要的实验方法后，下一节将开始介绍推荐系统常用的实验指标，这些指标大部分都可以通过本节介绍的3种实验方法获得。</p>
<h3 id="评测指标"><a class="header" href="#评测指标">评测指标</a></h3>
<p>本节将介绍各种推荐系统的评测指标。这些评测指标可用于评价推荐系统各方面的性能。这些指标有些可以定量计算，有些只能定性描述，有些可以通过离线实验计算，有些需要通过用户调查获得，还有些只能在线评测。对于重要的评测指标，后面几章将会详细讨论如何优化它们，本章只给出指标的定义。但对于一些次要的指标，本章在给出定义的同时也会顺便讨论一下应该如何优化。下面几节将详细讨论各个不同的指标。</p>
<ol>
<li>用户满意度</li>
</ol>
<p>用户作为推荐系统的重要参与者，其满意度是评测推荐系统的最重要指标。但是，用户满意度没有办法离线计算，只能通过用户调查或者在线实验获得。</p>
<p>用户调查获得用户满意度主要是通过调查问卷的形式。用户对推荐系统的满意度分为不同的层次。GroupLens曾经做过一个论文推荐系统的调查问卷，该问卷的调查问题是请问下面哪句话最能描述你看到推荐结果后的感受？</p>
<p>推荐的论文都是我非常想看的。</p>
<p>推荐的论文很多我都看过了，确实是符合我兴趣的不错论文。</p>
<p>推荐的论文和我的研究兴趣是相关的，但我并不喜欢。</p>
<p>不知道为什么会推荐这些论文，它们和我的兴趣丝毫没有关系。</p>
<p>由此可以看出，这个调查问卷不是简单地询问用户对结果是否满意，而是从不同的侧面询问用户对结果的不同感受。比如，如果仅仅问用户是否满意，用户可能心里认为大体满意，但是对某个方面还有点不满，因而可能很难回答这个问题。因此在设计问卷时需要考虑到用户各方面的感受，这样用户才能针对问题给出自己准确的回答。</p>
<p>在在线系统中，用户满意度主要通过一些对用户行为的统计得到。比如在电子商务网站中，用户如果购买了推荐的商品，就表示他们在一定程度上满意。因此，我们可以利用购买率度量用户的满意度。此外，有些网站会通过设计一些用户反馈界面收集用户满意度。比如在视频网站Hulu的推荐页面（如图1-24所示）和豆瓣网络电台（如图1-25所示）中，都有对推荐结果满意或者不满意的反馈按钮，通过统计两种按钮的单击情况就可以度量系统的用户满意度。更一般的情况下，我们可以用点击率、用户停留时间和转化率等指标度量用户的满意度。</p>
<ol start="2">
<li>预测准确度</li>
</ol>
<p>预测准确度度量一个推荐系统或者推荐算法预测用户行为的能力。这个指标是最重要的推荐系统离线评测指标，从推荐系统诞生的那一天起，几乎99%与推荐相关的论文都在讨论这个指标。这主要是因为该指标可以通过离线实验计算，方便了很多学术界的研究人员研究推荐算法。</p>
<p>在计算该指标时需要有一个离线的数据集，该数据集包含用户的历史行为记录。然后，将该数据集通过时间分成训练集和测试集。最后，通过在训练集上建立用户的行为和兴趣模型预测用户在测试集上的行为，并计算预测行为和测试集上实际行为的重合度作为预测准确度。</p>
<p>由于离线的推荐算法有不同的研究方向，因此下面将针对不同的研究方向介绍它们的预测准确度指标。</p>
<p>评分预测</p>
<p>很多提供推荐服务的网站都有一个让用户给物品打分的功能（如图1-26所示）。那么，如果知道了用户对物品的历史评分，就可以从中习得用户的兴趣模型，并预测该用户在将来看到一个他没有评过分的物品时，会给这个物品评多少分。预测用户对物品评分的行为称为评分预测。</p>
<p>评分预测的预测准确度一般通过均方根误差（RMSE）和平均绝对误差（MAE）计算。</p>
<p>关于RMSE和MAE这两个指标的优缺点， Netflix认为RMSE加大了对预测不准的用户物品评分的惩罚（平方项的惩罚），因而对系统的评测更加苛刻。研究表明，如果评分系统是基于整数建立的（即用户给的评分都是整数），那么对预测结果取整会降低MAE的误差。</p>
<p>TopN推荐</p>
<p>网站在提供推荐服务时，一般是给用户一个个性化的推荐列表，这种推荐叫做To p N推荐。To pN推荐的预测准确率一般通过准确率（precision）/召回率（recall）度量。</p>
<p>有的时候，为了全面评测Top N推荐的准确率和召回率，一般会选取不同的推荐列表长度N，计算出一组准确率/召回率，然后画出准确率/召回率曲线（precision/recall curve）。</p>
<p>关于评分预测和TopN推荐的讨论</p>
<p>评分预测一直是推荐系统研究的热点，绝大多数推荐系统的研究都是基于用户评分数据的评分预测。这主要是因为，一方面推荐系统的早期研究组GroupLens的研究主要就是基于电影评分数据MovieLens进行的，其次，Netflix大赛也主要面向评分预测问题。因而，很多研究人员都将研究精力集中在优化评分预测的RMSE上。</p>
<p>对此，亚马逊前科学家Greg Linden有不同的看法。2009年, 他在Communications of the ACM网站发表了一篇文章，指出电影推荐的目的是找到用户最有可能感兴趣的电影，而不是预测用户看了电影后会给电影什么样的评分。因此，To p N推荐更符合实际的应用需求。也许有一部电影用户看了之后会给很高的分数，但用户看的可能性非常小。因此，  预测用户是否会看一部电影，应该比预测用户看了电影后会给它什么评分更加重要。因此，本书主要也是讨论Top N推荐。</p>
<ol start="3">
<li>覆盖率</li>
</ol>
<p>覆盖率（coverage）描述一个推荐系统对物品长尾的发掘能力。覆盖率有不同的定义方法，最简单的定义为推荐系统能够推荐出来的物品占总物品集合的比例。</p>
<p>从上面的定义可以看到，覆盖率是一个内容提供商会关心的指标。以图书推荐为例，出版社可能会很关心他们的书有没有被推荐给用户。覆盖率为100%的推荐系统可以将每个物品都推荐给至少一个用户。此外，从上面的定义也可以看到，热门排行榜的推荐覆盖率是很低的，它只会推荐那些热门的物品，这些物品在总物品中占的比例很小。一个好的推荐系统不仅需要有比较高的用户满意度，也要有较高的覆盖率。</p>
<p>但是上面的定义过于粗略。覆盖率为100%的系统可以有无数的物品流行度分布。为了更细致地描述推荐系统发掘长尾的能力，需要统计推荐列表中不同物品出现次数的分布。如果所有的物品都出现在推荐列表中，且出现的次数差不多，那么推荐系统发掘长尾的能力就很好。因此，可以通过研究物品在推荐列表中出现次数的分布描述推荐系统挖掘长尾的能力。如果这个分布比较平，那么说明推荐系统的覆盖率较高，而如果这个分布较陡峭，说明推荐系统的覆盖率较低。在信息论和经济学中有两个著名的指标可以用来定义覆盖率。第一个是信息熵，第二个指标是基尼系数（Gini Index）。</p>
<p>社会学领域有一个著名的马太效应，即所谓强者更强，弱者更弱的效应。如果一个系统会增大热门物品和非热门物品的流行度差距，让热门的物品更加热门，不热门的物品更加不热门，那么这个系统就有马太效应。比如，首页的热门排行榜就有马太效应。进入排行榜的都是热门的物品，但它们因为被放在首页的排行榜展示有了更多的曝光机会，所以会更加热门。相反，没有进入排行榜的物品得不到展示，就会更不热门。搜索引擎的PageRank算法也具有一定的马太效应，如果一个网页的某个热门关键词排名很高，并因此被展示在搜索结果的第一条，那么它就会获得更多的关注，从而获得更多的外链，PageRank排名也越高。</p>
<p>那么，推荐系统是否有马太效应呢？推荐系统的初衷是希望消除马太效应，使得各种物品都能被展示给对它们感兴趣的某一类人群。但是，很多研究表明现在主流的推荐算法（比如协同过滤算法）是具有马太效应的。评测推荐系统是否具有马太效应的简单办法就是使用基尼系数。如果G1是从初始用户行为中计算出的物品流行度的基尼系数，G2是从推荐列表中计算出的物品流行度的基尼系数，那么如果G2 &gt; G1，就说明推荐算法具有马太效应。</p>
<ol start="4">
<li>多样性</li>
</ol>
<p>用户的兴趣是广泛的，在一个视频网站中，用户可能既喜欢看《猫和老鼠》一类的动画片，也喜欢看成龙的动作片。那么，为了满足用户广泛的兴趣，推荐列表需要能够覆盖用户不同的兴趣领域，即推荐结果需要具有多样性。多样性推荐列表的好处用一句俗话表述就是“不在一棵树上吊死”。尽管用户的兴趣在较长的时间跨度中是一样的，但具体到用户访问推荐系统的某一刻，其兴趣往往是单一的，那么如果推荐列表只能覆盖用户的一个兴趣点，而这个兴趣点不是用户这个时刻的兴趣点，推荐列表就不会让用户满意。反之，如果推荐列表比较多样，覆盖了用户绝大多数的兴趣点，那么就会增加用户找到感兴趣物品的概率。因此给用户的推荐列表也需要满足用户广泛的兴趣，即具有多样性。多样性描述了推荐列表中物品两两之间的不相似性。因此，多样性和相似性是对应的。</p>
<p>从上面的定义可以看到，不同的物品相似度度量函数s(i, j)可以定义不同的多样性。如果用内容相似度描述物品间的相似度，我们就可以得到内容多样性函数，如果用协同过滤的相似度函数描述物品间的相似度，就可以得到协同过滤的多样性函数。</p>
<p>关于推荐系统多样性最好达到什么程度，可以通过一个简单的例子说明。假设用户喜欢动作片和动画片，且用户80%的时间在看动作片，20%的时间在看动画片。那么，可以提供4种不同的推荐列表：A列表中有10部动作片，没有动画片；B列表中有10部动画片，没有动作片；C列表中有8部动作片和2部动画片；D列表有5部动作片和5部动画片。在这个例子中，一般认为C列表是最好的，因为它具有一定的多样性，但又考虑到了用户的主要兴趣。A满足了用户的主要兴趣，但缺少多样性，D列表过于多样，没有考虑到用户的主要兴趣。B列表即没有考虑用户的主要兴趣，也没有多样性，因此是最差的。</p>
<ol start="5">
<li>新颖性</li>
</ol>
<p>新颖的推荐是指给用户推荐那些他们以前没有听说过的物品。在一个网站中实现新颖性的最简单办法是，把那些用户之前在网站中对其有过行为的物品从推荐列表中过滤掉。比如在一个视频网站中，新颖的推荐不应该给用户推荐那些他们已经看过、打过分或者浏览过的视频。但是，有些视频可能是用户在别的网站看过，或者是在电视上看过，因此仅仅过滤掉本网站中用户有过行为的物品还不能完全实现新颖性。</p>
<p>O’scar Celma在博士论文“Music Recommendation and Discovery in the Long Tail”中研究了新颖度的评测。评测新颖度的最简单方法是利用推荐结果的平均流行度，因为越不热门的物品越可能让用户觉得新颖。因此，如果推荐结果中物品的平均热门程度较低，那么推荐结果就可能有比较高的新颖性。</p>
<p>但是，用推荐结果的平均流行度度量新颖性比较粗略，因为不同用户不知道的东西是不同的。因此，要准确地统计新颖性需要做用户调查。</p>
<p>最近几年关于多样性和新颖性的研究越来越受到推荐系统研究人员的关注。ACM的推荐系统会议在2011年有一个专门的研讨会讨论推荐的多样性和新颖性。该研讨会的组织者认为，通过牺牲精度来提高多样性和新颖性是很容易的，而困难的是如何在不牺牲精度的情况下提高多样性和新颖性。关心这两个指标的读者可以关注一下这个研讨会最终发表的论文。</p>
<ol start="6">
<li>惊喜度</li>
</ol>
<p>惊喜度（serendipity）是最近这几年推荐系统领域最热门的话题。但什么是惊喜度，惊喜度与新颖性有什么区别是首先需要弄清楚的问题。注意，这里讨论的是惊喜度和新颖度作为推荐指标在意义上的区别，而不是这两个词在中文里的含义区别（因为这两个词是英文词翻译过来的，所以它们在中文里的含义区别和英文词的含义区别并不相同），所以我们首先要摒弃大脑中关于这两个词在中文中的基本含义。</p>
<p>可以举一个例子说明这两种指标的区别。假设一名用户喜欢周星驰的电影，然后我们给他推荐了一部叫做《临歧》的电影（该电影是1983年由刘德华、周星驰、梁朝伟合作演出的，很少有人知道这部有周星驰出演的电影），而该用户不知道这部电影，那么可以说这个推荐具有新颖性。但是，这个推荐并没有惊喜度，因为该用户一旦了解了这个电影的演员，就不会觉得特别奇怪。但如果我们给用户推荐张艺谋导演的《红高粱》，假设这名用户没有看过这部电影，那么他看完这部电影后可能会觉得很奇怪，因为这部电影和他的兴趣一点关系也没有，但如果用户看完电影后觉得这部电影很不错，那么就可以说这个推荐是让用户惊喜的。这个例子的原始版本来自于Guy Shani的论文，他的基本意思就是，如果推荐结果和用户的历史兴趣不相似，但却让用户觉得满意，那么就可以说推荐结果的惊喜度很高，而推荐的新颖性仅仅取决于用户是否听说过这个推荐结果。</p>
<p>目前并没有什么公认的惊喜度指标定义方式，这里只给出一种定性的度量方式。上面提到，令用户惊喜的推荐结果是和用户历史上喜欢的物品不相似，但用户却觉得满意的推荐。那么，定义惊喜度需要首先定义推荐结果和用户历史上喜欢的物品的相似度，其次需要定义用户对推荐结果的满意度。前面也曾提到，用户满意度只能通过问卷调查或者在线实验获得，而推荐结果和用户历史上喜欢的物品相似度一般可以用内容相似度定义。也就是说，如果获得了一个用户观看电影的历史，得到这些电影的演员和导演集合A，然后给用户推荐一个不属于集合A的导演和演员创作的电影，而用户表示非常满意，这样就实现了一个惊喜度很高的推荐。因此提高推荐惊喜度需要提高推荐结果的用户满意度，同时降低推荐结果和用户历史兴趣的相似度。</p>
<p>惊喜度的问题最近几年获得了学术界的一定关注，但这方面的工作还不是很成熟。相关工作可以参考Yuan  Cao  Zhang等的论文和To mo k o   Mu r ak a mi等的论文，本书就不对该问题进一步展开讨论了。</p>
<ol start="7">
<li>信任度</li>
</ol>
<p>如果你有两个朋友，一个人你很信任，一个人经常满嘴跑火车，那么如果你信任的朋友推荐你去某个地方旅游，你很有可能听从他的推荐，但如果是那位满嘴跑火车的朋友推荐你去同样的地方旅游，你很有可能不去。这两个人可以看做两个推荐系统，尽管他们的推荐结果相同，但用户却可能产生不同的反应，这就是因为用户对他们有不同的信任度。对于基于机器学习的自动推荐系统，同样存在信任度（trust）的问题，如果用户信任推荐系统，那就会增加用户和推荐系统的交互。特别是在电子商务推荐系统中，让用户对推荐结果产生信任是非常重要的。同样的推荐结果，以让用户信任的方式推荐给用户就更能让用户产生购买欲，而以类似广告形式的方法推荐给用户就可能很难让用户产生购买的意愿。</p>
<p>度量推荐系统的信任度只能通过问卷调查的方式，询问用户是否信任推荐系统的推荐结果。因为本书后面的章节不太涉及如何提高推荐系统信任度的问题，因此这里简单介绍一下如何提高用户对推荐结果的信任度，以及关于信任度的一些研究现状。</p>
<p>提高推荐系统的信任度主要有两种方法。首先需要增加推荐系统的透明度（transparency），而增加推荐系统透明度的主要办法是提供推荐解释。只有让用户了解推荐系统的运行机制，让用户认同推荐系统的运行机制，才会提高用户对推荐系统的信任度。其次是考虑用户的社交网络信息，利用用户的好友信息给用户做推荐，并且用好友进行推荐解释。这是因为用户对他们的好友一般都比较信任，因此如果推荐的商品是好友购买过的，那么他们对推荐结果就会相对比较信任。</p>
<ol start="8">
<li>实时性</li>
</ol>
<p>在很多网站中，因为物品（新闻、微博等）具有很强的时效性，所以需要在物品还具有时效性时就将它们推荐给用户。比如，给用户推荐昨天的新闻显然不如给用户推荐今天的新闻。因此，在这些网站中，推荐系统的实时性就显得至关重要。</p>
<p>推荐系统的实时性包括两个方面。首先，推荐系统需要实时地更新推荐列表来满足用户新的行为变化。比如，当一个用户购买了iPhone，如果推荐系统能够立即给他推荐相关配件，那么肯定比第二天再给用户推荐相关配件更有价值。很多推荐系统都会在离线状态每天计算一次用户推荐列表，然后于在线期间将推荐列表展示给用户。这种设计显然是无法满足实时性的。与用户行为相应的实时性，可以通过推荐列表的变化速率来评测。如果推荐列表在用户有行为后变化不大，或者没有变化，说明推荐系统的实时性不高。</p>
<p>实时性的第二个方面是推荐系统需要能够将新加入系统的物品推荐给用户。这主要考验了推荐系统处理物品冷启动的能力。关于如何将新加入系统的物品推荐给用户，本书将在后面的章节进行讨论，而对于新物品推荐能力，我们可以利用用户推荐列表中有多大比例的物品是当天新加的来评测。</p>
<ol start="9">
<li>健壮性</li>
</ol>
<p>任何一个能带来利益的算法系统都会被人攻击，这方面最典型的例子就是搜索引擎。搜索引擎的作弊和反作弊斗争异常激烈，这是因为如果能让自己的商品成为热门搜索词的第一个搜索结果，会带来极大的商业利益。推荐系统目前也遇到了同样的作弊问题，而健壮性（即robust,鲁棒性）指标衡量了一个推荐系统抗击作弊的能力。</p>
<p>2011年的推荐系统大会专门有一个关于推荐系统健壮性的教程。作者总结了很多作弊方法，其中最著名的就是行为注入攻击（profile injection attack）。众所周知，绝大部分推荐系统都是通过分析用户的行为实现推荐算法的。比如，亚马逊有一种推荐叫做“购买商品A的用户也经常购买的其他商品”。它的主要计算方法是统计购买商品A的用户购买其他商品的次数。那么，我们可以很简单地攻击这个算法，让自己的商品在这个推荐列表中获得比较高的排名，比如可以注册很多账号，用这些账号同时购买A和自己的商品。还有一种攻击主要针对评分系统，比如豆瓣的电影评分。这种攻击很简单，就是雇用一批人给自己的商品非常高的评分，而评分行为是推荐系统依赖的重要用户行为。</p>
<p>算法健壮性的评测主要利用模拟攻击。首先，给定一个数据集和一个算法，可以用这个算法给这个数据集中的用户生成推荐列表。然后，用常用的攻击方法向数据集中注入噪声数据，然后利用算法在注入噪声后的数据集上再次给用户生成推荐列表。最后，通过比较攻击前后推荐列表的相似度评测算法的健壮性。如果攻击后的推荐列表相对于攻击前没有发生大的变化，就说明算法比较健壮。</p>
<p>在实际系统中，提高系统的健壮性，除了选择健壮性高的算法，还有以下方法。</p>
<p>设计推荐系统时尽量使用代价比较高的用户行为。比如，如果有用户购买行为和用户浏览行为，那么主要应该使用用户购买行为，因为购买需要付费，所以攻击购买行为的代价远远大于攻击浏览行为。</p>
<p>在使用数据前，进行攻击检测，从而对数据进行清理。</p>
<ol start="10">
<li>商业目标</li>
</ol>
<p>很多时候，网站评测推荐系统更加注重网站的商业目标是否达成，而商业目标和网站的盈利模式是息息相关的。一般来说，最本质的商业目标就是平均一个用户给公司带来的盈利。不过这种指标不是很难计算，只是计算一次需要比较大的代价。因此，很多公司会根据自己的盈利模式设计不同的商业目标。</p>
<p>不同的网站具有不同的商业目标。比如电子商务网站的目标可能是销售额，基于展示广告盈利的网站其商业目标可能是广告展示总数，基于点击广告盈利的网站其商业目标可能是广告点击总数。因此，设计推荐系统时需要考虑最终的商业目标，而网站使用推荐系统的目的除了满足用户发现内容的需求，也需要利用推荐系统加快实现商业上的指标。</p>
<ol start="11">
<li>总结</li>
</ol>
<p>本节提到了很多指标，其中有些指标可以离线计算，有些只能在线获得。但是，离线指标很多，在线指标也很多，那么如何优化离线指标来提高在线指标是推荐系统研究的重要问题。关于这个问题，目前仍然没有什么定论，只是不同系统的研究人员有不同的感性认识。</p>
<p>表1-3对前面提到的指标进行了总结。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250202215101.png" alt="" /></p>
<h3 id="评测维度"><a class="header" href="#评测维度">评测维度</a></h3>
<p>上一节介绍了很多评测指标，但是在评测系统中还需要考虑评测维度，比如一个推荐算法，虽然整体性能不好，但可能在某种情况下性能比较好，而增加评测维度的目的就是知道一个算法在什么情况下性能最好。这样可以为融合不同推荐算法取得最好的整体性能带来参考。</p>
<p>一般来说，评测维度分为如下3种。</p>
<p>用户维度  主要包括用户的人口统计学信息、活跃度以及是不是新用户等。</p>
<p>物品维度  包括物品的属性信息、流行度、平均分以及是不是新加入的物品等。</p>
<p>时间维度  包括季节，是工作日还是周末，是白天还是晚上等。</p>
<p>如果能够在推荐系统评测报告中包含不同维度下的系统评测指标，就能帮我们全面地了解推荐系统性能，找到一个看上去比较弱的算法的优势，发现一个看上去比较强的算法的缺点。</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="利用用戶行为数据"><a class="header" href="#利用用戶行为数据">利用用戶行为数据</a></h1>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE%E7%AE%80%E4%BB%8B">用户行为数据简介</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90">用户行为分析</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E7%94%A8%E6%88%B7%E6%B4%BB%E8%B7%83%E5%BA%A6%E5%92%8C%E7%89%A9%E5%93%81%E6%B5%81%E8%A1%8C%E5%BA%A6%E7%9A%84%E5%88%86%E5%B8%83">用户活跃度和物品流行度的分布</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E7%94%A8%E6%88%B7%E6%B4%BB%E8%B7%83%E5%BA%A6%E5%92%8C%E7%89%A9%E5%93%81%E6%B5%81%E8%A1%8C%E5%BA%A6%E7%9A%84%E5%85%B3%E7%B3%BB">用户活跃度和物品流行度的关系</a></li>
</ul>
</li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E5%AE%9E%E9%AA%8C%E8%AE%BE%E8%AE%A1%E5%92%8C%E7%AE%97%E6%B3%95%E8%AF%84%E6%B5%8B">实验设计和算法评测</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E9%82%BB%E5%9F%9F%E7%9A%84%E7%AE%97%E6%B3%95">基于邻域的算法</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E7%94%A8%E6%88%B7%E7%9A%84%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95">基于用户的协同过滤算法</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E7%89%A9%E5%93%81%E7%9A%84%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E7%AE%97%E6%B3%95">基于物品的协同过滤算法</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#usercf%E5%92%8Citemcf%E7%9A%84%E7%BB%BC%E5%90%88%E6%AF%94%E8%BE%83">UserCF和ItemCF的综合比较</a></li>
</ul>
</li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E9%9A%90%E8%AF%AD%E4%B9%89%E6%A8%A1%E5%9E%8B">隐语义模型</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95">基础算法</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8Elfm%E7%9A%84%E5%AE%9E%E9%99%85%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BE%8B%E5%AD%90">基于LFM的实际系统的例子</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#lfm%E5%92%8C%E5%9F%BA%E4%BA%8E%E9%82%BB%E5%9F%9F%E7%9A%84%E6%96%B9%E6%B3%95%E7%9A%84%E6%AF%94%E8%BE%83">LFM和基于邻域的方法的比较</a></li>
</ul>
</li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E5%9B%BE%E7%9A%84%E6%A8%A1%E5%9E%8B">基于图的模型</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BA%8C%E5%88%86%E5%9B%BE%E8%A1%A8%E7%A4%BA">用户行为数据的二分图表示</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B6%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E5%9B%BE%E7%9A%84%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95">基于图的推荐算法</a></li>
</ul>
</li>
</ul>
<p>基于用户行为分析的推荐算法是个性化推荐系统的重要算法，学术界一般将这种类型的算法称为协同过滤算法。顾名思义，协同过滤就是指用户可以齐心协力，通过不断地和网站互动，使自己的推荐列表能够不断过滤掉自己不感兴趣的物品，从而越来越满足自己的需求。</p>
<h2 id="用户行为数据简介"><a class="header" href="#用户行为数据简介">用户行为数据简介</a></h2>
<p>本章提到的个性化推荐算法都是基于用户行为数据分析设计的，因此本节将首先介绍用户行为数据。</p>
<p>用户行为数据在网站上最简单的存在形式就是日志。网站在运行过程中都产生大量原始日志（raw log），并将其存储在文件系统中。很多互联网业务会把多种原始日志按照用户行为汇总成会话日志（session log），其中每个会话表示一次用户行为和对应的服务。比如，在搜索引擎和搜索广告系统中，服务会为每次查询生成一个展示日志（impression  log），其中记录了查询和返回结果。如果用户点击了某个结果，这个点击信息会被服务器截获并存储在点击日志（click log）中。一个并行程序会周期性地归并展示日志和点击日志，得到的会话日志中每个消息是一个用户提交的查询、得到的结果以及点击。类似地，推荐系统和电子商务网站也会汇总原始日志生成描述用户行为的会话日志。会话日志通常存储在分布式数据仓库中，如支持离线分析的 Hadoop Hive和支持在线分析的Google  Dremel。这些日志记录了用户的各种行为，如在电子商务网站中这些行为主要包括网页浏览、购买、点击、评分和评论等。</p>
<p>用户行为在个性化推荐系统中一般分两种——显性反馈行为（explicit feedback）和隐性反馈行为（implicit feedback）。显性反馈行为包括用户明确表示对物品喜好的行为。图2-2显示了不同网站收集显性反馈的方式。可以看到，这里的主要方式就是评分和喜欢/不喜欢。很多网站都使用了5分的评分系统来让用户直接表达对物品的喜好，但也有些网站使用简单的“喜欢”或者“不喜欢”按钮收集用户的兴趣。这些不同的显性反馈方式各有利弊。YouTube最早是用5分评分系统收集显性反馈的，但后来他们的研究人员统计了不同评分的评分数，结果发现，用户最常用的评分是5分，其次是1分，其他的分数很少有用户打。因此，后来YouTube就把评分系统改成了两档评分系统（喜欢/不喜欢）。当然，我们举这个例子并不是试图说明一种评分系统比另一种好，而是要说明不同的网站需要根据自己的特点设计评分系统，而不是一味照搬其他网站的设计。YouTube的用户主要将精力放在看视频上，因此他们只有在特别不满或者特别满意时才会评分，因此二级评分系统就足够了。但如果是评论网站，用户主要将精力放在评论上，这时多级评分系统就是必要的。</p>
<p>和显性反馈行为相对应的是隐性反馈行为。隐性反馈行为指的是那些不能明确反应用户喜好的行为。最具代表性的隐性反馈行为就是页面浏览行为。用户浏览一个物品的页面并不代表用户一定喜欢这个页面展示的物品，比如可能因为这个页面链接显示在首页，用户更容易点击它而已。相比显性反馈，隐性反馈虽然不明确，但数据量更大。在很多网站中，很多用户甚至只有隐性反馈数据，而没有显性反馈数据。表2-1从几个不同方面比较了显性反馈数据和隐性反馈数据。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250203095510.png" alt="" /></p>
<p>按照反馈的明确性分，用户行为数据可以分为显性反馈和隐性反馈，但按照反馈的方向分，又可以分为正反馈和负反馈。正反馈指用户的行为倾向于指用户喜欢该物品，而负反馈指用户的行为倾向于指用户不喜欢该物品。在显性反馈中，很容易区分一个用户行为是正反馈还是负反馈，而在隐性反馈行为中，就相对比较难以确定。</p>
<p>为了更好地说明什么数据是显性反馈数据，什么是隐性反馈数据，表2-2列举了各个领域的网站中这两种行为的例子。</p>
<p>表2-2  各代表网站中显性反馈数据和隐性反馈数据的例子</p>
<div class="table-wrapper"><table><thead><tr><th>网站类型</th><th>显性反馈</th><th>隐性反馈</th></tr></thead><tbody>
<tr><td>视频网站</td><td>用户对视频的评分</td><td>用户观看视频的日志、浏览视频页面的日志</td></tr>
<tr><td>电子商务网站</td><td>用户对商品的评分</td><td>购买日志、浏览日志</td></tr>
<tr><td>门户网站</td><td>用户对新闻的评分</td><td>阅读新闻的日志</td></tr>
<tr><td>音乐网站</td><td>用户对音乐/歌手/专辑的评分</td><td>听歌的日志</td></tr>
</tbody></table>
</div>
<p>互联网中的用户行为有很多种，比如浏览网页、购买商品、评论、评分等。要用一个统一的方式表示所有这些行为是比较困难的。表2-3给出了一种表示方式，它将一个用户行为表示为6部分，即产生行为的用户和行为的对象、行为的种类、产生行为的上下文、行为的内容和权重。</p>
<p>表2-3  用户行为的统一表示</p>
<div class="table-wrapper"><table><thead><tr><th>表示</th><th>含义</th></tr></thead><tbody>
<tr><td>user id</td><td>产生行为的用户的唯一标识</td></tr>
<tr><td>item id</td><td>产生行为的对象的唯一标识</td></tr>
<tr><td>behavior type</td><td>行为的种类（比如是购买还是浏览）</td></tr>
<tr><td>context</td><td>产生行为的上下文，包括时间和地点等</td></tr>
<tr><td>behavior weight</td><td>行为的权重（如果是观看视频的行为，那么这个权重可以是观看时长；如果是打分行为，这个权重可以是分数）</td></tr>
<tr><td>behavior content</td><td>行为的内容（如果是评论行为，那么就是评论的文本；如果是打标签的行为，就是标签）</td></tr>
</tbody></table>
</div>
<p>当然，在很多时候我们并不使用统一结构表示所有行为，而是针对不同的行为给出不同表示。而且，有些时候可能会忽略一些信息（比如上下文）。当然，有些信息是不能忽略的，比如产生行为的用户和行为的对象就是所有行为都必须包含的。一般来说，不同的数据集包含不同的行为，目前比较有代表性的数据集有下面几个。</p>
<p>无上下文信息的隐性反馈数据集  每一条行为记录仅仅包含用户ID和物品ID。Book-Crossing就是这种类型的数据集。</p>
<p>无上下文信息的显性反馈数据集  每一条记录包含用户ID、物品ID和用户对物品的评分。</p>
<p>有上下文信息的隐性反馈数据集  每一条记录包含用户ID、物品ID和用户对物品产生行为的时间戳。Lastfm数据集就是这种类型的数据集。</p>
<p>有上下文信息的显性反馈数据集  每一条记录包含用户ID、物品ID、用户对物品的评分和评分行为发生的时间戳。Netflix Prize提供的就是这种类型的数据集。</p>
<p>本章使用的数据集基本都是第一种数据集，即无上下文信息的隐性反馈数据集。</p>
<h2 id="用户行为分析"><a class="header" href="#用户行为分析">用户行为分析</a></h2>
<p>在利用用户行为数据设计推荐算法之前，研究人员首先需要对用户行为数据进行分析，了解数据中蕴含的一般规律，这样才能对算法的设计起到指导作用。本节将介绍用户行为数据中蕴含的一般规律，这些规律并不是只存在于一两个网站中的特例，而是存在于很多网站中的普遍规律。</p>
<h3 id="用户活跃度和物品流行度的分布"><a class="header" href="#用户活跃度和物品流行度的分布">用户活跃度和物品流行度的分布</a></h3>
<p>很多关于互联网数据的研究发现，互联网上的很多数据分布都满足一种称为Power Law的分布，这个分布在互联网领域也称长尾分布。</p>
<p>长尾分布其实很早就被统计学家注意到了。1932年，哈佛大学的语言学家Zipf在研究英文单词的词频时发现，如果将单词出现的频率按照由高到低排列，则每个单词出现的频率和它在热门排行榜中排名的常数次幂成反比。这个分布称为Zipf定律。这个现象表明，在英文中大部分词的词频其实很低，只有很少的词被经常使用。</p>
<p>很多研究人员发现，用户行为数据也蕴含着这种规律。</p>
<p>这两幅图都是双对数曲线，而长尾分布在双对数曲线上应该呈直线。这两幅图中的曲线都呈近似直线的形状，从而证明不管是物品的流行度还是用户的活跃度，都近似于长尾分布，特别是物品流行度的双对数曲线，非常接近直线。</p>
<h3 id="用户活跃度和物品流行度的关系"><a class="header" href="#用户活跃度和物品流行度的关系">用户活跃度和物品流行度的关系</a></h3>
<p>一般来说，不活跃的用户要么是新用户，要么是只来过网站一两次的老用户。那么，不同活跃度的用户喜欢的物品的流行度是否有差别？一般认为，新用户倾向于浏览热门的物品，因为他们对网站还不熟悉，只能点击首页的热门物品，而老用户会逐渐开始浏览冷门的物品。</p>
<p>仅仅基于用户行为数据设计的推荐算法一般称为协同过滤算法。学术界对协同过滤算法进行了深入研究，提出了很多方法，比如基于邻域的方法（neighborhood-based）、隐语义模型（latent factor model）、基于图的随机游走算法（random walk on graph）等。在这些方法中，最著名的、在业界得到最广泛应用的算法是基于邻域的方法，而基于邻域的方法主要包含下面两种算法。</p>
<p>基于用户的协同过滤算法  这种算法给用户推荐和他兴趣相似的其他用户喜欢的物品。</p>
<p>基于物品的协同过滤算法  这种算法给用户推荐和他之前喜欢的物品相似的物品。</p>
<p>下面几节将首先介绍上面两种算法，然后再简单介绍隐语义模型和基于图的模型。</p>
<h2 id="实验设计和算法评测"><a class="header" href="#实验设计和算法评测">实验设计和算法评测</a></h2>
<p>前文说过，评测推荐系统有3种方法——离线实验、用户调查和在线实验。本节将通过离线实验方法评测提到的算法。首先介绍用到的数据集，然后介绍采用的实验方法和评测指标。</p>
<h2 id="基于邻域的算法"><a class="header" href="#基于邻域的算法">基于邻域的算法</a></h2>
<p>基于邻域的算法是推荐系统中最基本的算法，该算法不仅在学术界得到了深入研究，而且在业界得到了广泛应用。基于邻域的算法分为两大类，一类是基于用户的协同过滤算法，另一类是基于物品的协同过滤算法。下面几节将对这两种算法进行深入介绍，对比它们的优缺点并提出改进方案。</p>
<h3 id="基于用户的协同过滤算法"><a class="header" href="#基于用户的协同过滤算法">基于用户的协同过滤算法</a></h3>
<p>基于用户的协同过滤算法是推荐系统中最古老的算法。可以不夸张地说，这个算法的诞生标志了推荐系统的诞生。该算法在1992年被提出，并应用于邮件过滤系统，1994年被GroupLens用于新闻过滤。在此之后直到2000年，该算法都是推荐系统领域最著名的算法。本节将对该算法进行详细介绍，首先介绍最基础的算法，然后在此基础上提出不同的改进方法，并通过真实的数据集进行评测。</p>
<ol>
<li>基础算法</li>
</ol>
<p>每年新学期开始，刚进实验室的师弟总会问师兄相似的问题，比如“我应该买什么专业书啊”、“我应该看什么论文啊”等。这个时候，师兄一般会给他们做出一些推荐。这就是现实中个性化推荐的一种例子。在这个例子中，师弟可能会请教很多师兄，然后做出最终的判断。师弟之所以请教师兄，一方面是因为他们有社会关系，互相认识且信任对方，但更主要的原因是师兄和师弟有共同的研究领域和兴趣。那么，在一个在线个性化推荐系统中，当一个用户A需要个性化推荐时，可以先找到和他有相似兴趣的其他用户，然后把那些用户喜欢的、而用户A没有听说过的物品推荐给A。这种方法称为基于用户的协同过滤算法。从上面的描述中可以看到，基于用户的协同过滤算法主要包括两个步骤。</p>
<p>(1) 找到和目标用户兴趣相似的用户集合。</p>
<p>(2) 找到这个集合中的用户喜欢的，且目标用户没有听说过的物品推荐给目标用户。</p>
<h3 id="基于物品的协同过滤算法"><a class="header" href="#基于物品的协同过滤算法">基于物品的协同过滤算法</a></h3>
<p>基于物品的协同过滤（item-based  collaborative  filtering）算法是目前业界应用最多的算法。无论是亚马逊网，还是Netflix、Hulu、YouTube，其推荐算法的基础都是该算法。本节将从基础的算法开始介绍，然后提出算法的改进方法，并通过实际数据集评测该算法。</p>
<ol>
<li>基础算法</li>
</ol>
<p>基于用户的协同过滤算法在一些网站（如Digg）中得到了应用，但该算法有一些缺点。首先，随着网站的用户数目越来越大，计算用户兴趣相似度矩阵将越来越困难，其运算时间复杂度和空间复杂度的增长和用户数的增长近似于平方关系。其次，基于用户的协同过滤很难对推荐结果作出解释。因此，著名的电子商务公司亚马逊提出了另一个算法——基于物品的协同过滤算法。</p>
<p>基于物品的协同过滤算法（简称ItemCF）给用户推荐那些和他们之前喜欢的物品相似的物品。比如，该算法会因为你购买过《数据挖掘导论》而给你推荐《机器学习》。不过，ItemCF算法并不利用物品的内容属性计算物品之间的相似度，它主要通过分析用户的行为记录计算物品之间的相似度。该算法认为，物品A和物品B具有很大的相似度是因为喜欢物品A的用户大都也喜欢物品B。</p>
<p>基于物品的协同过滤算法主要分为两步。</p>
<p>(1) 计算物品之间的相似度。</p>
<p>(2) 根据物品的相似度和用户的历史行为给用户生成推荐列表。</p>
<h3 id="usercf和itemcf的综合比较"><a class="header" href="#usercf和itemcf的综合比较">UserCF和ItemCF的综合比较</a></h3>
<p>UserCF是推荐系统领域较为古老的算法，1992年就已经在电子邮件的个性化推荐系统Tap estry中得到了应用，1994年被GroupLens用来实现新闻的个性化推荐，后来被著名的文章分享网站Digg用来给用户推荐个性化的网络文章。ItemCF则是相对比较新的算法，在著名的电子商务网站亚马逊和DVD租赁网站Netflix中得到了广泛应用。</p>
<p>那么，为什么Digg使用UserCF，而亚马逊网使用ItemCF呢？</p>
<p>首先回顾一下UserCF算法和ItemCF算法的推荐原理。UserCF给用户推荐那些和他有共同兴趣爱好的用户喜欢的物品，而ItemCF给用户推荐那些和他之前喜欢的物品类似的物品。从这个算法的原理可以看到，UserCF的推荐结果着重于反映和用户兴趣相似的小群体的热点，而ItemCF的推荐结果着重于维系用户的历史兴趣。换句话说，UserCF的推荐更社会化，反映了用户所在的小型兴趣群体中物品的热门程度，而ItemCF的推荐更加个性化，反映了用户自己的兴趣传承。</p>
<p>在新闻网站中，用户的兴趣不是特别细化，绝大多数用户都喜欢看热门的新闻。即使是个性化，也是比较粗粒度的，比如有些用户喜欢体育新闻，有些喜欢社会新闻，而特别细粒度的个性化一般是不存在的。比方说，很少有用户只看某个话题的新闻，主要是因为这个话题不可能保证每天都有新的消息，而这个用户却是每天都要看新闻的。因此，个性化新闻推荐更加强调抓住新闻热点，热门程度和时效性是个性化新闻推荐的重点，而个性化相对于这两点略显次要。因此，UserCF可以给用户推荐和他有相似爱好的一群其他用户今天都在看的新闻，这样在抓住热点和时效性的同时，保证了一定程度的个性化。这是Digg在新闻推荐中使用UserCF的最重要原因。</p>
<p>UserCF适合用于新闻推荐的另一个原因是从技术角度考量的。因为作为一种物品，新闻的更新非常快，每时每刻都有新内容出现，而ItemCF需要维护一张物品相关度的表，如果物品更新很快，那么这张表也需要很快更新，这在技术上很难实现。绝大多数物品相关度表都只能做到一天一次更新，这在新闻领域是不可以接受的。而UserCF只需要用户相似性表，虽然UserCF对于新用户也需要更新相似度表，但在新闻网站中，物品的更新速度远远快于新用户的加入速度，而且对于新用户，完全可以给他推荐最热门的新闻，因此UserCF显然是利大于弊。</p>
<p>但是，在图书、电子商务和电影网站，比如亚马逊、豆瓣、Netflix中，ItemCF则能极大地发挥优势。首先，在这些网站中，用户的兴趣是比较固定和持久的。一个技术人员可能都是在购买技术方面的书，而且他们对书的热门程度并不是那么敏感，事实上越是资深的技术人员，他们看的书就越可能不热门。此外，这些系统中的用户大都不太需要流行度来辅助他们判断一个物品的好坏，而是可以通过自己熟悉领域的知识自己判断物品的质量。因此，这些网站中个性化推荐的任务是帮助用户发现和他研究领域相关的物品。因此，ItemCF算法成为了这些网站的首选算法。此外，这些网站的物品更新速度不会特别快，一天一次更新物品相似度矩阵对它们来说不会造成太大的损失，是可以接受的。</p>
<p>同时，从技术上考虑，UserCF需要维护一个用户相似度的矩阵，而ItemCF需要维护一个物品相似度矩阵。从存储的角度说，如果用户很多，那么维护用户兴趣相似度矩阵需要很大的空间，同理，如果物品很多，那么维护物品相似度矩阵代价较大。</p>
<p>在早期的研究中，大部分研究人员都是让少量的用户对大量的物品进行评价，然后研究用户兴趣的模式。那么，对于他们来说，因为用户很少，计算用户兴趣相似度是最快也是最简单的方法。但在实际的互联网中，用户数目往往非常庞大，而在图书、电子商务网站中，物品的数目则是比较少的。此外，物品的相似度相对于用户的兴趣一般比较稳定，因此使用ItemCF是比较好的选择。当然，新闻网站是个例外，在那儿，物品的相似度变化很快，物品数目庞大，相反用户兴趣则相对固定（都是喜欢看热门的），所以新闻网站的个性化推荐使用UserCF算法的更多。</p>
<p>表2-11从不同的角度对比了UserCF和ItemCF算法。同时，我们也将前面几节的离线实验结果展示在图2-13、图2-14和图2-15中。从图中可见，ItemCF算法在各项指标上似乎都不如UserCF，特别是其推荐结果的覆盖率和新颖度都低于UserCF，这一点似乎和我们之前讨论的不太符合。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250203113104.png" alt="" /></p>
<p>首先要指出的是，离线实验的性能在选择推荐算法时并不起决定作用。首先应该满足产品的需求，比如如果需要提供推荐解释，那么可能得选择ItemCF算法。其次，需要看实现代价，比如若用户太多，很难计算用户相似度矩阵，这个时候可能不得不抛弃UserCF算法。最后，离线指标和点击率等在线指标不一定成正比。而且，这里对比的是最原始的UserCF和ItemCF算法，这两种算法都可以进行各种各样的改进。一般来说，这两种算法经过优化后，最终得到的离线性能是近似的。</p>
<p>下一节将分析为什么原始ItemCF算法的覆盖率和新颖度都不高。</p>
<p>上面的问题换句话说就是，两个不同领域的最热门物品之间往往具有比较高的相似度。这个时候，仅仅靠用户行为数据是不能解决这个问题的，因为用户的行为表示这种物品之间应该相似度很高。此时，我们只能依靠引入物品的内容数据解决这个问题，比如对不同领域的物品降低权重等。这些就不是协同过滤讨论的范畴了。</p>
<h2 id="隐语义模型"><a class="header" href="#隐语义模型">隐语义模型</a></h2>
<p>自从Netflix Prize比赛举办以来，LFM（latent factor model）隐语义模型逐渐成为推荐系统领域耳熟能详的名词。其实该算法最早在文本挖掘领域被提出，用于找到文本的隐含语义。相关的名词有LSI、pLSA、LDA和Topic Model。本节将对隐含语义模型在Top -N推荐中的应用进行详细介绍，并通过实际的数据评测该模型。</p>
<h3 id="基础算法"><a class="header" href="#基础算法">基础算法</a></h3>
<p>隐语义模型是最近几年推荐系统领域最为热门的研究话题，它的核心思想是通过隐含特征(latent factor)联系用户兴趣和物品。</p>
<p>首先通过一个例子来理解一下这个模型。图2-16展示了两个用户在豆瓣的读书列表。</p>
<p>从他们的阅读列表可以看出，用户A的兴趣涉及侦探小说、科普图书以及一些计算机技术书，而用户B的兴趣比较集中在数学和机器学习方面。</p>
<p>那么如何给A和B推荐图书呢？</p>
<p>对于UserCF，首先需要找到和他们看了同样书的其他用户（兴趣相似的用户），然后给他们推荐那些用户喜欢的其他书。</p>
<p>对于ItemCF，需要给他们推荐和他们已经看的书相似的书，比如作者B看了很多关于数据挖掘的书，可以给他推荐机器学习或者模式识别方面的书。</p>
<p>还有一种方法，可以对书和物品的兴趣进行分类。对于某个用户，首先得到他的兴趣分类，然后从分类中挑选他可能喜欢的物品。</p>
<p>总结一下，这个基于兴趣分类的方法大概需要解决3个问题。</p>
<p>如何给物品进行分类？</p>
<p>如何确定用户对哪些类的物品感兴趣，以及感兴趣的程度？</p>
<p>对于一个给定的类，选择哪些属于这个类的物品推荐给用户，以及如何确定这些物品在一个类中的权重？</p>
<p>对于第一个问题的简单解决方案是找编辑给物品分类。以图书为例，每本书出版时，编辑都会给书一个分类。为了给图书分类，出版界普遍遵循中国图书分类法。但是，即使有很系统的分类体系，编辑给出的分类仍然具有以下缺点。</p>
<p>编辑的意见不能代表各种用户的意见。比如，对于《具体数学》应该属于什么分类，有人认为应该属于数学，有些人认为应该属于计算机。从内容看，这本书是关于数学的，但从用户看，这本书的读大部分是做计算机出身的。编辑的分类大部分是从书的内容出发，而不是从书的读者群出发。</p>
<p>编辑很难控制分类的粒度。我们知道分类是有不同粒度的，《数据挖掘导论》在粗粒度的分类中可能属于计算机技术，但在细粒度的分类中可能属于数据挖掘。对于不同的用户，我们可能需要不同的粒度。比如对于一位初学者，我们粗粒度地给他做推荐就可以了，而对于一名资深研究人员，我们就需要深入到他的很细分的领域给他做个性化推荐。</p>
<p>编辑很难给一个物品多个分类。有的书不仅属于一个类，而是可能属于很多的类。</p>
<p>编辑很难给出多维度的分类。我们知道，分类是可以有很多维度的，比如按照作者分类、按照译者分类、按照出版社分类。比如不同的用户看《具体数学》原因可能不同，有些人是因为它是数学方面的书所以才看的，而有些人是因为它是大师Knuth的著作所以才去看，因此在不同人的眼中这本书属于不同的分类。</p>
<p>编辑很难决定一个物品在某一个分类中的权重。比如编辑可以很容易地决定《数据挖掘导论》属于数据挖掘类图书，但这本书在这类书中的定位是什么样的，编辑就很难给出一个准确的数字来表示。</p>
<p>为了解决上面的问题，研究人员提出：为什么我们不从数据出发，自动地找到那些类，然后进行个性化推荐？于是，隐含语义分析技术（latent variable analysis）出现了。隐含语义分析技术因为采取基于用户行为统计的自动聚类，较好地解决了上面提出的5个问题。</p>
<p>编辑的意见不能代表各种用户的意见，但隐含语义分析技术的分类来自对用户行为的统计，代表了用户对物品分类的看法。隐含语义分析技术和ItemCF在物品分类方面的思想类似，如果两个物品被很多用户同时喜欢，那么这两个物品就很有可能属于同一个类。</p>
<p>编辑很难控制分类的粒度，但隐含语义分析技术允许我们指定最终有多少个分类，这个数字越大，分类的粒度就会越细，反正分类粒度就越粗。编辑很难给一个物品多个分类，但隐含语义分析技术会计算出物品属于每个类的权重，因此每个物品都不是硬性地被分到某一个类中。</p>
<p>编辑很难给出多维度的分类，但隐含语义分析技术给出的每个分类都不是同一个维度的，它是基于用户的共同兴趣计算出来的，如果用户的共同兴趣是某一个维度，那么LFM给出的类也是相同的维度。</p>
<p>编辑很难决定一个物品在某一个分类中的权重，但隐含语义分析技术可以通过统计用户行为决定物品在每个类中的权重，如果喜欢某个类的用户都会喜欢某个物品，那么这个物品在这个类中的权重就可能比较高。</p>
<p>隐含语义分析技术从诞生到今天产生了很多著名的模型和方法，其中和该技术相关且耳熟能详的名词有pLSA、LDA、隐含类别模型（latent class model）、隐含主题模型（latent topic model）、矩阵分解（matrix  factorization）。这些技术和方法在本质上是相通的，其中很多方法都可以用于个性化推荐系统。本章将以LFM为例介绍隐含语义分析技术在推荐系统中的应用。</p>
<p>LFM通过如下公式计算用户u对物品i的兴趣：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Preference</span></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1383em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.2666em;vertical-align:-1.4382em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4382em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>这个公式中<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>是模型的参数，其中<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>度量了用户u的兴趣和第k个隐类的关系，<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>度量了第k个隐类和物品i之间的关系。那么，下面的问题就是如何计算这两个参数。</p>
<p>对最优化理论或者机器学习有所了解的读者，可能对如何计算这两个参数都比较清楚。这两个参数是从数据集中计算出来的。要计算这两个参数，需要一个训练集，对于每个用户u，训练集里都包含了用户u喜欢的物品和不感兴趣的物品，通过学习这个数据集，就可以获得上面的模型参数。</p>
<p>推荐系统的用户行为分为显性反馈和隐性反馈。LFM在显性反馈数据（也就是评分数据）上解决评分预测问题并达到了很好的精度。不过本章主要讨论的是隐性反馈数据集，这种数据集的特点是只有正样本（用户喜欢什么物品），而没有负样本（用户对什么物品不感兴趣）。</p>
<p>那么，在隐性反馈数据集上应用LFM解决To pN推荐的第一个关键问题就是如何给每个用户生成负样本。</p>
<p>对于这个问题，Rong Pan在文章中进行了深入探讨。他对比了如下几种方法。</p>
<p>对于一个用户，用他所有没有过行为的物品作为负样本。</p>
<p>对于一个用户，从他没有过行为的物品中均匀采样出一些物品作为负样本。</p>
<p>对于一个用户，从他没有过行为的物品中采样出一些物品作为负样本，但采样时，保证每个用户的正负样本数目相当。</p>
<p>对于一个用户，从他没有过行为的物品中采样出一些物品作为负样本，但采样时，偏重采样不热门的物品。</p>
<p>对于第一种方法，它的明显缺点是负样本太多，正负样本数目相差悬殊，因而计算复杂度很高，最终结果的精度也很差。对于另外3种方法，Rong  Pan在文章中表示第三种好于第二种，而第二种好于第四种。</p>
<p>后来，通过2011年的KDD Cup的Yahoo! Music推荐系统比赛，我们发现对负样本采样时应该遵循以下原则。</p>
<p>对每个用户，要保证正负样本的平衡（数目相似）。</p>
<p>对每个用户采样负样本时，要选取那些很热门，而用户却没有行为的物品。</p>
<p>一般认为，很热门而用户却没有行为更加代表用户对这个物品不感兴趣。因为对于冷门的物品，用户可能是压根没在网站中发现这个物品，所以谈不上是否感兴趣。</p>
<h3 id="基于lfm的实际系统的例子"><a class="header" href="#基于lfm的实际系统的例子">基于LFM的实际系统的例子</a></h3>
<p>雅虎的研究人员公布过一个使用LFM进行雅虎首页个性化设计的方案。本节将简单介绍他们的设计并讨论他们的设计方案。</p>
<h3 id="lfm和基于邻域的方法的比较"><a class="header" href="#lfm和基于邻域的方法的比较">LFM和基于邻域的方法的比较</a></h3>
<p>LFM是一种基于机器学习的方法，具有比较好的理论基础。这个方法和基于邻域的方法（比如UserCF、ItemCF）相比，各有优缺点。下面将从不同的方面对比LFM和基于邻域的方法。</p>
<p>理论基础  LFM具有比较好的理论基础，它是一种学习方法，通过优化一个设定的指标建立最优的模型。基于邻域的方法更多的是一种基于统计的方法，并没有学习过程。</p>
<p>离线计算的空间复杂度   基于邻域的方法需要维护一张离线的相关表。在离线计算相关表的过程中，如果用户/物品数很多，将会占据很大的内存。假设有M个用户和N个物品，在计算相关表的过程中，我们可能会获得一张比较稠密的临时相关表（尽管最终我们对每个物品只保留K个最相关的物品，但在中间计算过程中稠密的相关表是不可避免的），那么假设是用户相关表，则需要O(M*M)的空间，而对于物品相关表，则需要O(N*N)的空间。而LFM在建模过程中，如果是F个隐类，那么它需要的存储空间是O(F*(M+N))，这在M和N很大时可以很好地节省离线计算的内存。在Netflix  Prize中，因为用户数很庞大（40多万），很少有人使用UserCF算法（据说需要30  GB左右的内存），而LFM由于大量节省了训练过程中的内存（只需要4 GB），从而成为Netflix Prize中最流行的算法。</p>
<p>离线计算的时间复杂度  假设有M个用户、N个物品、K条用户对物品的行为记录。那么，UserCF计算用户相关表的时间复杂度是O(N * (K/N)^2)，而ItemCF计算物品相关表的时间复杂度是O(M*(K/M)^2)。而对于LFM，如果用F个隐类，迭代S次，那么它的计算复杂度是O(K  *  F  *  S)。那么，如果K/N  &gt;  F*S，则代表UserCF的时间复杂度低于LFM，如果K/M&gt;F*S，则说明ItemCF的时间复杂度低于LFM。在一般情况下，LFM的时间复杂度要稍微高于UserCF和ItemCF，这主要是因为该算法需要多次迭代。但总体上，这两种算法在时间复杂度上没有质的差别。</p>
<p>在线实时推荐  UserCF和ItemCF在线服务算法需要将相关表缓存在内存中，然后可以在线进行实时的预测。以ItemCF算法为例，一旦用户喜欢了新的物品，就可以通过查询内存中的相关表将和该物品相似的其他物品推荐给用户。因此，一旦用户有了新的行为，而且该行为被实时地记录到后台的数据库系统中，他的推荐列表就会发生变化。而从LFM的预测公式可以看到，LFM在给用户生成推荐列表时，需要计算用户对所有物品的兴趣权重，然后排名，返回权重最大的N个物品。那么，在物品数很多时，这一过程的时间复杂度非常高，可达O(M<em>N</em>F)。因此，LFM不太适合用于物品数非常庞大的系统，如果要用，我们也需要一个比较快的算法给用户先计算一个比较小的候选列表，然后再用LFM重新排名。另一方面，LFM在生成一个用户推荐列表时速度太慢，因此不能在线实时计算，而需要离线将所有用户的推荐结果事先计算好存储在数据库中。因此，LFM不能进行在线实时推荐，也就是说，当用户有了新的行为后，他的推荐列表不会发生变化。</p>
<p>推荐解释  ItemCF算法支持很好的推荐解释，它可以利用用户的历史行为解释推荐结果。但LFM无法提供这样的解释，它计算出的隐类虽然在语义上确实代表了一类兴趣和物品，却很难用自然语言描述并生成解释展现给用户。</p>
<h2 id="基于图的模型"><a class="header" href="#基于图的模型">基于图的模型</a></h2>
<p>用户行为很容易用二分图表示，因此很多图的算法都可以用到推荐系统中。本节将重点讨论如何将用户行为用图表示，并利用图的算法给用户进行个性化推荐。</p>
<h3 id="用户行为数据的二分图表示"><a class="header" href="#用户行为数据的二分图表示">用户行为数据的二分图表示</a></h3>
<p>基于图的模型（graph-based model）是推荐系统中的重要内容。其实，很多研究人员把基于邻域的模型也称为基于图的模型，因为可以把基于邻域的模型看做基于图的模型的简单形式。</p>
<h3 id="基于图的推荐算法"><a class="header" href="#基于图的推荐算法">基于图的推荐算法</a></h3>
<p>将用户行为表示为二分图模型后，下面的任务就是在二分图上给用户进行个性化推荐。如果将个性化推荐算法放到二分图模型上，那么给用户u推荐物品的任务就可以转化为度量用户顶点vu和与vu没有边直接相连的物品节点在图上的相关性，相关性越高的物品在推荐列表中的权重就越高。度量图中两个顶点之间相关性的方法很多，但一般来说图中顶点的相关性主要取决于下面3个因素：</p>
<p>两个顶点之间的路径数；</p>
<p>两个顶点之间路径的长度；</p>
<p>两个顶点之间的路径经过的顶点。</p>
<p>而相关性高的一对顶点一般具有如下特征：</p>
<p>两个顶点之间有很多路径相连；</p>
<p>连接两个顶点之间的路径长度都比较短；</p>
<p>连接两个顶点之间的路径不会经过出度比较大的顶点。</p>
<p>基于上面3个主要因素，研究人员设计了很多计算图中顶点之间相关性的方法。本节将介绍一种基于随机游走的PersonalRank算法。</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="推荐系统冷启动问题"><a class="header" href="#推荐系统冷启动问题">推荐系统冷启动问题</a></h1>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%86%B7%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98.html#%E5%86%B7%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98%E7%AE%80%E4%BB%8B">冷启动问题简介</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%86%B7%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98.html#%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E4%BF%A1%E6%81%AF">利用用户注册信息</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%86%B7%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98.html#%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E7%89%A9%E5%93%81%E5%90%AF%E5%8A%A8%E7%94%A8%E6%88%B7%E7%9A%84%E5%85%B4%E8%B6%A3">选择合适的物品启动用户的兴趣</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%86%B7%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98.html#%E5%88%A9%E7%94%A8%E7%89%A9%E5%93%81%E7%9A%84%E5%86%85%E5%AE%B9%E4%BF%A1%E6%81%AF">利用物品的内容信息</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%86%B7%E5%90%AF%E5%8A%A8%E9%97%AE%E9%A2%98.html#%E5%8F%91%E6%8C%A5%E4%B8%93%E5%AE%B6%E7%9A%84%E4%BD%9C%E7%94%A8">发挥专家的作用</a></li>
</ul>
<p>推荐系统需要根据用户的历史行为和兴趣预测用户未来的行为和兴趣，因此大量的用户行为数据就成为推荐系统的重要组成部分和先决条件。对于很多像百度、当当这样的网站来说，这或许不是个问题，因为它们目前已经积累了大量的用户数据。但是对于很多做纯粹推荐系统的网站（比如Jinni和Pandora），或者很多在开始阶段就希望有个性化推荐应用的网站来说，如何在没有大量用户数据的情况下设计个性化推荐系统并且让用户对推荐结果满意从而愿意使用推荐系统，就是冷启动的问题。</p>
<p>下面各节将简单介绍一下冷启动问题的分类，以及如何解决不同种类的冷启动问题。</p>
<h2 id="冷启动问题简介"><a class="header" href="#冷启动问题简介">冷启动问题简介</a></h2>
<p>冷启动问题（cold start）主要分3类。</p>
<p>用户冷启动  用户冷启动主要解决如何给新用户做个性化推荐的问题。当新用户到来时，我们没有他的行为数据，所以也无法根据他的历史行为预测其兴趣，从而无法借此给他做个性化推荐。</p>
<p>物品冷启动  物品冷启动主要解决如何将新的物品推荐给可能对它感兴趣的用户这一问题。</p>
<p>系统冷启动  系统冷启动主要解决如何在一个新开发的网站上（还没有用户，也没有用户行为，只有一些物品的信息）设计个性化推荐系统，从而在网站刚发布时就让用户体验到个性化推荐服务这一问题。</p>
<p>对于这3种不同的冷启动问题，有不同的解决方案。一般来说，可以参考如下解决方案。</p>
<p>提供非个性化的推荐  非个性化推荐的最简单例子就是热门排行榜，我们可以给用户推荐热门排行榜，然后等到用户数据收集到一定的时候，再切换为个性化推荐。</p>
<p>利用用户注册时提供的年龄、性别等数据做粗粒度的个性化。</p>
<p>利用用户的社交网络账号登录（需要用户授权），导入用户在社交网站上的好友信息，然后给用户推荐其好友喜欢的物品。</p>
<p>要求用户在登录时对一些物品进行反馈，收集用户对这些物品的兴趣信息，然后给用户推荐那些和这些物品相似的物品。</p>
<p>对于新加入的物品，可以利用内容信息，将它们推荐给喜欢过和它们相似的物品的用户。</p>
<p>在系统冷启动时，可以引入专家的知识，通过一定的高效方式迅速建立起物品的相关度表。</p>
<p>下面几节将详细描述其中的某些方案。</p>
<h2 id="利用用户注册信息"><a class="header" href="#利用用户注册信息">利用用户注册信息</a></h2>
<p>在网站中，当新用户刚注册时，我们不知道他喜欢什么物品，于是只能给他推荐一些热门的商品。但如果我们知道她是一位女性，那么可以给她推荐女性都喜欢的热门商品。这也是一种个性化的推荐。当然这个个性化的粒度很粗，因为所有刚注册的女性看到的都是同样的结果，但相对于不区分男女的方式，这种推荐的精度已经大大提高了。因此，利用用户的注册信息可以很好地解决注册用户的冷启动问题。在绝大多数网站中，年龄、性别一般都是注册用户的必备信息。如3-1所示，个性化电台Pandora的注册界面就要求用户提供生日、邮编和性别等数据。Pandora在解释为什么需要这些数据时表示是为了让用户能够看到和自己更加相关的广告。其实，这些数据也可以用于解决用户听音乐的冷启动问题。</p>
<p>用户的注册信息分3种。</p>
<p>人口统计学信息  包括用户的年龄、性别、职业、民族、学历和居住地。</p>
<p>用户兴趣的描述  有一些网站会让用户用文字描述他们的兴趣。</p>
<p>从其他网站导入的用户站外行为数据  比如用户通过豆瓣、新浪微博的账号登录，就可以在得到用户同意的情况下获取用户在豆瓣或者新浪微博的一些行为数据和社交网络数据。</p>
<p>这一节主要讨论如何通过用户注册时填写的人口统计学信息给用户提供粗粒度的个性化推荐。</p>
<p>人口统计学特征包括年龄、性别、工作、学历、居住地、国籍、民族等，这些特征对预测用户的兴趣有很重要的作用，比如男性和女性的兴趣不同，不同年龄的人兴趣也不同。图3-2显示了IMDB（IMDB网站中给出了每一部电影和电视剧的评分人数按照年龄和性别分布的数据）中给著名美剧评分的男女用户数的比例。这幅图中的数据只代表IMDB用户观看电视剧的性别分布，因为IMDB网站用户的性别分布本身是不均匀的（男性用户较多）。如图3-2所示，用户选择电视剧的行为和性别有很大的相关性，有些电视剧（比如《实习医生格雷》和《绝望主妇》）比较受女性的欢迎，而一些电视剧（比如《生活大爆炸》和《荒野求生》）则比较受男性的欢迎。</p>
<p>为了证明利用用户人口统计学特征后的推荐结果好于随机推荐的结果，Krulwich做了一个AB测试。相对于利用人口统计学特征的算法，Krulwich设计了一个对照组，该组用户看到的推荐结果是完全随机的。实验结果显示，对于利用人口统计学特征的个性化推荐算法，其用户点击率为89%，而随机算法的点击率只有27%。对于利用人口统计学特征的个性化算法，44%的用户觉得推荐结果是他们喜欢的，而对于随机算法只有31%的用户觉得推荐结果是自己喜欢的。因此，我们得到一个结论——使用人口统计学信息相对于随机推荐能够获得更好的推荐效果。当然，Krulwich的实验也有明显的缺点，即他没有对比和给用户推荐最热门的物品的推荐算法。因为热门排行榜作为一种非个性化推荐算法，一般也比随机推荐具有更高的点击率。</p>
<p>基于注册信息的个性化推荐流程基本如下：</p>
<p>(1) 获取用户的注册信息；</p>
<p>(2) 根据用户的注册信息对用户分类；</p>
<p>(3) 给用户推荐他所属分类中用户喜欢的物品。</p>
<p>当然，实际应用中也可以考虑组合特征，比如将年龄性别作为一个特征，或者将性别职业作为一个特征。不过在使用组合时需要注意用户不一定具有所有的特征（比如有些用户没有职业信息），因为一般的注册系统并不要求用户填写所有注册项。</p>
<h2 id="选择合适的物品启动用户的兴趣"><a class="header" href="#选择合适的物品启动用户的兴趣">选择合适的物品启动用户的兴趣</a></h2>
<p>解决用户冷启动问题的另一个方法是在新用户第一次访问推荐系统时，不立即给用户展示推荐结果，而是给用户提供一些物品，让用户反馈他们对这些物品的兴趣，然后根据用户反馈给提供个性化推荐。很多推荐系统采取了这种方式来解决用户冷启动问题。以Jinni为例，当新用户访问推荐系统时，它会给出一条提示语，表示用户需要给多部电影评分才能获取推荐结果（如图3-7所示）。当用户选择给多部电影评分后，Jinni会首先展示一个页面让用户选择他喜欢的电影类别（如图3-8所示），当用户选择了某一个类别后，Jinni会展示第三个界面让用户对电影进行反馈（如图3-9所示）。</p>
<p>对于这些通过让用户对物品进行评分来收集用户兴趣，从而对用户进行冷启动的系统，它们需要解决的首要问题就是如何选择物品让用户进行反馈。</p>
<p>一般来说，能够用来启动用户兴趣的物品需要具有以下特点。</p>
<p>比较热门  如果要让用户对一个物品进行反馈，前提是用户知道这个物品是什么东西。以电影为例，如果一开始让用户进行反馈的电影都很冷门，而用户不知道这些电影的情节和内容，也就无法对它们做出准确的反馈。</p>
<p>具有代表性和区分性  启动用户兴趣的物品不能是大众化或老少咸宜的，因为这样的物品对用户的兴趣没有区分性。还以电影为例，用一部票房很高且广受欢迎的电影做启动物品，可以想象的到的是几乎所有用户都会喜欢这部电影，因而无法区分用户个性化的兴趣。</p>
<p>启动物品集合需要有多样性  在冷启动时，我们不知道用户的兴趣，而用户兴趣的可能性非常多，为了匹配多样的兴趣，我们需要提供具有很高覆盖率的启动物品集合，这些物品能覆盖几乎所有主流的用户兴趣。以图3-8为例，Jinni在让用户反馈时没有直接拿电影让用户反馈，而是给出了12个电影类型（截图中只显示了其中的6个电影类型），让用户先选择喜欢哪种类型，这样就很好地保证了启动物品集合的多样性。</p>
<p>上面这些因素都是选择启动物品时需要考虑的，但如何设计一个选择启动物品集合的系统呢？Nadav Golbandi在论文中探讨了这个问题，提出可以用一个决策树解决这个问题。</p>
<h2 id="利用物品的内容信息"><a class="header" href="#利用物品的内容信息">利用物品的内容信息</a></h2>
<p>物品冷启动需要解决的问题是如何将新加入的物品推荐给对它感兴趣的用户。物品冷启动在新闻网站等时效性很强的网站中非常重要，因为那些网站中时时刻刻都有新加入的物品，而且每个物品必须能够在第一时间展现给用户，否则经过一段时间后，物品的价值就大大降低了。</p>
<p>第2章介绍了两种主要的推荐算法——UserCF和ItemCF算法。首先需要指出的是，UserCF算法对物品冷启动问题并不非常敏感。因为，UserCF在给用户进行推荐时，会首先找到和用户兴趣相似的一群用户，然后给用户推荐这一群用户喜欢的物品。在很多网站中，推荐列表并不是给用户展示内容的唯一列表，那么当一个新物品加入时，总会有用户从某些途径看到这些物品，对这些物品产生反馈。那么，当一个用户对某个物品产生反馈后，和他历史兴趣相似的其他用户的推荐列表中就有可能出现这一物品，从而更多的人就会对这个物品产生反馈，导致更多的人的推荐列表中会出现这一物品，因此该物品就能不断地扩散开来，从而逐步展示到对它感兴趣用户的推荐列表中。</p>
<p>但是，有些网站中推荐列表可能是用户获取信息的主要途径，比如豆瓣网络电台。那么对于UserCF算法就需要解决第一推动力的问题，即第一个用户从哪儿发现新的物品。只要有一小部分人能够发现并喜欢新的物品，UserCF算法就能将这些物品扩散到更多的用户中。解决第一推动力最简单的方法是将新的物品随机展示给用户，但这样显然不太个性化，因此可以考虑利用物品的内容信息，将新物品先投放给曾经喜欢过和它内容相似的其他物品的用户。关于如何利用内容信息，本节将在后面介绍。</p>
<p>对于ItemCF算法来说，物品冷启动就是一个严重的问题了。因为ItemCF算法的原理是给用户推荐和他之前喜欢的物品相似的物品。ItemCF算法会每隔一段时间利用用户行为计算物品相似度表（一般一天计算一次），在线服务时ItemCF算法会将之前计算好的物品相关度矩阵放在内存中。因此，当新物品加入时，内存中的物品相关表中不会存在这个物品，从而ItemCF算法无法推荐新的物品。解决这一问题的办法是频繁更新物品相似度表，但基于用户行为计算物品相似度是非常耗时的事情，主要原因是用户行为日志非常庞大。而且，新物品如果不展示给用户，用户就无法对它产生行为，通过行为日志计算是计算不出包含新物品的相关矩阵的。为此，我们只能利用物品的内容信息计算物品相关表，并且频繁地更新相关表（比如半小时计算一次）。</p>
<p>物品的内容信息多种多样，不同类型的物品有不同的内容信息。如果是电影，那么内容信息一般包括标题、导演、演员、编剧、剧情、风格、国家、年代等。如果是图书，内容信息一般包含标题、作者、出版社、正文、分类等。表3-4展示了常见物品的常用内容信息。</p>
<p>表3-4 常见物品的内容信息</p>
<div class="table-wrapper"><table><thead><tr><th>类型</th><th>内容信息</th></tr></thead><tbody>
<tr><td>图书</td><td>标题、作者、出版社、出版年代、丛书名、目录、正文</td></tr>
<tr><td>论文</td><td>标题、作者、作者单位、关键字、分类、摘要、正文</td></tr>
<tr><td>电影</td><td>标题、导演、演员、编剧、类别、剧情简介、发行公司</td></tr>
<tr><td>新闻</td><td>标题、正文、来源、作者</td></tr>
<tr><td>微博</td><td>作者、内容、评论</td></tr>
<tr><td>一般来说，物品的内容可以通过向量空间模型表示，该模型会将物品表示成一个关键词向量。如果物品的内容是一些诸如导演、演员等实体的话，可以直接将这些实体作为关键词。但如果内容是文本的形式，则需要引入一些理解自然语言的技术抽取关键词。图3-11展示了从文本生成关键词向量的主要步骤。对于中文，首先要对文本进行分词，将字流变成词流，然后从词流中检测出命名实体（如人名、地名、组织名等），这些实体和一些其他重要的词将组成关键词集合，最后对关键词进行排名，计算每个关键词的权重，从而生成关键词向量。</td><td></td></tr>
</tbody></table>
</div>
<p>也许有读者认为，既然内容相似度计算简单，能频繁更新，而且能够解决物品冷启动问题，那么为什么还需要协同过滤的算法。为了说明内容过滤算法和协同过滤算法的优劣，本节在MovieLens和GitHub两个数据集上进行了实验。MovieLens数据集上一章已经详细介绍了，它也提供了有限的内容信息，主要包括电影的类别信息（动作片、爱情片等类别），GitHub数据集包含代码开发者对开源项目的兴趣数据，它的用户是程序员，物品是开源工程，如果一名程序员关注某个开源工程，就会有一条行为记录。该数据集中主要的内容数据是开源项目的所有者名。</p>
<p>从MovieLens数据集上的结果可以发现，ContentItemKNN的准确率和召回率仅仅优于Random算法，明显差于ItemCF算法，甚至比MostPopular算法还要差。不过在覆盖率和流行度指标上ContentItemKNN却优于ItemCF。这主要是因为内容过滤算法忽视了用户行为，从而也忽视了物品的流行度以及用户行为中所包含的规律，所以它的精度比较低，但结果的新颖度却比较高。不过，事情不是绝对的。如果看GitHub数据集的结果，我们会发现完全相反的现象——Content-ItemKNN在所有指标上都优于ItemCF。这主要是因为GitHub提供了一个非常强的内容特征，就是开源项目的作者。在GitHub中，程序员会经常会关注同一个作者的不同项目，这一点是GitHub数据集最重要的特征。而协同过滤算法由于数据稀疏的影响，不能从用户行为中完全统计出这一特征，所以协同过滤算法反而不如利用了先验信息的内容过滤算法。这一点也说明，如果用户的行为强烈受某一内容属性的影响，那么内容过滤的算法还是可以在精度上超过协同过滤算法的。不过这种强的内容特征不是所有物品都具有的，而且需要丰富的领域知识才能获得，所以很多时候内容过滤算法的精度比协同过滤算法差。不过，这也提醒我们，如果能够将这两种算法融合，一定能够获得比单独使用这两种算法更好的效果。</p>
<p>ECML/PKDD在2011年举办过一次利用物品内容信息解决冷启动问题的比赛。该比赛提供了物品的内容信息，希望参赛者能够利用这些内容信息尽量逼近协同过滤计算出的相似度表。对内容推荐感兴趣的读者可以关注该比赛的相关论文。</p>
<p>向量空间模型在内容数据丰富时可以获得比较好的效果。以文本为例，如果是计算长文本的相似度，用向量空间模型利用关键词计算相似度已经可以获得很高的精确度。但是，如果文本很短，关键词很少，向量空间模型就很难计算出准确的相似度。举个例子，假设有两篇论文，它们的标题分别是“推荐系统的动态特性”和“基于时间的协同过滤算法研究”。如果读者对推荐系统很熟悉，可以知道这两篇文章的研究方向是类似的，但是它们标题中没有一样的关键词。其实，它们的关键词虽然不同，但却是相似的。“动态”和“基于时间”含义相似，“协同过滤”是“推荐系统”的一种算法。换句话说，这两篇文章的关键词虽然不同，但关键词所属的话题是相同的。在这种情况下，首先需要知道文章的话题分布，然后才能准确地计算文章的相似度。如何建立文章、话题和关键词的关系是话题模型（topic model）研究的重点。</p>
<p>代表性的话题模型有LDA。以往关于该模型的理论文章已经很多了，本书不准备讨论太多的数学问题，所以这里准备用形象的语言介绍一下LDA，并用工程师很容易懂的方法介绍这个算法。关于LDA的详细理论介绍可以参考DM Blei的论文“Latent Dirichlet Allocation”。</p>
<p>任何模型都有一个假设，LDA作为一种生成模型，对一篇文档产生的过程进行了建模。话题模型的基本思想是，一个人在写一篇文档的时候，会首先想这篇文章要讨论哪些话题，然后思考这些话题应该用什么词描述，从而最终用词写成一篇文章。因此，文章和词之间是通过话题联系的。</p>
<p>在使用LDA计算物品的内容相似度时，我们可以先计算出物品在话题上的分布，然后利用两个物品的话题分布计算物品的相似度。比如，如果两个物品的话题分布相似，则认为两个物品具有较高的相似度，反之则认为两个物品的相似度较低。计算分布的相似度可以利用KL散度。</p>
<h2 id="发挥专家的作用"><a class="header" href="#发挥专家的作用">发挥专家的作用</a></h2>
<p>很多推荐系统在建立时，既没有用户的行为数据，也没有充足的物品内容信息来计算准确的物品相似度。那么，为了在推荐系统建立时就让用户得到比较好的体验，很多系统都利用专家进行标注。这方面的代表系统是个性化网络电台Pandora和电影推荐网站Jinni。</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="利用用户标签数据"><a class="header" href="#利用用户标签数据">利用用户标签数据</a></h1>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B7%E6%A0%87%E7%AD%BE%E6%95%B0%E6%8D%AE.html#ugc%E6%A0%87%E7%AD%BE%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BB%A3%E8%A1%A8%E5%BA%94%E7%94%A8">UGC标签系统的代表应用</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B7%E6%A0%87%E7%AD%BE%E6%95%B0%E6%8D%AE.html#%E6%A0%87%E7%AD%BE%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E6%8E%A8%E8%8D%90%E9%97%AE%E9%A2%98">标签系统中的推荐问题</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B7%E6%A0%87%E7%AD%BE%E6%95%B0%E6%8D%AE.html#%E7%94%A8%E6%88%B7%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%9B%E8%A1%8C%E6%A0%87%E6%B3%A8">用户为什么进行标注</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B7%E6%A0%87%E7%AD%BE%E6%95%B0%E6%8D%AE.html#%E7%94%A8%E6%88%B7%E5%A6%82%E4%BD%95%E6%89%93%E6%A0%87%E7%AD%BE">用户如何打标签</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B7%E6%A0%87%E7%AD%BE%E6%95%B0%E6%8D%AE.html#%E7%94%A8%E6%88%B7%E6%89%93%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84%E6%A0%87%E7%AD%BE">用户打什么样的标签</a></li>
</ul>
</li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B7%E6%A0%87%E7%AD%BE%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E6%A0%87%E7%AD%BE%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F">基于标签的推荐系统</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B7%E6%A0%87%E7%AD%BE%E6%95%B0%E6%8D%AE.html#%E7%BB%99%E7%94%A8%E6%88%B7%E6%8E%A8%E8%8D%90%E6%A0%87%E7%AD%BE">给用户推荐标签</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%94%A8%E6%88%B7%E6%A0%87%E7%AD%BE%E6%95%B0%E6%8D%AE.html#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB">扩展阅读</a></li>
</ul>
<p>推荐系统的目的是联系用户的兴趣和物品，这种联系需要依赖不同的媒介。GroupLens在一篇文章中表示目前流行的推荐系统基本上通过3种方式联系用户兴趣和物品。如图4-1所示，第一种方式是利用用户喜欢过的物品，给用户推荐与他喜欢过的物品相似的物品，这就是前面提到的基于物品的算法。第二种方式是利用和用户兴趣相似的其他用户，给用户推荐那些和他们兴趣爱好相似的其他用户喜欢的物品，这是前面提到的基于用户的算法。除了这两种方法，第三种重要的方式是通过一些特征（feature）联系用户和物品，给用户推荐那些具有用户喜欢的特征的物品。这里的特征有不同的表现方式，比如可以表现为物品的属性集合（比如对于图书，属性集合包括作者、出版社、主题和关键词等），也可以表现为隐语义向量（latent factor vector），这可以通过前面提出的隐语义模型习得到。本章将讨论一种重要的特征表现方式——标签。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250203181241.png" alt="" /></p>
<p>根据维基百科的定义，标签是一种无层次化结构的、用来描述信息的关键词，它可以用来描述物品的语义。根据给物品打标签的人的不同，标签应用一般分为两种：一种是让作者或者专家给物品打标签；另一种是让普通用户给物品打标签，也就是UGC（User Generated Content，用户生成的内容）的标签应用。UGC的标签系统是一种表示用户兴趣和物品语义的重要方式。当一个用户对一个物品打上一个标签，这个标签一方面描述了用户的兴趣，另一方面则表示了物品的语义，从而将用户和物品联系了起来。因此本章主要讨论UGC的标签应用，研究用户给物品打标签的行为，探讨如何通过分析这种行为给用户进行个性化推荐。</p>
<h3 id="ugc标签系统的代表应用"><a class="header" href="#ugc标签系统的代表应用">UGC标签系统的代表应用</a></h3>
<p>UGC标签系统是很多Web   2.0网站的必要组成部分，本节将讨论使用UGC标签系统的代表网站——UGC标签系统的鼻祖Delicious、论文书签网站CiteULike、音乐网站Last.fm、视频网站Hulu、书和电影评论网站豆瓣等。下面将分别介绍这些应用。</p>
<p>从前面的各种应用可以看到，标签系统在各种各样的（音乐、视频和社交等）网站中都得到了广泛应用。标签系统的最大优势在于可以发挥群体的智能，获得对物品内容信息比较准确的关键词描述，而准确的内容信息是提升个性化推荐系统性能的重要资源。</p>
<p>关于标签系统的作用， GroupLen的Shilads Wieland Sen在MoveLens电影推荐系统上做了更为深入的、基于问卷调查的研究。在博士论文中，他探讨了标签系统的不同作用，以及每种作用能够影响多大的人群，如下所示。</p>
<p>表达  标签系统帮助我表达对物品的看法。（30%的用户同意。）</p>
<p>组织  打标签帮助我组织我喜欢的电影。（23%的用户同意。）</p>
<p>学习  打标签帮助我增加对电影的了解。（27%的用户同意。）</p>
<p>发现  标签系统使我更容易发现喜欢的电影。（19%的用户同意。）</p>
<p>决策  标签系统帮助我判定是否看某一部电影。（14%的用户同意。）</p>
<p>上面的研究证明，标签系统确实能够帮助用户发现可能喜欢的电影，而这正是个性化推荐系统的使命之一。因此，本章将对如何发挥标签在个性化推荐中的作用进行深入探讨。</p>
<h2 id="标签系统中的推荐问题"><a class="header" href="#标签系统中的推荐问题">标签系统中的推荐问题</a></h2>
<p>打标签作为一种重要的用户行为，蕴含了很多用户兴趣信息，因此深入研究和利用用户打标签的行为可以很好地指导我们改进个性化推荐系统的推荐质量。同时，标签的表示形式非常简单，便于很多算法处理。</p>
<p>标签系统中的推荐问题主要有以下两个。</p>
<p>如何利用用户打标签的行为为其推荐物品（基于标签的推荐）？</p>
<p>如何在用户给物品打标签时为其推荐适合该物品的标签（标签推荐）？</p>
<p>为了研究上面的两个问题，我们首先需要解答下面3个问题。</p>
<p>用户为什么要打标签？</p>
<p>用户怎么打标签？</p>
<p>用户打什么样的标签？</p>
<h3 id="用户为什么进行标注"><a class="header" href="#用户为什么进行标注">用户为什么进行标注</a></h3>
<p>在设计基于标签的个性化推荐系统之前，我们需要深入了解用户的标注行为（即打标签的行为），知道用户为什么要标注，用户怎么标注，只有深入了解用户的行为，我们才能基于这个行为设计出令他们满意的个性化推荐系统。</p>
<p>Morgan Ames研究图片分享网站中用户标注的动机问题，并从两个维度进行探讨。首先是社会维度，有些用户标注是给内容上传者使用的（便于上传者组织自己的信息），而有些用户标注是给广大用户使用的（便于帮助其他用户找到信息）。另一个维度是功能维度，有些标注用于更好地组织内容，方便用户将来的查找，而另一些标注用于传达某种信息，比如照片的拍摄时间和地点等。</p>
<h3 id="用户如何打标签"><a class="header" href="#用户如何打标签">用户如何打标签</a></h3>
<p>在互联网中，尽管每个用户的行为看起来是随机的，但其实这些表面随机的行为背后蕴含着很多规律。这一节将通过研究Delicious数据集总结用户标注行为中的一些统计规律。</p>
<p>德国研究人员公布过一个很庞大的Delicious数据集，该数据集包含2003年9月到2007年12月Delicious用户4.2亿条标签行为记录。本节选用该数据集2007年一个月的数据进行分析，对该数据集的统计特性进行研究。</p>
<p>前面几章都提到，用户行为数据集中用户活跃度和物品流行度的分布都遵循长尾分布（Power Law分布）。</p>
<h3 id="用户打什么样的标签"><a class="header" href="#用户打什么样的标签">用户打什么样的标签</a></h3>
<p>在用户看到一个物品时，我们希望他打的标签是能够准确描述物品内容属性的关键词，但用户往往不是按照我们的想法操作，而是可能会给物品打上各种各样奇奇怪怪的标签。</p>
<p>Scott A. Golder 总结了Delicious上的标签，将它们分为如下几类。</p>
<p>表明物品是什么  比如是一只鸟，就会有“鸟”这个词的标签；是豆瓣的首页，就有一个标签叫“豆瓣”；是乔布斯的首页，就会有个标签叫“乔布斯”。</p>
<p>表明物品的种类 比如在Delicious的书签中，表示一个网页类别的标签包括 article（文章）、blog（博客）、 book（图书）等。</p>
<p>表明谁拥有物品  比如很多博客的标签中会包括博客的作者等信息。</p>
<p>表达用户的观点  比如用户认为网页很有趣，就会打上标签funny（有趣），认为很无聊，就会打上标签boring（无聊）。</p>
<p>用户相关的标签 比如 my favorite（我最喜欢的）、my comment（我的评论）等。</p>
<p>用户的任务 比如 to read（即将阅读）、job search（找工作）等。</p>
<h2 id="基于标签的推荐系统"><a class="header" href="#基于标签的推荐系统">基于标签的推荐系统</a></h2>
<p>用户用标签来描述对物品的看法，因此标签是联系用户和物品的纽带，也是反应用户兴趣的重要数据源，如何利用用户的标签数据提高个性化推荐结果的质量是推荐系统研究的重要课题。</p>
<p>豆瓣很好地利用了标签数据，它将标签系统融入到了整个产品线中。首先，在每本书的页面上，豆瓣都提供了一个叫做“豆瓣成员常用标签”的应用，它给出了这本书上用户最常打的标签。同时，在用户给书做评价时，豆瓣也会让用户给图书打标签。最后，在最终的个性化推荐结果里，豆瓣利用标签将用户的推荐结果做了聚类，显示了对不同标签下用户的推荐结果，从而增加了推荐的多样性和可解释性。</p>
<p>一个用户标签行为的数据集一般由一个三元组的集合表示，其中记录(u, i, b) 表示用户u给物品i打上了标签b。当然，用户的真实标签行为数据远远比三元组表示的要复杂，比如用户打标签的时间、用户的属性数据、物品的属性数据等。但是本章为了集中讨论标签数据，只考虑上面定义的三元组形式的数据，即用户的每一次打标签行为都用一个三元组（用户、物品、标签）表示。</p>
<h2 id="给用户推荐标签"><a class="header" href="#给用户推荐标签">给用户推荐标签</a></h2>
<p>当用户浏览某个物品时，标签系统非常希望用户能够给这个物品打上高质量的标签，这样才能促进标签系统的良性循环。因此，很多标签系统都设计了标签推荐模块给用户推荐标签。图4-14展示了音乐网站Last.fm和豆瓣的标签推荐系统。</p>
<p>在讨论如何给用户推荐标签之前，首先需要了解为什么要给用户推荐标签。一般认为，给用户推荐标签有以下好处。</p>
<p>方便用户输入标签  让用户从键盘输入标签无疑会增加用户打标签的难度，这样很多用户不愿意给物品打标签，因此我们需要一个辅助工具来减小用户打标签的难度，从而提高用户打标签的参与度。</p>
<p>提高标签质量  同一个语义不同的用户可能用不同的词语来表示。这些同义词会使标签的词表变得很庞大，而且会使计算相似度不太准确。而使用推荐标签时，我们可以对词表进行选择，首先保证词表不出现太多的同义词，同时保证出现的词都是一些比较热门的、有代表性的词。</p>
<h2 id="扩展阅读"><a class="header" href="#扩展阅读">扩展阅读</a></h2>
<p>本章主要讨论了UGC标签在推荐系统中的应用。标签作为描述语义的重要媒介，无论是对于描述用户兴趣还是表示物品的内容都有很重要的意义。标签在推荐系统中的应用主要集中在两个问题上，一个是如何利用用户打标签的行为给用户推荐物品，另一个是如何给用户推荐标签。本章在深入分析用户标签行为的基础上对这两个问题进行了深入探讨。</p>
<p>关于标签的问题，最近几年在学术界获得了广泛关注。ECML/PKDD在2008年曾经推出过基于标签的推荐系统比赛。在这些研究中涌现了很多新的方法，比如张量分解（tensor factorization）、基于LDA的算法、基于图的算法等。不过这些算法很多具有较高的复杂度，在实际系统中应用起来还有很多实际的困难需要解决。GroupLens的研究人员给MovieLens系统做了很多标签方面的工作。Shilad Sen在论文中研究了如何利用标签联系用户和物品并给用户进行个性化电影推荐。Jesse  Vig在论文中研究了如何利用标签进行推荐解释，他将用户和物品之间的关系转化为用户对标签的兴趣（tag preference）以及标签和物品的相关度（tag relevance）两种因素。同时他们研究了如何对标签进行清理，以及如何选择合适的标签进行解释。</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="利用上下文信息"><a class="header" href="#利用上下文信息">利用上下文信息</a></h1>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF.html#%E6%97%B6%E9%97%B4%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF">时间上下文信息</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF.html#%E6%97%B6%E9%97%B4%E6%95%88%E5%BA%94%E7%AE%80%E4%BB%8B">时间效应简介</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF.html#%E6%97%B6%E9%97%B4%E6%95%88%E5%BA%94%E4%B8%BE%E4%BE%8B">时间效应举例</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF.html#%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4%E7%89%B9%E6%80%A7%E7%9A%84%E5%88%86%E6%9E%90">系统时间特性的分析</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF.html#%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E6%97%B6%E6%80%A7">推荐系统的实时性</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF.html#%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95%E7%9A%84%E6%97%B6%E9%97%B4%E5%A4%9A%E6%A0%B7%E6%80%A7">推荐算法的时间多样性</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF.html#%E6%97%B6%E9%97%B4%E4%B8%8A%E4%B8%8B%E6%96%87%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95">时间上下文推荐算法</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF.html#%E6%97%B6%E9%97%B4%E6%AE%B5%E5%9B%BE%E6%A8%A1%E5%9E%8B">时间段图模型</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF.html#%E7%A6%BB%E7%BA%BF%E5%AE%9E%E9%AA%8C">离线实验</a></li>
</ul>
</li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF.html#%E5%9C%B0%E7%82%B9%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF">地点上下文信息</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF.html#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB">扩展阅读</a></li>
</ul>
<p>本章之前提到的推荐系统算法主要集中研究了如何联系用户兴趣和物品，将最符合用户兴趣的物品推荐给用户，但这些算法都忽略了一点，就是用户所处的上下文（context）。这些上下文包括用户访问推荐系统的时间、地点、心情等，对于提高推荐系统的推荐性能是非常重要的。比如，一个卖衣服的推荐系统在冬天和夏天应该给用户推荐不同种类的服装。推荐系统不能因为用户在夏天喜欢过某件T恤，就在冬天也给该用户推荐类似的T恤。再举个例子，当用户在中关村打开一个美食推荐系统时，如果这个推荐系统推荐的餐馆都是中关村附近的，显然推荐结果更加能够令用户满意。上下文影响用户兴趣的例子还有很多，比如用户上班时和下班后的兴趣会有区别，用户在平时和周末的兴趣会有区别，用户和父母在一起与和同学在一起时的兴趣有区别，甚至用户在上厕所时阅读的文章和在办公桌旁阅读的文章也是不同的。因此，准确了解用户的上下文信息，并将该信息应用于推荐算法是设计好的推荐系统的关键步骤。</p>
<p>关于上下文推荐的研究，可以参考Alexander  Tuzhilin教授的一篇综述“Context  Aware  Recommender Systems”。Alexander Tuzhilin教授最近几年和他的学生们对上下文相关的推荐算法进行了深入研究。他们在论文中提到了一个上下文推荐系统的例子——Sourcetone音乐推荐系统（如图5-1所示）。该系统会让用户选择自己现在的心情，然后它根据用户选择的心情给用户推荐音乐。这里，心情是一种重要的上下文，用户在不同的心情下会选择不同的音乐。当然，当用户在某个时间点刚刚使用推荐系统时，系统很难猜出用户当时是什么心情。因此Sourcetone采取了让用户主动告诉系统他现在心情的方式，然后系统根据用户当前的心情并综合考虑其历史兴趣推荐符合他要求的合适歌曲。</p>
<p>和心情类似的上下文还有很多，以看视频为例。用户是在上班时间看还是在下班后看，用户是在家里看还是在单位看，用户是自己一个人看还是和好友一起看，用户是和同学一起看还是和父母一起看，用户是喝着啤酒看还是吃着鸡翅看，这些都是上下文信息，而且这些上下文对用户当时观看什么电视剧都有很大影响。</p>
<p>本章我们主要讨论时间上下文，并简单介绍一下地点上下文，讨论如何将时间信息和地点信息建模到推荐算法中，从而让推荐系统能够准确预测用户在某个特定时刻及特定地点的兴趣。本章仍然研究Top N推荐，即如何给用户生成一个长度为N的推荐列表，而该列表包含了用户在某一时刻或者某个地方最可能喜欢的物品。</p>
<h2 id="时间上下文信息"><a class="header" href="#时间上下文信息">时间上下文信息</a></h2>
<p>本节将重点讨论上下文信息中最重要的时间上下文信息。本节首先介绍各种不同的时间效应，然后研究如何将这些时间效应建模到推荐系统的模型中，最后通过实际数据集对比不同模型的效果。</p>
<h3 id="时间效应简介"><a class="header" href="#时间效应简介">时间效应简介</a></h3>
<p>时间是一种重要的上下文信息，对用户兴趣有着深入而广泛的影响。一般认为，时间信息对用户兴趣的影响表现在以下几个方面。</p>
<p>用户兴趣是变化的  我们这里提到的用户兴趣变化是因为用户自身原因发生的变化。比如随着年龄的增长，用户小时候喜欢看动画片，长大了喜欢看文艺片。一位程序员随着工作时间的增加，逐渐从阅读入门书籍过渡到阅读专业书籍。一个人参加工作了，工作后的兴趣和学生时代的兴趣相比发生了变化。那么，如果我们要准确预测用户现在的兴趣，就应该关注用户最近的行为，因为用户最近的行为最能体现他现在的兴趣。当然，考虑用户最近的兴趣只能针对渐变的用户兴趣，而对突变的用户兴趣很难起作用，比如用户突然中奖了。</p>
<p>物品也是有生命周期的  一部电影刚上映的时候可能被很多人关注，但是经久不衰的电影是很少的，很多电影上映后不久就被人们淡忘了。此外，物品也可能受新闻事件的影响，比如一部已经被淡忘的电影会因为突然被某个新闻事件涉及而重新热门起来。因此，当我们决定在某个时刻给某个用户推荐某个物品时，需要考虑该物品在该时刻是否已经过时了。比如，我们给一个NBA迷推荐10年前的某个NBA新闻显然是不太合适的（当然这也不一定，比如用户当时就是在寻找旧的NBA新闻时）。不同系统的物品具有不同的生命周期，比如新闻的生命周期很短暂，而电影的生命周期相对较长。</p>
<p>季节效应  季节效应主要反映了时间本身对用户兴趣的影响。比如人们夏天吃冰淇淋，冬天吃火锅，夏天穿T恤，冬天穿棉衣。当然，我们也不排除有特别癖好的人存在，但大部分用户都是遵循这个规律的。除此之外，节日也是一种季节效应：每年的圣诞节，人们都要去购物；每年的奥斯卡颁奖礼，人们都要关注电影。2011年ACM推荐大会的一个研讨会曾经举办过一次上下文相关的电影推荐算法比赛，该比赛要求参赛者预测数据集中用户在奥斯卡颁奖礼附近时刻的行为。关注季节效应的读者可以关注一下这个研讨会上发表的相关论文。</p>
<h3 id="时间效应举例"><a class="header" href="#时间效应举例">时间效应举例</a></h3>
<p>下面通过一些例子体会一下时间对用户兴趣的影响。我们通过Google  Insights工具对时间效应进行一些分析。Google  Insights提供了某个搜索词自2004年以来的搜索频率曲线，我们可以通过该曲线发现一些用户兴趣变化的例子。</p>
<h3 id="系统时间特性的分析"><a class="header" href="#系统时间特性的分析">系统时间特性的分析</a></h3>
<p>在给定时间信息后，推荐系统从一个静态系统变成了一个时变的系统，而用户行为数据也变成了时间序列。研究一个时变系统，需要首先研究这个系统的时间特性。本节将通过研究时变的用户行为数据集来研究不同类型网站的时间特性。包含时间信息的用户行为数据集由一系列三元组构成，其中每个三元组(u,i,t)代表了用户u在时刻t对物品i产生过行为。在给定数据集后，本节通过统计如下信息研究系统的时间特性。</p>
<p>数据集每天独立用户数的增长情况  有些网站处于快速增长期，它们每天的独立用户数都在线性（甚至呈指数级）增加。而有些网站处于平稳期，每天的独立用户数都比较平稳。还有一些网站处于衰落期，每天的用户都在流失。在3种不同的系统中用户行为是不一样的，因此我们首先需要确定系统的增长情况。</p>
<p>系统的物品变化情况  有些网站，比如新闻网站，每天都会出现大量新的新闻，而每条热门的新闻其时间周期都不会太长，今天热门的新闻也许明天就被人忘记了。</p>
<p>用户访问情况  有些网站用户来一次就永远不来了，有些网站用户每周来一次，而有些网站用户每天都来。为了度量这些特性，我们可以统计用户的平均活跃天数，同时也可以统计相隔T天来系统的用户的重合度。</p>
<h3 id="推荐系统的实时性"><a class="header" href="#推荐系统的实时性">推荐系统的实时性</a></h3>
<p>用户兴趣是不断变化的，其变化体现在用户不断增加的新行为中。一个实时的推荐系统需要能够实时响应用户新的行为，让推荐列表不断变化，从而满足用户不断变化的兴趣。</p>
<p>实现推荐系统的实时性除了对用户行为的存取有实时性要求，还要求推荐算法本身具有实时性，而推荐算法本身的实时性意味着：</p>
<p>实时推荐系统不能每天都给所有用户离线计算推荐结果，然后在线展示昨天计算出来的结果。所以，要求在每个用户访问推荐系统时，都根据用户这个时间点前的行为实时计算推荐列表。</p>
<p>推荐算法需要平衡考虑用户的近期行为和长期行为，即要让推荐列表反应出用户近期行为所体现的兴趣变化，又不能让推荐列表完全受用户近期行为的影响，要保证推荐列表对用户兴趣预测的延续性。</p>
<h3 id="推荐算法的时间多样性"><a class="header" href="#推荐算法的时间多样性">推荐算法的时间多样性</a></h3>
<p>很多推荐系统的研究人员经常遇到一个问题，就是每天给用户的推荐结果都差不多，没有什么变化。推荐系统每天推荐结果的变化程度被定义为推荐系统的时间多样性。时间多样性高的推荐系统中用户会经常看到不同的推荐结果。</p>
<p>那么推荐系统的时间多样性和用户满意度之间是否存在关系呢？时间多样性高是否就能提高用户的满意度？为了解答这些问题，英国研究人员进行了一次实验，他们设计了3种推荐系统。</p>
<p>A  给用户推荐最热门的10部电影。</p>
<p>B  从最热门的100部电影中推荐10部给用户，但保证了时间多样性，每周都有7部电影推荐结果不在上周的推荐列表中。</p>
<p>C  每次都从所有电影中随机挑选10部推荐给用户。</p>
<p>对比这3种算法可知，A算法每天给用户的推荐结果都一样，没有时间多样性，B算法保证了一定的时间多样性，同时推荐结果也是比较热门的电影，C算法具有完全的时间多样性，因为它每次推荐都是从所有电影中随机选择的，但是它并没有考虑电影的热门程度。</p>
<p>然后，研究人员进行了用户调查实验。他们每次给用户展示30个推荐结果（分别来自3个不同的算法）然后让用户给这些推荐结果评分。经过5周的实验后，研究人员统计了每一周不同算法的推荐结果的平均评分，发现了如下现象（具体结果分析请参考他们的论文）。</p>
<p>A、B算法的平均分明显高于C算法。这说明纯粹的随机推荐虽然具有最高的时间多样性，但不能保证推荐的精度。</p>
<p>A算法的平均分随时间逐渐下降，而B算法的平均分随时间基本保持不变。这说明A算法因为没有时间多样性，从而造成用户满意度不断下降，从而也说明了保证时间多样性的重要性。</p>
<p>在证明了时间多样性对推荐系统的正面意义之后，下面的问题就是如何在不损失精度的情况下提高推荐结果的时间多样性。</p>
<p>提高推荐结果的时间多样性需要分两步解决：首先，需要保证推荐系统能够在用户有了新的行为后及时调整推荐结果，使推荐结果满足用户最近的兴趣；其次，需要保证推荐系统在用户没有新的行为时也能够经常变化一下结果，具有一定的时间多样性。</p>
<p>对于第一步，又可以分成两种情况进行分析。第一是从推荐系统的实时性角度分析。有些推荐系统会每天离线生成针对所有用户的推荐结果，然后在线直接将这些结果展示给用户。这种类型的系统显然无法做到在用户有了新行为后及时调整推荐结果。第二，即使是实时推荐系统，由于使用的算法不同，也具有不同的时间多样性。对于不同算法的时间多样性，Neal Lathia博士在博士论文中进行了深入探讨，这里就不再详述了。</p>
<p>那么，如果用户没有行为，如何保证给用户的推荐结果具有一定的时间多样性呢？一般的思路有以下几种。</p>
<p>在生成推荐结果时加入一定的随机性。比如从推荐列表前20个结果中随机挑选10个结果展示给用户，或者按照推荐物品的权重采样10个结果展示给用户。</p>
<p>记录用户每天看到的推荐结果，然后在每天给用户进行推荐时，对他前几天看到过很多次的推荐结果进行适当地降权。</p>
<p>每天给用户使用不同的推荐算法。可以设计很多推荐算法，比如协同过滤算法、内容过滤算法等，然后在每天用户访问推荐系统时随机挑选一种算法给他进行推荐。</p>
<p>当然，时间多样性也不是绝对的。推荐系统需要首先保证推荐的精度，在此基础上适当地考虑时间多样性。在实际应用中需要通过多次的实验才能知道什么程度的时间多样性对系统是最好的。</p>
<h3 id="时间上下文推荐算法"><a class="header" href="#时间上下文推荐算法">时间上下文推荐算法</a></h3>
<p>上一节介绍了很多时间效应，本节主要讨论如何将这些时间效应应用到系统中。建模时间信息有很多方法，本节将分别介绍不同的方法，并通过实验对比这些方法。</p>
<ol>
<li>最近最热门</li>
<li>时间上下文相关的ItemCF算法  基于物品（item-based）的个性化推荐算法是商用推荐系统中应用最广泛的，从前面几章的讨论可以看到，该算法由两个核心部分构成：利用用户行为离线计算物品之间的相似度；根据用户的历史行为和物品相似度矩阵，给用户做在线个性化推荐。</li>
<li>时间上下文相关的UserCF算法   和ItemCF算法一样，UserCF算法同样可以利用时间信息提高预测的准确率。首先，回顾一下前面关于UserCF算法的基本思想：给用户推荐和他兴趣相似的其他用户喜欢的物品。</li>
</ol>
<h3 id="时间段图模型"><a class="header" href="#时间段图模型">时间段图模型</a></h3>
<p>基于图的模型在前面几章中得到了广泛应用。在时变个性化推荐系统中，它依然得到了广泛应用。我们在KDD会议上曾经提出过一个时间段图模型，试图解决如何将时间信息建模到图模型中的方法，最终取得了不错的效果。</p>
<h3 id="离线实验"><a class="header" href="#离线实验">离线实验</a></h3>
<p>为了证明时间上下文信息对推荐系统至关重要，本节将利用离线实验对比使用时间信息后不同推荐算法的离线性能。</p>
<h2 id="地点上下文信息"><a class="header" href="#地点上下文信息">地点上下文信息</a></h2>
<p>除了时间，地点作为一种重要的空间特征，也是一种重要的上下文信息。不同地区的用户兴趣有所不同，用户到了不同的地方，兴趣也会有所不同。在中关村逛街逛累了，希望寻找美食时，你可能会考虑几个因素，包括距离、价位、口味和口碑，而在这些因素里，最重要的因素可能是距离。</p>
<p>明尼苏达大学的研究人员提出过一个称为LARS（Location Aware Recommender System,位置感知推荐系统）的和用户地点相关的推荐系统。该系统首先将物品分成两类，一类是有空间属性的，比如餐馆、商店、旅游景点等，另一类是无空间属性的物品，比如图书和电影等。同时，它将用户也分成两类，一类是有空间属性的，比如给出了用户现在的地址（国家、城市、邮编等），另一类用户并没有相关的空间属性信息。</p>
<h2 id="扩展阅读-1"><a class="header" href="#扩展阅读-1">扩展阅读</a></h2>
<p>时间上下文信息在Netflix Prize中得到了广泛关注，很多参赛者都研究了如何利用这一信息。这方面最著名的文章无疑是Koren的“collaborative filtering with temporal dynamics”，该文系统地总结了各种使用时间信息的方式，包括考虑用户近期行为的影响，考虑时间的周期性等。</p>
<p>英国剑桥大学的Neal Lathia在读博士期间对时间上下文信息以及推荐系统的时间效应进行了深入研究。他在“Temporal Diversity in Recommender Systems”一文中深入分析了时间多样性对推荐系统的影响。他的博士论文“Evaluating  Collaborative  Filtering  Over  Time”论述了各种不同推荐算法是如何随时间演化的。</p>
<p>如果要系统地研究与上下文推荐相关的工作，可以参考Alexander  Tuzhili教授的工作（http://pages.stern.nyu.edu/~atuzhili/），他在最近几年和学生对上下文推荐问题进行了深入研究。</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="利用社交网络数据"><a class="header" href="#利用社交网络数据">利用社交网络数据</a></h1>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E8%8E%B7%E5%8F%96%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E7%9A%84%E9%80%94%E5%BE%84">获取社交网络数据的途径</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E7%AE%80%E4%BB%8B">社交网络数据简介</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E7%9A%84%E6%8E%A8%E8%8D%90">基于社交网络的推荐</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E9%82%BB%E5%9F%9F%E7%9A%84%E7%A4%BE%E4%BC%9A%E5%8C%96%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95">基于邻域的社会化推荐算法</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E5%9B%BE%E7%9A%84%E7%A4%BE%E4%BC%9A%E5%8C%96%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95">基于图的社会化推荐算法</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E5%AE%9E%E9%99%85%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E7%A4%BE%E4%BC%9A%E5%8C%96%E6%8E%A8%E8%8D%90">实际系统中的社会化推荐</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E7%A4%BE%E4%BC%9A%E5%8C%96%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%92%8C%E5%8D%8F%E5%90%8C%E8%BF%87%E6%BB%A4%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F">社会化推荐系统和协同过滤推荐系统</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90">信息流推荐</a></li>
</ul>
</li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E7%BB%99%E7%94%A8%E6%88%B7%E6%8E%A8%E8%8D%90%E5%A5%BD%E5%8F%8B">给用户推荐好友</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AE%B9%E7%9A%84%E5%8C%B9%E9%85%8D">基于内容的匹配</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E5%85%B1%E5%90%8C%E5%85%B4%E8%B6%A3%E7%9A%84%E5%A5%BD%E5%8F%8B%E6%8E%A8%E8%8D%90">基于共同兴趣的好友推荐</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E5%9B%BE%E7%9A%84%E5%A5%BD%E5%8F%8B%E6%8E%A8%E8%8D%90">基于社交网络图的好友推荐</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E5%9F%BA%E4%BA%8E%E7%94%A8%E6%88%B7%E8%B0%83%E6%9F%A5%E7%9A%84%E5%A5%BD%E5%8F%8B%E6%8E%A8%E8%8D%90%E7%AE%97%E6%B3%95%E5%AF%B9%E6%AF%94">基于用户调查的好友推荐算法对比</a></li>
</ul>
</li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E5%88%A9%E7%94%A8%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE.html#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB">扩展阅读</a></li>
</ul>
<p>自从搜索引擎谷歌诞生后，大家都在讨论互联网的下一个金矿是什么。现在，几乎所有的人都认为那就是社交网络。根据尼尔森2010年的报告，用户在互联网上22%的时间花费在社交网站和社交媒体上。Facebook和Twitter作为两种不同类型社交网络的代表，是目前互联网界的宠儿。谷歌公司也不甘落后，连续推出了很多社交网络产品（Buzz和Google  Plus）。国内的互联网以新浪微博为代表，也吸引了很多人的眼球。</p>
<p>基于社交网络的推荐可以很好地模拟现实社会。在现实社会中，很多时候我们都是通过朋友获得推荐。美国著名的第三方调查机构尼尔森调查了影响用户相信某个推荐的因素。调查结果显示，90%的用户相信朋友对他们的推荐，70%的用户相信网上其他用户对广告商品的评论。从该调查可以看到，好友的推荐对于增加用户对推荐结果的信任度非常重要。</p>
<p>为了进一步证实好友推荐对用户的影响，尼尔森和Facebook合作进行了一次个性化广告实验。尼尔森测试了同一个品牌的3种不同形式的广告。第一种广告和第二种广告都是图片广告，但两者的推荐理由不同。第一种广告的推荐理由没有社会化信息，仅仅是表示该品牌受到了51  930个用户的关注，而第二种广告的推荐理由是用户的某些好友关注了这个广告。第三种广告比较特别，它是在用户的好友关注该品牌时，就在用户的信息流中加入一条信息，告诉用户他的某个好友关注了一个品牌。通过在线AB测试，尼尔森发现第三种广告的效果明显高于第二种，而第二种广告的效果明显高于第一种，从而证明了社会化推荐对于增加用户对广告的印象和购买意愿具有非常强烈的作用。同时，该实验也从侧面说明社交网络在推荐系统中可能具有重要的作用。</p>
<p>本章将详细讨论如何利用社交网络数据给用户进行个性化推荐。本章不仅讨论如何利用社交网络给用户推荐物品，而且将讨论如何利用社交网络给用户推荐好友。</p>
<h2 id="获取社交网络数据的途径"><a class="header" href="#获取社交网络数据的途径">获取社交网络数据的途径</a></h2>
<p>现在互联网上充斥着各种各样带有社交性质的网站。那么，从什么方面可以获得社交网络数据呢？一般来说，有如下方式。</p>
<ol>
<li>电子邮件</li>
<li>用户注册信息</li>
<li>用户的位置数据</li>
<li>论坛和讨论组</li>
<li>即时聊天工具</li>
<li>社交网络</li>
</ol>
<p>上述各种获取用户社交关系的途径，要么就是因为隐私问题很难获取，要么就是虽然容易获取，但却都是隐性社交关系数据，很难推断出用户之间的显性社交关系。在Facebook和Twitter诞生之前，社会化应用（无论是电子邮件系统还是即时聊天系统）都过于封闭。用户只能和自己的好友进行交流，而无法了解到好友圈以外的世界，而且用户之间交流的内容都是非常私密的，大部分用户不会允许将它们公开来用作其他用途。</p>
<p>但以Facebook和Twitter为代表的新一代社交网络突破了这个瓶颈。它们允许用户创建一个公开的页面介绍自己，并且默认公开用户的好友列表（当然用户可以指定不将某些好友公开，但如果用户不指定，默认是公开的），而用户基于它们讨论的话题也很少涉及个人隐私，大都是讨论一些社会热点或分享一些图片、音乐、视频和笑话。</p>
<p>社交网站的另一个好处是自然地减轻了信息过载问题。在社交网站中，我们可以通过好友给自己过滤信息。比如，我们只关注那些和我们兴趣相似的好友，只阅读他们分享的信息，因此可以避免阅读很多和自己无关的信息。个性化推荐系统可以利用社交网站公开的用户社交网络和行为数据，辅助用户更好地完成信息过滤的任务，更好地找到和自己兴趣相似的好友，更快地找到自己感兴趣的内容。</p>
<ol>
<li>社会图谱和兴趣图谱</li>
</ol>
<p>Facebook和Twitter作为社交网站中的两个代表，它们其实代表了不同的社交网络结构。在Facebook里，人们的好友一般都是自己在现实社会中认识的人，比如亲戚、同学、同事等，而且Facebook中的好友关系是需要双方确认的。在Twitter里，人们的好友往往都是现实中自己不认识的，而只是出于对对方言论的兴趣而建立好友关系，好友关系也是单向的关注关系。以Facebook为代表的社交网络称为社交图谱（social  graph），而以Twitter为代表的社交网络称为兴趣图谱（interest graph）。</p>
<p>关于这两种社交网络的分类其实早在19世纪就被社会学家研究过了。19世纪，德国社会学家斐迪南·滕尼斯（Ferdinand  Tönnies）认为社会群体分为两种，一种是通过人们之间的共同兴趣和信念形成的，他将这种社会群体称为Gemeinschaft，而Gemeinschaft这个词后来被翻译成英语就是community，即汉语中的社区。另一种社会群体则是由于人们之间的亲属关系，工作关系而形成的，他称之为Gesellschaft，英文翻译为society，即汉语中的“社会”。因此，斐迪南·滕尼斯说的Gemeinschaft就是兴趣图谱，而Gesellschaft就是社会图谱。但是，每个社会化网站都不是单纯的社交图谱或者兴趣图谱。一般认为，Facebook中的绝大多数用户联系基于社交图谱，而Twitter中的绝大多数用户联系基于兴趣图谱。</p>
<p>但是，在Twitter或者微博中，我们也会关注现实中的亲朋好友，在Facebook中我们也会和一部分好友有同样的兴趣。</p>
<h2 id="社交网络数据简介"><a class="header" href="#社交网络数据简介">社交网络数据简介</a></h2>
<p>社交网络定义了用户之间的联系，因此可以用图定义社交网络。我们用图<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span>定义一个社交网络，其中V是顶点集合，每个顶点代表一个用户，E是边集合，如果用户va和vb有社交网络关系，那么就有一条边<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>连接这两个用户，而<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>定义了边的权重。业界有两种著名的社交网络。一种以Facebook为代表，它的朋友关系是需要双向确认的，因此在这种社交网络上可以用无向边连接有社交网络关系的用户。另一种以Twitter为代表，它的朋友关系是单向的，因此可以用有向边代表这种社交网络上的用户关系。</p>
<p>此外，对图G中的用户顶点u，定义out(u)为顶点u指向的顶点集合（如果套用微博中的术语，out(u)就是用户u关注的用户集合），定义in(u)为指向顶点u的顶点集合（也就是关注用户u的用户集合）。那么，在Facebook这种无向社交网络中显然有out(u)=in(u)。</p>
<p>一般来说，有3种不同的社交网络数据。</p>
<p>双向确认的社交网络数据 在以Facebook和人人网为代表的社交网络中，用户A和B之间形成好友关系需要通过双方的确认。因此，这种社交网络一般可以通过无向图表示。</p>
<p>单向关注的社交网络数据 在以Twitter和新浪微博为代表的社交网络中，用户A可以关注用户B而不需要得到用户B的允许，因此这种社交网络中的用户关系是单向的，可以通过有向图表示。</p>
<p>基于社区的社交网络数据  还有一种社交网络数据，用户之间并没有明确的关系，但是这种数据包含了用户属于不同社区的数据。比如豆瓣小组，属于同一个小组可能代表了用户兴趣的相似性。或者在论文数据集中，同一篇文章的不同作者也存在着一定的社交关系。或者是在同一家公司工作的人，或是同一个学校毕业的人等。</p>
<p>社交网络数据中的长尾分布</p>
<p>和前面第2章提到的用户活跃度分布和物品流行度分布类似，社交网络中用户的入度（in degree）和出度（out degree）的分布也是满足长尾分布的。</p>
<h2 id="基于社交网络的推荐"><a class="header" href="#基于社交网络的推荐">基于社交网络的推荐</a></h2>
<p>很多网站都利用Facebook的社交网络数据给用户提供社会化推荐。</p>
<p>社会化推荐之所以受到很多网站的重视，是缘于如下优点。</p>
<p>好友推荐可以增加推荐的信任度  好友往往是用户最信任的。用户往往不一定信任计算机的智能，但会信任好朋友的推荐。同样是给用户推荐《天龙八部》，前面提到的基于物品的协同过滤算法会说是因为用户之前看过《射雕英雄传》，而好友推荐会说是因为用户有8个好友都非常喜欢《天龙八部》。对比这两种解释，第二种解释一般能让用户更加心动，从而购买或者观看《天龙八部》。</p>
<p>社交网络可以解决冷启动问题  当一个新用户通过微博或者Facebook账号登录网站时，我们可以从社交网站中获取用户的好友列表，然后给用户推荐好友在网站上喜欢的物品。从而我们可以在没有用户行为记录时就给用户提供较高质量的推荐结果，部分解决了推荐系统的冷启动问题。</p>
<p>当然，社会化推荐也有一些缺点，其中最主要的就是很多时候并不一定能提高推荐算法的离线精度（准确率和召回率）。特别是在基于社交图谱数据的推荐系统中，因为用户的好友关系不是基于共同兴趣产生的，所以用户好友的兴趣往往和用户的兴趣并不一致。比如，我们和自己父母的兴趣往往就差别很大。不过，因为社会化推荐算法不一定能提供离线精度，而且包含社交网络数据和用户行为数据的数据集不太多，因此本章不准备通过离线实验证明社会化推荐的优势。2</p>
<p>010年，ACM推荐系统大会的一个讨论组CAMRa曾经举办过一个关于社交网络的推荐系统比赛。该比赛希望参赛者能够利用用户之间的好友关系给用户推荐电影，并且利用准确率相关的指标评测参赛者的推荐算法。对社会化推荐感兴趣的读者可以关注一下该会议的相关论文。</p>
<h3 id="基于邻域的社会化推荐算法"><a class="header" href="#基于邻域的社会化推荐算法">基于邻域的社会化推荐算法</a></h3>
<p>如果给定一个社交网络和一份用户行为数据集。其中社交网络定义了用户之间的好友关系，而用户行为数据集定义了不同用户的历史行为和兴趣数据。那么我们想到的最简单算法是给用户推荐好友喜欢的物品集合。</p>
<h3 id="基于图的社会化推荐算法"><a class="header" href="#基于图的社会化推荐算法">基于图的社会化推荐算法</a></h3>
<p>前几章都提到了如何在推荐系统中使用图模型，比如用户物品二分图、用户-物品-标签图模型等。从前面几章的介绍可以看到，图模型的优点是可以将各种数据和关系都表示到图上去。在社交网站中存在两种关系，一种是用户对物品的兴趣关系，一种是用户之间的社交网络关系。本节主要讨论如何将这两种关系建立到图模型中，从而实现对用户的个性化推荐。</p>
<p>用户的社交网络可以表示为社交网络图，用户对物品的行为可以表示为用户物品二分图，而这两种图可以结合成一个图。</p>
<h3 id="实际系统中的社会化推荐"><a class="header" href="#实际系统中的社会化推荐">实际系统中的社会化推荐</a></h3>
<p>前面提到的基于邻域的社会化推荐算法看起来非常简单，但在实际系统中却是很难操作的，这主要是因为该算法需要拿到用户所有好友的历史行为数据，而这一操作在实际系统中是比较重的操作。因为大型网站中用户数目非常庞大，用户的历史行为记录也非常庞大，所以不太可能将用户的所有行为都缓存在内存中，只能在数据库前做一个热数据的缓存。而如果我们需要比较实时的数据，这个缓存中的数据就要比较频繁地更新，因而避免不了数据库的查询。我们知道，数据库查询一般是很慢的，特别是针对行为很多的用户更是如此。所以，如果一个算法再给一个用户做推荐时，需要他所有好友的历史行为数据，这在实际环境中是比较困难的。</p>
<p>如果回想一下ItemCF可以发现，ItemCF算法只需要当前用户的历史行为数据和物品的相关表就可以生成推荐结果。对于物品数不是特别多的网站，可以很容易地将物品相关表缓存在内存中，因此查询相关物品的代价很低，所以ItemCF算法很容易在实际环境下实现。</p>
<p>当然，我们可以从几个方面改进基于邻域的社会化推荐算法，让它能够具有比较快的响应时间。改进的方向有两种，一种是治标不治本的方法。简单地说，就是可以做两处截断。第一处截断就是在拿用户好友集合时并不拿出用户所有的好友，而是只拿出和用户相似度最高的N个好友。这里N可以取一个比较小的数。从而给该用户做推荐时可以只查询N次用户历史行为接口。此外，在查询每个用户的历史行为时，可以只返回用户最近1个月的行为，这样就可以在用户行为缓存中缓存更多用户的历史行为数据，从而加快查询用户历史行为接口的速度。此外，还可以牺牲一定的实时性，降低缓存中用户行为列表过期的频率。</p>
<p>而第二种解决方案需要重新设计数据库。通过前面的分析可以发现，社会化推荐中关键的操作就是拿到用户所有好友的行为数据，然后通过一定的聚合展示给用户。如果对照一下微博，我们就可以发现微博中每个用户都有一个信息墙，这个墙上实时展示着用户关注的所有好友的动态。因此，如果能够实现这个信息墙，就能够实现社会化推荐算法。Twitter的解决方案是给每个用户维护一个消息队列（message queue），当一个用户发表一条微博时，所有关注他的用户的消息队列中都会加入这条微博。这个实现的优点是用户获取信息墙时可以直接读消息队列，所以终端用户的读操作很快。不过这个实现也有缺点，当一个用户发表了一条微博，就会触发很多写操作，因为要更新所有关注他的用户的消息队列，特别是当一个人被很多人关注时，就会有大量的写操作。Twitter通过大量的缓存解决了这一问题。具体的细节可以参考InfoQ对Twitter架构的介绍。</p>
<p>如果将Twitter的架构搬到社会化推荐系统中，我们就可以按照如下方式设计系统：</p>
<p>首先，为每个用户维护一个消息队列，用于存储他的推荐列表；</p>
<p>当一个用户喜欢一个物品时，就将（物品ID、用户ID和时间）这条记录写入关注该用户的推荐列表消息队列中；</p>
<p>当用户访问推荐系统时，读出他的推荐列表消息队列，对于这个消息队列中的每个物品，重新计算该物品的权重。计算权重时需要考虑物品在队列中出现的次数，物品对应的用户和当前用户的熟悉程度、物品的时间戳。同时，计算出每个物品被哪些好友喜欢过，用这些好友作为物品的推荐解释。</p>
<h3 id="社会化推荐系统和协同过滤推荐系统"><a class="header" href="#社会化推荐系统和协同过滤推荐系统">社会化推荐系统和协同过滤推荐系统</a></h3>
<p>关于社会化推荐系统的离线评测可以参考Georg Groh和Christian Ehmig的工作成果。不过社会化推荐系统的效果往往很难通过离线实验评测，因为社会化推荐的优势不在于增加预测准确度，而是在于通过用户的好友增加用户对推荐结果的信任度，从而让用户单击那些很冷门的推荐结果。此外，很多社交网站（特别是基于社交图谱的社交网站）中具有好友关系的用户并不一定有相似的兴趣。因此，利用好友关系有时并不能增加离线评测的准确率和召回率。因此，很多研究人员利用用户调查和在线实验的方式评测社会化推荐系统。</p>
<p>对社会化推荐系统进行用户调查的代表性工作成果是Rashmi  Sinha和Kirsten  Swearingen对比社会化推荐系统和协同过滤推荐系统的论文。这一节将简单介绍一下他们的工作方法和结果。</p>
<p>一共有19个人参加了实验，他们都来自加州大学伯克利分校，年龄为20~35岁，其中6名男性13名女性，9名实验人员从事互联网技术相关的工作，而剩下10位从事的工作和互联网技术无关。Sinha首先让他们进行第一项任务：评测3个真实的电影推荐系统（Amazon、MovieCritic、Reel.co）和3个真实的图书推荐系统（Amazon.com、 RatingZone、 Sleeper）。在评测每一个真实推荐系统时，参试者需要按照如下顺序完成实验。</p>
<p>利用一个虚假的邮箱注册推荐系统，从而保证这些新账号没有任何历史行为。</p>
<p>利用新注册的账号给电影、图书进行评分。</p>
<p>查看推荐列表。</p>
<p>如果一开始的推荐列表中没有符合用户兴趣的物品，用户将被要求从该网站中搜索到至少一个令他们感兴趣的物品，如果实在找不到，可以停止搜索。</p>
<p>回答调查问卷。在完成真实推荐系统的评测任务后，参试者还需要评测社会化推荐系统。</p>
<p>实验步骤如下。</p>
<p>每个参试者需要提供3个他们认为了解其兴趣的好友的邮箱。</p>
<p>实验人员给每个好友发邮件，要求他们给参试者推荐3本书和3部电影，并且要求这些书和电影不能是参试者之前和他们讨论过的，即不能是参试者之前告诉他们并表示喜欢的物品。</p>
<p>参试者将会看到好友推荐的书和电影的缩略图以及一段简单的介绍。</p>
<p>回答调查问卷。作者通过分析用户实验的过程和最终回答的调查问卷证明，社会化推荐系统推荐结果的用户满意度明显高于主要基于协同过滤算法的几个真实推荐系统。具体的数据可以参考作者的论文。这里仅引用亚马逊网的图书推荐和好友推荐的结果对比。60%的参试者认为亚马逊网的图书推荐是好的推荐，32%的参试者认为亚马逊网的图书推荐是有用的推荐。与之形成对比的是，90%的参试者认为好友的图书推荐是好的推荐，78%的参试者认为好友的图书推荐是有用的推荐。从这个数据可以看出，好友推荐结果的用户满意度明显高于基于协同过滤的亚马逊推荐系统。</p>
<p>不过作者也承认实验存在一些问题。其中两个主要的问题如下：</p>
<p>不是双盲实验，参试者知道什么结果来自基于协同过滤的推荐系统，什么结果来自好友的推荐；</p>
<p>参试者在实验室中的行为可能和他们平时的真实行为不同。</p>
<p>此外，上述实验结果仅仅来自对19个用户的调查，样本过小。因此，对于上面的结果不要过分解读，还是应该在自己的系统中进行AB测试，得到最为客观的答案。</p>
<h3 id="信息流推荐"><a class="header" href="#信息流推荐">信息流推荐</a></h3>
<p>信息流推荐是社会化推荐领域的新兴话题，它主要针对Twitter和Facebook这两种社交网站。在这两种社交网站中，每个用户都有一个信息墙，展示了用户好友最近的言论。这个信息墙无疑已经是个性化的，但是里面还是夹杂了很多垃圾信息。这主要是因为我们并不关心我们关注的好友的所有言论，而只关心他们的言论中和自己相关的部分。虽然我们在选择关注时已经考虑了关注对象和自己兴趣的相似度，但显然我们无法找到和自己兴趣完全一致的人。因此，信息流的个性化推荐要解决的问题就是如何进一步帮助用户从信息墙上挑选有用的信息。</p>
<p>目前最流行的信息流推荐算法是Facebook的EdgeRank，该算法综合考虑了信息流中每个会话的时间、长度与用户兴趣的相似度。EdgeRank算法比较神秘，没有相关的论文，不过Tech Crun ch曾经公开过它的主要思想。</p>
<p>不过，EdgeRank算法的个性化因素仅仅是好友的熟悉度，它并没有考虑帖子内容和用户兴趣的相似度。所以EdgeRank仅仅考虑了“我”周围用户的社会化兴趣，而没有重视“我”个人的个性化兴趣。为此，GroupLens的研究人员Jilin  Chen深入研究了信息流推荐中社会兴趣和个性化兴趣之间的关系。</p>
<h2 id="给用户推荐好友"><a class="header" href="#给用户推荐好友">给用户推荐好友</a></h2>
<p>好友关系是社会化网站的重要组成部分，如果用户的好友很稀少，就不能体验到社会化的好处。因此好友推荐是社会化网站的重要应用之一。好友推荐系统的目的是根据用户现有的好友、用户的行为记录给用户推荐新的好友，从而增加整个社交网络的稠密程度和社交网站用户的活跃度。由此可以说明，好友推荐模块已经成为社交网站的标准配置之一。</p>
<p>好友推荐算法在社交网络上被称为链接预测（link  prediction）。关于链接预测算法研究的代表文章是Jon Kleinberg的“Link Prediction in Social Network”。该文对各种用户好友关系的预测方法进行了系统地研究和对比。本章我们将介绍其中一些比较直观和简单的算法。</p>
<h3 id="基于内容的匹配"><a class="header" href="#基于内容的匹配">基于内容的匹配</a></h3>
<p>我们可以给用户推荐和他们有相似内容属性的用户作为好友。下面给出了常用的内容属性。</p>
<p>用户人口统计学属性，包括年龄、性别、职业、毕业学校和工作单位等。</p>
<p>用户的兴趣，包括用户喜欢的物品和发布过的言论等。</p>
<p>用户的位置信息，包括用户的住址、IP地址和邮编等。</p>
<p>利用内容信息计算用户的相似度和我们前面讨论的利用内容信息计算物品的相似度类似。</p>
<h3 id="基于共同兴趣的好友推荐"><a class="header" href="#基于共同兴趣的好友推荐">基于共同兴趣的好友推荐</a></h3>
<p>在Twitter和微博为代表的以兴趣图谱为主的社交网络中，用户往往不关心对于一个人是否在现实社会中认识，而只关心是否和他们有共同的兴趣爱好。因此，在这种网站中需要给用户推荐和他有共同兴趣的其他用户作为好友。</p>
<p>我们在前面介绍基于用户的协同过滤算法（UserCF）时已经详细介绍了如何计算用户之间的兴趣相似度，其主要思想就是如果用户喜欢相同的物品，则说明他们具有相似的兴趣。在新浪微博中，可以将微博看做物品，如果两个用户曾经评论或者转发同样的微博，说明他们具有相似的兴趣。在Facebook中，因为有大量用户Like（喜欢）的数据，所以更容易用UserCF算法计算用户的兴趣相似度。关于这方面的算法可以参考第3章。</p>
<p>此外，也可以根据用户在社交网络中的发言提取用户的兴趣标签，来计算用户的兴趣相似度。关于如何分析用户发言的内容、提取文本的关键词、计算文本的相似度，可以参考第4章。</p>
<h3 id="基于社交网络图的好友推荐"><a class="header" href="#基于社交网络图的好友推荐">基于社交网络图的好友推荐</a></h3>
<p>在社交网站中，我们会获得用户之间现有的社交网络图，然后可以基于现有的社交网络给用户推荐新的好友，比如可以给用户推荐好友的好友。</p>
<p>最简单的好友推荐算法是给用户推荐好友的好友。在人人网，我们经常可以通过这个功能找到很多自己的老同学。在刚开始用人人网时，我们只能加入有限的好友，因为我们记住的好友有限。虽然我们只能记住几个同学，但那些同学又能记住几个不同的同学，在这种情况下，我们可以通过朋友的朋友找到更多我们认识的人。</p>
<p>基于好友的好友推荐算法可以用来给用户推荐他们在现实社会中互相熟悉，而在当前社交网络中没有联系的其他用户。</p>
<h3 id="基于用户调查的好友推荐算法对比"><a class="header" href="#基于用户调查的好友推荐算法对比">基于用户调查的好友推荐算法对比</a></h3>
<p>对于前面3节提出的几种不同的好友推荐算法，上一节提到的GroupLen的Jilin Chen也进行了研究。他通过用户调查对比了不同算法的用户满意度，其中算法（这里我们使用了不同的命名）如下。</p>
<p>InterestBased  给用户推荐和他兴趣相似的其他用户作为好友。</p>
<p>SocialBased  基于社交网络给用户推荐他好友的好友作为好友。</p>
<p>Interest+Social 将InterestBased算法推荐的好友和SocialBased算法推荐的好友按照一定权重融合。</p>
<p>SONASONA是IBM内部的推荐算法，该算法利用大量用户信息建立了IBM员工之间的社交网络。这些信息包括所在的部门、共同发表的文章、共同写的Wiki、IBM的内部社交网络信息、共同合作的专利等。</p>
<p>然后，Jilin  Chen在IBM数据的基础上用上述算法建立4种不同的好友推荐系统，然后给每个参加测试的用户提供12个推荐结果，其中每个算法提供了3个推荐结果。也就是说，参试者并不知道每个结果来自哪个算法。然后，Jilin Chen让参试者对每个推荐结果回答以下4个问题。</p>
<p>你是否认识这个人？</p>
<p>你是否觉得这是一个好的推荐结果？</p>
<p>你是否觉得推荐理由能够帮助你决策？</p>
<p>看到这个推荐结果后你决定进行以下哪种行为（单选）：主动和这个人交朋友；希望别人能够向这个人介绍自己；什么也不干。</p>
<p>首先，从结果可以发现，对推荐结果的新颖性不同算法的排名如下：InterestBased &gt; Interest+Social &gt; SocialBased &gt; SONA</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250204115853.png" alt="" /></p>
<p>SONA因为用到了部门信息、共同写论文和发表专利的信息，所以推荐的好友大部分都是用户认识的，因此新颖度不高。</p>
<p>其次，结果表明如果用户认识推荐结果中的人，那么绝大部分用户都会觉得这是一个好的推荐结果，而如果用户不认识推荐结果中的人，绝大多数人都觉得推荐结果不好。</p>
<p>从用户认为推荐结果是否好的比例看，不同算法的排名如下：SONA &gt; SocialBased &gt; Interest+Social &gt; InterestBased</p>
<p>SONA排名不高是因为它综合了更多的信息。</p>
<h2 id="扩展阅读-2"><a class="header" href="#扩展阅读-2">扩展阅读</a></h2>
<p>社交网络分析的研究已经有很悠久的历史了。其中关于社交网络最让人耳熟能详的结论就是六度原理。六度原理讲的是社会中任意两个人都可以通过不超过6个人的路径相互认识，如果转化为图的术语，就是社交网络图的直径为6。不过喜欢刨根问底的读者一定好奇六度原理的正确性。六度原理在均匀随机图上已经得到了完美证明，对此感兴趣的读者可以参考Random Graph一书。很多对社交网络的研究都是基于随机图理论的，因此深入研究社交网络必须掌握随机图理论的相关知识。</p>
<p>社交网络研究中有两个最著名的问题。第一个是如何度量人的重要性，也就是社交网络顶点的中心度（centrality），第二个问题是如何度量社交网络中人和人之间的关系，也就是链接预测。这两个问题的研究都有着深刻的实际意义，因此得到了业界和学术界的广泛关注。对这两个问题感兴趣的读者可以参考社交网络分析方面的书。</p>
<p>对于基于社交网络的推荐算法，因为数据集的限制，最早的研究都是基于Epinion的用户信任网络的。Ma Hao在Epinion数据集上提出了很多基于矩阵分解的社会化推荐算法用来解决评分预测问题，其主要思想是在矩阵分解模型中加入正则化项，让具有社交关系的用户的隐语义向量具有比较高的相似度。</p>
<p>ACM推荐系统大会在2010年曾经举办过一个社会化推荐比赛，该比赛将社交网络看做一种上下文，希望参赛者能够利用社交网络信息提高推荐系统的性能。关注社交化推荐的读者可以关注一下该比赛最后发出的论文集。</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="推荐系统实例"><a class="header" href="#推荐系统实例">推荐系统实例</a></h1>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E4%BE%8B.html#%E5%A4%96%E5%9B%B4%E6%9E%B6%E6%9E%84">外围架构</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E4%BE%8B.html#%E6%95%B0%E6%8D%AE%E6%94%B6%E9%9B%86%E5%92%8C%E5%AD%98%E5%82%A8">数据收集和存储</a></li>
</ul>
</li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E4%BE%8B.html#%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84">推荐系统架构</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E4%BE%8B.html#%E6%8E%A8%E8%8D%90%E5%BC%95%E6%93%8E%E7%9A%84%E6%9E%B6%E6%9E%84">推荐引擎的架构</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E4%BE%8B.html#%E7%94%9F%E6%88%90%E7%94%A8%E6%88%B7%E7%89%B9%E5%BE%81%E5%90%91%E9%87%8F">生成用户特征向量</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E4%BE%8B.html#%E7%89%B9%E5%BE%81%E7%89%A9%E5%93%81%E7%9B%B8%E5%85%B3%E6%8E%A8%E8%8D%90">特征—物品相关推荐</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E4%BE%8B.html#%E8%BF%87%E6%BB%A4%E6%A8%A1%E5%9D%97">过滤模块</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E4%BE%8B.html#%E6%8E%92%E5%90%8D%E6%A8%A1%E5%9D%97">排名模块</a></li>
</ul>
</li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E4%BE%8B.html#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB">扩展阅读</a></li>
</ul>
<p>前面几章介绍了各种各样的数据和基于这些数据的推荐算法。在实际系统中，前面几章提到的数据大都存在，因此如何设计一个真实的推荐系统处理不同的数据，根据不同的数据设计算法，并将这些算法融合到一个系统当中是本章讨论的主要问题。本章将首先介绍推荐系统的外围架构，然后介绍推荐系统的架构，并对架构中每个模块的设计进行深入讨论。</p>
<h2 id="外围架构"><a class="header" href="#外围架构">外围架构</a></h2>
<p>这一节主要讨论推荐系统是如何和网站的其他系统接口的。下图表示了推荐系统和网站其他系统的关系。一般来说，每个网站都会有一个UI系统，UI系统负责给用户展示网页并和用户交互。网站会通过日志系统将用户在UI上的各种各样的行为记录到用户行为日志中。日志可能存储在内存缓存里，也可能存储在数据库中，也可能存储在文件系统中。而推荐系统通过分析用户的行为日志，给用户生成推荐列表，最终展示到网站的界面上。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250204121027.png" alt="" /></p>
<p>从上面的结构可以看到，推荐系统要发挥强大的作用，除了推荐系统本身，主要还依赖于两个条件——界面展示和用户行为数据。关于如何设计推荐系统的界面，笔者没有太多的发言权。不过，如果我们看看目前流行的推荐系统界面，可以看到这些界面都有一些共性。</p>
<p>通过一定方式展示物品，主要包括物品的标题、缩略图和介绍等。</p>
<p>很多推荐界面都提供了推荐理由，理由可以增加用户对推荐结果的信任度。</p>
<p>推荐界面还需要提供一些按钮让用户对推荐结果进行反馈，这样才能让推荐算法不断改善用户的个性化推荐体验。</p>
<p>在设计推荐界面时，我们可以综合考虑其他网站的设计并结合自己网站的特点。</p>
<p>下面着重讨论如何收集和存储用户数据。</p>
<h3 id="数据收集和存储"><a class="header" href="#数据收集和存储">数据收集和存储</a></h3>
<p>个性化推荐算法依赖于用户行为数据，而在任何一个网站中都存在着各种各样的用户行为数据。那么如何存取这些数据就是推荐系统需要解决的首要问题。表7-1展示了一个假想的电子商务网站上的典型用户行为数据。如表所示，从产生行为的用户角度看，有些行为是只有注册用户才能产生的，而有些行为是所有用户都可以产生的。从规模上看，浏览网页、搜索记录的规模都很大，因为这种行为所有用户都能产生，而且平均每个用户都会产生很多这些行为。购买、收藏行为规模中等，因为只有注册用户才能产生这种行为，但购买行为又是电商网站的主要行为，所以它们相对于评论来说规模更大，但相对于网页浏览行为来说规模要小得多，最后剩下的行为是注册用户里的一小部分人才有的，所以规模不会很大。从实时存取的角度上看，购买、收藏、评论、评分、分享等行为都是需要实时存取的，因为只要用户有了这些行为，界面上就需要体现出来，比如用户购买了商品后，用户的个人购买列表中就应立即显示用户购买的商品。而有些行为，比如浏览网页的行为和搜索行为并不需要实时存取。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250204121204.png" alt="" /></p>
<p>按照前面数据的规模和是否需要实时存取，不同的行为数据将被存储在不同的媒介中。一般来说，需要实时存取的数据存储在数据库和缓存中，而大规模的非实时地存取数据存储在分布式文件系统（如HDFS）中。</p>
<p>数据能否实时存取在推荐系统中非常重要，因为推荐系统的实时性主要依赖于能否实时拿到用户的新行为。只有快速拿到大量用户的新行为，推荐系统才能够实时地适应用户当前的需求，给用户进行实时推荐。</p>
<h2 id="推荐系统架构"><a class="header" href="#推荐系统架构">推荐系统架构</a></h2>
<p>前面提到推荐系统是联系用户和物品的媒介，而推荐系统联系用户和物品的方式主要有3种 。如果将这3种方式都抽象一下就可以发现，如果认为用户喜欢的物品也是一种用户特征，或者和用户兴趣相似的其他用户也是一种用户特征，那么用户就和物品通过特征相联系。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250204121351.png" alt="" /></p>
<p>根据上面的抽象，可以设计一种基于特征的推荐系统架构。如图7-3所示，当用户到来之后，推荐系统需要为用户生成特征，然后对每个特征找到和特征相关的物品，从而最终生成用户的推荐列表。因而，推荐系统的核心任务就被拆解成两部分，一个是如何为给定用户生成特征，另一个是如何根据特征找到物品。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250204164519.png" alt="" /></p>
<p>用户的特征种类非常多，主要包括如下几类。</p>
<p>人口统计学特征  包括用户的年龄、性别、国籍和民族等用户在注册时提供的信息。</p>
<p>用户的行为特征  包括用户浏览过什么物品、收藏过什么物品、给什么物品打过什么样的分数等用户行为相关的特征。同时，用户行为从时间上也可以分为用户近期的行为和长期的行为。</p>
<p>用户的话题特征  可以根据用户的历史行为利用话题模型（topic  model）将电视剧和电影聚合成不同的话题，并且计算出每个用户对什么话题感兴趣。比如用户如果看了《叶问》、《新龙门客栈》和《醉拳》，那么可以认为用户对“香港武侠电影”这个话题感兴趣。</p>
<p>推荐系统的推荐任务也有很多种，如下所示。</p>
<p>将最新加入的物品推荐给用户。</p>
<p>将商业上需要宣传的物品推荐给用户。</p>
<p>给用户推荐不同种类的物品，比如亚马逊会推荐图书、音像、电子产品和服装等。</p>
<p>给用户混合推荐，有时需要将图书和音像制品放到一个推荐列表中展示给用户。</p>
<p>对于不同的产品推荐不同新颖度的物品。比如在首页给用户展示比较热门的推荐结果，在推荐系统页面给用户展示长尾中的物品。</p>
<p>考虑到用户访问推荐系统的上下文，比如当你在豆瓣音乐找到“李宗盛”时，右侧会有一个链接告诉你可以在豆瓣电台收听“李宗盛”。单击了这个链接后，豆瓣电台给你推荐的音乐就考虑了“李宗盛”这个上下文。</p>
<p>如果要在一个系统中把上面提到的各种特征和任务都统筹考虑，那么系统将会非常复杂，而且很难通过配置文件方便地配置不同特征和任务的权重。因此，推荐系统需要由多个推荐引擎组成，每个推荐引擎负责一类特征和一种任务，而推荐系统的任务只是将推荐引擎的结果按照一定权重或者优先级合并、排序然后返回。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250204164928.png" alt="" /></p>
<p>这样做还有两个好处。</p>
<p>可以方便地增加/删除引擎，控制不同引擎对推荐结果的影响。对于绝大多数需求，只需要通过不同的引擎组合实现。</p>
<p>可以实现推荐引擎级别的用户反馈。每一个推荐引擎其实代表了一种推荐策略，而不同的用户可能喜欢不同的推荐策略。有些用户可能喜欢利用他的年龄性别作出的推荐，有些用户可能比较喜欢看到新加入的和他兴趣相关的视频，有些用户喜欢比较新颖的推荐，有些用户喜欢专注于一个邻域的推荐，有些用户喜欢多样的推荐。我们可以将每一种策略都设计成一个推荐引擎，然后通过分析用户对推荐结果的反馈了解用户比较喜欢哪些引擎推荐出来的结果，从而对不同的用户给出不同的引擎组合权重。</p>
<p>将推荐系统拆分成不同推荐引擎后，如何设计一个推荐引擎变成了推荐系统设计的核心部分。下一节将讨论推荐引擎的设计方法。</p>
<h2 id="推荐引擎的架构"><a class="header" href="#推荐引擎的架构">推荐引擎的架构</a></h2>
<p>上一节提到，推荐引擎使用一种或几种用户特征，按照一种推荐策略生成一种类型物品的推荐列表。图7-9展示了每个具体推荐引擎的架构。</p>
<p>如图7-9所示，推荐引擎架构主要包括3部分。</p>
<p>该部分负责从数据库或者缓存中拿到用户行为数据，通过分析不同行为，生成当前用户的特征向量。不过如果是使用非行为特征，就不需要使用行为提取和分析模块了。该模块的输出是用户特征向量。</p>
<p>该部分负责将用户的特征向量通过特征-物品相关矩阵转化为初始推荐物品列表。</p>
<p>该部分负责对初始的推荐列表进行过滤、排名等处理，从而生成最终的推荐结果。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250204165537.png" alt="" /></p>
<p>下面一节将对各个不同的部分分别详细解释。</p>
<h3 id="生成用户特征向量"><a class="header" href="#生成用户特征向量">生成用户特征向量</a></h3>
<p>一般来说，用户的特征包括两种，一种是用户的注册信息中可以提取出来的，主要包括用户的人口统计学特征。对于使用这种特征的推荐引擎，如果内存够，可以将存储这些特征的信息直接缓存在内存中，在推荐时直接拿到用户的特征数据并生成特征向量。除了这种特征，另一种特征主要是从用户的行为中计算出来的，本节着重讨论如何生成特征。</p>
<p>一个特征向量由特征以及特征的权重组成，在利用用户行为计算特征向量时需要考虑以下因素。</p>
<p>用户行为的种类  在一个网站中，用户可以对物品产生很多不同种类的行为。用户可以浏览物品、单击物品的链接、收藏物品、给物品打分、购买物品、评论物品、给物品打上不同的标签、和好友分享物品、搜索不同的关键词等。这些行为都会对物品特征的权重产生影响，但不同行为的影响不同，大多时候很难确定什么行为更加重要，一般的标准就是用户付出代价越大的行为权重越高。比如，购买物品需要用户掏钱，所以用户一定会三思而后行，因此购买行为最为重要。相反，浏览物品的网页代价很小，所以这种行为对反映用户的真实兴趣的影响很小。</p>
<p>用户行为产生的时间  一般来说，用户近期的行为比较重要，而用户很久之前的行为相对比较次要。因此，如果用户最近购买过某一个物品，那么这个物品对应的特征将会具有比较高的权重。</p>
<p>用户行为的次数  有时用户对一个物品会产生很多次行为。比如用户会听一首歌很多次，看一部电视剧的很多集等。因此用户对同一个物品的同一种行为发生的次数也反映了用户对物品的兴趣，行为次数多的物品对应的特征权重越高。</p>
<p>物品的热门程度 如果用户对一个很热门的物品产生了行为，往往不能代表用户的个性，因为用户可能是在跟风，可能对该物品并没有太大兴趣，特别是在用户对一个热门物品产生了偶尔几次不重要的行为（比如浏览行为）时，就更说明用户对这个物品可能没有什么兴趣，可能只是因为这个物品的链接到处都是，很容易点到而已。反之，如果用户对一个不热门的物品产生了行为，就说明了用户的个性需求。因此，推荐引擎在生成用户特征时会加重不热门物品对应的特征的权重。</p>
<h3 id="特征物品相关推荐"><a class="header" href="#特征物品相关推荐">特征—物品相关推荐</a></h3>
<p>在得到用户的特征向量后，我们可以根据离线的相关表得到初始的物品推荐列表。</p>
<p>对于每个特征，我们可以在相关表中存储和它最相关的N个物品的ID。</p>
<p>在线使用的特征物品相关表一般都不止一张。以论文之间的相关表为例，计算论文之间的相关性既可以使用第3章提出的协同过滤算法（即如果两篇论文的读者重合度很大说明两部电视剧相似），也可以通过内容计算（比如有相同的作者、关键词、相似的标题等）。即使是协同过滤，也可以根据不同的用户行为数据得到不同的相关表。比如可以根据用户的打分行为计算论文之间的相关性，也可以根据用户的浏览行为计算论文之间的相关性。总之，对于一个推荐引擎可以在配置文件中配置很多相关表以及它们的权重，而在线服务在启动时会将这些相关表按照配置的权重相加，然后将最终的相关表保存在内存中，而在给用户进行推荐时，用的已经是加权后的相关表了。</p>
<p>从上面的架构图可以看到，特征—物品相关推荐模块还可以接受一个候选物品集合。候选物品集合的目的是保证推荐结果只包含候选物品集合中的物品。它的应用场合一般是产品需求希望将某些类型的电视剧推荐给用户。比如有些产品要求给用户推荐最近一周加入的新物品，那么候选物品集合就包括最近一周新加的物品。</p>
<p>也许有读者会奇怪，为什么不在过滤模块中将候选集合外的电视剧过滤掉，而要在相关推荐模块中处理候选物品列表？这里举一个简单的例子说明原因。首先，一般来说对于协同过滤算法计算出的相关表，每个物品都会倾向于和比较热门的物品具有较高的相似度。那么假设用户购买过物品A，候选列表中包含了物品B，A和B相关，但A比B热门。那么，一般情况下，B在A的相关物品列表中会排在靠后的位置（假设排在第10名），而A在B的相关物品列表中会排在靠前的位置（假设排在第1名）。那么，如果推荐算法是给用户推荐和A最相关的5部电视剧，那么B就不会出现在用户的推荐列表中。但是，如果算法在给定候选列表时会用一种不同的方式进行推荐，比如如果用户看过和A最相关的5部电视剧中的某一部，就将B推荐给用户，那么这种情况下B就出现在推荐列表中了。</p>
<p>一般来说，如果需要在一个小的候选物品集合中给用户推荐物品，那么可以考虑上述方法。但如果是要在一个很大的候选物品集合中给用户推荐物品，那么可以考虑直接在初始推荐列表中过滤掉不在候选物品集合中物品的方法。</p>
<p>特征—物品相关推荐模块除了给用户返回物品推荐列表，还需要给推荐列表中的每个推荐结果产生一个解释列表，表明这个物品是因为哪些特征推荐出来的。下面的代码给出了相关推荐模块的大体工作流程。</p>
<pre><code class="language-python">def RecommendationCore(features, related_table):     
	ret = dict()     
	for fid, fweight in features.items()         
		for item, sim in related_table[fid].items():             
			ret[item].weight += sim * fweight            
			ret[item].reason[fid] = sim * fweight     
		return    ret
</code></pre>
<h3 id="过滤模块"><a class="header" href="#过滤模块">过滤模块</a></h3>
<p>在得到初步的推荐列表后，还不能把这个列表展现给用户，首先需要按照产品需求对结果进行过滤，过滤掉那些不符合要求的物品。一般来说，过滤模块会过滤掉以下物品。</p>
<p>用户已经产生过行为物品  因为推荐系统的目的是帮助用户发现物品，因此没必要给用户推荐他已经知道的物品，这样可以保证推荐结果的新颖性。</p>
<p>候选物品以外的物品  候选物品集合一般有两个来源，一个是产品需求。比如在首页可能要求将新加入的物品推荐给用户，因此需要在过滤模块中过滤掉不满足这一条件的物品。另一个来源是用户自己的选择，比如用户选择了某一个价格区间，只希望看到这个价格区间内的物品，那么过滤模块需要过滤掉不满足用户需求的物品。</p>
<p>某些质量很差的物品  为了提高用户的体验，推荐系统需要给用户推荐质量好的物品，那么对于一些绝大多数用户评论都很差的物品，推荐系统需要过滤掉。这种过滤一般以用户的历史评分为依据，比如过滤掉平均分在2分以下的物品。</p>
<h3 id="排名模块"><a class="header" href="#排名模块">排名模块</a></h3>
<p>经过过滤后的推荐结果直接展示给用户一般也没有问题，但如果对它们进行一些排名，则可以更好地提升用户满意度，一般排名模块需要包括很多不同的子模块，下面将对不同的模块分别加以介绍。</p>
<ol>
<li>新颖性排名</li>
</ol>
<p>新颖性排名模块的目的是给用户尽量推荐他们不知道的、长尾中的物品。虽然前面的过滤模块已经过滤掉了用户曾经有过行为的物品，保证了一定程度的新颖性，但是用户在当前网站对某个物品没有行为并不代表用户不知道这个物品，比如用户可能已经在别的途径知道这个物品了。</p>
<p>要准确了解用户是否已经知道某个物品是非常困难的，因此我们只能通过某种近似的方式知道，比如对推荐结果中热门的物品进行降权。</p>
<p>不过，要实现推荐结果的新颖性，仅仅在最后对热门物品进行降权是不够的，而应在推荐引擎的各个部分考虑新颖性问题。</p>
<ol start="2">
<li>多样性</li>
</ol>
<p>多样性也是推荐系统的重要指标之一。增加多样性可以让推荐结果覆盖尽可能多的用户兴趣。当然，这里需要指出的是提高多样性并不是时时刻刻都很好。比如在个性化网络电台中，因为用户某一固定时刻的兴趣是固定的，所以不希望听到不同曲风的歌曲，尽管这些曲风可能都是用户之前表示喜欢的。不过，本节主要讨论如果要提高多样性，应该怎么提高。</p>
<p>第一种提高多样性的方法是将推荐结果按照某种物品的内容属性分成几类，然后在每个类中都选择该类中排名最高的物品组合成最终的推荐列表。比如，如果是电影，可以按照电影的类别（爱情片、动作片、科幻片等）对推荐结果中的电影分类，然后每种类别都选出几部电影组成最终的推荐结果。</p>
<p>这种方法的好处是比较简单直观，但这种方法也有严重的缺点。首先，选择什么样的内容属性进行分类对结果的影响很大。其次，就算选择了某种类别，但物品是否属于某个类别是编辑确定的，并不一定能够得到用户的公认。比如成龙的电影，有人认为是功夫片，有人认为是喜剧片，不同人看法不一。</p>
<p>因此，第二种提高推荐结果多样性的方法是控制不同推荐结果的推荐理由出现的次数。本章提出的推荐系统对于每个推荐出来的物品都有一个推荐理由，这个推荐理由一般是产生推荐结果的重要特征。那么，要提高推荐结果的多样性，就需要让推荐结果尽量来自不同的特征，具有不同的推荐理由，而不是所有的推荐结果都对应一个理由。</p>
<p>下面的代码根据推荐理由增加推荐结果的多样性，这里输入的recommendations是按照权重从大到小排序的，程序中每次拿出一个推荐结果，如果这个结果已经被用过了，就会对推荐结果的权重除以2降权（这里具体除以几可以在实际应用中自己调整），最终将推荐结果重新按照权重从大到小排序。</p>
<ol start="3">
<li>时间多样性</li>
</ol>
<p>时间多样性主要是为了保证用户不要每天来推荐系统都看到同样的推荐结果。在第5章已经提到，提高推荐系统的时间多样性要从两个地方着手。首先要保证推荐系统的实时性，在用户有新行为时实时调整推荐结果以满足用户最近的需求。这一点，在本章的推荐系统设计中已经考虑到了。如果用户有实时行为发生，那么行为提取和分析模块就能实时拿到行为数据并转化为新的特征，然后经过特征-物品相关模块转换成和新特征最相关的物品，因而推荐列表中就立即反应了用户最新行为的影响。提高推荐结果多样性的第二个方面是要在用户没有新的行为时，也要保证推荐结果每天都有变化。要实现这一点，只能通过如下方式。</p>
<p>记录用户每次登陆推荐系统看到的推荐结果。</p>
<p>将这些结果发回日志系统。这种数据不需要实时存储，只要能保证小于一天的延时就足够了。</p>
<p>在用户登录时拿到用户昨天及之前看过的推荐结果列表，从当前推荐结果中将用户已经看到的推荐结果降权。</p>
<ol start="4">
<li>用户反馈</li>
</ol>
<p>排名模块最重要的部分就是用户反馈模块。用户反馈模块主要通过分析用户之前和推荐结果的交互日志，预测用户会对什么样的推荐结果比较感兴趣。</p>
<p>如果推荐系统的目标是提高用户对推荐结果的点击率，那么可以利用点击模型（click model）预测用户是否会点击推荐结果。点击模型在很多领域得到了广泛应用，比如搜索结果的点击预测、搜索广告的点击预测、上下文广告的点击预测。点击预测的主要问题是预测用户看到某个推荐结果时是否会点击。那么要进行点击率预测，首先需要提取特征。在推荐系统的点击率预测中可以用如下特征预测用户u会不会点击物品i：</p>
<p>用户u相关的特征，比如年龄、性别、活跃程度、之前有没有点击行为；</p>
<p>物品i相关的特征，比如流行度，平均分，内容属性；</p>
<p>物品i在推荐列表中的位置。用户的点击和用户界面的设计有很高的相关性，因此物品i在推荐列表中的位置对预测用户是否点击很重要；</p>
<p>用户之前是否点击过和推荐物品i具有同样推荐解释的其他推荐结果；</p>
<p>用户之前是否点击过和推荐物品i来自同样推荐引擎的其他推荐结果。点击模型需要离线计算好，在线将模型加载到内存中。为了提高在线预测的效率，一般只可以使用线性模型。</p>
<h2 id="扩展阅读-3"><a class="header" href="#扩展阅读-3">扩展阅读</a></h2>
<p>关于推荐系统架构方面的文章很多，不过详细介绍架构的技术报告不多。知名公司亚马逊和Netflix等都只给出了一些简单的线索。本章提到的推荐系统架构主要是基于我在Hulu工作时使用的架构抽象发挥出来的，对于Hulu架构感兴趣的读者可以参考Hulu的技术博客。</p>
<p>MyMedia是一个比较著名的开源推荐系统架构。它是由欧洲研究人员开发的一个推荐系统开源框架。该框架同时支持评分预测和TopN推荐，全面支持各种数据和各种算法，对该项目感兴趣的用户可以访问该项目的网站http://www.mymediaproject.org/default.aspx。</p>
<p>本章提出的推荐系统架构基本上是从基于物品的推荐算法衍生出来的，因此本章的架构并不适合用来解决社会化推荐问题。如果要了解社会化推荐方面的架构，可以参考Twitter公开的一些文档。</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="评分预测问题"><a class="header" href="#评分预测问题">评分预测问题</a></h1>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E8%AF%84%E5%88%86%E9%A2%84%E6%B5%8B%E9%97%AE%E9%A2%98.html#%E7%A6%BB%E7%BA%BF%E5%AE%9E%E9%AA%8C%E6%96%B9%E6%B3%95">离线实验方法</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E8%AF%84%E5%88%86%E9%A2%84%E6%B5%8B%E9%97%AE%E9%A2%98.html#%E8%AF%84%E5%88%86%E9%A2%84%E6%B5%8B%E7%AE%97%E6%B3%95">评分预测算法</a>
<ul>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E8%AF%84%E5%88%86%E9%A2%84%E6%B5%8B%E9%97%AE%E9%A2%98.html#%E5%B9%B3%E5%9D%87%E5%80%BC">平均值</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E8%AF%84%E5%88%86%E9%A2%84%E6%B5%8B%E9%97%AE%E9%A2%98.html#%E5%9F%BA%E4%BA%8E%E9%82%BB%E5%9F%9F%E7%9A%84%E6%96%B9%E6%B3%95">基于邻域的方法</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E8%AF%84%E5%88%86%E9%A2%84%E6%B5%8B%E9%97%AE%E9%A2%98.html#%E9%9A%90%E8%AF%AD%E4%B9%89%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%9F%A9%E9%98%B5%E5%88%86%E8%A7%A3%E6%A8%A1%E5%9E%8B">隐语义模型与矩阵分解模型</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E8%AF%84%E5%88%86%E9%A2%84%E6%B5%8B%E9%97%AE%E9%A2%98.html#%E5%8A%A0%E5%85%A5%E6%97%B6%E9%97%B4%E4%BF%A1%E6%81%AF">加入时间信息</a></li>
<li><a href="%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B5/%E8%AF%84%E5%88%86%E9%A2%84%E6%B5%8B%E9%97%AE%E9%A2%98.html#%E6%A8%A1%E5%9E%8B%E8%9E%8D%E5%90%88">模型融合</a></li>
</ul>
</li>
</ul>
<p>本书到目前为止都是在讨论TopN推荐，即给定一个用户，如何给他生成一个长度为N的推荐列表，使该推荐列表能够尽量满足用户的兴趣和需求。本书之所以如此重视TopN推荐，是因为它非常接近于满足实际系统的需求，实际系统绝大多数情况下就是给用户提供一个包括N个物品的个性化推荐列表。</p>
<p>但是，很多从事推荐系统研究的同学最早接触的却是评分预测问题。从GroupLens到Netflix Prize到Yahoo! Music的KDD Cup，评分预测问题都是推荐系统研究的核心。评分预测问题最基本的数据集就是用户评分数据集。该数据集由用户评分记录组成，每一条评分记录是一个三元组<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span>，表示用户u给物品i赋予了评分r，本章用<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示用户u对物品i的评分。因为用户不可能对所有物品都评分，因此评分预测问题就是如何通过已知的用户历史评分记录预测未知的用户评分记录。表8-1是一个评分预测问题的例子，在该例子中每个用户都对一些电影给出了评分，比如用户A给《虎口脱险》评了1分，给《唐山大兄》评了5分，给《少林足球》评了4分，给《大话西游》评了5分。但是，每个用户都没有对所有电影评分，比如用户A没有给《变形金刚》和《黑客帝国》评分。那么，当用户浏览网页并看到《变形金刚》和《黑客帝国》时，我们希望能够给用户一个分数表明我们认为用户是否会喜欢这部电影，而这个分数也可以帮助用户决策是否要看这部电影，而如何提高这个分数的预测精度就是评分预测要解决的主要问题。</p>
<p>本章将主要讨论评分预测这一推荐领域的经典问题。因为这一问题的研究集中在学术界，所以本章的介绍也比较偏学术，相对前面各章会增加一些公式和理论的讨论。</p>
<h2 id="离线实验方法"><a class="header" href="#离线实验方法">离线实验方法</a></h2>
<p>评分预测问题基本都通过离线实验进行研究。在给定用户评分数据集后，研究人员会将数据集按照一定的方式分成训练集和测试集，然后根据测试集建立用户兴趣模型来预测测试集中的用户评分。</p>
<p>评分预测的目的就是找到最好的模型最小化测试集的RMSE。</p>
<p>关于如何划分训练集和测试集，如果是和时间无关的预测任务，可以以均匀分布随机划分数据集，即对每个用户，随机选择一些评分记录作为测试集，剩下的记录作为测试集。如果是和时间相关的任务，那么需要将用户的旧行为作为训练集，将用户的新行为作为测试集。Netflix通过如下方式划分数据集，首先将每个用户的评分记录按照从早到晚进行排序，然后将用户最后10%的评分记录作为测试集，前90%的评分记录作为训练集。</p>
<h2 id="评分预测算法"><a class="header" href="#评分预测算法">评分预测算法</a></h2>
<p>自从Netflix  Prize大赛以来，不同国家的不同研究人员提出了很多评分预测算法，而Netflix Prize的获胜队伍更是用了上百个不同的模型才取得了最终的成功。本节将从简单到复杂地介绍具有代表性的算法，并给出它们在Netflix数据集上的效果。</p>
<h3 id="平均值"><a class="header" href="#平均值">平均值</a></h3>
<p>最简单的评分预测算法是利用平均值预测用户对物品的评分的。下面各节将分别介绍各种不同的平均值。</p>
<ol>
<li>全局平均值</li>
<li>用户评分平均值</li>
<li>物品评分平均值</li>
<li>用户分类对物品分类的平均值</li>
</ol>
<p>除了这3种特殊的平均值，在用户评分数据上还可以定义很多不同的分类函数。</p>
<p>用户和物品的平均分  对于一个用户，可以计算他的评分平均分。然后将所有用户按照评分平均分从小到大排序，并将用户按照平均分平均分成N类。物品也可以用同样的方式分类。</p>
<p>用户活跃度和物品流行度  对于一个用户，将他评分的物品数量定义为他的活跃度。得到用户活跃度之后，可以将用户通过活跃度从小到大排序，然后平均分为N类。物品的流行度定义为给物品评分的用户数目，物品也可以按照流行度均匀分成N类。</p>
<h3 id="基于邻域的方法"><a class="header" href="#基于邻域的方法">基于邻域的方法</a></h3>
<p>基于用户的邻域算法和基于物品的邻域算法都可以应用到评分预测中。</p>
<p>对于如何计算物品的相似度，Badrul  Sarwar等在论文里做了详细的研究，文章比较了3种主要的相似度。第一种是普通的余弦相似度（cosine similarity），第二种是皮尔逊系数（pearson correlation)，第三种被Sarwar称为修正的余弦相似度（adjust cosine similarity）。</p>
<p>Sarwar利用MovieLens最小的数据集对3种相似度进行了对比，并将MAE作为评测指标。实验结果表明利用修正后的余弦相似度进行评分预测可以获得最优的MAE。不过需要说明的是，在一个数据集上的实验并不意味着在其他数据集上也能获得相同的结果。</p>
<h3 id="隐语义模型与矩阵分解模型"><a class="header" href="#隐语义模型与矩阵分解模型">隐语义模型与矩阵分解模型</a></h3>
<p>最近这几年做机器学习和数据挖掘研究的人经常会看到下面的各种名词，即隐含类别模型（Latent  Class  Model）、隐语义模型（Latent  Factor  Model）、pLSA、LDA、Topic  Model、Matrix Factorization、Factorized Model。</p>
<p>这些名词在本质上应该是同一种思想体系的不同扩展。在推荐系统领域，提的最多的就是潜语义模型和矩阵分解模型。其实，这两个名词说的是一回事，就是如何通过降维的方法将评分矩阵补全。</p>
<p>用户的评分行为可以表示成一个评分矩阵R，其中<code>R[u][i]</code>就是用户u对物品i的评分。但是，用户不会对所有的物品评分，所以这个矩阵里有很多元素都是空的，这些空的元素称为缺失值（missing  value）。因此，评分预测从某种意义上说就是填空，如果一个用户对一个物品没有评过分，那么推荐系统就要预测这个用户是否是否会对这个物品评分以及会评几分。</p>
<ol>
<li>传统的SVD分解</li>
</ol>
<p>对于如何补全一个矩阵，历史上有过很多的研究。一个空的矩阵有很多种补全方法，而我们要找的是一种对矩阵扰动最小的补全方法。那么什么才算是对矩阵扰动最小呢？一般认为，如果补全后矩阵的特征值和补全之前矩阵的特征值相差不大，就算是扰动比较小。所以，最早的矩阵分解模型就是从数学上的SVD（奇异值分解）开始的。</p>
<ol start="2">
<li>Simon Funk的SVD分解</li>
</ol>
<p>正是由于上面的两个缺点，SVD分解算法提出几年后在推荐系统领域都没有得到广泛的关注。直到2006年Netflix  Prize开始后，Simon  Funk在博客上公布了一个算法①（称为Funk-SVD），一下子引爆了学术界对矩阵分解类方法的关注。而且，Simon Funk的博客也成为了很多学术论文经常引用的对象。Simon  Funk提出的矩阵分解方法后来被Netflix  Prize的冠军Koren称为Latent Factor Model（简称为LFM）。</p>
<ol start="3">
<li>加入偏置项后的LFM</li>
<li>考虑邻域影响的LFM</li>
</ol>
<h3 id="加入时间信息"><a class="header" href="#加入时间信息">加入时间信息</a></h3>
<p>无论是MovieLens数据集还是Netflix Prize数据集都包含时间信息，对于用户每次的评分行为，都给出了行为发生的时间。因此，在Netflix Prize比赛期间，很多研究人员提出了利用时间信息降低预测误差的方法。</p>
<p>利用时间信息的方法也主要分成两种，一种是将时间信息应用到基于邻域的模型中，另一种是将时间信息应用到矩阵分解模型中。下面将分别介绍这两种算法。</p>
<ol>
<li>基于邻域的模型融合时间信息</li>
</ol>
<p>因为Netflix Prize数据集中用户数目太大，所以基于用户的邻域模型很少被使用，主要是因为存储用户相似度矩阵非常困难。因此，本节主要讨论如何将时间信息融合到基于物品的邻域模型中。</p>
<p>Netflix  Prize的参赛队伍BigChaos在技术报告中提到了一种融入时间信息的基于邻域的模型，本节将这个模型称为TItemCF。</p>
<ol start="2">
<li>基于矩阵分解的模型融合时间信息</li>
</ol>
<p>在引入时间信息后，用户评分矩阵不再是一个二维矩阵，而是变成了一个三维矩阵。不过， 我们可以仿照分解二维矩阵的方式对三维矩阵进行分解。</p>
<h3 id="模型融合"><a class="header" href="#模型融合">模型融合</a></h3>
<p>Netflix Prize的最终获胜队伍通过融合上百个模型的结果才取得了最终的成功。由此可见模型融合对提高评分预测的精度至关重要。本节讨论模型融合的两种不同技术。</p>
<ol>
<li>模型级联融合</li>
</ol>
<p>由上面的描述可以发现，级联融合很像Adaboost算法。和Adaboost算法类似，该方法每次产生一个新模型，按照一定的参数加到旧模型上去，从而使训练集误差最小化。不同的是，这里每次生成新模型时并不对样本集采样，针对那些预测错的样本，而是每次都还是利用全样本集进行预测，但每次使用的模型都有区别。</p>
<p>一般来说，级联融合的方法都用于简单的预测器，比如前面提到的平均值预测器。</p>
<ol start="2">
<li>模型加权融合</li>
</ol>
<p>最简单的融合算法就是线性融合，即最终的预测器ˆr是这K个预测器的线性加权。</p>
<p>一般来说，评分预测问题的解决需要在训练集上训练K个不同的预测器，然后在测试集上作出预测。但是，如果我们继续在训练集上融合K个预测器，得到线性加权系数，就会造成过拟合的问题。因此，在模型融合时一般采用如下方法。</p>
<p>假设数据集已经被分为了训练集A和测试集B，那么首先需要将训练集A按照相同的分割方法分为A1和A2，其中A2的生成方法和B的生成方法一致，且大小相似。</p>
<p>在A1上训练K个不同的预测器，在A2上作出预测。因为我们知道A2上的真实评分值，所以可以在A2上利用最小二乘法计算出线性融合系数<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<p>在A上训练K个不同的预测器，在B上作出预测，并且将这K个预测器在B上的预测结果按照已经得到的线性融合系数加权融合，以得到最终的预测结果。</p>
<p>除了线性融合，还有很多复杂的融合方法，比如利用人工神经网络的融合算法。其实，模型融合问题就是一个典型的回归问题，因此所有的回归算法都可以用于模型融合。</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="小红书推荐系统"><a class="header" href="#小红书推荐系统">小红书推荐系统</a></h1>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%B0%8F%E7%BA%A2%E4%B9%A6%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F.html#%E8%AF%BE%E7%A8%8B%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90">课程相关资源</a></li>
</ul>
<h2 id="课程相关资源"><a class="header" href="#课程相关资源">课程相关资源</a></h2>
<p>本文为王树森老师《小红书推荐系统公开课》的课程笔记</p>
<ul>
<li>课程来源：<a href="https://space.bilibili.com/1369507485/channel/collectiondetail?sid=615109" title="ShusenWang的个人空间-ShusenWang个人主页-哔哩哔哩视频 (bilibili.com)">ShusenWang的个人空间-ShusenWang个人主页-哔哩哔哩视频 (bilibili.com)</a></li>
<li>课程资料：<a href="https://github.com/wangshusen/RecommenderSystem" title="GitHub - wangshusen/RecommenderSystem">GitHub - wangshusen/RecommenderSystem</a></li>
</ul>
<p><a href="https://blog.csdn.net/qq_43629945/article/details/134109883">【上】王树森《小红书推荐系统公开课》- 课程笔记（推荐系统基础、召回、排序）</a></p>
<p><a href="https://blog.csdn.net/qq_43629945/article/details/138551391">【下】王树森《小红书推荐系统公开课》- 课程笔记（特征交叉、行为序列、重排/推荐系统多样性、物品冷启动、涨指标的方法）</a></p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="推荐系统基础"><a class="header" href="#推荐系统基础">推荐系统基础</a></h1>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">基本概念</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#%E8%BD%AC%E5%8C%96%E6%B5%81%E7%A8%8B">转化流程</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#%E6%B6%88%E8%B4%B9%E6%8C%87%E6%A0%87">消费指标</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#%E5%8C%97%E6%9E%81%E6%98%9F%E6%8C%87%E6%A0%87%E6%9C%80%E5%85%B3%E9%94%AE%E6%8C%87%E6%A0%87">北极星指标（最关键指标）</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#%E5%AE%9E%E9%AA%8C%E6%B5%81%E7%A8%8B">实验流程</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E9%93%BE%E8%B7%AF">推荐系统链路</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E7%9A%84ab%E6%B5%8B%E8%AF%95">推荐系统的AB测试</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#%E9%9A%8F%E6%9C%BA%E5%88%86%E6%A1%B6">随机分桶</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#%E5%88%86%E5%B1%82%E5%AE%9E%E9%AA%8C">分层实验</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#holdout-%E6%9C%BA%E5%88%B6">Holdout 机制</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#%E5%AE%9E%E9%AA%8C%E6%8E%A8%E5%85%A8%E5%8F%8D%E8%BD%AC%E5%AE%9E%E9%AA%8C">实验推全&amp;反转实验</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#%E9%99%84%E5%BD%95ab%E6%B5%8B%E8%AF%95">附录A/B测试</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">1. 基本概念</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#2-%E5%AE%9E%E6%96%BD%E6%AD%A5%E9%AA%A4">2. 实施步骤</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#3-%E4%BC%98%E7%82%B9%E5%92%8C%E7%BC%BA%E7%82%B9">3. 优点和缺点</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80.html#4-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">4. 应用场景</a></li>
</ul>
</li>
</ul>
<h2 id="基本概念"><a class="header" href="#基本概念">基本概念</a></h2>
<h3 id="转化流程"><a class="header" href="#转化流程">转化流程</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250214101705.png" alt="" /></p>
<h3 id="消费指标"><a class="header" href="#消费指标">消费指标</a></h3>
<ul>
<li>点击率=点击次数／曝光次数</li>
<li>点赞率=点赞次数／点击次数</li>
<li>收藏率=收藏次数／点击次数</li>
<li>转发率=转发次数／点击次数</li>
<li>阅读完成率=滑动到底次数／点击次数×f(笔记长度)</li>
</ul>
<p>f(笔记长度)为归一化函数。</p>
<h3 id="北极星指标最关键指标"><a class="header" href="#北极星指标最关键指标">北极星指标（最关键指标）</a></h3>
<ul>
<li>用户规模：日活用户数（DAU）、月活用户数（MAU）</li>
<li>消费：人均使用推荐的时长、人均阅读笔记的数量。</li>
<li>发布：发布渗透率、人均发布量。</li>
</ul>
<h3 id="实验流程"><a class="header" href="#实验流程">实验流程</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250214101633.png" alt="" /></p>
<h2 id="推荐系统链路"><a class="header" href="#推荐系统链路">推荐系统链路</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250214101902.png" alt="" /></p>
<p>召回：用多条通道，取回几千篇笔记。</p>
<p>粗排：用小规模神经网络，给几千篇笔记打分，选出分数最高的几百篇。</p>
<p>精排：用大规模神经网络，给几百篇笔记打分。</p>
<p>重排：做多样性抽样丶规则打散丶插入广告和运营笔记。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250214102645.png" alt="" /></p>
<p>召回通道： 协同过滤、双塔模型、关注的作者等等。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250214102738.png" alt="" /></p>
<p>重排流程：</p>
<ul>
<li>做多样性抽样（比如MMR、DPP）从几百篇中选出几十篇。</li>
<li>用规则打散相似笔记。</li>
<li>插入广告、运营推广内容，根据生态要求调整排序。</li>
</ul>
<h2 id="推荐系统的ab测试"><a class="header" href="#推荐系统的ab测试">推荐系统的AB测试</a></h2>
<p>召回团队实现了一种GNN召回通道，离线实验结果正向。</p>
<p>下一步是做线上的小流量A/B测试，考察新的召回通道对线上指标的影响。</p>
<p>模型中有一些参数，比如 GNN 的深度取值∈{1,2,3}， 需要用A/B测试选取最优参数。</p>
<h3 id="随机分桶"><a class="header" href="#随机分桶">随机分桶</a></h3>
<p>分 b=10 个桶，每个桶中有 10% 的用户。</p>
<p>首先用哈希函数把用户ID映射成某个区间内的整数，然后把这些整数均匀随机分成b个桶。</p>
<p>全部n位用户，分成b个桶，每个桶中有<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>位用户</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250214111303.png" alt="" /></p>
<h3 id="分层实验"><a class="header" href="#分层实验">分层实验</a></h3>
<p>目标：解决流量不够用的问题</p>
<p>信息流产品的公司有很多部门和团队，大家都需要做A/B 测试。</p>
<ul>
<li>推荐系统（召回、粗排、精排、重排)</li>
<li>用户界面</li>
<li>广告</li>
</ul>
<p>如果把用户随机分成10组，1组做对照，9组做实验，那么只能同时做9组实验。</p>
<p>分层实验：召回、粗排、精排、重排、用户界面、广告····(例如 GNN 召回通道属于召回层。)</p>
<ul>
<li>同层互斥：GNN实验占了召回层的4个桶，其他召回实验只能用剩余的6个桶。</li>
<li>不同层正交：每一层独立随机对用户做分桶。每一层都可以独立用100%的用户做实验。</li>
</ul>
<p>召回层把用户分成10个桶：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>精排层把用户分成10个桶：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord">2</span><span class="mpunct">,,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>设系统共有n个用户，那么<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mord">/10</span></span></span></span></p>
<p>召回桶<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和召回桶<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 交集为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span></p>
<p>召回桶<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和精排桶<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 交集的大小为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mord">/100</span></span></span></span></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250214112200.png" alt="" /></p>
<p>互斥VS正交：</p>
<ul>
<li>如果所有实验都正交，则可以同时做无数组实验。</li>
<li>同类的策略（例如精排模型的两种结构）天然互斥，对于一个用户，只能用其中一种。</li>
<li>同类的策略（例如添加两条召回通道）效果会相互增强（1+1&gt;2）或相互抵消（1+1&lt;2）。互斥可以避免同类策略相互干扰。</li>
<li>不同类型的策略 (例如添加召回通道、优化粗排模型) 通常不会相互干扰（1+1=2），可以作为正交的两层。</li>
</ul>
<h3 id="holdout-机制"><a class="header" href="#holdout-机制">Holdout 机制</a></h3>
<p>每个实验（召回、粗排丶精排丶重排）独立汇报对业务指标的提升。</p>
<p>公司考察一个部门（比如推荐系统）在一段时间内对业务指标总体的提升。</p>
<p>取 10% 的用户作为holdout 桶（对照组），推荐系统使用剩余 90%的用户做实验，两者互斥。</p>
<p>10% holdout 桶 vs 90% 实验桶的 diff (需要归一化) 为整个部门的业务指标收益。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250214105933.png" alt="" /></p>
<p>每个考核周期结束之后，清除holdout 桶，让推全实验从90%用户扩大到100%用户。</p>
<p>重新随机划分用户，得到holdout 桶和实验桶’开始下一轮考核周期。</p>
<p>新的 holdout 桶与实验桶各种业务指标的 diff接近0。</p>
<p>随着召回、粗排、精排、重排实验上线和推全，diff 会逐渐扩大。</p>
<h3 id="实验推全反转实验"><a class="header" href="#实验推全反转实验">实验推全&amp;反转实验</a></h3>
<p>为什么要进行反转实验？</p>
<p>有的指标（点击、交互）立刻收到新策略影响，有的指标（留存）有滞后性，需要长期观测。</p>
<p>实验观测到显著收益后尽快推全新策略。目的是腾出桶供其他实验使用，或需要基于新策略做后续的开发。</p>
<p>用反转实验解决上述矛盾，既可以尽快推全，也可以长期观测实验指标。</p>
<p>在推全的新层中开一个旧策略的桶，长期观测实验指标。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250214112739.png" alt="" /></p>
<h3 id="总结"><a class="header" href="#总结">总结</a></h3>
<p>分层实验：同层互斥（不允许两个实验同时影响一位用户）、不同层正交（实验有重叠的用户）。</p>
<p>Holdout：保留10% 的用户，完全不受实验影响，可以考察整个部门对业务指标的贡献。</p>
<p>实验推全：新建一个推全层，与其他层正交。</p>
<p>反转实验：在新的推全层上’保留一个小的反转桶，使用旧策略。长期观测新旧策略的diff。</p>
<h2 id="附录ab测试"><a class="header" href="#附录ab测试">附录A/B测试</a></h2>
<p>A/B 测试是一种用于比较两种或多种版本的产品、网页、广告等，以确定哪一种效果更好的实验方法。它通常用于优化用户体验、提高转化率或评估新功能的影响。以下是对 A/B 测试的详细介绍：</p>
<h3 id="1-基本概念"><a class="header" href="#1-基本概念">1. <strong>基本概念</strong></a></h3>
<ul>
<li><strong>A/B 分组</strong>：在 A/B 测试中，用户被随机分为两个或多个组，例如“版本A”和“版本B”。每个组看到的是不同版本的内容。</li>
<li><strong>关键指标</strong>：测试的目标可能是提高点击率、转化率、用户留存率等。通过比较这些指标，分析哪一版本表现更好。</li>
</ul>
<h3 id="2-实施步骤"><a class="header" href="#2-实施步骤">2. <strong>实施步骤</strong></a></h3>
<ol start="2">
<li><strong>明确目标</strong>：首先清楚你想要改善的具体指标，例如销售额、注册用户数量等。</li>
<li><strong>选择变量</strong>：决定要测试的内容，比如按钮颜色、文案、图片等。</li>
<li><strong>创建版本</strong>：根据选择的变量，设计不同的版本。</li>
<li><strong>流量分配</strong>：将用户随机分配到不同的版本中，确保流量来源一致。</li>
<li><strong>收集数据</strong>：在测试期间，持续收集用户行为数据。</li>
<li><strong>分析结果</strong>：使用统计方法分析数据，评估哪个版本的表现更优。</li>
<li><strong>做出决策</strong>：基于测试结果，决定是否采纳新的版本。</li>
</ol>
<h3 id="3-优点和缺点"><a class="header" href="#3-优点和缺点">3. <strong>优点和缺点</strong></a></h3>
<p>优点：</p>
<ul>
<li><strong>数据驱动</strong>：帮助做出基于实际数据的决策，而不是凭直觉。</li>
<li><strong>简单明了</strong>：易于理解和实施，不需要复杂的分析。</li>
<li><strong>实时反馈</strong>：可以在实施中快速获取反馈，及时调整策略。</li>
</ul>
<p>缺点：</p>
<ul>
<li><strong>样本大小</strong>：如果样本量不足，结果可能不具备统计意义。</li>
<li><strong>时间消耗</strong>：某些测试可能需要较长时间才能收集到足够的数据。</li>
<li><strong>外部影响</strong>：外部因素（如市场波动）可能影响测试结果的准确性。</li>
</ul>
<h3 id="4-应用场景"><a class="header" href="#4-应用场景">4. <strong>应用场景</strong></a></h3>
<p>A/B 测试广泛应用于电子商务网站、移动应用、营销广告、用户界面设计等多个领域。通过这些测试，企业可以依据用户行为做出更优的决策，从而提升整体业绩。</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="召回"><a class="header" href="#召回">召回</a></h1>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#item-cf">Item CF</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#item-cf%E7%9A%84%E5%8E%9F%E7%90%86">Item CF的原理</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%89%A9%E5%93%81%E7%9B%B8%E4%BC%BC%E5%BA%A6%E8%AE%A1%E7%AE%97">物品相似度计算</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%8F%AC%E5%9B%9E%E6%B5%81%E7%A8%8B">召回流程</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E4%BA%8B%E5%85%88%E5%81%9A%E7%A6%BB%E7%BA%BF%E8%AE%A1%E7%AE%97">事先做离线计算</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%BA%BF%E4%B8%8A%E5%81%9A%E5%8F%AC%E5%9B%9E">线上做召回</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#item-cf%E5%8F%AC%E5%9B%9E%E9%80%9A%E9%81%93">Item CF召回通道</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#itemcf%E5%AE%9E%E7%8E%B0">ItemCF实现</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#1-%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD%E5%92%8C%E7%94%A8%E6%88%B7-%E7%89%A9%E5%93%81%E7%9F%A9%E9%98%B5">1. 数据加载和用户-物品矩阵</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#2-%E8%AE%A1%E7%AE%97%E7%89%A9%E5%93%81%E7%9B%B8%E4%BC%BC%E5%BA%A6">2. 计算物品相似度</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#3-%E7%94%9F%E6%88%90%E6%8E%A8%E8%8D%90%E5%88%97%E8%A1%A8">3. 生成推荐列表</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#4-%E8%AF%84%E4%BC%B0%E6%8E%A8%E8%8D%90%E6%95%88%E6%9E%9C">4. 评估推荐效果</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#5-%E8%AE%A1%E7%AE%97%E5%A4%9A%E6%A0%B7%E6%80%A7">5. 计算多样性</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#swing-%E6%A8%A1%E5%9E%8B">Swing 模型</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%8E%9F%E7%90%86">原理</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%80%BB%E7%BB%93-1">总结</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#user-cf">User CF</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#usercf%E7%9A%84%E5%8E%9F%E7%90%86">UserCF的原理</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E8%AE%A1%E7%AE%97%E7%94%A8%E6%88%B7%E7%9B%B8%E4%BC%BC%E5%BA%A6">计算用户相似度</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E8%AE%A1%E7%AE%97%E7%9B%B8%E4%BC%BC%E5%BA%A6%E5%85%AC%E5%BC%8F">计算相似度公式</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E9%99%8D%E4%BD%8E%E7%83%AD%E9%97%A8%E7%89%A9%E5%93%81%E6%9D%83%E9%87%8D">降低热门物品权重</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%8F%AC%E5%9B%9E%E6%B5%81%E7%A8%8B-1">召回流程</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E4%BA%8B%E5%85%88%E5%81%9A%E7%A6%BB%E7%BA%BF%E8%AE%A1%E7%AE%97-1">事先做离线计算</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%BA%BF%E4%B8%8A%E5%81%9A%E5%8F%AC%E5%9B%9E-1">线上做召回</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#usercf%E5%8F%AC%E5%9B%9E%E9%80%9A%E9%81%93">UserCF召回通道</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#usercf%E5%AE%9E%E7%8E%B0">UserCF实现</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#1-%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD">1. 数据加载</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#2-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7-%E7%89%A9%E5%93%81%E7%9F%A9%E9%98%B5">2. 创建用户-物品矩阵</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#3-%E8%AE%A1%E7%AE%97%E7%94%A8%E6%88%B7%E7%9B%B8%E4%BC%BC%E5%BA%A6">3. 计算用户相似度</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#4-%E7%94%9F%E6%88%90%E6%8E%A8%E8%8D%90%E5%88%97%E8%A1%A8">4. 生成推荐列表</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#5-%E8%AF%84%E4%BC%B0%E6%8E%A8%E8%8D%90%E6%95%88%E6%9E%9C">5. 评估推荐效果</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#6-%E8%AE%A1%E7%AE%97%E5%A4%9A%E6%A0%B7%E6%80%A7">6. 计算多样性</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%80%BB%E7%BB%93-2">总结</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%A6%BB%E6%95%A3%E7%89%B9%E5%BE%81%E5%A4%84%E7%90%86">离散特征处理</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%B5%81%E7%A8%8B">流程</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#one-hot%E7%BC%96%E7%A0%81">One-hot编码</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#embedding%E5%B5%8C%E5%85%A5">Embedding（嵌入）</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#one-hot%E5%92%8Cembedding%E7%9A%84%E5%85%B3%E7%B3%BB">One-hot和Embedding的关系</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%80%BB%E7%BB%93-3">总结</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%90%91%E9%87%8F%E5%8F%AC%E5%9B%9E">向量召回</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%9F%A9%E9%98%B5%E8%A1%A5%E5%85%85matrix-completion">矩阵补充（Matrix Completion）</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%9F%A9%E9%98%B5%E8%A1%A5%E5%85%85%E6%9E%B6%E6%9E%84%E5%9B%BE">矩阵补充架构图</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%9F%BA%E6%9C%AC%E6%83%B3%E6%B3%95">基本想法</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%9F%A9%E9%98%B5%E8%A1%A5%E5%85%85%E7%BC%BA%E7%82%B9">矩阵补充缺点</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%BA%BF%E4%B8%8A%E6%9C%8D%E5%8A%A1">线上服务</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%A8%A1%E5%9E%8B%E5%AD%98%E5%82%A8">模型存储</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%BA%BF%E4%B8%8A%E6%9C%8D%E5%8A%A1-1">线上服务</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E8%BF%91%E4%BC%BC%E6%9C%80%E8%BF%91%E9%82%BB%E6%9F%A5%E6%89%BEapproximate-nearest-neighbor-search">近似最近邻查找（Approximate Nearest Neighbor Search）</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%80%BB%E7%BB%93-4">总结</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%8F%8C%E5%A1%94%E6%A8%A1%E5%9E%8B">双塔模型</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%84%E8%AE%AD%E7%BB%83%E6%96%B9%E6%B3%95">模型结构、训练方法</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%84">模型结构</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%8F%8C%E5%A1%94%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%AE%AD%E7%BB%83">双塔模型的训练</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%AD%A3%E8%B4%9F%E6%A0%B7%E6%9C%AC%E7%9A%84%E9%80%89%E6%8B%A9">正负样本的选择</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#pointwise%E8%AE%AD%E7%BB%83">Pointwise训练</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#pairwise%E8%AE%AD%E7%BB%83">Pairwise训练</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#listwise%E8%AE%AD%E7%BB%83">Listwise训练</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E4%B8%8D%E9%80%82%E7%94%A8%E4%BA%8E%E5%8F%AC%E5%9B%9E%E7%9A%84%E6%A8%A1%E5%9E%8B">不适用于召回的模型</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%AD%A3%E8%B4%9F%E6%A0%B7%E6%9C%AC">正负样本</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%AD%A3%E6%A0%B7%E6%9C%AC">正样本</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%AE%80%E5%8D%95%E8%B4%9F%E6%A0%B7%E6%9C%AC%E5%85%A8%E4%BD%93%E7%89%A9%E5%93%81">简单负样本：全体物品</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%9D%87%E5%8C%80%E6%8A%BD%E6%A0%B7%E5%92%8C%E9%9D%9E%E5%9D%87%E6%8A%BD%E9%87%87%E6%A0%B7">均匀抽样和非均抽采样</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#batch%E5%86%85%E8%B4%9F%E6%A0%B7%E6%9C%AC">Batch内负样本</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%9B%B0%E9%9A%BE%E8%B4%9F%E6%A0%B7%E6%9C%AC">困难负样本</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E8%AE%AD%E7%BB%83%E6%95%B0%E6%8D%AE">训练数据</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%B8%B8%E8%A7%81%E7%9A%84%E9%94%99%E8%AF%AF">常见的错误</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E9%80%89%E6%8B%A9%E8%B4%9F%E6%A0%B7%E6%9C%AC%E7%9A%84%E5%8E%9F%E7%90%86">选择负样本的原理</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%8F%8C%E5%A1%94%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%BA%BF%E4%B8%8A%E5%8F%AC%E5%9B%9E">双塔模型的线上召回</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%A8%A1%E5%9E%8B%E6%9B%B4%E6%96%B0">模型更新</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%85%A8%E9%87%8F%E6%9B%B4%E6%96%B0">全量更新</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0">增量更新</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%85%A8%E9%87%8F%E6%9B%B4%E6%96%B0-vs-%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0">全量更新 VS 增量更新</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%8F%8C%E5%A1%94%E6%A8%A1%E5%9E%8B%E8%87%AA%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0">双塔模型+自监督学习</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%8F%8C%E5%A1%94%E6%A8%A1%E5%9E%8B%E7%9A%84%E9%97%AE%E9%A2%98">双塔模型的问题</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E8%87%AA%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0">自监督学习</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2random-mask">特征变换Random Mask</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2dropout%E4%BB%85%E5%AF%B9%E5%A4%9A%E5%80%BC%E7%A6%BB%E6%95%A3%E7%89%B9%E5%BE%81%E7%94%9F%E6%95%88">特征变换：Dropout（仅对多值离散特征生效）</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2%E4%BA%92%E8%A1%A5%E7%89%B9%E5%BE%81complementary">特征变换：互补特征（complementary）</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%89%B9%E5%BE%81%E5%8F%98%E6%8D%A2mask%E4%B8%80%E7%BB%84%E5%85%B3%E8%81%94%E7%9A%84%E7%89%B9%E5%BE%81">特征变换：Mask一组关联的特征</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B">训练模型</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#deep-retrieval">Deep Retrieval</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#outline">Outline</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%85%B6%E4%BB%96%E5%8F%AC%E5%9B%9E%E9%80%9A%E9%81%93">其他召回通道</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E5%8F%AC%E5%9B%9E">地理位置召回</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#geohash%E5%8F%AC%E5%9B%9E">GeoHash召回</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%90%8C%E5%9F%8E%E5%8F%AC%E5%9B%9E">同城召回</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E4%BD%9C%E8%80%85%E5%8F%AC%E5%9B%9E">作者召回</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E5%85%B3%E6%B3%A8%E4%BD%9C%E8%80%85%E5%8F%AC%E5%9B%9E">关注作者召回</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%9C%89%E4%BA%A4%E4%BA%92%E7%9A%84%E4%BD%9C%E8%80%85%E5%8F%AC%E5%9B%9E">有交互的作者召回</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%9B%B8%E4%BC%BC%E4%BD%9C%E8%80%85%E5%8F%AC%E5%9B%9E">相似作者召回</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E7%BC%93%E5%AD%98%E5%8F%AC%E5%9B%9E">缓存召回</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E9%80%80%E5%9C%BA%E6%9C%BA%E5%88%B6">退场机制</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%9B%9D%E5%85%89%E8%BF%87%E6%BB%A4bloom-filter">曝光过滤&amp;Bloom Filter</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%9B%9D%E5%85%89%E8%BF%87%E6%BB%A4%E9%97%AE%E9%A2%98">曝光过滤问题</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#bloom-filter">Bloom Filter</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%9E%B6%E6%9E%84%E5%9B%BE">架构图</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#%E6%9B%9D%E5%85%89%E8%BF%87%E6%BB%A4%E7%9A%84%E9%93%BE%E8%B7%AF">曝光过滤的链路</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E5%8F%AC%E5%9B%9E.html#bloom-filter%E7%9A%84%E7%BC%BA%E7%82%B9">Bloom Filter的缺点</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="item-cf"><a class="header" href="#item-cf">Item CF</a></h1>
<p>这节课介绍基于物品的协同过滤（Item Based Collaborative Filtering，缩写 ItemCF）。</p>
<p>ItemCF 的原理：如果用户喜欢物品1，而且物品1与物品2相似，那么用户很可能喜欢物品2。</p>
<p>这节课的三个要点：</p>
<ol>
<li>如何计算两个物品之间的相似度。</li>
<li>如何预估用户对候选物品的兴趣。</li>
<li>如何利用索引在线上快速做召回。</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250309131821.png" alt="" /></p>
<h2 id="item-cf的原理"><a class="header" href="#item-cf的原理">Item CF的原理</a></h2>
<p>用户喜欢物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，那么用户喜欢与物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>相似的物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<p>如果喜欢<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的用户有很大的重叠，那么<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>与<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>相似。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250309120951.png" alt="" /></p>
<h3 id="物品相似度计算"><a class="header" href="#物品相似度计算">物品相似度计算</a></h3>
<p>两个物品的受众重合度越高，两个物品越相似。</p>
<p>例如：喜欢《射雕英雄传》和《神雕侠侣》的读者重合度很高。可以认为《射雕英雄传》和《神雕侠侣》相似。</p>
<p>喜欢物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的用户记作集合<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<p>喜欢物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的用户记作集合<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>定义交集 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>物品相似度计算公式：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">im</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8396em;vertical-align:-0.8296em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.4642em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0369em;"><span class="svg-align" style="top:-3.4286em;"><span class="pstrut" style="height:3.4286em;"></span><span class="mord mtight" style="padding-left:1.19em;"><span class="mord mtight">∣</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0269em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">⋅</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0269em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight">∣</span></span></span><span style="top:-3.0089em;"><span class="pstrut" style="height:3.4286em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.5429em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.5429em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4197em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0269em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">∩</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0269em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8296em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，注意该公式没有考虑喜欢的程度<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.03148em;">ik</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">ser</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span></p>
<p>下面的公式考虑了喜欢的程度</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250309131710.png" alt="" /></p>
<h2 id="召回流程"><a class="header" href="#召回流程">召回流程</a></h2>
<h3 id="事先做离线计算"><a class="header" href="#事先做离线计算">事先做离线计算</a></h3>
<p>建立“用户→物品”的索引</p>
<ul>
<li>记录每个用户最近点击、交互过的物品ID。</li>
<li>给定任意用户ID，可以找到他近期感兴趣的物品列表。</li>
</ul>
<p>建立“物品→物品”的索引</p>
<ul>
<li>计算物品之间两两相似度。</li>
<li>对于每个物品，索引它最相似的k个物品</li>
<li>给定任意物品ID，可以快速找到它最相似的k个物品。</li>
</ul>
<h3 id="线上做召回"><a class="header" href="#线上做召回">线上做召回</a></h3>
<p>索引的意义在于避免枚举所有的物品。</p>
<ol>
<li>记录用户最近感兴趣的<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">200</span></span></span></span>个物品。</li>
<li>取回每个物品最相似的<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span></span></span></span>个物品。</li>
<li>给取回的<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">nk</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2000</span></span></span></span>个物品打分（用户对物品的兴趣）</li>
<li>返回分数最高的100个物品作为ItemCF通道的输出。</li>
</ol>
<p>用索引，离线计算量大，线上计算量小。</p>
<h3 id="item-cf召回通道"><a class="header" href="#item-cf召回通道">Item CF召回通道</a></h3>
<p>维护两个索引：</p>
<ul>
<li>用户→物品列表：用户最近交互过的n个物品。</li>
<li>物品→物品列表：相似度最高的k个物品。</li>
</ul>
<p>线上做召回：</p>
<ul>
<li>利用两个索引，每次取回<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>个物品。</li>
<li>预估用户对每个物品的兴趣分数：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1858em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.03148em;">ik</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">ser</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">im</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span></li>
<li>返回分数最高的100个物品，作为召回结果。</li>
</ul>
<h2 id="itemcf实现"><a class="header" href="#itemcf实现">ItemCF实现</a></h2>
<p>实现基于Item-CF（物品协同过滤）推荐算法的过程与User-CF算法类似，但焦点在物品之间的相似度计算上。以下是详细的步骤和代码示例，以帮助你理解如何实现Item-CF推荐算法。</p>
<h3 id="1-数据加载和用户-物品矩阵"><a class="header" href="#1-数据加载和用户-物品矩阵">1. 数据加载和用户-物品矩阵</a></h3>
<p>如果你已经加载了MovieLens数据集，并创建了用户-物品矩阵，可以跳过这个步骤。不过，为了完整性，以下代码会重新载入数据并构建用户-物品矩阵：</p>
<pre><code class="language-python">import pandas as pd

# 加载数据集
data = pd.read_csv('u.data', delimiter='\t', names=['user_id', 'item_id', 'rating', 'timestamp'])

# 创建用户-物品矩阵
user_item_matrix = data.pivot(index='user_id', columns='item_id', values='rating').fillna(0)
user_item_matrix = user_item_matrix.values
</code></pre>
<h3 id="2-计算物品相似度"><a class="header" href="#2-计算物品相似度">2. 计算物品相似度</a></h3>
<p>这一步是计算物品之间的相似度，通常使用余弦相似度或皮尔逊相关系数。下面示范如何使用余弦相似度：</p>
<pre><code class="language-python">from sklearn.metrics.pairwise import cosine_similarity

# 计算物品相似度
item_similarity = cosine_similarity(user_item_matrix.T)
item_similarity_df = pd.DataFrame(item_similarity)
print(item_similarity_df.head())
</code></pre>
<h3 id="3-生成推荐列表"><a class="header" href="#3-生成推荐列表">3. 生成推荐列表</a></h3>
<p>基于计算出的物品相似度，我们可以为每个用户生成推荐列表。对于Item-CF，我们会根据用户已评分的物品找到相似物品，然后进行推荐。</p>
<pre><code class="language-python">def get_item_recommendations(user_id, user_item_matrix, item_similarity, n_recommendations=5):
    # 获取指定用户的评分
    user_index = user_id - 1  # 假设用户ID是从1开始
    user_ratings = user_item_matrix[user_index]
    
    # 计算与用户已评分物品相似的物品
    similar_score = item_similarity.dot(user_ratings)
    
    # 过滤已评分的物品
    similar_score[user_ratings &gt; 0] = 0
    
    # 获取推荐物品
    recommended_items_indices = similar_score.argsort()[::-1][:n_recommendations]
    
    return recommended_items_indices + 1  # 返回物品ID，从1开始

# 示例：生成用户1的推荐列表
recommendations = get_item_recommendations(1, user_item_matrix, item_similarity)
print("推荐列表:", recommendations)
</code></pre>
<h3 id="4-评估推荐效果"><a class="header" href="#4-评估推荐效果">4. 评估推荐效果</a></h3>
<p>与User-CF类似，我们可以计算<strong>precision</strong>、<strong>recall</strong>、<strong>F1 score</strong> 和 <strong>多样性</strong>，以评估推荐效果。</p>
<pre><code class="language-python">def calculate_precision_recall(recommendations, true_items, k=5):
    true_positive = len(set(recommendations[:k]) &amp; set(true_items))
    precision = true_positive / k
    recall = true_positive / len(true_items) if len(true_items) &gt; 0 else 0
    F1_score = (2 * precision * recall) / (precision + recall) if (precision + recall) &gt; 0 else 0
    return precision, recall, F1_score

# 用于测试的真实购买和推荐 (假设)
true_items = [50, 55, 25]  # 用户真实评分的物品ID
k = 5

precision, recall, F1_score = calculate_precision_recall(recommendations, true_items, k)
print(f'Precision: {precision:.2f}, Recall: {recall:.2f}, F1 Score: {F1_score:.2f}')
</code></pre>
<h3 id="5-计算多样性"><a class="header" href="#5-计算多样性">5. 计算多样性</a></h3>
<p>和在User-CF中一样，多样性可以通过计算推荐物品之间的相似度来测量。</p>
<pre><code class="language-python">def calculate_diversity(recommendations, item_similarity):
    # 过滤推荐物品的相似度
    if len(recommendations) &lt;= 1:
        return 0
    sim_sum = sum(item_similarity[i-1][j-1] for i in recommendations for j in recommendations if i != j)
    diversity = 1 - (sim_sum / (len(recommendations) * (len(recommendations) - 1)))  # 多样性分值
    return diversity

diversity = calculate_diversity(recommendations, item_similarity)
print(f'Diversity: {diversity:.2f}')
</code></pre>
<h3 id="总结-1"><a class="header" href="#总结-1">总结</a></h3>
<p>通过以上步骤，你可以实现一个基于Item-CF的推荐系统。它的核心在于计算物品相似度，并根据用户的评分生成个性化的推荐列表。你可以根据不同的计算方法和参数来优化推荐效果，提高模型的性能。</p>
<h1 id="swing-模型"><a class="header" href="#swing-模型">Swing 模型</a></h1>
<p>这节课介绍 Swing 模型，它跟 ItemCF 非常类似，唯一的区别在于计算物品相似度的方式不同。</p>
<h2 id="原理"><a class="header" href="#原理">原理</a></h2>
<p>和Item CF区别是定义物品相似度的方法不同。</p>
<p>Swing 模型给用户设置权重来解决小圈子问题。</p>
<p>用户<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 喜欢的物品记作集合<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>用户<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 喜欢的物品记作集合<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>定义两个用户的重合度：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></p>
<p>用户 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的重合度高，则他们可能来自一个小圈子；要降低他们的权重。</p>
<p>喜欢物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的用户记作集合<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>喜欢物品 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的用户记作集合<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>定义交集 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>两个物品的相似度：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">sim</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.7159em;vertical-align:-1.3944em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8557em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">∈</span><span class="mord mathcal mtight" style="margin-right:0.08222em;">V</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3944em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8557em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mrel mtight">∈</span><span class="mord mathcal mtight" style="margin-right:0.08222em;">V</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3944em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord text"><span class="mord">overlap</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<h2 id="总结-2"><a class="header" href="#总结-2">总结</a></h2>
<p>Swing与Item CF唯一的区别在于物品相似度的计算方式。</p>
<p>Item CF：两个物品重合的用户比例高，则判定两个物品相似。</p>
<p>Swing：额外考虑重合的用户是否来自一个小圈子。</p>
<ul>
<li>同时喜欢两个物品的用户记作集合V。</li>
<li>对于<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span>中的用户<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>重合度记作<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。</li>
<li>两个用户重合度大，则可能来自一个小圈子，权重降低。</li>
</ul>
<h1 id="user-cf"><a class="header" href="#user-cf">User CF</a></h1>
<p>这节课介绍基于用户的召回（User Based Collaborative Filtering，缩写 UserCF）。</p>
<p>UserCF 的原理：如果用户1跟用户2相似，而且用户2喜欢某物品，那么用户1很可能喜欢该物品。</p>
<p>这节课的三个要点：</p>
<ol>
<li>如何计算两个用户之间的相似度。</li>
<li>如何预估用户对候选物品的兴趣。</li>
<li>如何利用索引在线上快速做召回。</li>
</ol>
<p>UserCF 的基本思想：</p>
<ul>
<li>如果用户<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">se</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>跟用户<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">se</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>相似，而且<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">se</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>喜欢某物品，那么用户<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">se</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>也很可能喜欢该物品。</li>
<li>预估用户<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">se</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>对候选物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span></span></span></span>的兴趣：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1858em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">im</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">ser</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">se</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.03148em;">ik</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal">se</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span></li>
<li>计算两个用户的相似度：把每个用户表示为一个稀疏向量，向量每个元素对应一个物品。相似度sim 就是两个向量夹角的余弦。</li>
</ul>
<h2 id="usercf的原理"><a class="header" href="#usercf的原理">UserCF的原理</a></h2>
<p>有很多跟我兴趣非常相似的网友，其中某个网友对某笔记点赞、转发，我没看过这篇笔记=&gt;给我推荐这篇笔记</p>
<p>推荐系统如何找到跟我兴趣非常相似的网友呢?</p>
<p>方法一：点击、点赞、收藏、转发的笔记有很大的重合。</p>
<p>方法二：关注的作者有很大的重合。</p>
<h2 id="计算用户相似度"><a class="header" href="#计算用户相似度">计算用户相似度</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250215111317.png" alt="" /></p>
<h3 id="计算相似度公式"><a class="header" href="#计算相似度公式">计算相似度公式</a></h3>
<p>用户<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 喜欢的物品记作集合<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>用户<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 喜欢的物品记作集合<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>定义交集 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>两个用户的相似度：</p>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">im</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8396em;vertical-align:-0.8296em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.4642em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0369em;"><span class="svg-align" style="top:-3.4286em;"><span class="pstrut" style="height:3.4286em;"></span><span class="mord mtight" style="padding-left:1.19em;"><span class="mord mtight">∣</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0962em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">⋅</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0962em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight">∣</span></span></span><span style="top:-3.0089em;"><span class="pstrut" style="height:3.4286em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.5429em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.5429em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702 c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14 c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54 c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10 s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429 c69,-144,104.5,-217.7,106.5,-221 l0 -0 c5.3,-9.3,12,-14,20,-14 H400000v40H845.2724 s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7 c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4197em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8296em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<h3 id="降低热门物品权重"><a class="header" href="#降低热门物品权重">降低热门物品权重</a></h3>
<p>用户<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 喜欢的物品记作集合<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>用户<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 喜欢的物品记作集合<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>定义交集 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0962em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>两个用户的相似度：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">im</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.8851em;vertical-align:-1.13em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7551em;"><span style="top:-2.175em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.935em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord">∣</span><span class="mord"><span class="mord mathcal" style="margin-right:0.18472em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathcal" style="margin-right:0.18472em;">J</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-2.895em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119 c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120 c340,-704.7,510.7,-1060.3,512,-1067 l0 -0 c4.7,-7.3,11,-11,19,-11 H40000v40H1012.3 s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232 c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1 s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26 c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z M1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.305em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1864em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">l</span><span class="mtight">o</span><span class="mtight" style="margin-right:0.01389em;">g</span></span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>指喜欢物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span>的用户数量，反映物品的热门程度</p>
<h2 id="召回流程-1"><a class="header" href="#召回流程-1">召回流程</a></h2>
<h3 id="事先做离线计算-1"><a class="header" href="#事先做离线计算-1">事先做离线计算</a></h3>
<p>建立“用户→物品”的索引</p>
<ul>
<li>记录每个用户最近点击、交互过的物品ID。</li>
<li>给定任意用户ID，可以找到他近期感兴趣的物品列表。</li>
</ul>
<p>建立“用户→用户”的索引</p>
<ul>
<li>对于每个用户，索引他最相似的k个用户。</li>
<li>给定任意用户ID，可以快速找到他最相似的k个用户。</li>
</ul>
<h3 id="线上做召回-1"><a class="header" href="#线上做召回-1">线上做召回</a></h3>
<ol>
<li>给定用户ID，通过“用户→用户”索引，找到top-k相似用户。</li>
<li>对于每个top-k相似用户，通过“用户→物品”索引’找到用户近期感兴趣的物品列表（last-n）。</li>
<li>对于召回的nk个相似物品，用公式预估用户对每个物品的兴趣分数。</li>
<li>返回分数最高的100个物品，作为召回结果。</li>
</ol>
<h3 id="usercf召回通道"><a class="header" href="#usercf召回通道">UserCF召回通道</a></h3>
<p>维护两个索引：</p>
<ul>
<li>用户→物品列表：用户近期交互过的n个物品。</li>
<li>用户→用户列表：相似度最高的k个用户。</li>
</ul>
<p>线上做召回：</p>
<ul>
<li>利用两个索引，每次取回nk个物品。</li>
<li>预估用户user对每个物品item 的兴趣分数：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1858em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">im</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">ser</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">se</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.03148em;">ik</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal">se</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span></li>
<li>返回分数最高的100个物品，作为召回结果。</li>
</ul>
<h2 id="usercf实现"><a class="header" href="#usercf实现">UserCF实现</a></h2>
<p>实现基于User-CF（用户协同过滤）推荐算法的整个过程可以分为几个关键步骤，包括数据加载、用户相似度计算、生成推荐列表以及评价推荐效果。下面是一个详细的说明和代码示例。</p>
<h3 id="1-数据加载"><a class="header" href="#1-数据加载">1. 数据加载</a></h3>
<p>我们首先需要加载MovieLens数据集。假设我们使用的是MovieLens 100k数据集，它通常包含两列，用户ID和电影ID。</p>
<pre><code class="language-python">import pandas as pd

# 加载数据集
data = pd.read_csv('u.data', delimiter='\t', names=['user_id', 'item_id', 'rating', 'timestamp'])
print(data.head())
</code></pre>
<h3 id="2-创建用户-物品矩阵"><a class="header" href="#2-创建用户-物品矩阵">2. 创建用户-物品矩阵</a></h3>
<p>接下来，我们需要构建一个用户-物品矩阵，其中行表示用户，列表示物品，值表示评分。</p>
<pre><code class="language-python"># 创建用户-物品矩阵
user_item_matrix = data.pivot(index='user_id', columns='item_id', values='rating').fillna(0)
user_item_matrix = user_item_matrix.values
</code></pre>
<h3 id="3-计算用户相似度"><a class="header" href="#3-计算用户相似度">3. 计算用户相似度</a></h3>
<p>在这一部分，我们将计算用户之间的相似度。最常用的方法是余弦相似度。</p>
<pre><code class="language-python">from sklearn.metrics.pairwise import cosine_similarity

# 计算用户相似度
user_similarity = cosine_similarity(user_item_matrix)
user_similarity_df = pd.DataFrame(user_similarity)
print(user_similarity_df.head())
</code></pre>
<h3 id="4-生成推荐列表"><a class="header" href="#4-生成推荐列表">4. 生成推荐列表</a></h3>
<p>基于用户相似度，我们可以为每个用户生成推荐列表。我们将为每个用户找到与其相似度最高的用户，根据这些用户的评分来生成推荐。</p>
<pre><code class="language-python">def get_recommendations(user_id, user_item_matrix, user_similarity, n_recommendations=5):
    # 获取指定用户的评分
    user_index = user_id - 1  # 假设用户ID是从1开始
    similar_users = user_similarity[user_index]
    
    # 找到与当前用户最相似的用户
    similar_users_indices = similar_users.argsort()[::-1][:10]  # 获取前10个相似用户
    
    # 计算推荐评分
    weighted_ratings = user_item_matrix[similar_users_indices].T.dot(similar_users[similar_users_indices])
    
    # 过滤已评分的物品
    user_ratings = user_item_matrix[user_index]
    weighted_ratings[user_ratings &gt; 0] = 0  # 不推荐已评分的物品
    
    # 获取推荐物品
    recommended_items_indices = weighted_ratings.argsort()[::-1][:n_recommendations]
    
    return recommended_items_indices + 1  # 返回物品ID，从1开始

# 示例：生成用户1的推荐列表
recommendations = get_recommendations(1, user_item_matrix, user_similarity)
print("推荐列表:", recommendations)
</code></pre>
<h3 id="5-评估推荐效果"><a class="header" href="#5-评估推荐效果">5. 评估推荐效果</a></h3>
<p>推荐效果的评估通常会计算 <strong>precision</strong>、<strong>recall</strong>、<strong>F1 score</strong> 和 <strong>多样性</strong>。这里我们手动计算这些指标。</p>
<pre><code class="language-python">def calculate_precision_recall(recommendations, true_items, k=5):
    true_positive = len(set(recommendations[:k]) &amp; set(true_items))
    precision = true_positive / k
    recall = true_positive / len(true_items) if len(true_items) &gt; 0 else 0
    F1_score = (2 * precision * recall) / (precision + recall) if (precision + recall) &gt; 0 else 0
    return precision, recall, F1_score

# 用于测试的真实购买和推荐 (假设)
true_items = [50, 55, 25]  # 用户真实评分的物品ID
k = 5

precision, recall, F1_score = calculate_precision_recall(recommendations, true_items, k)
print(f'Precision: {precision:.2f}, Recall: {recall:.2f}, F1 Score: {F1_score:.2f}')
</code></pre>
<h3 id="6-计算多样性"><a class="header" href="#6-计算多样性">6. 计算多样性</a></h3>
<p>多样性可以通过计算推荐物品之间的相似度来测量。</p>
<pre><code class="language-python">def calculate_diversity(recommendations, user_item_matrix):
    # 过滤推荐物品的相似度
    item_similarity = cosine_similarity(user_item_matrix.T)
    
    # 计算推荐物品之间的相似度平均值
    if len(recommendations) &lt;= 1:
        return 0
    sim_sum = sum(item_similarity[i-1][j-1] for i in recommendations for j in recommendations if i != j)
    diversity = 1 - (sim_sum / (len(recommendations) * (len(recommendations) - 1)))  # 多样性分值
    return diversity

diversity = calculate_diversity(recommendations, user_item_matrix)
print(f'Diversity: {diversity:.2f}')
</code></pre>
<h3 id="总结-3"><a class="header" href="#总结-3">总结</a></h3>
<p>这个代码示例构建了一个完整的User-CF推荐系统，涵盖了用户相似度计算、推荐生成以及评估指标的计算。你可以通过调整参数或使用不同的相似度计算方法来优化推荐效果。</p>
<h1 id="离散特征处理"><a class="header" href="#离散特征处理">离散特征处理</a></h1>
<p>这节课的内容是离散特征的处理，包括 one-hot encoding (独热编码) 和 embedding (嵌入)。这节课是为后面几节课的向量召回做准备。</p>
<h2 id="流程"><a class="header" href="#流程">流程</a></h2>
<ol>
<li>建立字典：把类别映射成序号
<ul>
<li>中国→1</li>
<li>美国→2</li>
<li>印度→3</li>
</ul>
</li>
<li>向量化：把序号映射成向量。
<ul>
<li>One-hot编码：把序号映射成高维稀疏向量</li>
<li>Embedding：把序号映射成低维稠密向量</li>
</ul>
</li>
</ol>
<h2 id="one-hot编码"><a class="header" href="#one-hot编码">One-hot编码</a></h2>
<p>例1：性别特征</p>
<p>性别：男、女两种类别。</p>
<p>字典：男→1，女→2。</p>
<p>One-hot编码：用 2 维向量表示性别</p>
<ul>
<li>未知→0 →[0,0]</li>
<li>男→1→[1,0]</li>
<li>女→ 2→ [0,1]</li>
</ul>
<p>例2：国籍特征</p>
<p>国籍：中国、美国、印度等200种类别。</p>
<p>字典：中国→1，美国→2，印度→3，</p>
<p>One-hot编码：用 200 维稀疏向量表示国籍</p>
<ul>
<li>未知 → 0 → [0,0,0,0,...,0]</li>
<li>中国→1→[1,0,0,0,...,0]</li>
<li>美国 → 2 → [0,1,0,0,...,0]</li>
<li>印度→3→[0,0,1,0,...,0]</li>
</ul>
<p>One-Hot编码的局限：类别数量太大时，通常不用one-hot 编码。</p>
<p>例1：自然语言处理中，对单词做编码。英文有几万个常见单词。那么one-hot向量的维度是几万</p>
<p>例2：推荐系统中，对物品ID做编码，小红书有几亿篇笔记，那么one-hot向量的维度是几亿。</p>
<h2 id="embedding嵌入"><a class="header" href="#embedding嵌入">Embedding（嵌入）</a></h2>
<p>例 1：国籍的Embedding</p>
<p>参数数量：向量维度×类别数量</p>
<p>设embedding得到的向量都是4维的。一共有200个国籍。参数数量=4×200=800。</p>
<p>编程实现：TensorFlow、PyTorch 提供 embedding 层。</p>
<p>参数以矩阵的形式保存，矩阵大小是向量维度×类别数量。</p>
<p>输入是序号，比如“美国”的序号是2。</p>
<p>输出是向量，比如“美国”对应参数矩阵的第2列。</p>
<p>例2：物品ID的Embedding</p>
<p>数据库里一共有10,000部电影。任务是给用户推荐电影。设embedding 向量的维度是 16。Embedding 层有多少参数？</p>
<p>参数数量=向量维度× 类别数量=160,000</p>
<h2 id="one-hot和embedding的关系"><a class="header" href="#one-hot和embedding的关系">One-hot和Embedding的关系</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250215113509.png" alt="" /></p>
<h2 id="总结-4"><a class="header" href="#总结-4">总结</a></h2>
<p>离散特征处理：one-hot 编码、embedding</p>
<p>类别数量很大时，用embedding，例如：</p>
<ul>
<li>Word embedding</li>
<li>用户 ID embedding</li>
<li>物品 ID embedding</li>
</ul>
<h1 id="向量召回"><a class="header" href="#向量召回">向量召回</a></h1>
<p>这节课介绍矩阵补充（matrix completion），它是一种向量召回通道。矩阵补充的本质是对用户 ID 和物品 ID 做 embedding，并用两个 embedding 向量的內积预估用户对物品的兴趣。值得注意的是，矩阵补充存在诸多缺点，在实践中效果远不及双塔模型。</p>
<p>做向量召回需要做最近邻查找（nearest neighbor search）。这节课的最后介绍加速最近邻查找的近似算法以及工业界的实践。</p>
<h2 id="矩阵补充matrix-completion"><a class="header" href="#矩阵补充matrix-completion">矩阵补充（Matrix Completion）</a></h2>
<h3 id="矩阵补充架构图"><a class="header" href="#矩阵补充架构图">矩阵补充架构图</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250309115231.png" alt="" /></p>
<h3 id="基本想法"><a class="header" href="#基本想法">基本想法</a></h3>
<p>用户embedding参数矩阵记作A。第u号用户对应矩阵第u列，记作向量<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<p>物品embedding参数矩阵记作B。第i号物品对应矩阵第i列，记作向量<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<p>内积<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span>是第u号用户对第i号物品兴趣的预估值。</p>
<p>训练模型的目的是学习矩阵A和B，使得预估值拟合真实观测的兴趣分数。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250309115605.png" alt="" /></p>
<h3 id="矩阵补充缺点"><a class="header" href="#矩阵补充缺点">矩阵补充缺点</a></h3>
<p>矩阵补充在实践中效果不好</p>
<p>缺点1：仅用ID embedding，没利用物品、用户属性</p>
<ul>
<li>物品属性：类目、关键词、地理位置、作者信息</li>
<li>用户属性：性别、年龄、地理定位、感兴趣的类目</li>
</ul>
<p>双塔模型可以看做矩阵补充的升级版。</p>
<p>缺点2：负样本的选取方式不对。</p>
<ul>
<li>样本：用户—物品的二元组，记作（u,i）</li>
<li>正样本：曝光之后，有点击、交互。（正确的做法）</li>
<li>负样本：曝光之后，没有点击、交互。（错误的做法）</li>
</ul>
<p>缺点3：做训练的方法不好。</p>
<ul>
<li>内积<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span>不如余弦相似度</li>
<li>用平方损失（回归），不如用交叉熵损失（分类）</li>
</ul>
<h2 id="线上服务"><a class="header" href="#线上服务">线上服务</a></h2>
<h3 id="模型存储"><a class="header" href="#模型存储">模型存储</a></h3>
<ol>
<li>
<p>训练得到矩阵A和B</p>
<ul>
<li>A的每一列对应一个用户</li>
<li>B的每一列对应一个物品。</li>
</ul>
</li>
<li>
<p>把矩阵 A 的列存储到 key-value 表</p>
<ul>
<li>key是用户ID，value是A的一列</li>
<li>给定用户ID，返回一个向量（用户的embedding）</li>
</ul>
</li>
<li>
<p>矩阵B的存储和索引比较复杂。</p>
</li>
</ol>
<h3 id="线上服务-1"><a class="header" href="#线上服务-1">线上服务</a></h3>
<ol>
<li>把用户ID作为key查询key-value 表，得到该用户的向量，记作a。</li>
<li>最近邻查找：查找用户最有可能感兴趣的k个物品，作为召回结果。
<ul>
<li>第<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>号物品的 embedding 向量记作<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>内积<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span>是用户对第<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>号物品兴趣的预估。</li>
<li>返回内积最大的<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>个物品。</li>
</ul>
</li>
</ol>
<p>如果枚举所有物品，时间复杂度正比于物品数量。</p>
<h3 id="近似最近邻查找approximate-nearest-neighbor-search"><a class="header" href="#近似最近邻查找approximate-nearest-neighbor-search">近似最近邻查找（Approximate Nearest Neighbor Search）</a></h3>
<p>支持最近邻查找的系统：Milvus、Faiss、HnswLib等等</p>
<p>衡量最近邻的标准：</p>
<ul>
<li>欧式距离最小（L2距离）</li>
<li>向量内积最大（内积相似度）</li>
<li>向量夹角余弦最大（cosine相似度）</li>
</ul>
<h3 id="总结-5"><a class="header" href="#总结-5">总结</a></h3>
<p>矩阵补充：</p>
<ul>
<li>把物品ID、用户ID做embedding，映射成向量。</li>
<li>两个向量的内积<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span>作为用户<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span>对物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>兴趣的预估。</li>
<li>让<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span>拟合真实观测的兴趣分数，学习模型的 embedding 层参数。</li>
<li>矩阵补充模型有很多缺点，效果不好。</li>
</ul>
<p>线上召回：</p>
<ul>
<li>把用户向量a作为 query，查找使得<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span></span></span></span>最大化的物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>。</li>
<li>暴力枚举速度太慢。实践中用近似最近邻查找。</li>
<li>Milvus、Faiss、HnswLib等向量数据库支持近似最近邻查找。</li>
</ul>
<h1 id="双塔模型"><a class="header" href="#双塔模型">双塔模型</a></h1>
<p>用户塔、物品塔各输出一个向量。</p>
<p>两个向量的余弦相似度作为兴趣的预估值。</p>
<p>三种训练方式：</p>
<ul>
<li>Pointwise：每次用一个用户、一个物品（可正可负）</li>
<li>Pairwise：每次用一个用户、一个正样本、一个负样本</li>
<li>Listwise：每次用一个用户、一个正样本、多个负样本。</li>
</ul>
<p>正样本：曝光而且有点击</p>
<p>简单负样本：</p>
<ul>
<li>全体物品</li>
<li>batch内负样本</li>
</ul>
<p>困难负样本：被召回，但是被排序淘汰。</p>
<p>错误：曝光、但是未点击的物品做召回的负样本。</p>
<p>双塔模型</p>
<ul>
<li>用户塔、物品塔各输出一个向量；两个向量的余弦相似度作为兴趣的预估值。</li>
<li>三种训练的方式：pointwise、pairwise、listwise</li>
<li>正样本：用户点击过的物品。</li>
<li>负样本：全体物品（简单）、被排序淘汰的物品（困难）。</li>
</ul>
<p>召回</p>
<ul>
<li>做完训练，把物品向量存储到向量数据库，供线上最近邻查找。</li>
<li>线上召回时，给定用户ID、用户画像，调用用户塔现算用户向量a。</li>
<li>把a作为query，查询向量数据库，找到余弦相似度最高的k个物品向量，返回k个物品ID。</li>
</ul>
<p>更新模型</p>
<ul>
<li>全量更新：今天凌晨，用昨天的数据训练整个神经网络；做1 epoch 的随机梯度下降。</li>
<li>增量更新：用实时数据训练神经网络，只更新ID Embedding，锁住全连接层。</li>
</ul>
<p>实际的系统：</p>
<ul>
<li>全量更新&amp;增量更新相结合。</li>
<li>每隔几十分钟，发布最新的用户ID Embedding，供用户塔在线上计算用户向量。</li>
</ul>
<p>双塔模型学不好低曝光物品的向量表征。（这是数据的问题）</p>
<p>自监督学习：</p>
<ul>
<li>对物品做随机特征变换。</li>
<li>特征向量<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0106em;vertical-align:-0.2587em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0106em;vertical-align:-0.2587em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span></span></span></span>相似度高（相同物品）</li>
<li>特征向量<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0106em;vertical-align:-0.2587em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1467em;vertical-align:-0.3948em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span></span></span></span>相似度低（不同物品）</li>
</ul>
<p>实验效果：低曝光物品、新物品的推荐变得更准。</p>
<p>对点击做随机抽样，得到n对用户—物品二元组，作为一个batch。</p>
<p>做梯度下降，使得损失减小：</p>
<p>总的损失 = 双塔模型的损失 + 自监督学习的损失即<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">cos</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3175em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">main</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.2809em;vertical-align:-0.4358em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">self</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span></p>
<h2 id="模型结构训练方法"><a class="header" href="#模型结构训练方法">模型结构、训练方法</a></h2>
<p>双塔模型（two-tower）也叫 DSSM，是推荐系统中最重要的召回通道，没有之一。这节课的内容是双塔模型的结构、训练方式。</p>
<p>双塔模型有两个塔：用户塔、物品塔。两个塔各输出一个向量，作为用户、物品的表征。两个向量的內积或余弦相似度作为对兴趣的预估。</p>
<p>有三种训练双塔模型的方式：pointwise、pairwise、listwise。</p>
<h3 id="模型结构"><a class="header" href="#模型结构">模型结构</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250309103143.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250309103123.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250216093614.png" alt="" /></p>
<h3 id="双塔模型的训练"><a class="header" href="#双塔模型的训练">双塔模型的训练</a></h3>
<ul>
<li>Pointwise：独立看待每个正样本、负样本；做简单的二元分类</li>
<li>Pairwise：每次取一个正样本、一个负样本[1]</li>
<li>Listwise：每次取一个正样本、多个负样本[2]</li>
</ul>
<h4 id="正负样本的选择"><a class="header" href="#正负样本的选择">正负样本的选择</a></h4>
<ul>
<li>正样本：用户点击的物品</li>
<li>负样本<code>[1,2]</code>:
<ul>
<li>没有被召回的？</li>
<li>召回但是被粗排、精排淘汰的？</li>
<li>曝光但是未点击的？</li>
</ul>
</li>
</ul>
<h4 id="pointwise训练"><a class="header" href="#pointwise训练">Pointwise训练</a></h4>
<ul>
<li>把召回看做二元分类任务。</li>
<li>对于正样本’鼓励cos(a,b)接近+1</li>
<li>对于负样本鼓励cos(a,b)接近－1</li>
<li>控制正负样本数量为 1:2 或者 1:3。</li>
</ul>
<h4 id="pairwise训练"><a class="header" href="#pairwise训练">Pairwise训练</a></h4>
<p>基本想法：鼓励<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0213em;vertical-align:-0.25em;"></span><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 大于 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0213em;vertical-align:-0.25em;"></span><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250309103557.png" alt="" /></p>
<p>常用损失函数：</p>
<ul>
<li>Triplet hinge loss</li>
<li>Triplet logistic loss</li>
</ul>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0713em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord textbf">Triplet hinge loss:</span></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mop">max</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textbf">Triplet logistic loss:</span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1.0713em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop">exp</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">.</span></span></span></span></span></p>
<h4 id="listwise训练"><a class="header" href="#listwise训练">Listwise训练</a></h4>
<p>一条数据包含：</p>
<ul>
<li>一个用户，特征向量记作 a。</li>
<li>一个正样本，特征向量记作b+。</li>
<li>多个负样本，特征向量记作<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0778em;vertical-align:-0.2663em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8115em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1031em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>。</li>
</ul>
<p>鼓励 cos(a,b+）尽量大</p>
<p>鼓励 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0778em;vertical-align:-0.2663em;"></span><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8115em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1031em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>,<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0213em;vertical-align:-0.25em;"></span><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>尽量小</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250216094900.png" alt="" /></p>
<h4 id="不适用于召回的模型"><a class="header" href="#不适用于召回的模型">不适用于召回的模型</a></h4>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250216095822.png" alt="" /></p>
<p>这里是前期融合，常用于粗排或精排，而双塔模型是后期融合。</p>
<h2 id="正负样本"><a class="header" href="#正负样本">正负样本</a></h2>
<p>这节课讲解双塔模型（two-tower，也叫 DSSM）正负样本的选取。正样本是有点击的物品。负样本是被召回、排序淘汰的物品，分为简单负样本和困难负样本。</p>
<h3 id="正样本"><a class="header" href="#正样本">正样本</a></h3>
<p>正样本：曝光而且有点击的用户一物品二元组。（用户对物品感兴趣）。</p>
<p>问题：少部分物品占据大部分点击，导致正样本大多是热门物品。</p>
<p>解决方案：过采样冷门物品，或降采样热门物品。</p>
<ul>
<li>过采样（up-sampling）：一个样本出现多次。</li>
<li>降采样（down-sampling）：一些样本被抛弃。</li>
</ul>
<h3 id="简单负样本全体物品"><a class="header" href="#简单负样本全体物品">简单负样本：全体物品</a></h3>
<ul>
<li>未被召回的物品，大概率是用户不感兴趣的。</li>
<li>未被召回的物品 ≈全体物品</li>
<li>从全体物品中做抽样；作为负样本。</li>
<li>均匀抽样or非均匀抽样?</li>
</ul>
<h4 id="均匀抽样和非均抽采样"><a class="header" href="#均匀抽样和非均抽采样">均匀抽样和非均抽采样</a></h4>
<p>均匀抽样：对冷门物品不公平</p>
<ul>
<li>正样本大多是热门物品。</li>
<li>如果均匀抽样产生负样本，负样本大多是冷门物品。</li>
</ul>
<p>非均抽采样：目的是打压热门物品</p>
<ul>
<li>负样本抽样概率与热门程度（点击次数）正相关。</li>
<li>抽样概率正比于<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">点击次数</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0.75</span></span></span></span></span></span></span></span></span></span></span></span>，其中0.75是个经验值。</li>
</ul>
<h3 id="batch内负样本"><a class="header" href="#batch内负样本">Batch内负样本</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250309104632.png" alt="" /></p>
<p>一个batch 内有 n个正样本，一个用户和n－1个物品组成负样本。这个 batch 内一共有 n(n － 1) 个负样本。这些负样本都是简单负样本。（因为第一个用户不喜欢第二个物品。）</p>
<p>一个物品出现在 batch 内的概率正比于点击次数。</p>
<p>物品成为负样本的概率本该是正比于<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">点击次数</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mord">.75</span></span></span></span>，但在这里是正比于点击次数。</p>
<p>热门物品成为负样本的概率过大。</p>
<p>物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>被抽样到的概率<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>正比于点击次数。</p>
<p>预估用户对物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>的兴趣<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<p>根据YouTube论文的建议，做训练的时候，可以把<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>调整为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，这样可以纠偏，避免过度打压热门物品。训练结束之后，在线上召回时，还是使用原本的余弦相似度<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。</p>
<h3 id="困难负样本"><a class="header" href="#困难负样本">困难负样本</a></h3>
<ul>
<li>被粗排淘汰的物品（比较困难）</li>
<li>精排分数靠后的物品（非常困难）</li>
</ul>
<p>对正负样本做二元分类：</p>
<ul>
<li>全体物品（简单）分类准确率高。</li>
<li>被粗排淘汰的物品（比较困难）容易分错。</li>
<li>精排分数靠后的物品（非常困难）更容易分错。</li>
</ul>
<h3 id="训练数据"><a class="header" href="#训练数据">训练数据</a></h3>
<ul>
<li>混合几种负样本。</li>
<li>50%的负样本是全体物品（简单负样本）</li>
<li>50%的负样本是没通过排序的物品（困难负样本）</li>
</ul>
<h3 id="常见的错误"><a class="header" href="#常见的错误">常见的错误</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250216103942.png" alt="" /></p>
<h3 id="选择负样本的原理"><a class="header" href="#选择负样本的原理">选择负样本的原理</a></h3>
<p>召回的目标：快速找到用户可能感兴趣的物品。</p>
<p>全体物品（easy）：绝大多数是用户根本不感兴趣的。</p>
<p>被排序淘汰（hard）：用户可能感兴趣’但是不够感兴趣。</p>
<p>有曝光没点击（没用）：用户感兴趣，可能碰巧没有点击。<strong>有曝光没点击（没用）的物品可以作为排序的负样本，不能作为召回的负样本。</strong></p>
<h2 id="双塔模型的线上召回"><a class="header" href="#双塔模型的线上召回">双塔模型的线上召回</a></h2>
<p>这节课讲解双塔模型（two-tower，也叫 DSSM）的线上服务和模型更新。</p>
<p>在开始线上服务之前，需要把物品向量存储到Milvus、Faiss、HnswLib这类向量数据库，供最近邻查找（KNN 或 ANN）。当用户发起推荐请求时，用户塔用用户ID和用户画像现算一个用户向量，作为query，去向量数据库中做最近邻查找。</p>
<p>模型需要定期做更新，分为全量更新（天级别）和增量更新（实时）。全量更新会训练整个模型，包括embedding和全连接层。而增量更新只需要训练embedding层。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250309111327.png" alt="" /></p>
<p>离线存储：把物品向量b 存入向量数据库。</p>
<ol>
<li>完成训练之后，用物品塔计算每个物品的特征向量b；</li>
<li>把几亿个物品向量b存入向量数据库（比如Milvus、Faiss 、HnswLib）</li>
<li>向量数据库建索引，以便加速最近邻查找。</li>
</ol>
<p>线上召回：查找用户最感兴趣的k个物品。</p>
<ol>
<li>给定用户ID和画像，线上用神经网络算用户向量a。</li>
<li>最近邻查找：把向量a作为query，调用向量数据库做最近邻查找。返回余弦相似度最大的k个物品，作为召回结果。</li>
</ol>
<p>思考问题：事先存储物品向量b，线上现算用户向量a，why？</p>
<ul>
<li>每做一次召回，用到一个用户向量a，几亿物品向量b。（线上算物品向量的代价过大。）</li>
<li>用户兴趣动态变化，而物品特征相对稳定。（可以离线存储用户向量，但不利于推荐效果。)</li>
</ul>
<h2 id="模型更新"><a class="header" href="#模型更新">模型更新</a></h2>
<h3 id="全量更新"><a class="header" href="#全量更新">全量更新</a></h3>
<p>全量更新：今天凌晨，用昨天全天的数据训练模型。</p>
<ul>
<li>在昨天模型参数的基础上做训练。（不是随机初始化）</li>
<li>用昨天的数据，训练1 epoch，即每天数据只用一遍。</li>
<li>发布新的用户塔神经网络和物品向量，供线上召回使用。</li>
<li>全量更新对数据流、系统的要求比较低。</li>
</ul>
<h3 id="增量更新"><a class="header" href="#增量更新">增量更新</a></h3>
<p>增量更新：做 online learning 更新模型参数</p>
<ul>
<li>用户兴趣会随时发生变化。</li>
<li>实时收集线上数据，做流式处理，生成TFRecord文件</li>
<li>对模型做 online learning，增量更新 ID Embedding 参数。（不更新神经网络其他部分的参数。）</li>
<li>发布用户IDEmbedding，供用户塔在线上计算用户向量。</li>
</ul>
<h3 id="全量更新-vs-增量更新"><a class="header" href="#全量更新-vs-增量更新">全量更新 VS 增量更新</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250216105707.png" alt="" /></p>
<p>思考问题：能否只做增量更新，不做全量更新？</p>
<p>只做增量更新，不做全量更新的方式推荐效果较差。</p>
<ul>
<li>小时级数据有偏；分钟级数据偏差更大</li>
<li>全量更新：random shuffle一天的数据，做 1 epoch 训练，来消除偏差。</li>
<li>增量更新：按照数据从早到晚的顺序；做1 epoch 训练</li>
<li>随机打乱优于按顺序排列数据，全量训练优于增量训练。</li>
</ul>
<h2 id="双塔模型自监督学习"><a class="header" href="#双塔模型自监督学习">双塔模型+自监督学习</a></h2>
<p>前几节课详细讲解了双塔模型。这节课介绍一种改进双塔模型的方法，叫做自监督学习（self-supervised learning），用在双塔模型上可以提升业务指标。这种方法由谷歌在2021年提出，工业界（包括小红书）普遍验证有效。</p>
<p>参考文献：</p>
<ul>
<li>Tiansheng Yao et al. Self-supervised Learning for Large-scale Item Recommendations. In CIKM, 2021.</li>
</ul>
<h3 id="双塔模型的问题"><a class="header" href="#双塔模型的问题">双塔模型的问题</a></h3>
<p>推荐系统的头部效应严重：</p>
<ul>
<li>少部分物品占据大部分点击。</li>
<li>大部分物品的点击次数不高。</li>
</ul>
<p>高点击物品的表征学得好，长尾物品的表征学得不好。</p>
<p>自监督学习：做data augmentation，更好地学习长尾物品的向量表征。</p>
<p>训练双塔模型时，batch内负样本打压热门物品，需要纠偏。</p>
<h3 id="自监督学习"><a class="header" href="#自监督学习">自监督学习</a></h3>
<p>物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>的两个向量表征<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0106em;vertical-align:-0.2587em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span></span></span></span>;和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0106em;vertical-align:-0.2587em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span></span></span></span>有较高的相似度，物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>的向量表征<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0106em;vertical-align:-0.2587em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1467em;vertical-align:-0.3948em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span></span></span></span>有较低的相似度，鼓励 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0106em;vertical-align:-0.2587em;"></span><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>尽量大<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1467em;vertical-align:-0.3948em;"></span><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3948em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>尽量小。</p>
<p>常用方法：</p>
<ul>
<li>特征变换：Random Mask</li>
<li>特征变换：Dropout（仅对多值离散特征生效）</li>
<li>特征变换：互补特征（complementary）</li>
<li>特征变换：Mask一组关联的特征</li>
</ul>
<h4 id="特征变换random-mask"><a class="header" href="#特征变换random-mask">特征变换Random Mask</a></h4>
<p>随机选一些离散特征（比如类目），把它们遮住。</p>
<p>例：某物品的类目特征是U={数码,摄影}，Mask后的类目特征是U'={default}。</p>
<h4 id="特征变换dropout仅对多值离散特征生效"><a class="header" href="#特征变换dropout仅对多值离散特征生效">特征变换：Dropout（仅对多值离散特征生效）</a></h4>
<p>一个物品可以有多个类目，那么类目是一个多值离散特征。</p>
<p>Dropout：随机丢弃特征中50%的值。</p>
<p>例：某物品的类目特征是U={美妆,摄影}。Dropout 后的类目特征是U'={美妆}。</p>
<h4 id="特征变换互补特征complementary"><a class="header" href="#特征变换互补特征complementary">特征变换：互补特征（complementary）</a></h4>
<p>假设物品一共有4种特征：ID，类目，关键词，城市</p>
<p>随机分成两组：{ID，关键词}和{类目，城市}</p>
<p>{ID，default，关键词，default}→物品表征</p>
<p>{default，类目，default，城市}→物品表征</p>
<h4 id="特征变换mask一组关联的特征"><a class="header" href="#特征变换mask一组关联的特征">特征变换：Mask一组关联的特征</a></h4>
<p>受众性别：U={男,女,中性}</p>
<p>类目：V ={美妆,数码,足球,摄影,科技,··}</p>
<p>u=女和v=美妆同时出现的概率<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span>大。</p>
<p>u=女和v=数码同时出现的概率<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span>小。</p>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mclose">)</span></span></span></span>：某特征取值为u的概率。</p>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span>：某特征取值为u，另一个特征取值为v，同时发生的概率。</p>
<p>离线计算特征两两之间的关联，用互信息（mutual information）衡量。</p>
<p>设一共有k种特征。离线计算特征两两之间MI，得到 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 的矩阵。随机选一个特征作为种子，找到种子最相关的<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord">/2</span></span></span></span>种特征。Mask 种子及其相关的<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord">/2</span></span></span></span>种特征，保留其余的<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord">/2</span></span></span></span>种特征。</p>
<p>好处：比 random mask、dropout、互补特征等方法效果更好。</p>
<p>坏处：方法复杂，实现的难度大，不容易维护。</p>
<h3 id="训练模型"><a class="header" href="#训练模型">训练模型</a></h3>
<p>从全体物品中均匀抽样，得到m个物品；作为一个 batch。做两类特征变换，物品塔输出两组向量。计算第<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>个物品的损失函数。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250309113955.png" alt="" /></p>
<p>构建自监督学习的损失函数，做梯度下降，减小自监督学习的损失。</p>
<h1 id="deep-retrieval"><a class="header" href="#deep-retrieval">Deep Retrieval</a></h1>
<p>经典的双塔模型把用户、物品表示为向量，线上做最近邻查找。</p>
<p>Deep Retrieval[1]把物品表征为路径（path），线上查找用户最匹配的路径。</p>
<p>Deep Retrieval 类似于阿里的 TDM[2]。</p>
<p>参考文献：</p>
<ol>
<li>Weihao Gao et al. Learning A Retrievable Structure for Large-Scale Recommendations. In CIKM, 2021.</li>
<li>Han Zhu et al. Learning Tree-based Deep Model for Recommender Systems. In KDD, 2018.</li>
</ol>
<h2 id="outline"><a class="header" href="#outline">Outline</a></h2>
<ol>
<li>索引：
<ul>
<li>路径→List&lt;物品&gt;</li>
<li>物品 → List&lt;路径&gt;</li>
</ul>
</li>
<li>预估模型：神经网络预估用户对路径的兴趣</li>
<li>线上召回：用户→路径→物品。</li>
<li>训练：
<ul>
<li>学习神经网络参数。</li>
<li>学习物品表征（物品→路径）</li>
</ul>
</li>
</ol>
<h1 id="其他召回通道"><a class="header" href="#其他召回通道">其他召回通道</a></h1>
<h2 id="地理位置召回"><a class="header" href="#地理位置召回">地理位置召回</a></h2>
<h3 id="geohash召回"><a class="header" href="#geohash召回">GeoHash召回</a></h3>
<p>用户可能对附近发生的事情感兴趣。</p>
<p>GeoHash是对经纬度的编码，代表地图上一个长方形区域。</p>
<p>索引：GeoHash-&gt;优质笔记列表（按时间倒排）。</p>
<p>这条召回通道没有个性化处理。</p>
<p>根据用户定位的GeoHash，取回该地点最新的 k 篇优质笔记。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250309101152.png" alt="" /></p>
<h3 id="同城召回"><a class="header" href="#同城召回">同城召回</a></h3>
<p>用户可能对同城发生的事感兴趣。</p>
<p>索引：城市→优质笔记列表（按时间倒排）</p>
<p>这条召回通道也没有个性化处理。</p>
<h2 id="作者召回"><a class="header" href="#作者召回">作者召回</a></h2>
<h3 id="关注作者召回"><a class="header" href="#关注作者召回">关注作者召回</a></h3>
<p>用户对关注的作者发布的笔记感兴趣。</p>
<p>索引：</p>
<ul>
<li>用户→ 关注的作者</li>
<li>作者 →发布的笔记</li>
</ul>
<p>召回：用户→关注的作者→最新的笔记</p>
<h3 id="有交互的作者召回"><a class="header" href="#有交互的作者召回">有交互的作者召回</a></h3>
<p>如果用户对某笔记感兴趣（点赞、收藏、转发），那么用户可能对该作者的其他笔记感兴趣。</p>
<p>索引：用户→有交互的作者</p>
<p>召回：用户→有交互的作者→最新的笔记</p>
<h3 id="相似作者召回"><a class="header" href="#相似作者召回">相似作者召回</a></h3>
<p>如果用户喜欢某作者，那么用户喜欢相似的作者。</p>
<p>索引：作者→相似作者（k 个作者）</p>
<p>召回：用户→感兴趣的作者（n 个作者）→相似作者（nk 个作者）→最新的笔记（nk 篇笔记）</p>
<h2 id="缓存召回"><a class="header" href="#缓存召回">缓存召回</a></h2>
<p>想法：复用前n次推荐精排的结果</p>
<p>背景：</p>
<ul>
<li>精排输出几百篇笔记，送入重排。</li>
<li>重排做多样性抽样，选出几十篇。</li>
<li>精排结果一大半没有曝光，被浪费。</li>
</ul>
<p>精排前50，但是没有曝光的，缓存起来，作为一条召回通道。</p>
<h3 id="退场机制"><a class="header" href="#退场机制">退场机制</a></h3>
<p>缓存大小固定，需要退场机制。</p>
<p>一旦笔记成功曝光，就从缓存退场。</p>
<p>如果超出缓存大小，就移除最先进入缓存的笔记。</p>
<p>笔记最多被召回10次，达到10次就退场。</p>
<p>每篇笔记最多保存3天，达到3天就退场。</p>
<h1 id="曝光过滤bloom-filter"><a class="header" href="#曝光过滤bloom-filter">曝光过滤&amp;Bloom Filter</a></h1>
<h2 id="曝光过滤问题"><a class="header" href="#曝光过滤问题">曝光过滤问题</a></h2>
<p>如果用户看过某个物品，则不再把该物品曝光给该用户。</p>
<p>对于每个用户，记录已经曝光给他的物品。（小红书只召回1个月以内的笔记，因此只需要记录每个用户最近1个月的曝光历史。）</p>
<p>对于每个召回的物品，判断它是否已经给该用户曝光过，排除掉曾经曝光过的物品。</p>
<p>一位用户看过<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>个物品，本次召回<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>个物品，如果暴力对比，需要<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span>的时间。</p>
<h2 id="bloom-filter"><a class="header" href="#bloom-filter">Bloom Filter</a></h2>
<p>Bloom filter 判断一个物品ID是否在已曝光的物品集合中。</p>
<p>如果判断为no，那么该物品一定不在集合中。</p>
<p>如果判断为yes，那么该物品很可能在集合中。（可能误伤，错误判断未曝光物品为已曝光，将其过滤掉。）</p>
<p>Bloom filter 把物品集合表征为一个m 维二进制向量。</p>
<p>每个用户有一个曝光物品的集合，表征为一个向量，需要m bit的存储。</p>
<p>Bloom filter 有k个哈希函数，每个哈希函数把物品 ID 映射成介于0和m一1之间的整数。</p>
<p>参考文献：</p>
<ul>
<li>Burton H. Bloom. Space/time trade-offs in hash coding with allowable errors. Communications of the ACM, 1970.</li>
</ul>
<h3 id="架构图"><a class="header" href="#架构图">架构图</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250308112810.png" alt="" /></p>
<p>曝光物品集合大小为n，二进制向量维度为m，使用k个哈希函数。</p>
<p>Bloom filter 误伤的概率为 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">((</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.2251em;vertical-align:-0.345em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">kn</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span></p>
<ul>
<li>n越大，向量中的1越多，误伤概率越大。（未曝光物品的 k 个位置恰好都是1的概率大。）</li>
<li>m越大，向量越长，越不容易发生哈希碰撞。</li>
<li>k太大、太小都不好，k有最优取值。</li>
</ul>
<h3 id="曝光过滤的链路"><a class="header" href="#曝光过滤的链路">曝光过滤的链路</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250308113105.png" alt="" /></p>
<h3 id="bloom-filter的缺点"><a class="header" href="#bloom-filter的缺点">Bloom Filter的缺点</a></h3>
<p>Bloom filter 把物品的集合表示成一个二进制向量。</p>
<p>每往集合中添加一个物品，只需要把向量k个位置的元素置为1。（如果原本就是1，则不变。）</p>
<p>Bloom filter只支持添加物品，不支持删除物品。从集合中移除物品，无法消除它对向量的影响。</p>
<p>每天都需要从物品集合中移除年龄大于1个月的物品。（超龄物品不可能被召回，没必要把它们记录在 Bloom filter，降低n可以降低误伤率。）</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="排序"><a class="header" href="#排序">排序</a></h1>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E5%A4%9A%E7%9B%AE%E6%A0%87%E6%A8%A1%E5%9E%8B">多目标模型</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%93%BE%E8%B7%AF">推荐系统的链路</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E7%94%A8%E6%88%B7%E4%B8%80%E7%AC%94%E8%AE%B0%E7%9A%84%E4%BA%A4%E4%BA%92">用户一笔记的交互</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E6%8C%87%E6%A0%87%E8%AE%A1%E7%AE%97%E5%85%AC%E5%BC%8F">指标计算公式</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E6%8E%92%E5%BA%8F%E7%9A%84%E4%BE%9D%E6%8D%AE">排序的依据</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E5%A4%9A%E7%9B%AE%E6%A0%87%E6%A8%A1%E5%9E%8B%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E5%9B%BE">多目标模型系统架构图</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E8%AE%AD%E7%BB%83">训练</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E9%A2%84%E4%BC%B0%E5%80%BC%E6%A0%A1%E5%87%86">预估值校准</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#multi-gate-mixture-of-expertsmmoe">Multi-gate Mixture-of-Experts(MMoE)</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E6%9E%B6%E6%9E%84%E5%9B%BE">架构图</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E6%9E%81%E5%8C%96%E7%8E%B0%E8%B1%A1polarization">极化现象（Polarization）</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E8%A7%A3%E5%86%B3%E6%9E%81%E5%8C%96%E9%97%AE%E9%A2%98">解决极化问题</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">参考文献</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E9%A2%84%E4%BC%B0%E5%88%86%E6%95%B0%E8%9E%8D%E5%90%88">预估分数融合</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E7%AE%80%E5%8D%95%E7%9A%84%E5%8A%A0%E6%9D%83%E5%92%8C">简单的加权和</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E7%82%B9%E5%87%BB%E7%8E%87%E4%B9%98%E4%BB%A5%E5%85%B6%E4%BB%96%E9%A1%B9%E7%9A%84%E5%8A%A0%E6%9D%83%E5%92%8C">点击率乘以其他项的加权和</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E6%B5%B7%E5%A4%96%E6%9F%90%E7%9F%AD%E8%A7%86%E9%A2%91app%E7%9A%84%E8%9E%8D%E5%88%86%E5%85%AC%E5%BC%8F">海外某短视频APP的融分公式</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E5%9B%BD%E5%86%85%E6%9F%90%E7%9F%AD%E8%A7%86%E9%A2%91app%E7%9A%84%E8%9E%8D%E5%88%86%E5%85%AC%E5%BC%8F">国内某短视频APP的融分公式</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E6%9F%90%E7%94%B5%E5%95%86%E7%9A%84%E8%9E%8D%E5%88%86%E5%85%AC%E5%BC%8F">某电商的融分公式</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%BB%BA%E6%A8%A1">视频播放建模</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E5%9B%BE%E6%96%87-vs-%E8%A7%86%E9%A2%91">图文 VS 视频</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E6%97%B6%E9%95%BF%E5%BB%BA%E6%A8%A1">视频播放时长建模</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E8%A7%86%E9%A2%91%E5%AE%8C%E6%92%AD">视频完播</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E5%9B%9E%E5%BD%92%E6%96%B9%E6%B3%95">回归方法</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E4%BA%8C%E5%85%83%E5%88%86%E7%B1%BB%E6%96%B9%E6%B3%95">二元分类方法</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E6%8E%92%E5%BA%8F%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%89%B9%E5%BE%81">排序模型的特征</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E7%94%A8%E6%88%B7%E7%94%BB%E5%83%8Fuser-profile">用户画像(User Profile)</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E7%89%A9%E5%93%81%E7%94%BB%E5%83%8Fitem-profile">物品画像(Item Profile)</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E7%94%A8%E6%88%B7%E7%BB%9F%E8%AE%A1%E7%89%B9%E5%BE%81">用户统计特征</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E7%AC%94%E8%AE%B0%E7%BB%9F%E8%AE%A1%E7%89%B9%E5%BE%81">笔记统计特征</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E5%9C%BA%E6%99%AF%E7%89%B9%E5%BE%81context">场景特征(Context)</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E7%89%B9%E5%BE%81%E5%A4%84%E7%90%86">特征处理</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E5%B0%8F%E7%BB%93">小结</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E7%89%B9%E5%BE%81%E8%A6%86%E7%9B%96%E7%8E%87">特征覆盖率</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E6%95%B0%E6%8D%AE%E6%9C%8D%E5%8A%A1">数据服务</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E7%B2%97%E6%8E%92%E6%A8%A1%E5%9E%8B">粗排模型</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E7%B2%97%E6%8E%92-vs-%E7%B2%BE%E6%8E%92">粗排 VS 精排</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E7%B2%BE%E6%8E%92%E6%A8%A1%E5%9E%8B%E5%92%8C%E5%8F%8C%E5%A1%94%E6%A8%A1%E5%9E%8B">精排模型和双塔模型</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E5%B0%8F%E7%BA%A2%E4%B9%A6%E7%B2%97%E6%8E%92%E7%9A%84%E4%B8%89%E5%A1%94%E6%A8%A1%E5%9E%8B">小红书粗排的三塔模型</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E6%9E%B6%E6%9E%84">架构</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%8E%92%E5%BA%8F.html#%E4%B8%89%E5%A1%94%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%8E%A8%E7%90%86">三塔模型的推理</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="多目标模型"><a class="header" href="#多目标模型">多目标模型</a></h1>
<h2 id="推荐系统的链路"><a class="header" href="#推荐系统的链路">推荐系统的链路</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250308094242.png" alt="" /></p>
<h2 id="用户一笔记的交互"><a class="header" href="#用户一笔记的交互">用户一笔记的交互</a></h2>
<p>对于每篇笔记，系统记录：</p>
<ul>
<li>曝光次数（number of impressions）</li>
<li>点击次数(number of clicks)</li>
<li>点赞次数（number of likes）</li>
<li>收藏次数（number of collects）</li>
<li>转发次数（number of shares）</li>
</ul>
<h3 id="指标计算公式"><a class="header" href="#指标计算公式">指标计算公式</a></h3>
<ul>
<li>点击率=点击次数／曝光次数</li>
<li>点赞率=点赞次数／点击次数</li>
<li>收藏率=收藏次数／点击次数</li>
<li>转发率=转发次数/点击次数</li>
</ul>
<h3 id="排序的依据"><a class="header" href="#排序的依据">排序的依据</a></h3>
<ul>
<li>排序模型预估点击率、点赞率、收藏率、转发率等多种分数。</li>
<li>融合这些预估分数。（比如加权和。）</li>
<li>根据融合的分数做排序、截断。</li>
</ul>
<h2 id="多目标模型系统架构图"><a class="header" href="#多目标模型系统架构图">多目标模型系统架构图</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221091210.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221091133.png" alt="" /></p>
<h2 id="训练"><a class="header" href="#训练">训练</a></h2>
<p>困难：类别不平衡。</p>
<ul>
<li>每100次曝光，约有10次点击、90次无点击</li>
<li>每100次点击，约有10次收藏、90次无收藏</li>
</ul>
<p>解决方案：负样本降采样(down-sampling)</p>
<ul>
<li>保留一小部分负样本。</li>
<li>让正负样本数量平衡，节约计算。</li>
</ul>
<h2 id="预估值校准"><a class="header" href="#预估值校准">预估值校准</a></h2>
<p>正样本、负样本数量分别为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2583em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2583em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>。对负样本做降采样，抛弃一部分负样本。使用<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2583em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>个负样本，<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>是采样率。由于负样本变少，预估点击率大于真实点击率。</p>
<p>真实点击率：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2399em;vertical-align:-0.4868em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7532em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2737em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2025em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2737em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2025em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4518em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2737em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2025em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4868em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord cjk_fallback">期望</span><span class="mclose">)</span></span></span></span></p>
<p>预估点击率：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">==</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2399em;vertical-align:-0.4868em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7532em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2737em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2025em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mbin mtight">⋅</span><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2737em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2025em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4518em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2737em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2025em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4868em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord cjk_fallback">期望</span><span class="mclose">)</span></span></span></span></p>
<p>由上面两个等式可得校准公式：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">true</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3723em;vertical-align:-0.5481em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8242em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">pred</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mpunct mtight"><span class="mpunct mtight">⋅</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">pred</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5131em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mpunct mtight"><span class="mpunct mtight">⋅</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">pred</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2901em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5481em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<p>参考文献：</p>
<ol>
<li>Xinran He et al. Practical lessons from predicting clicks on ads at Facebook. In the 8th
International Workshop on Data Mining for Online Advertising.</li>
</ol>
<h1 id="multi-gate-mixture-of-expertsmmoe"><a class="header" href="#multi-gate-mixture-of-expertsmmoe">Multi-gate Mixture-of-Experts(MMoE)</a></h1>
<h2 id="架构图-1"><a class="header" href="#架构图-1">架构图</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250308095243.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250308095218.png" alt="" /></p>
<p>一个指标对应一组权重。上图中有两个特征点击率和点赞率，所以有两组权重。</p>
<p>专家数量是个超参数，需要自己设定，通常设定为4或8。</p>
<h3 id="极化现象polarization"><a class="header" href="#极化现象polarization">极化现象（Polarization）</a></h3>
<p>极化：Softmax输出值一个接近1，其余接近0。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221091614.png" alt="" /></p>
<h2 id="解决极化问题"><a class="header" href="#解决极化问题">解决极化问题</a></h2>
<p>如果有n个“专家”，那么每个softmax的输入和输出都是n维向量。</p>
<p>在训练时，对softmax 的输出使用dropout。</p>
<ul>
<li>Softmax 输出的 n 个数值被 mask 的概率都是10%。</li>
<li>每个“专家”被随机丢弃的概率都是10%。</li>
</ul>
<h2 id="参考文献"><a class="header" href="#参考文献">参考文献</a></h2>
<p>Google 的论文[1]提出MMoE 模型。</p>
<p>YouTube 的论文[2] 提出极化问题的解决方案。</p>
<p>参考文献：</p>
<ol>
<li>Jiaqi Ma et al. Modeling Task Relationships in Multi-task Learning with Multi-gate Mixture-of-Experts. In KDD, 2018.</li>
<li>Zhe Zhao et al. Recommending What Video to Watch Next: A Multitask Ranking System. In RecSys, 2019.</li>
</ol>
<p>Tips：MMoE不一定起作用！</p>
<h1 id="预估分数融合"><a class="header" href="#预估分数融合">预估分数融合</a></h1>
<h2 id="简单的加权和"><a class="header" href="#简单的加权和">简单的加权和</a></h2>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">ik</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal mtight">ec</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.1056em;"></span><span class="mord">...</span></span></span></span></p>
<h2 id="点击率乘以其他项的加权和"><a class="header" href="#点击率乘以其他项的加权和">点击率乘以其他项的加权和</a></h2>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">ik</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal mtight">ec</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">...</span><span class="mclose">)</span></span></span></span></p>
<h2 id="海外某短视频app的融分公式"><a class="header" href="#海外某短视频app的融分公式">海外某短视频APP的融分公式</a></h2>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">im</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0037em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">ik</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mord">...</span></span></span></span></p>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>都是超参数，需要自己做AB测试手动调。</p>
<h2 id="国内某短视频app的融分公式"><a class="header" href="#国内某短视频app的融分公式">国内某短视频APP的融分公式</a></h2>
<p>根据预估时长<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">im</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>对<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>篇候选视频做排序。</p>
<p>如果某视频排名第<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">im</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>则它的得分为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4157em;vertical-align:-0.5706em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6523em;"><span style="top:-2.1777em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">im</span><span class="mord mathnormal mtight">e</span></span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3223em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.05278em;">β</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5706em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。</p>
<p>对点击、点赞、转发、评论等预估分数做类似处理。</p>
<p>最终融合分数：</p>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3536em;vertical-align:-0.6421em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7115em;"><span style="top:-2.5835em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8664em;"><span style="top:-2.1777em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">im</span><span class="mord mathnormal mtight">e</span></span></span></span><span style="top:-3.0588em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:-0.0037em;margin-right:0.1em;"><span class="pstrut" style="height:2.6444em;"></span><span class="mord mtight">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2996em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3223em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0528em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0269em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6421em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.371em;vertical-align:-0.6595em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7115em;"><span style="top:-2.5835em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8664em;"><span style="top:-2.1528em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.0588em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:-0.0037em;margin-right:0.1em;"><span class="pstrut" style="height:2.6444em;"></span><span class="mord mtight">2</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2996em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3472em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0528em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0269em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6595em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.371em;vertical-align:-0.6595em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7115em;"><span style="top:-2.5835em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8664em;"><span style="top:-2.1528em;margin-left:-0.0278em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">ik</span><span class="mord mathnormal mtight">e</span></span></span></span><span style="top:-3.0588em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3448em;margin-left:-0.0037em;margin-right:0.1em;"><span class="pstrut" style="height:2.6444em;"></span><span class="mord mtight">3</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2996em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3472em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0528em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0269em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6595em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.1056em;"></span><span class="mord">...</span></span></span></span></p>
<h2 id="某电商的融分公式"><a class="header" href="#某电商的融分公式">某电商的融分公式</a></h2>
<p>电商的转化流程：曝光→点击→加购物车→付款</p>
<p>模型预估：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>、<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>、<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>最终融合分数：</p>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0476em;vertical-align:-0.3013em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.3987em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.1449em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0037em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3013em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.992em;vertical-align:-0.2458em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.4542em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.1449em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0037em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2458em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0475em;vertical-align:-0.3831em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0037em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3831em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8588em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0037em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<h1 id="视频播放建模"><a class="header" href="#视频播放建模">视频播放建模</a></h1>
<h2 id="图文-vs-视频"><a class="header" href="#图文-vs-视频">图文 VS 视频</a></h2>
<p>图文笔记排序的主要依据：点击、点赞、收藏、转发、评论····</p>
<p>视频排序的依据还有播放时长和完播。</p>
<p>直接用回归拟合播放时长效果不好。建议用YouTube的时长建模[1] 。</p>
<p>参考文献：</p>
<ol>
<li>Paul Covington, Jay Adams, &amp; Emre Sargin. Deep Neural Networks for YouTube Recommendations. In RecSys, 2016.</li>
</ol>
<h2 id="视频播放时长建模"><a class="header" href="#视频播放时长建模">视频播放时长建模</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250308104020.png" alt="" /></p>
<p>把最后一个全连接层的输出记作z。设p= sigmoid(z)。</p>
<p>实际观测的播放时长记作t。（如果没有点击，则t=0。）</p>
<p>做训练：最小化交叉熵损失<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2533em;vertical-align:-0.4033em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8246em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span></p>
<p>实践中可以去掉分母<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></p>
<p>做推理：把exp(z)作为播放时长的预估</p>
<p>把exp(z)作为融分公式中的一项</p>
<h2 id="视频完播"><a class="header" href="#视频完播">视频完播</a></h2>
<h3 id="回归方法"><a class="header" href="#回归方法">回归方法</a></h3>
<p>例：视频长度10分钟，实际播放4分钟，则实际播放率为y=0.4</p>
<p>让预估播放率p拟合y:</p>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oss</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mord">.</span></span></span></span></p>
<p>线上预估完播率，模型输出 p=0.73，意思是预计播放73%</p>
<h3 id="二元分类方法"><a class="header" href="#二元分类方法">二元分类方法</a></h3>
<p>自定义完播指标，比如完播80%。</p>
<p>例：视频长度10分钟，播放&gt;8分钟作为正样本，播放 &lt;8分钟作为负样本。</p>
<p>做二元分类训练模型：播放&gt;80% vs 播放&lt;80%。</p>
<p>线上预估完播率，模型输出 p=0.73，意思是P(播放 &gt; 80%) = 0.73。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221093342.png" alt="" /></p>
<p>不能直接把预估的完播率用到融分公式，因为这样做对长视频不公平。</p>
<p>线上预估完播率，然后做调整：</p>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">ini</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3923em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mopen mtight">(</span><span class="mord cjk_fallback mtight">视频长度</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">预估完播率</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<p>把<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">ini</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>作为融分公式中的一项</p>
<h1 id="排序模型的特征"><a class="header" href="#排序模型的特征">排序模型的特征</a></h1>
<h2 id="用户画像user-profile"><a class="header" href="#用户画像user-profile">用户画像(User Profile)</a></h2>
<ul>
<li>用户ID（在召回、排序中做embedding）</li>
<li>人口统计学属性：性别、年龄。</li>
<li>账号信息：新老、活跃度······</li>
<li>感兴趣的类目、关键词、品牌。</li>
</ul>
<h2 id="物品画像item-profile"><a class="header" href="#物品画像item-profile">物品画像(Item Profile)</a></h2>
<ul>
<li>物品ID(在召回、排序中做embedding)</li>
<li>发布时间 （或者年龄）</li>
<li>GeoHash（经纬度编码）、所在城市。</li>
<li>标题、类目、关键词、品牌·····</li>
<li>字数、图片数、视频清晰度、标签数·······</li>
<li>内容信息量、图片美学····</li>
</ul>
<h2 id="用户统计特征"><a class="header" href="#用户统计特征">用户统计特征</a></h2>
<ul>
<li>用户最近30天（7天、1天、1小时）的曝光数、点击数、点赞数、收藏数······</li>
<li>按照笔记图文/视频分桶。（比如最近7天’该用户对图文笔记的点击率、对视频笔记的点击率。）</li>
<li>按照笔记类目分桶。（比如最近30天，用户对美妆笔记的点击率、对美食笔记的点击率、对科技数码笔记的点击率。）</li>
</ul>
<h2 id="笔记统计特征"><a class="header" href="#笔记统计特征">笔记统计特征</a></h2>
<ul>
<li>笔记最近30天（7天、1天、1小时）的曝光数、点击数、点赞数、收藏数······</li>
<li>按照用户性别分桶、按照用户年龄分桶···</li>
<li>作者特征：
<ul>
<li>发布笔记数</li>
<li>粉丝数</li>
<li>消费指标(曝光数、点击数、点赞数、收藏数)</li>
</ul>
</li>
</ul>
<h2 id="场景特征context"><a class="header" href="#场景特征context">场景特征(Context)</a></h2>
<ul>
<li>用户定位GeoHash（经纬度编码）、城市。</li>
<li>当前时刻（分段，做embedding）</li>
<li>是否是周末、是否是节假日。</li>
<li>手机品牌、手机型号、操作系统。</li>
</ul>
<h2 id="特征处理"><a class="header" href="#特征处理">特征处理</a></h2>
<p>离散特征：做embedding。</p>
<ul>
<li>用户ID、笔记ID、作者ID。</li>
<li>类目、关键词、城市、手机品牌。</li>
</ul>
<p>连续特征：做分桶，变成离散特征。</p>
<ul>
<li>年龄、笔记字数、视频长度。</li>
</ul>
<p>连续特征：其他变换。</p>
<ul>
<li>曝光数、点击数、点赞数等数值做<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>。</li>
<li>转化为点击率、点赞率等值并做平滑。做平滑处理目的：去掉偶然性带来的波动。</li>
</ul>
<h2 id="小结"><a class="header" href="#小结">小结</a></h2>
<ol>
<li>用户画像特征。</li>
<li>笔记画像特征。</li>
<li>用户统计特征。</li>
<li>笔记统计特征。</li>
<li>场景特征。</li>
</ol>
<h2 id="特征覆盖率"><a class="header" href="#特征覆盖率">特征覆盖率</a></h2>
<p>很多特征无法覆盖100%样本。</p>
<p>例：很多用户不填年龄，因此用户年龄特征的覆盖率远小于 100%。</p>
<p>例：很多用户设置隐私权限，APP不能获得用户地理定位，因此场景特征有缺失。</p>
<p>提高特征覆盖率，可以让精排模型更准。</p>
<h2 id="数据服务"><a class="header" href="#数据服务">数据服务</a></h2>
<ol>
<li>用户画像（User Profile）</li>
<li>物品画像(Item Profile)</li>
<li>统计数据</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221100708.png" alt="" /></p>
<h1 id="粗排模型"><a class="header" href="#粗排模型">粗排模型</a></h1>
<h2 id="粗排-vs-精排"><a class="header" href="#粗排-vs-精排">粗排 VS 精排</a></h2>
<p>粗排</p>
<ul>
<li>给几千篇笔记打分。</li>
<li>单次推理代价必须小。</li>
<li>预估的准确性不高。</li>
</ul>
<p>精排</p>
<ul>
<li>给几百篇笔记打分。</li>
<li>单次推理代价很大。</li>
<li>预估的准确性更高。</li>
</ul>
<h2 id="精排模型和双塔模型"><a class="header" href="#精排模型和双塔模型">精排模型和双塔模型</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221100844.png" alt="" /></p>
<p>shared bottom是共享区域。</p>
<p>精排模型特点：</p>
<ul>
<li>前期融合：先对所有特征做 concatenation  再输入神经网络。</li>
<li>线上推理代价大：如果有n篇候选笔记，整个大模型要做n次推理。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221100937.png" alt="" /></p>
<p>双塔模型适合做召回</p>
<p>双塔模型特点：</p>
<ul>
<li>后期融合：把用户、物品特征分别输入不同的神经网络；不对用户、物品特征做融合。</li>
<li>线上计算量小：
<ul>
<li>用户塔只需要做一次线上推理，计算用户表征a。</li>
<li>物品表征b事先储存在向量数据库中，物品塔在线上不做推理。</li>
</ul>
</li>
<li>预估准确性不如精排模型。</li>
</ul>
<h2 id="小红书粗排的三塔模型"><a class="header" href="#小红书粗排的三塔模型">小红书粗排的三塔模型</a></h2>
<p>参考文献：</p>
<ul>
<li>Zhe Wang et al. COLD: Towards the Next Generation of Pre-Ranking System. In DLP-KDD, 2020.</li>
</ul>
<h3 id="架构"><a class="header" href="#架构">架构</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221101124.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221101241.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221101330.png" alt="" /></p>
<h3 id="三塔模型的推理"><a class="header" href="#三塔模型的推理">三塔模型的推理</a></h3>
<p>从多个数据源取特征：</p>
<ul>
<li>1个用户的画像、统计特征。</li>
<li>n个物品的画像、统计特征。</li>
</ul>
<p>用户塔：只做1次推理。</p>
<p>物品塔：未命中缓存时需要做推理。</p>
<p>交叉塔：必须做n次推理。</p>
<p>上层网络做n次推理，给n个物品打分。</p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="特征交叉"><a class="header" href="#特征交叉">特征交叉</a></h1>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#factorized-machinefm-%E5%9B%A0%E5%BC%8F%E5%88%86%E8%A7%A3%E6%9C%BA">Factorized Machine(FM) 因式分解机</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B">线性模型</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#%E4%BA%8C%E9%98%B6%E4%BA%A4%E5%8F%89%E7%89%B9%E5%BE%81">二阶交叉特征</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B%E4%BA%8C%E9%98%B6%E4%BA%A4%E5%8F%89%E7%89%B9%E5%BE%81-vs-fm">线性模型+二阶交叉特征 VS FM</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#factorized-machine">Factorized Machine</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#dcn%E6%B7%B1%E5%BA%A6%E4%BA%A4%E5%8F%89%E7%BD%91%E7%BB%9C">DCN深度交叉网络</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#%E5%A4%9A%E7%9B%AE%E6%A0%87%E9%A2%84%E6%B5%8B">多目标预测</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#mmoe">MMoE</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#%E4%BA%A4%E5%8F%89%E5%B1%82">交叉层</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#%E5%93%88%E8%BE%BE%E7%8E%9B%E4%B9%98%E7%A7%AF-hadamard-product">哈达玛乘积 (Hadamard product)</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#a--b-beginbmatrix15--26-37--48end">A ⊙ B =$$\begin{bmatrix}15 &amp; 26 \37 &amp; 48\end</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#%E4%BA%A4%E5%8F%89%E7%BD%91%E7%BB%9C">交叉网络</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#dcn">DCN</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#%E5%8F%AA%E7%94%A8%E4%BA%8E%E7%B2%BE%E6%8E%92%E7%9A%84lhucppnet">只用于精排的LHUC（PPNet）</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#learning-hidden-unit-contributions-lhuc">Learning Hidden Unit Contributions (LHUC)</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#%E8%AF%AD%E9%9F%B3%E8%AF%86%E5%88%AB%E4%B8%AD%E7%9A%84-lhuc">语音识别中的 LHUC</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E6%8E%92%E5%BA%8F%E6%A8%A1%E5%9E%8B%E4%B8%AD%E7%9A%84-lhuc">推荐系统排序模型中的 LHUC</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#senet%E5%92%8Cbilinear%E4%BA%A4%E5%8F%89">SENet和Bilinear交叉</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#senet">SENet</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#senet%E7%89%B9%E7%82%B9">SENet特点</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#field%E9%97%B4%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89">Field间特征交叉</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#senet%E5%92%8Cfield%E9%97%B4%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89">SENet和Field间特征交叉</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%B9%E5%BE%81%E4%BA%A4%E5%8F%89.html#fibinet">FiBiNet</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="factorized-machinefm-因式分解机"><a class="header" href="#factorized-machinefm-因式分解机">Factorized Machine(FM) 因式分解机</a></h2>
<p>线性模型对输入的特征取加权和，作为对目标的预估。如果先做特征交叉，再用线性模型，通常可以取得更好的效果。如果做二阶特征交叉，那么参数量为O(特征数量平方)，计算量大，而且容易造成过拟合。因式分解机（Factorized Machine, FM）用低秩矩阵分解的方式降低参数量，加速计算。任何可以用线性模型（比如线性回归、逻辑回归）解决的问题，都可以用 FM 解决。</p>
<h3 id="线性模型"><a class="header" href="#线性模型">线性模型</a></h3>
<p>线性模型有d个特征，d+1个参数，预测是特征的加权和。（只有加，没有乘。）</p>
<h3 id="二阶交叉特征"><a class="header" href="#二阶交叉特征">二阶交叉特征</a></h3>
<p>有d个特征，线性模型+二阶交叉特征模型有$O(d^2)$个参数。</p>
<p>下面考虑如何减少参数数量。</p>
<h3 id="线性模型二阶交叉特征-vs-fm"><a class="header" href="#线性模型二阶交叉特征-vs-fm">线性模型+二阶交叉特征 VS FM</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221102045.png" alt="" /></p>
<h3 id="factorized-machine"><a class="header" href="#factorized-machine">Factorized Machine</a></h3>
<p>FM是线性模型的替代品，能用线性回归、逻辑回归的场景，都可以用FM。</p>
<p>FM使用二阶交叉特征，表达能力比线性模型更强。</p>
<p>通过做近似$u_{ij}≈ v_i^Tv_j$，FM 把二阶交叉权重的数量从$O(d^2)$降低到$O(kd)$ 。</p>
<p>现在，FM 已过时。</p>
<p>参考文献：
Steffen Rendle. Factorization machines. In ICDM, 2010</p>
<h2 id="dcn深度交叉网络"><a class="header" href="#dcn深度交叉网络">DCN深度交叉网络</a></h2>
<p>Deep &amp; Cross Networks (DCN) 译作“深度交叉网络”，可以用于召回双塔模型、粗排三塔模型、精排模型。DCN 由一个深度网络和一个交叉网络组成，交叉网络的基本组成单元是交叉层 (Cross Layer)。这节课最重点的部分就是交叉层。</p>
<h3 id="多目标预测"><a class="header" href="#多目标预测">多目标预测</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250305102214.png" alt="" /></p>
<h3 id="mmoe"><a class="header" href="#mmoe">MMoE</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250305102241.png" alt="" /></p>
<h3 id="交叉层"><a class="header" href="#交叉层">交叉层</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221102422.png" alt="" />
<img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221102553.png" alt="" /></p>
<p>类似跳跃连接（可以防止梯度消失）</p>
<h3 id="哈达玛乘积-hadamard-product"><a class="header" href="#哈达玛乘积-hadamard-product">哈达玛乘积 (Hadamard product)</a></h3>
<p>哈达玛乘积 (Hadamard product)，也称为 Schur 乘积或元素对应乘积 (element-wise product)，是矩阵的一种运算方式。它与标准的矩阵乘法不同。</p>
<p><strong>定义：</strong></p>
<p>给定两个维度相同的矩阵 A 和 B (例如，都是 m x n 的矩阵)，它们的哈达玛积 A ⊙ B 是一个同样维度的矩阵，其每个元素是由 A 和 B 相应位置的元素相乘得到的。</p>
<p>用数学公式表示：</p>
<h1 bmatrix="">$$(A ⊙ B)<sub>ij</sub> = A<sub>ij</sub> * B<sub>ij</sub><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">其中：</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊙</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord cjk_fallback">表示矩阵</span><span class="mord mathnormal">A</span><span class="mord cjk_fallback">和</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord cjk_fallback">的哈达玛积</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">ij</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">/</span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord cjk_fallback">表示矩阵</span><span class="mord mathnormal">A</span><span class="mord cjk_fallback">的第</span><span class="mord mathnormal">i</span><span class="mord cjk_fallback">行第</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord cjk_fallback">列的元素</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">ij</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">/</span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord cjk_fallback">表示矩阵</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord cjk_fallback">的第</span><span class="mord mathnormal">i</span><span class="mord cjk_fallback">行第</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord cjk_fallback">列的元素</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">∗</span><span class="mord cjk_fallback">表示普通的标量乘法</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">∗</span><span class="mord cjk_fallback">例子：</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">∗</span><span class="mord cjk_fallback">假设有两个矩阵：</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span></span></span>
\begin{bmatrix}
1 &amp; 2 \
3 &amp; 4
\end{bmatrix}
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span></span></span>
\begin{bmatrix}
5 &amp; 6 \
7 &amp; 8
\end{bmatrix}
<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">那么它们的哈达玛积</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊙</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord cjk_fallback">为：</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊙</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span></span></span>
\begin{bmatrix}
1<em>5 &amp; 2</em>6 \
3<em>7 &amp; 4</em>8
\end</h1>
<p>\begin{bmatrix}
5 &amp; 12 \
21 &amp; 32
\end{bmatrix}
$$</p>
<p><strong>与标准矩阵乘法的区别：</strong></p>
<ul>
<li><strong>哈达玛积：</strong> 要求参与运算的矩阵维度完全相同，结果矩阵的维度也与输入矩阵相同，每个元素是对应位置元素相乘。</li>
<li><strong>标准矩阵乘法：</strong> 要求第一个矩阵的列数等于第二个矩阵的行数，结果矩阵的维度取决于输入矩阵的维度，元素是通过行向量和列向量的点积计算得到的。</li>
</ul>
<p><strong>应用：</strong></p>
<p>哈达玛积在很多领域都有应用，包括：</p>
<ul>
<li><strong>图像处理：</strong>  可以用于图像的像素级操作，例如改变图像的亮度或对比度。</li>
<li><strong>神经网络：</strong> 在某些神经网络结构中，哈达玛积被用作一种非线性操作。</li>
<li><strong>量子信息：</strong>  在量子计算中，哈达玛矩阵的哈达玛积被用来构建更复杂的量子门。</li>
<li><strong>推荐系统：</strong> 可以用于计算用户或物品之间的相似度。</li>
<li><strong>信号处理：</strong> 用于信号的调制和解调。</li>
</ul>
<p><strong>总结：</strong></p>
<p>哈达玛积是一种简单但非常有用的矩阵运算，它将两个维度相同的矩阵对应位置的元素相乘。理解它的定义和与标准矩阵乘法的区别对于理解其应用至关重要。</p>
<h3 id="交叉网络"><a class="header" href="#交叉网络">交叉网络</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221102854.png" alt="" /></p>
<h3 id="参考资料"><a class="header" href="#参考资料">参考资料</a></h3>
<p>这节课介绍的是Cross Network V2[1]。</p>
<p>老版本的 Cross Network 在论文[2] 中提出。</p>
<p>参考文献：</p>
<ol>
<li>Ruoxi Wang et al. DCN V2: Improved Deep &amp; Cross Network and Practical Lessons for Web-scale Learning to Rank Systems. In WWW, 2021.</li>
<li>Ruoxi Wang et al. Deep &amp; Cross Network for Ad Click Predictions. In ADKDD, 2017.</li>
</ol>
<h3 id="dcn"><a class="header" href="#dcn">DCN</a></h3>
<p>DCN可以用于召回和排序</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221102936.png" alt="" /></p>
<h2 id="只用于精排的lhucppnet"><a class="header" href="#只用于精排的lhucppnet">只用于精排的LHUC（PPNet）</a></h2>
<p>这节课介绍 LHUC 这种神经网络结构，可以用于精排。LHUC 的起源是语音识别，后来被应用到推荐系统，快手将其称为 PPNet，现在已经在业界广泛落地。</p>
<p>视频中遗漏一个细节：将LHUC用于推荐系统，门控神经网络（2 x sigmoid）的梯度不要传递到用户ID embedding特征，需要对其做 stop gradient。</p>
<p>参考文献：</p>
<ol>
<li>Pawel Swietojanski, Jinyu Li, &amp; Steve Renals. Learning hidden unit contributions for unsupervised acoustic model adaptation. IEEE/ACM Transactions on Audio, Speech, and Language Processing, 2016.</li>
<li>快手落地万亿参数推荐精排模型，2021。链接：https://ai.51cto.com/art/202102/644214.html</li>
</ol>
<h3 id="learning-hidden-unit-contributions-lhuc"><a class="header" href="#learning-hidden-unit-contributions-lhuc">Learning Hidden Unit Contributions (LHUC)</a></h3>
<p>LHUC起源于语音识别[1]。</p>
<p>快手将LHUC应用在推荐精排[2]，称作PPNet。</p>
<p>参考文献：</p>
<ol>
<li>Pawel Swietojanski, Jinyu Li, &amp; Steve Renals. Learning hidden unit contributions for unsupervised acoustic model adaptation. IEEE/ACM Transactions on Audio, Speech, and Language Processing, 2016.</li>
<li>快手落地万亿参数推荐精排模型，2021。链接： https:/ /ai.51cto.c0m/art/202102/644214.html</li>
</ol>
<h3 id="语音识别中的-lhuc"><a class="header" href="#语音识别中的-lhuc">语音识别中的 LHUC</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221103213.png" alt="" /></p>
<p>提取说话者个人特征</p>
<h3 id="推荐系统排序模型中的-lhuc"><a class="header" href="#推荐系统排序模型中的-lhuc">推荐系统排序模型中的 LHUC</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221103235.png" alt="" /></p>
<h2 id="senet和bilinear交叉"><a class="header" href="#senet和bilinear交叉">SENet和Bilinear交叉</a></h2>
<p>这节课介绍几种方法：</p>
<ol>
<li>SENet 是计算机视觉中的一种技术，可以用在推荐系统中对特征做动态加权。</li>
<li>双线性（bilinear）特征交叉可以提升排序模型的表现。有很多种 bilinear 交叉的方法。</li>
<li>FiBiNet 是将 SENet 与 Bilinear 模型结合。</li>
</ol>
<h3 id="senet"><a class="header" href="#senet">SENet</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250305103356.png" alt="" /></p>
<p>上图中把向量都映射成k维。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250305103449.png" alt="" /></p>
<p>参考文献：</p>
<ol>
<li>Jie Hu, Li Shen, and Gang Sun. Squeeze-and-Excitation Networks. In CVPR, 2018.</li>
<li>Tongwen Huang, Zhiqi Zhang, and Junlin Zhang. FiBiNET: Combining Feature Importance and Bilinear feature Interaction for Click-Through Rate Prediction. In RecSys, 2019.</li>
</ol>
<h3 id="senet特点"><a class="header" href="#senet特点">SENet特点</a></h3>
<p>SENet 对离散特征做 field-wise 加权。</p>
<p>Field：用户 ID Embedding 是 64 维向量。64个元素算一个field，获得相同的权重。</p>
<p>如果有m个fields，那么权重向量是m维。</p>
<h3 id="field间特征交叉"><a class="header" href="#field间特征交叉">Field间特征交叉</a></h3>
<p>特征交叉：内积和哈达玛乘积</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250305103706.png" alt="" /></p>
<p>Bilinear Cross（内积）</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250305103915.png" alt="" /></p>
<p>在实践中，需要手动选择特征进行交叉，否则参数量会非常大！</p>
<h3 id="senet和field间特征交叉"><a class="header" href="#senet和field间特征交叉">SENet和Field间特征交叉</a></h3>
<ul>
<li>SENet 对离散特征做 field-wise 加权</li>
<li>Field 间特征交叉:
<ul>
<li>向量内积</li>
<li>哈达玛乘积</li>
<li>Bilinear cross</li>
</ul>
</li>
</ul>
<h3 id="fibinet"><a class="header" href="#fibinet">FiBiNet</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221103842.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="行为序列"><a class="header" href="#行为序列">行为序列</a></h1>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#%E7%94%A8%E6%88%B7%E5%8E%86%E5%8F%B2%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97%E5%BB%BA%E6%A8%A1">用户历史行为序列建模</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#lastn%E7%89%B9%E5%BE%81">LastN特征</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#%E5%B0%8F%E7%BA%A2%E4%B9%A6%E7%9A%84%E5%AE%9E%E8%B7%B5">小红书的实践</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#din%E6%A8%A1%E5%9E%8B%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6">DIN模型（注意力机制）</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#din%E6%A8%A1%E5%9E%8B">DIN模型</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#%E7%AE%80%E5%8D%95%E5%B9%B3%E5%9D%87-vs-%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6">简单平均 V.S. 注意力机制</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#din%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%BC%BA%E7%82%B9">DIN模型的缺点</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#%E5%A6%82%E4%BD%95%E6%94%B9%E8%BF%9Bdin">如何改进DIN？</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#sim%E6%A8%A1%E5%9E%8B%E9%95%BF%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B">SIM模型（长序列模型）</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#sim%E6%A8%A1%E5%9E%8B%E7%89%B9%E5%BE%81">SIM模型特征</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#%E7%AC%AC%E4%B8%80%E6%AD%A5%E6%9F%A5%E6%89%BE">第一步：查找</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6">第二步：注意力机制</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97.html#%E7%BB%93%E8%AE%BA">结论</a></li>
</ul>
</li>
</ul>
<h2 id="用户历史行为序列建模"><a class="header" href="#用户历史行为序列建模">用户历史行为序列建模</a></h2>
<p>用户最近 n 次点击、点赞、收藏、转发等行为都是推荐系统中重要的特征，可以帮助召回和排序变得更精准。这节课介绍最简单的方法——对用户行为取简单的平均，作为特征输入召回、排序模型。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250305093523.png" alt="" /></p>
<p>last n物品 -&gt;特征处理</p>
<h3 id="lastn特征"><a class="header" href="#lastn特征">LastN特征</a></h3>
<p>LastN：用户最近的n次交互（点击、点赞等）的物品ID。</p>
<p>对LastN 物品ID 做embedding，得到n个向量。</p>
<p>把n个向量取平均，作为用户的一种特征。</p>
<p>适用于召回双塔模型、粗排三塔模型、精排模型。</p>
<p>参考文献：</p>
<ul>
<li>Covington, Adams, and Sargin. Deep neural networks for YouTube recommendations. In ACM Conference on Recommender Systems, 2016</li>
</ul>
<h3 id="小红书的实践"><a class="header" href="#小红书的实践">小红书的实践</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221104217.png" alt="" /></p>
<h2 id="din模型注意力机制"><a class="header" href="#din模型注意力机制">DIN模型（注意力机制）</a></h2>
<p>上节课介绍了用户的 LastN 序列特征。这节课介绍 DIN 模型，它是对 LastN 序列建模的一种方法，效果优于简单的平均。DIN 的本质是注意力机制（attention）。DIN 是阿里在 2018 年提出的，有兴趣的话可以阅读下面的参考文献。</p>
<p>参考文献：<br />
Zhou et al. Deep interest network for click-through rate prediction. In KDD, 2018.</p>
<p>DIN用加权平均代替平均，即注意力机制(attention)。</p>
<p>权重：候选物品与用户LastN物品的相似度。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221104536.png" alt="" /></p>
<h3 id="din模型"><a class="header" href="#din模型">DIN模型</a></h3>
<p>对于某候选物品，计算它与用户LastN物品的相似度。</p>
<p>以相似度为权重，求用户LastN物品向量的加权和，结果是一个向量。</p>
<p>把得到的向量作为一种用户特征，输入排序模型，预估（用户，候选物品）的点击率、点赞率等指标。</p>
<p>本质是注意力机制（attention）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250305094010.png" alt="" /></p>
<h3 id="简单平均-vs-注意力机制"><a class="header" href="#简单平均-vs-注意力机制">简单平均 V.S. 注意力机制</a></h3>
<p>简单平均和注意力机制都适用于精排模型。</p>
<p>简单平均适用于双塔模型、三塔模型。简单平均只需要用到LastN，属于用户自身的特征。把LastN 向量的平均作为用户塔的输入。</p>
<p>注意力机制不适用于双塔模型、三塔模型。注意力机制需要用到LastN+候选物品。用户塔看不到候选物品，不能把注意力机制用在用户塔。</p>
<h3 id="din模型的缺点"><a class="header" href="#din模型的缺点">DIN模型的缺点</a></h3>
<p>注意力层的计算量正比于用户行为序列的长度<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>。</p>
<p>只能记录最近几百个物品，否则计算量太大。</p>
<p>缺点：关注短期兴趣，遗忘长期兴趣。</p>
<p>参考文献：
Zhou et al. Deep interest network for click-through rate prediction. In KDD, 2018.</p>
<h3 id="如何改进din"><a class="header" href="#如何改进din">如何改进DIN？</a></h3>
<p>目标：保留用户长期行为序列（n很大）而且计算量不会过大。</p>
<p>改进DIN：</p>
<ul>
<li>DIN对LastN向量做加权平均，权重是相似度。</li>
<li>如果某LastN物品与候选物品差异很大，则权重接近零。快速排除掉与候选物品无关的LastN</li>
<li>物品，降低注意力层的计算量。</li>
</ul>
<h2 id="sim模型长序列模型"><a class="header" href="#sim模型长序列模型">SIM模型（长序列模型）</a></h2>
<p>这节课继续讲解推荐系统中的用户行为序列建模。这节课介绍 SIM 模型，它的主要目的是保留用户的长期兴趣。SIM 的原理是对用户行为序列做快速筛选，缩短序列长度，使得DIN可以用于长序列。</p>
<p>参考文献：<br />
Qi et al. Search-based User Interest Modeling with Lifelong Sequential Behavior Data for Click-Through Rate Prediction. In CIKM, 2020.</p>
<h3 id="sim模型特征"><a class="header" href="#sim模型特征">SIM模型特征</a></h3>
<p>保留用户长期行为记录，n的大小可以是几千。</p>
<p>对于每个候选物品，在用户LastN记录中做快速查找，找到k个相似物品。</p>
<p>把LastN变成TopK，然后输入到注意力层。</p>
<p>SIM模型减小计算量（从n降到k）</p>
<p>参考文献：
Qi et al. Search-based User Interest Modeling with Lifelong Sequential Behavior Data for Click-Through Rate Prediction. In CIKM, 2020.</p>
<h3 id="第一步查找"><a class="header" href="#第一步查找">第一步：查找</a></h3>
<p>方法一：Hard Search</p>
<ul>
<li>根据候选物品的类目，保留LastN物品中类目相同的。</li>
<li>简单，快速，无需训练。</li>
</ul>
<p>方法二：Soft Search</p>
<ul>
<li>把物品做embedding，变成向量。</li>
<li>把候选物品向量作为query，做k近邻查找，保留LastN 物品中最接近的k个。</li>
<li>效果更好，编程实现更复杂。</li>
</ul>
<h3 id="第二步注意力机制"><a class="header" href="#第二步注意力机制">第二步：注意力机制</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250221105245.png" alt="" /></p>
<p>trick：使用时间信息</p>
<ul>
<li>用户与某个LastN物品的交互时刻距今为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span></span></span></span>。</li>
<li>对<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span></span></span></span>做离散化，再做embedding，变成向量<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>。</li>
<li>把两个向量做concatenation，表征一个LastN物品。
<ul>
<li>向量x是物品embedding</li>
<li>向量d是时间的embedding</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250305095419.png" alt="" /></p>
<p>为什么SIM使用时间信息？</p>
<ul>
<li>DIN的序列短，记录用户近期行为。</li>
<li>SIM的序列长，记录用户长期行为。</li>
<li>时间越久远，重要性越低。</li>
</ul>
<h3 id="结论"><a class="header" href="#结论">结论</a></h3>
<ul>
<li>长序列（长期兴趣）优于短序列（近期兴趣）。</li>
<li>注意力机制优于简单平均。</li>
<li>Soft search 还是hard search？取决于工程基建。</li>
<li>使用时间信息有提升。</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="重排"><a class="header" href="#重排">重排</a></h1>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E7%89%A9%E5%93%81%E7%9B%B8%E4%BC%BC%E6%80%A7%E7%9A%84%E5%BA%A6%E9%87%8F%E6%8F%90%E5%8D%87%E5%A4%9A%E6%A0%B7%E6%80%A7%E7%9A%84%E6%96%B9%E6%B3%95">物品相似性的度量、提升多样性的方法</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E7%9B%B8%E4%BC%BC%E6%80%A7%E7%9A%84%E5%BA%A6%E9%87%8F">相似性的度量</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E5%9F%BA%E4%BA%8E%E7%89%A9%E5%93%81%E5%B1%9E%E6%80%A7%E6%A0%87%E7%AD%BE">基于物品属性标签</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E5%9F%BA%E4%BA%8E%E5%9B%BE%E6%96%87%E5%86%85%E5%AE%B9%E7%9A%84%E7%89%A9%E5%93%81%E7%89%B9%E5%BE%81">基于图文内容的物品特征</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E6%8F%90%E5%8D%87%E5%A4%9A%E6%A0%B7%E6%80%A7%E7%9A%84%E6%96%B9%E6%B3%95">提升多样性的方法</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#maximal-marginal-relevancemmr">Maximal Marginal Relevance(MMR)</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E5%A4%9A%E6%A0%B7%E6%80%A7">多样性</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#mmr%E5%A4%9A%E6%A0%B7%E6%80%A7%E7%AE%97%E6%B3%95">MMR多样性算法</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3">滑动窗口</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E4%B8%9A%E5%8A%A1%E8%A7%84%E5%88%99%E7%BA%A6%E6%9D%9F%E4%B8%8B%E7%9A%84%E5%A4%9A%E6%A0%B7%E6%80%A7%E7%AE%97%E6%B3%95">业务规则约束下的多样性算法</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E9%87%8D%E6%8E%92%E7%9A%84%E8%A7%84%E5%88%99">重排的规则</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#mmr--%E9%87%8D%E6%8E%92%E8%A7%84%E5%88%99">MMR + 重排规则</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E5%A4%9A%E6%A0%B7%E6%80%A7%E7%AE%97%E6%B3%95dpp">多样性算法DPP</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80">数学基础</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E5%A4%9A%E6%A0%B7%E6%80%A7%E9%97%AE%E9%A2%98">多样性问题</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#hulu%E7%9A%84%E5%BF%AB%E9%80%9F%E6%B1%82%E8%A7%A3%E7%AE%97%E6%B3%95">Hulu的快速求解算法</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#dpp%E6%89%A9%E5%B1%95%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3">DPP扩展——滑动窗口</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E9%87%8D%E6%8E%92.html#%E8%A7%84%E5%88%99%E7%BA%A6%E6%9D%9F">规则约束</a></li>
</ul>
</li>
</ul>
<h1 id="物品相似性的度量提升多样性的方法"><a class="header" href="#物品相似性的度量提升多样性的方法">物品相似性的度量、提升多样性的方法</a></h1>
<p>这节课和后面几节课的内容是推荐系统中的多样性。如果多样性做得好，可以显著提升推荐系统的核心业务指标。这节课的内容分两部分：</p>
<ol>
<li>物品相似性的度量。可以用物品标签或向量表征度量物品的相似性。最好的方法是基于图文内容的向量表征，比如 CLIP 方法。</li>
<li>提升多样性的方法。在推荐的链路上，在粗排和精排的后处理阶段，综合排序模型打分和多样性分数做选择。</li>
</ol>
<h2 id="相似性的度量"><a class="header" href="#相似性的度量">相似性的度量</a></h2>
<ul>
<li>基于物品属性标签：类目、品牌、关键词······</li>
<li>基于物品向量表征：用召回的双塔模型学到的物品向量（不好）、基于内容的向量表征（好）</li>
</ul>
<h3 id="基于物品属性标签"><a class="header" href="#基于物品属性标签">基于物品属性标签</a></h3>
<p>物品属性标签：类目、品牌、关键词····</p>
<p>根据一级类目、二级类目、品牌计算相似度。</p>
<p>物品i：美妆、彩妆、香奈儿</p>
<p>物品j：美妆、香水、香奈儿</p>
<p>相似度：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250303094112.png" alt="" /></p>
<h3 id="基于图文内容的物品特征"><a class="header" href="#基于图文内容的物品特征">基于图文内容的物品特征</a></h3>
<p>CLIP[1]是当前公认最有效的预训练方法。</p>
<p>思想：对于图片——文本二元组，预测图文是否匹配。</p>
<p>优势：无需人工标注。小红书的笔记天然包含图片+文字，大部分笔记图文相关。</p>
<p>参考文献：</p>
<ol>
<li>Radford et al. Learning transferable visual models from natural language supervision. In ICML, 2021.</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250224090657.png" alt="" /></p>
<h2 id="提升多样性的方法"><a class="header" href="#提升多样性的方法">提升多样性的方法</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250224090839.png" alt="" /></p>
<p>粗排和精排用多目标模型对物品做pointwise打分。对于物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>，模型输出点击率、交互率的预估，融合成分数<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 表示用户对物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>的兴趣，即物品本身价值。</p>
<p>后处理时，给定n个候选物品，排序模型打分<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。从n个候选物品中选出k个，既要它们的总分高，也需要它们有多样性。</p>
<p>粗排后处理也需要多样性算法。</p>
<p>精排后处理也被称为重排。</p>
<h1 id="maximal-marginal-relevancemmr"><a class="header" href="#maximal-marginal-relevancemmr">Maximal Marginal Relevance(MMR)</a></h1>
<p>这节课介绍推荐系统和搜索引擎重排中常用的 Maximal Marginal Relevance (MMR)，它根据精排打分和物品相似度，从 n 个物品中选出 k 个价值高、且多样性好的物品。这节课还介绍滑动窗口 (sliding window)，它可以与 MMR、DPP 等多样性算法结合，实践中滑动窗口的效果更优。</p>
<h2 id="多样性"><a class="header" href="#多样性">多样性</a></h2>
<p>精排给n个候选物品打分，融合之后的分数为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>把第<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span>个物品的相似度记作<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">im</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span>。</p>
<p>从n个物品中选出k个，既要有高精排分数，也要有多样性。</p>
<h2 id="mmr多样性算法"><a class="header" href="#mmr多样性算法">MMR多样性算法</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250224091252.png" alt="" /></p>
<p>其中<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>指物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>的精排分数，<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">ma</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord mathnormal">s</span><span class="mord mathnormal">im</span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span>指物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>的多样性分数</p>
<p>MMR多样性算法流程：</p>
<ol>
<li>已选中的物品S初始化为空集，未选中的物品R初始化为全集<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span></span></li>
<li>选择精排分数<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>最高的物品，从集合R移到S。</li>
<li>做<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord cjk_fallback">－</span><span class="mord">1</span></span></span></span>轮循环：a.计算集合R中所有物品的分数<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">}</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1774em;"><span></span></span></span></span></span></span></span></span></span>。 b.选出分数最高的物品，将其从R移到S。</li>
</ol>
<h2 id="滑动窗口"><a class="header" href="#滑动窗口">滑动窗口</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250224091440.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250224091555.png" alt="" /></p>
<h1 id="业务规则约束下的多样性算法"><a class="header" href="#业务规则约束下的多样性算法">业务规则约束下的多样性算法</a></h1>
<p>推荐系统有很多业务规则，比如不能连续出多篇某种类型的物品、某两种类型的物品笔记间隔多少。这些业务规则应用在重排阶段，可以与 MMR、DPP 等多样性算法相结合。</p>
<h2 id="重排的规则"><a class="header" href="#重排的规则">重排的规则</a></h2>
<p>规则：最多连续出现k篇某种笔记</p>
<ul>
<li>小红书推荐系统的物品分为图文笔记、视频笔记。</li>
<li>最多连续出现k=5篇图文笔记，最多连续出现k=5篇视频笔记。</li>
<li>如果排i到i+4的全都是图文笔记，那么排在i+5的必须是视频笔记。</li>
</ul>
<p>规则：每k篇笔记最多出现1篇某种笔记</p>
<ul>
<li>运营推广笔记的精排分会乘以大于1的系数（boost），帮助笔记获得更多曝光。</li>
<li>为了防止boost影响体验，限制每k=9篇笔记最多出现1篇运营推广笔记。</li>
<li>如果排第i位的是运营推广笔记，那么排i+1到i+ 8的不能是运营推广笔记。</li>
</ul>
<p>规则：前t篇笔记最多出现k篇某种笔记</p>
<ul>
<li>排名前t篇笔记最容易被看到，对用户体验最重要。（小红书的 top 4为首屏）</li>
<li>小红书推荐系统有带电商卡片的笔记，过多可能会影响体验。</li>
<li>前t=1篇笔记最多出现k=0篇带电商卡片的笔记。</li>
<li>前t=4篇笔记最多出现k=1篇带电商卡片的笔记</li>
</ul>
<h2 id="mmr--重排规则"><a class="header" href="#mmr--重排规则">MMR + 重排规则</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250224092013.png" alt="" /></p>
<h1 id="多样性算法dpp"><a class="header" href="#多样性算法dpp">多样性算法DPP</a></h1>
<p>行列式点过程 (determinantal point process, DPP) 是一种经典的机器学习方法，在 1970's 年代提出，在 2000 年之后有快速的发展。DPP 是目前推荐系统重排多样性公认的最好方法。</p>
<p>DPP 的数学比较复杂，这节课先介绍数学基础，下节课再介绍它在推荐系统的应用。这节课的内容主要是超平行体、超平行体的体积、行列式与体积的关系。</p>
<p>这节课介绍DPP及其再推荐系统重排中的应用。求解DPP是比较困难的，需要计算行列式很多次，而计算行列式需要矩阵分解，代价很大。这节课介绍Hulu论文中的算法，可以用较小的代价求解DPP。</p>
<p>参考文献：<br />
Chen et al. Fast greedy map inference for determinantal point process to improve recommendation diversity. In NIPS, 2018.</p>
<h2 id="数学基础"><a class="header" href="#数学基础">数学基础</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250304102841.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250224092534.png" alt="" /></p>
<p>其他条件相同时，超平形体体积越大，多样性越好。</p>
<h2 id="多样性问题"><a class="header" href="#多样性问题">多样性问题</a></h2>
<p>精排给n个物品打分：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<p>n个物品的向量表征：<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span>。</p>
<p>从n个物品中选出k个物品，组成集合S。</p>
<ul>
<li>价值大：分数之和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>越大越好。</li>
<li>多样性好：S中k个向量组成的超平形体<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mclose">)</span></span></span></span>的体积越大越好。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250304103313.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250304103436.png" alt="" /></p>
<p>NPHard 使用贪心算法近似求解</p>
<h2 id="hulu的快速求解算法"><a class="header" href="#hulu的快速求解算法">Hulu的快速求解算法</a></h2>
<p>贪心算法求解行列式</p>
<p>Cholesky 分解</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250304103636.png" alt="" /></p>
<h2 id="dpp扩展滑动窗口"><a class="header" href="#dpp扩展滑动窗口">DPP扩展——滑动窗口</a></h2>
<p>用S表示已选中的物品，用R表示未选中的物品，DPP的贪心算法求解：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.6217em;vertical-align:-0.7717em;"></span><span class="mop">ar<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.4306em;"><span style="top:-2.3557em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">∈</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">max</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7717em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord text"><span class="mord">reward</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">det</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mbin mtight">∪</span><span class="mopen mtight">{</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">}</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span></span></p>
<p>随着集合S增大，其中相似物品越来越多，物品向量会趋近线性相关。</p>
<p>行列式<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>会缩到零，对数趋于负无穷。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250304104018.png" alt="" /></p>
<h2 id="规则约束"><a class="header" href="#规则约束">规则约束</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250304104059.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="物品冷启动"><a class="header" href="#物品冷启动">物品冷启动</a></h1>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E4%BC%98%E5%8C%96%E7%9B%AE%E6%A0%87%E8%AF%84%E4%BB%B7%E6%8C%87%E6%A0%87">优化目标&amp;评价指标</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%96%B0%E7%AC%94%E8%AE%B0%E5%86%B7%E5%90%AF%E5%8A%A8">新笔记冷启动</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E4%BC%98%E5%8C%96%E5%86%B7%E5%90%AF%E7%9A%84%E7%9B%AE%E6%A0%87">优化冷启的目标</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E8%AF%84%E4%BB%B7%E6%8C%87%E6%A0%87">评价指标</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E4%BD%9C%E8%80%85%E4%BE%A7%E6%8C%87%E6%A0%87">作者侧指标</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E4%BD%9C%E8%80%85%E4%BE%A7%E6%8C%87%E6%A0%87-1">作者侧指标</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E5%86%85%E5%AE%B9%E4%BE%A7%E6%8C%87%E6%A0%87">内容侧指标</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E7%AE%80%E5%8D%95%E7%9A%84%E5%8F%AC%E5%9B%9E%E9%80%9A%E9%81%93">简单的召回通道</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E5%8F%AC%E5%9B%9E%E7%9A%84%E4%BE%9D%E6%8D%AE">召回的依据</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E5%86%B7%E5%90%AF%E5%8F%AC%E5%9B%9E%E7%9A%84%E5%9B%B0%E9%9A%BE">冷启召回的困难</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E5%8F%AC%E5%9B%9E%E9%80%9A%E9%81%93">召回通道</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E5%8F%8C%E5%A1%94%E6%A8%A1%E5%9E%8B">双塔模型</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E7%B1%BB%E7%9B%AE%E5%8F%AC%E5%9B%9E%E5%92%8C%E5%85%B3%E9%94%AE%E8%AF%8D%E5%8F%AC%E5%9B%9E">类目召回和关键词召回</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E8%81%9A%E7%B1%BB%E5%8F%AC%E5%9B%9E">聚类召回</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E8%81%9A%E7%B1%BB%E5%8F%AC%E5%9B%9E%E5%9F%BA%E6%9C%AC%E6%80%9D%E6%83%B3">聚类召回基本思想</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E8%81%9A%E7%B1%BB%E7%B4%A2%E5%BC%95">聚类索引</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E7%BA%BF%E4%B8%8A%E5%8F%AC%E5%9B%9E">线上召回</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E5%86%85%E5%AE%B9%E7%9B%B8%E4%BC%BC%E5%BA%A6%E6%A8%A1%E5%9E%8B">内容相似度模型</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%AE%AD%E7%BB%83">模型的训练</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E7%A7%8D%E5%AD%90%E7%AC%94%E8%AE%B0%E6%AD%A3%E6%A0%B7%E6%9C%AC">&lt;种子笔记，正样本&gt;</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E7%A7%8D%E5%AD%90%E7%AC%94%E8%AE%B0-%E8%B4%9F%E6%A0%B7%E6%9C%AC">&lt;种子笔记， 负样本&gt;</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E8%81%9A%E7%B1%BB%E5%8F%AC%E5%9B%9E%E6%80%BB%E7%BB%93">聚类召回总结</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#look-alike%E5%8F%AC%E5%9B%9E">Look-Alike召回</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E7%94%A8%E4%BA%8E%E4%BA%92%E8%81%94%E7%BD%91%E5%B9%BF%E5%91%8A">用于互联网广告</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#look-alike%E4%BA%BA%E7%BE%A4%E6%89%A9%E6%95%A3%E5%8F%AC%E5%9B%9E">Look-Alike人群扩散召回</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#look-alike%E7%94%A8%E4%BA%8E%E6%96%B0%E7%AC%94%E8%AE%B0%E5%8F%AC%E5%9B%9E">Look-Alike用于新笔记召回</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%B5%81%E9%87%8F%E8%B0%83%E6%8E%A7">流量调控</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%89%B6%E6%8C%81%E6%96%B0%E7%AC%94%E8%AE%B0%E7%9A%84%E7%9B%AE%E7%9A%84">扶持新笔记的目的</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9A%84%E5%81%9A%E6%B3%95">工业界的做法</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%B5%81%E9%87%8F%E8%B0%83%E6%8E%A7%E6%8A%80%E6%9C%AF%E7%9A%84%E5%8F%91%E5%B1%95">流量调控技术的发展</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%96%B0%E7%AC%94%E8%AE%B0%E6%8F%90%E6%9D%83">新笔记提权</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%96%B0%E7%AC%94%E8%AE%B0%E4%BF%9D%E9%87%8F">新笔记保量</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E5%B7%AE%E5%BC%82%E5%8C%96%E4%BF%9D%E9%87%8F">差异化保量</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%80%BB%E7%BB%93-1">总结</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E5%86%B7%E5%90%AF%E7%9A%84ab%E6%B5%8B%E8%AF%95">冷启的AB测试</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%96%B0%E7%AC%94%E8%AE%B0%E5%86%B7%E5%90%AF%E7%9A%84ab%E6%B5%8B%E8%AF%95">新笔记冷启的AB测试</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E7%94%A8%E6%88%B7%E4%BE%A7%E5%AE%9E%E9%AA%8C">用户侧实验</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E4%BD%9C%E8%80%85%E4%BE%A7%E5%AE%9E%E9%AA%8C">作者侧实验</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%96%B9%E6%A1%88%E4%B8%80">方案一</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%96%B9%E6%A1%88%E4%BA%8C">方案二</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%96%B9%E6%A1%88%E4%B8%89%E6%8A%8A%E8%80%81%E7%AC%94%E8%AE%B0%E4%B9%9F%E5%88%86%E4%B8%BA%E5%AE%9E%E9%AA%8C%E7%BB%84%E5%92%8C%E5%AF%B9%E7%85%A7%E7%BB%84">方案三：把老笔记也分为实验组和对照组</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E7%89%A9%E5%93%81%E5%86%B7%E5%90%AF%E5%8A%A8.html#%E6%80%BB%E7%BB%93-2">总结</a></li>
</ul>
</li>
</ul>
<h1 id="优化目标评价指标"><a class="header" href="#优化目标评价指标">优化目标&amp;评价指标</a></h1>
<p>物品冷启动指的是如何对新发布的物品做分发。优化物品冷启动在小红书这样的 User-Generated Content (UGC) 平台尤为重要，这是因为新物品数量巨大，内容质量良莠不齐，分发非常困难。</p>
<p>UGC 平台的物品冷启动有三个目标：</p>
<ol>
<li>精准推荐：克服冷启的困难，把新物品推荐给合适的用户，不引起用户反感。</li>
<li>激励发布：流量向低曝光新物品倾斜，激励发布。</li>
<li>挖掘高潜：通过初期小流量的试探，找到高质量的物品，给与流量倾斜。</li>
</ol>
<p>UGC 平台的物品冷启动主要考察三种指标：</p>
<ol>
<li>作者侧指标，包括发布渗透率、人均发布量。</li>
<li>用户侧指标，包括大盘消费指标和新物品消费指标。</li>
<li>内容侧指标，比如高热物品占比。</li>
</ol>
<p>UGC平台什么时候需要物品冷启动？</p>
<ul>
<li>小红书上用户新发布的笔记。</li>
<li>B站上用户新上传的视频。</li>
<li>今日头条上作者新发布的文章。</li>
</ul>
<p>主要研究UGC的物品冷启动，UGC冷启动难度高于PGC。</p>
<h2 id="新笔记冷启动"><a class="header" href="#新笔记冷启动">新笔记冷启动</a></h2>
<p>为什么要特殊对待新笔记？</p>
<ul>
<li>新笔记缺少与用户的交互，导致推荐的难度大、效果差。</li>
<li>扶持新发布、低曝光的笔记，可以增强作者发布意愿。</li>
</ul>
<h2 id="优化冷启的目标"><a class="header" href="#优化冷启的目标">优化冷启的目标</a></h2>
<ol>
<li>精准推荐：克服冷启的困难，把新笔记推荐给合适的用户，不引起用户反感。</li>
<li>激励发布：流量向低曝光新笔记倾斜；激励作者发布</li>
<li>挖掘高潜：通过初期小流量的试探，找到高质量的笔记，给与流量倾斜。</li>
</ol>
<h2 id="评价指标"><a class="header" href="#评价指标">评价指标</a></h2>
<p>作者侧指标：发布渗透率、人均发布量。</p>
<p>用户侧指标：</p>
<ul>
<li>新笔记指标：新笔记的点击率、交互率。</li>
<li>大盘指标：消费时长、日活、月活。</li>
</ul>
<p>内容侧指标：高热笔记占比。</p>
<h3 id="作者侧指标"><a class="header" href="#作者侧指标">作者侧指标</a></h3>
<p>发布渗透率（penetration rate）=当日发布人数／日活人数</p>
<p>发布一篇或以上，就算一个发布人数。</p>
<p>例：当日发布人数=100万，日活人数=2000万，发布渗透率= 100 ／ 2000 = 5%</p>
<p>人均发布量=当日发布笔记数／日活人数</p>
<p>例：每日发布笔记数=200万，日活人数=2000万，人均发布量=200／ 2000=0.1</p>
<h3 id="作者侧指标-1"><a class="header" href="#作者侧指标-1">作者侧指标</a></h3>
<p>发布渗透率、人均发布量反映出作者的发布积极性。</p>
<p>冷启的重要优化目标是促进发布，增大内容池。</p>
<p>新笔记获得的曝光越多，首次曝光和交互出现得越早，作者发布积极性越高。</p>
<p>**新笔记的消费指标</p>
<ul>
<li>新笔记的点击率、交互率。问题：曝光的基尼系数很大。少数头部新笔记占据了大部分的曝光。</li>
<li>分别考察高曝光、低曝光新笔记。高曝光：比如&gt;1000次曝光。低曝光：比如&lt;1000次曝光°</li>
</ul>
<p>高曝光的笔记无需冷启动处理，也能得到精准推荐。我们应该重点关注低曝光的笔记。</p>
<p><strong>用户侧指标大盘消费指标</strong>：大盘的消费时长、日活、月活。</p>
<p>大力扶持低曝光新笔记会发生什么？</p>
<ul>
<li>作者侧发布指标变好。</li>
<li>用户侧大盘消费指标变差。</li>
</ul>
<h3 id="内容侧指标"><a class="header" href="#内容侧指标">内容侧指标</a></h3>
<p>高热笔记占比</p>
<p>高热笔记：前30天获得1000+次点击。</p>
<p>高热笔记占比越高，说明冷启阶段挖掘优质笔记的能力越强。</p>
<h2 id="总结-6"><a class="header" href="#总结-6">总结</a></h2>
<p>作者侧指标：发布渗透率、人均发布量。</p>
<p>用户侧指标：新笔记消费指标、大盘消费指标。</p>
<p>内容侧指标：高热笔记占比</p>
<p>冷启动的优化点：</p>
<ul>
<li>优化全链路（包括召回和排序）</li>
<li>流量调控 (流量怎么在新物品、老物品中分配）</li>
</ul>
<h1 id="简单的召回通道"><a class="header" href="#简单的召回通道">简单的召回通道</a></h1>
<p>这节课的内容是物品冷启动 (item cold start) 中的召回。冷启动召回的难点是缺少用户交互，还没学好笔记 ID embedding，导致双塔模型效果不好。而且缺少用户交互会导致 ItemCF 不适用。</p>
<p>这节课介绍两种简单的召回通道：</p>
<ol>
<li>改造双塔模型，使得它适用于冷启动。</li>
<li>类目召回。</li>
</ol>
<h2 id="召回的依据"><a class="header" href="#召回的依据">召回的依据</a></h2>
<ul>
<li>√自带图片、文字、地点。</li>
<li>√算法或人工标注的标签。</li>
<li>×没有用户点击、点赞等信息。</li>
<li>× 没有笔记 ID embedding。</li>
</ul>
<h2 id="冷启召回的困难"><a class="header" href="#冷启召回的困难">冷启召回的困难</a></h2>
<ul>
<li>缺少用户交互，还没学好笔记ID embedding，导致双塔模型效果不好。</li>
<li>缺少用户交互，导致ItemCF不适用。</li>
</ul>
<p>为什么ItemCF不适用于物品冷启动？</p>
<h2 id="召回通道"><a class="header" href="#召回通道">召回通道</a></h2>
<ul>
<li>ItemCF召回 (不适用）</li>
<li>双塔模型（改造后适用）</li>
<li>类目、关键词召回（适用）</li>
<li>聚类召回（适用）</li>
<li>Look-Alike召回（适用）</li>
</ul>
<h3 id="双塔模型-1"><a class="header" href="#双塔模型-1">双塔模型</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225103322.png" alt="" /></p>
<p>改进ID Embedding来改造双塔模型。</p>
<p>改进方案 1：新笔记使用 default embedding。</p>
<ul>
<li>物品塔做ID embedding 时，让所有新笔记共享一个 ID，而不是用自己真正的ID。</li>
<li>Default embedding：共享的 ID 对应的 embedding 向量。</li>
<li>到下次模型训练的时候，新笔记才有自己的ID embedding 向量。</li>
</ul>
<p>改进方案 2：利用相似笔记 embedding 向量。</p>
<ul>
<li>查找top K内容最相似的高曝笔记。</li>
<li>把k个高曝笔记的 embedding 向量取平均，作为新笔记的embedding。</li>
</ul>
<p>在实践中，通常使用多个向量召回池。</p>
<ul>
<li>多个召回池，让新笔记有更多曝光机会。可以有1小时新笔记，6小时新笔记，24小时新笔记，30天笔记。</li>
<li>共享同一个双塔模型，那么多个召回池不增加训练的代价。</li>
</ul>
<h3 id="类目召回和关键词召回"><a class="header" href="#类目召回和关键词召回">类目召回和关键词召回</a></h3>
<p>用户画像</p>
<p>感兴趣的类目：美食、科技数码、电影····</p>
<p>感兴趣的关键词：纽约、职场、搞笑、程序员、大学······</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225103715.png" alt="" /></p>
<p><strong>基于类目的召回</strong></p>
<ul>
<li>系统维护类目索引：类目→笔记列表 (按时间倒排)</li>
<li>用类目索引做召回：用户画像→类目→笔记列表</li>
<li>取回笔记列表上前k篇笔记（即最新的k篇）</li>
</ul>
<p><strong>基于关键词的召回</strong></p>
<p>系统维护关键词索引：关键词→ 笔记列表（按时间倒排）</p>
<p>根据用户画像上的关键词做召回。</p>
<p><strong>缺点</strong>：</p>
<p>缺点1：只对刚刚发布的新笔记有效。</p>
<ul>
<li>取回某类目/关键词下最新的k篇笔记。</li>
<li>发布几小时之后，就再没有机会被召回。</li>
</ul>
<p>缺点2：弱个性化，不够精准。</p>
<p>优点：类目召回和关键词召回能让笔记立即获得曝光，有助于提升作者的发布积极性。</p>
<h1 id="聚类召回"><a class="header" href="#聚类召回">聚类召回</a></h1>
<p>这节课继续讲解物品冷启的召回。聚类召回是基于物品内容的召回通道。它假设如果用户喜欢一个物品，那么用户会喜欢内容相似的其他物品。使用聚类召回，需要事先训练一个多模态神经网络，将笔记图文表征为向量，并对向量做聚类，然后建索引。</p>
<h2 id="聚类召回基本思想"><a class="header" href="#聚类召回基本思想">聚类召回基本思想</a></h2>
<p>如果用户喜欢一篇笔记，那么他会喜欢内容相似的笔记。</p>
<p>事先训练一个神经网络，基于笔记的类目和图文内容，把笔记映射到向量。</p>
<p>对笔记向量做聚类，划分为1000 cluster，记录每个 cluster 的中心方向。(k-means 聚类，用余弦相似度。）</p>
<h2 id="聚类索引"><a class="header" href="#聚类索引">聚类索引</a></h2>
<p>一篇新笔记发布之后，用神经网络把它映射到一个特征向量。</p>
<p>从1000个向量（对应1000个cluster）中找到最相似的向量，作为新笔记的 cluster 。</p>
<p>索引：cluster → 笔记ID列表（按时间倒排）</p>
<h3 id="线上召回"><a class="header" href="#线上召回">线上召回</a></h3>
<p>给定用户ID，找到他的 last-n 交互的笔记列表，把这些笔记作为种子笔记。</p>
<p>把每篇种子笔记映射到向量，寻找最相似的cluster。（知道了用户对哪些 cluster 感兴趣。）</p>
<p>从每个 cluster 的笔记列表中，取回最新的 m 篇笔记。</p>
<p>最多取回 m*n 篇新笔记。</p>
<h2 id="内容相似度模型"><a class="header" href="#内容相似度模型">内容相似度模型</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225104304.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225104338.png" alt="" /></p>
<h3 id="模型的训练"><a class="header" href="#模型的训练">模型的训练</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225104416.png" alt="" /></p>
<p>基本想法：鼓励cos(a,b+)大于cos(a,b-)</p>
<p>常用损失函数：</p>
<ul>
<li>Triplet hinge loss</li>
<li>Triplet logistic loss</li>
</ul>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0713em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord textbf">Triplet hinge loss:</span></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mop">max</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">.</span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord textbf">Triplet logistic loss:</span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1.0713em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop">exp</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">.</span></span></span></span></span></p>
<h3 id="种子笔记正样本"><a class="header" href="#种子笔记正样本">&lt;种子笔记，正样本&gt;</a></h3>
<p>方法一：人工标注二元组的相似度，人工标注代价太大，不划算。</p>
<p>方法二：算法自动选正样本</p>
<p>筛选条件：</p>
<ul>
<li>只用高曝光笔记作为二元组（因为有充足的用户交互信息）。</li>
<li>两篇笔记有相同的二级类目，比如都是“菜谱教程”。</li>
</ul>
<p>用 ItemCF 的物品相似度选正样本。</p>
<h3 id="种子笔记-负样本"><a class="header" href="#种子笔记-负样本">&lt;种子笔记， 负样本&gt;</a></h3>
<p>从全体笔记中随机选出满足条件的：</p>
<ul>
<li>字数较多（神经网络提取的文本信息有效）。</li>
<li>笔记质量高，避免图文无关。</li>
</ul>
<h2 id="聚类召回总结"><a class="header" href="#聚类召回总结">聚类召回总结</a></h2>
<p>基本思想：根据用户的点赞、收藏、转发记录，推荐内容相似的笔记。</p>
<p>线下训练：多模态神经网络把图文内容映射成向量。</p>
<p>线上服务：用户喜欢的笔记 → 特征向量 → 最近的Cluster → 新笔记</p>
<h1 id="look-alike召回"><a class="header" href="#look-alike召回">Look-Alike召回</a></h1>
<p>这节课继续介绍物品冷启动。Look-Alike 是一种召回通道，对冷启很有效。Look-Alike 适用于发布一段时间、但是点击次数不高的物品。物品从发布到热门，主要的透出渠道会经历三个阶段：</p>
<ol>
<li>类目召回、聚类召回。它们是基于内容的召回通道，适用于刚刚发布的物品。</li>
<li>Look-Alike 召回。它适用于有点击，但是点击次数不高的物品。</li>
<li>双塔、ItemCF、Swing 等等。它们是基于用户行为的召回通道，适用于点击次数较高的物品。</li>
</ol>
<h2 id="用于互联网广告"><a class="header" href="#用于互联网广告">用于互联网广告</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225104916.png" alt="" /></p>
<p>Look-Alike用于互联网广告</p>
<p>如何计算两个用户的相似度？</p>
<ul>
<li>UserCF：两个用户有共同的兴趣点。</li>
<li>Embedding：两个用户向量的cosine较大。</li>
</ul>
<h2 id="look-alike人群扩散召回"><a class="header" href="#look-alike人群扩散召回">Look-Alike人群扩散召回</a></h2>
<p>点击、点赞、收藏、转发——用户对笔记可能感兴趣</p>
<p>把有交互的用户作为新笔记的种子用户。</p>
<p>用look-alike 在相似用户中扩散。</p>
<h2 id="look-alike用于新笔记召回"><a class="header" href="#look-alike用于新笔记召回">Look-Alike用于新笔记召回</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250302112702.png" alt="" /></p>
<ul>
<li>近线更新特征向量</li>
<li>特征向量是有交互的用户的向量的平均。</li>
<li>每当有用户交互该物品，更新笔记的特征向量。</li>
</ul>
<p>近线更新指近期更新，不用实时更新。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250302112910.png" alt="" /></p>
<h1 id="流量调控"><a class="header" href="#流量调控">流量调控</a></h1>
<p>流量调控是物品冷启动最重要的一环，直接影响作者发布指标。流量调控的发展通常会经历这几个阶段：</p>
<ol>
<li>在推荐结果中强插新笔记。</li>
<li>对新笔记做提权（boost）。</li>
<li>通过提权，对新笔记做保量。</li>
<li>差异化保量。</li>
</ol>
<h2 id="扶持新笔记的目的"><a class="header" href="#扶持新笔记的目的">扶持新笔记的目的</a></h2>
<p>目的1：促进发布，增大内容池。</p>
<ul>
<li>新笔记获得的曝光越多，作者创作积极性越高。</li>
<li>反映在发布渗透率、人均发布量。</li>
</ul>
<p>目的2：挖掘优质笔记。</p>
<ul>
<li>做探索，让每篇新笔记都能获得足够曝光。</li>
<li>挖掘的能力反映在高热笔记占比。</li>
</ul>
<h2 id="工业界的做法"><a class="header" href="#工业界的做法">工业界的做法</a></h2>
<ul>
<li>假设推荐系统只分发年龄&lt;30 天的笔记。</li>
<li>假设采用自然分发，新笔记（年龄&lt;24小时) 的曝光占比为 1/30。</li>
<li>扶持新笔记，让新笔记的曝光占比远大于1/30。</li>
</ul>
<h2 id="流量调控技术的发展"><a class="header" href="#流量调控技术的发展">流量调控技术的发展</a></h2>
<ol>
<li>在推荐结果中强插新笔记。</li>
<li>对新笔记的排序分数做提权（boost）。</li>
<li>通过提权，对新笔记做保量。</li>
<li>差异化保量。</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225112523.png" alt="" /></p>
<h3 id="新笔记提权"><a class="header" href="#新笔记提权">新笔记提权</a></h3>
<p>目标：让新笔记有更多机会曝光。</p>
<p>如果做自然分发，24小时新笔记占比为 1/30。做人为干涉，让新笔记占比大幅提升。</p>
<p>干涉粗排、重排环节，给新笔记提权（方法是给新笔记分数乘以一个大于1的常数，然后和老笔记自由竞争）。</p>
<p>优点：容易实现，投入产出比好。</p>
<p>缺点：</p>
<ul>
<li>曝光量对提权系数很敏感。</li>
<li>很难精确控制曝光量，容易过度曝光和不充分曝光。</li>
</ul>
<h3 id="新笔记保量"><a class="header" href="#新笔记保量">新笔记保量</a></h3>
<p>保量：无论笔记质量高低，都保证24小时获得100次曝光。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225112746.png" alt="" /></p>
<p><strong>动态提权保量</strong></p>
<p>用下面四个值计算提权系数</p>
<ul>
<li>目标时间：比如24小时。</li>
<li>目标曝光：比如100次。</li>
<li>发布时间：比如笔记已经发布12小时。</li>
<li>已有曝光：比如笔记已经获得20次曝光。</li>
</ul>
<p><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">提权系数</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2173em;vertical-align:-0.345em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">目标时间</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">发布时间</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">目标曝光</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">已有曝光</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">0.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.2</span><span class="mclose">)</span></span></span></span></p>
<p><strong>保量的难点</strong></p>
<p>保量成功率远低于 100%。很多笔记在24小时达不到100次曝光。原因：</p>
<ul>
<li>召回、排序存在不足。</li>
<li>提权系数调得不好。</li>
</ul>
<p>线上环境变化会导致保量失败。</p>
<ul>
<li>线上环境变化：新增召回通道、升级排序模型、改变重排打散规则····</li>
<li>线上环境变化后，需要调整提权系数。</li>
</ul>
<p><strong>思考题</strong></p>
<p>给所有新笔记一个很大的提权系数（比如4倍）直到达成 100 次曝光为止。这样的保量成功率很高。</p>
<p>为什么不用这种方法呢？效果不好！</p>
<p>给新笔记分数 boost 越多，对新笔记越有利？</p>
<p>好处：分数提升越多，曝光次数越多。</p>
<p>坏处：把笔记推荐给不太合适的受众。</p>
<ul>
<li>点击率、点赞率等指标会偏低。</li>
<li>长期会受推荐系统打压，难以成长为热门笔记。</li>
</ul>
<h2 id="差异化保量"><a class="header" href="#差异化保量">差异化保量</a></h2>
<p>保量：不论新笔记质量高低，都做扶持，在前24小时给100次曝光。</p>
<p>差异化保量：不同笔记有不同保量目标，普通笔记保100次曝光，内容优质的笔记保100~500次曝光。</p>
<ul>
<li>基础保量：24小时100 次曝光。</li>
<li>内容质量：用模型评价内容质量高低，给予额外保量目标，上限是加200次曝光。</li>
<li>作者质量：根据作者历史上的笔记质量，给予额外保量目标，上限是加200次曝光。</li>
<li>一篇笔记最少有100次保量，最多有500次保量。</li>
</ul>
<h2 id="总结-7"><a class="header" href="#总结-7">总结</a></h2>
<p>流量调控：流量怎么在新老笔记之间分配。</p>
<p>扶持新笔记：单独的召回通道、在排序阶段提权。</p>
<p>保量：帮助新笔记在前 24小时获得100 次曝光。</p>
<p>差异化保量：根据内容质量、作者质量，决定保量目标。</p>
<h1 id="冷启的ab测试"><a class="header" href="#冷启的ab测试">冷启的AB测试</a></h1>
<p>这节课的内容是物品冷启动的AB测试，内容很烧脑，不建议初学者观看。推荐系统常用的AB测试只考察用户侧消费指标，而推荐系统的AB测试还需要额外考察作者侧发布指标。后者远比前者复杂，而且所有已知的实验方案都存在缺陷。</p>
<h2 id="新笔记冷启的ab测试"><a class="header" href="#新笔记冷启的ab测试">新笔记冷启的AB测试</a></h2>
<p>作者侧指标：发布渗透率、人均发布量。</p>
<p>用户侧指标：对新笔记的点击率、交互率。大盘指标：消费时长、日活、月活</p>
<p>标准的AB测试通常指管制大盘指标：消费时长、日活、月活。实验比较好做。</p>
<h2 id="用户侧实验"><a class="header" href="#用户侧实验">用户侧实验</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225113623.png" alt="" /></p>
<p>缺点</p>
<ul>
<li>限定：保量100次曝光。</li>
<li>假设：新笔记曝光越多，用户使用APP时长越低。</li>
<li>新策略：把新笔记排序时的权重增大两倍。</li>
<li>结果（只看用户消费指标）：AB测试的diff是负数（实验组不如对照组）。如果推全，diff会缩小（比如一2%→一1%）。</li>
</ul>
<h2 id="作者侧实验"><a class="header" href="#作者侧实验">作者侧实验</a></h2>
<h3 id="方案一"><a class="header" href="#方案一">方案一</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225113758.png" alt="" /></p>
<p>方案一缺点：新笔记之间会抢流量</p>
<p>设定：</p>
<ul>
<li>新老笔记走各自队列，没有竞争。</li>
<li>重排分给新笔记1/3流量，分给老笔记 2/3流量</li>
</ul>
<p>新策略：把新笔记的权重增大两倍。</p>
<p>结果（只看作者发布指标）：AB 测试的 diff 是正数（实验组优于对照组）。如果推全，diff 会消失（比如 2% →0）。</p>
<p>方案一缺点：新笔记和老笔记抢流量</p>
<p>设定：新老笔记自由竞争。</p>
<p>新策略：把新笔记排序时的权重增大两倍。</p>
<p>AB测试时，50% 新笔记（带策略）跟100%老笔记抢流量。</p>
<p>推全后，100%新笔记（带策略）跟100%老笔记抢流量。</p>
<p>AB 测试结果与推全结果有差异。</p>
<h3 id="方案二"><a class="header" href="#方案二">方案二</a></h3>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250225114043.png" alt="" /></p>
<p>方案二比方案一的优缺点</p>
<p>优点：新笔记的两个桶不抢流量，实验结果更可信。</p>
<p>相同：新笔记和老笔记抢流量，AB 测试结果与推全结果有差异。</p>
<p>缺点：新笔记池减小一半，对用户体验造成负面影响。</p>
<h3 id="方案三把老笔记也分为实验组和对照组"><a class="header" href="#方案三把老笔记也分为实验组和对照组">方案三：把老笔记也分为实验组和对照组</a></h3>
<p>缺点：这种方式相当于把一个APP拆分为两个APP，不划算</p>
<h2 id="总结-8"><a class="header" href="#总结-8">总结</a></h2>
<p>冷启的AB测试需要观测作者发布指标和用户消费指标。</p>
<p>各种AB测试的方案都有缺点。（小红书有更好的方案，但也不完美。）</p>
<p>设计方案的时候，问自己几个问题：</p>
<ul>
<li>实验组、对照组新笔记会不会抢流量？</li>
<li>新笔记、老笔记怎么抢流量？</li>
<li>同时隔离笔记、用户，会不会让内容池变小？</li>
<li>如果对新笔记做保量，会发生什么？</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="涨指标的方法"><a class="header" href="#涨指标的方法">涨指标的方法</a></h1>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%A6%82%E8%BF%B0">概述</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%AF%84%E4%BB%B7%E6%8C%87%E6%A0%87">推荐系统的评价指标</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B">涨指标的方法有哪些？</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%8F%AC%E5%9B%9E">召回</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%8F%AC%E5%9B%9E%E6%A8%A1%E5%9E%8B%E5%8F%AC%E5%9B%9E%E9%80%9A%E9%81%93">召回模型&amp;召回通道</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%8F%8C%E5%A1%94%E6%A8%A1%E5%9E%8B">双塔模型</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#item2item%E6%A8%A1%E5%9E%8B">Item2Item模型</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%B0%8F%E4%BC%97%E7%9A%84%E5%8F%AC%E5%9B%9E%E6%A8%A1%E5%9E%8B">小众的召回模型</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%80%BB%E7%BB%93%E6%94%B9%E8%BF%9B%E5%8F%AC%E5%9B%9E%E6%A8%A1%E5%9E%8B">总结：改进召回模型</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%8E%92%E5%BA%8F%E6%A8%A1%E5%9E%8B">排序模型</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%B2%BE%E6%8E%92%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%94%B9%E8%BF%9B">精排模型的改进</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%B2%BE%E6%8E%92%E6%A8%A1%E5%9E%8B%E5%9F%BA%E5%BA%A7">精排模型：基座</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%B2%BE%E6%8E%92%E6%A8%A1%E5%9E%8B%E5%A4%9A%E7%9B%AE%E6%A0%87%E9%A2%84%E4%BC%B0">精排模型：多目标预估</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%B2%97%E6%8E%92%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%94%B9%E8%BF%9B">粗排模型的改进</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%B2%97%E6%8E%92%E6%A8%A1%E5%9E%8B">粗排模型</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%B2%97%E7%B2%BE%E6%8E%92%E4%B8%80%E8%87%B4%E6%80%A7%E5%BB%BA%E6%A8%A1">粗精排一致性建模</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97%E5%BB%BA%E6%A8%A1">用户行为序列建模</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97%E5%BB%BA%E6%A8%A1%E6%96%B9%E5%BC%8F">用户行为序列建模方式</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%94%B9%E8%BF%9B">改进</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%9C%A8%E7%BA%BF%E5%AD%A6%E4%B9%A0">在线学习</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%9C%A8%E7%BA%BF%E5%AD%A6%E4%B9%A0%E7%9A%84%E8%B5%84%E6%BA%90%E6%B6%88%E8%80%97">在线学习的资源消耗</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E8%80%81%E6%B1%A4%E6%A8%A1%E5%9E%8B">老汤模型</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%80%BB%E7%BB%93%E6%94%B9%E8%BF%9B%E6%8E%92%E5%BA%8F%E6%A8%A1%E5%9E%8B">总结：改进排序模型</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%A4%9A%E6%A0%B7%E6%80%A7">多样性</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%B2%BE%E6%8E%92%E5%A4%9A%E6%A0%B7%E6%80%A7">精排多样性</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%B2%97%E6%8E%92%E5%A4%9A%E6%A0%B7%E6%80%A7">粗排多样性</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%8F%8C%E5%A1%94%E6%A8%A1%E5%9E%8B-1">双塔模型</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%8F%8C%E5%A1%94%E6%A8%A1%E5%9E%8B%E6%B7%BB%E5%8A%A0%E5%99%AA%E5%A3%B0">双塔模型：添加噪声</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%8F%8C%E5%A1%94%E6%A8%A1%E5%9E%8B%E6%8A%BD%E6%A0%B7%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97">双塔模型：抽样用户行为序列</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#u2i2i%E6%8A%BD%E6%A0%B7%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%BA%8F%E5%88%97">U2I2I：抽样用户行为序列</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%8E%A2%E7%B4%A2%E6%B5%81%E9%87%8F">探索流量</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%80%BB%E7%BB%93%E6%8F%90%E5%8D%87%E5%A4%9A%E6%A0%B7%E6%80%A7">总结：提升多样性</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%89%B9%E6%AE%8A%E7%94%A8%E6%88%B7%E4%BA%BA%E7%BE%A4">特殊用户人群</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%89%B9%E6%AE%8A%E5%AF%B9%E5%BE%85%E7%89%B9%E6%AE%8A%E4%BA%BA%E7%BE%A4">为什么要特殊对待特殊人群？</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95">涨指标的方法</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%89%B9%E6%AE%8A%E5%86%85%E5%AE%B9%E6%B1%A0">特殊内容池</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E7%89%B9%E6%AE%8A%E5%86%85%E5%AE%B9%E6%B1%A0">为什么需要特殊内容池？</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%A6%82%E4%BD%95%E6%9E%84%E9%80%A0%E7%89%B9%E6%AE%8A%E5%86%85%E5%AE%B9%E6%B1%A0">如何构造特殊内容池？</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%89%B9%E6%AE%8A%E5%86%85%E5%AE%B9%E6%B1%A0%E7%9A%84%E5%8F%AC%E5%9B%9E">特殊内容池的召回</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%89%B9%E6%AE%8A%E7%9A%84%E6%8E%92%E5%BA%8F%E7%AD%96%E7%95%A5">特殊的排序策略</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%8E%92%E9%99%A4%E4%BD%8E%E8%B4%A8%E9%87%8F%E7%89%A9%E5%93%81">排除低质量物品</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%B7%AE%E5%BC%82%E5%8C%96%E7%9A%84%E8%9E%8D%E5%88%86%E5%85%AC%E5%BC%8F">差异化的融分公式</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%89%B9%E6%AE%8A%E7%9A%84%E6%8E%92%E5%BA%8F%E6%A8%A1%E5%9E%8B">特殊的排序模型</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%B7%AE%E5%BC%82%E5%8C%96%E7%9A%84%E6%8E%92%E5%BA%8F%E6%A8%A1%E5%9E%8B">差异化的排序模型</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E9%94%99%E8%AF%AF%E7%9A%84%E5%81%9A%E6%B3%95">错误的做法</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%80%BB%E7%BB%93%E7%89%B9%E6%AE%8A%E5%AF%B9%E5%BE%85%E7%89%B9%E6%AE%8A%E7%94%A8%E6%88%B7%E4%BA%BA%E7%BE%A4">总结：特殊对待特殊用户人群</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E4%BA%A4%E4%BA%92%E8%A1%8C%E4%B8%BA%E5%85%B3%E6%B3%A8%E8%BD%AC%E5%8F%91%E8%AF%84%E8%AE%BA">交互行为（关注、转发、评论）</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%94%A8%E6%88%B7%E7%9A%84%E4%BA%A4%E4%BA%92%E8%A1%8C%E4%B8%BA">用户的交互行为</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%85%B3%E6%B3%A8">关注</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%85%B3%E6%B3%A8%E9%87%8F%E5%AF%B9%E7%95%99%E5%AD%98%E7%9A%84%E4%BB%B7%E5%80%BC">关注量对留存的价值</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8%E5%85%B3%E6%B3%A8%E5%85%B3%E7%B3%BB%E6%8F%90%E5%8D%87%E7%94%A8%E6%88%B7%E7%95%99%E5%AD%98">如何利用关注关系提升用户留存？</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E7%B2%89%E4%B8%9D%E6%95%B0%E5%AF%B9%E4%BF%83%E5%8F%91%E5%B8%83%E7%9A%84%E4%BB%B7%E5%80%BC">粉丝数对促发布的价值</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E9%9A%90%E5%BC%8F%E5%85%B3%E6%B3%A8%E5%85%B3%E7%B3%BB">隐式关注关系</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E8%BD%AC%E5%8F%91">转发</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E4%BF%83%E8%BD%AC%E5%8F%91%E5%88%86%E4%BA%AB%E5%9B%9E%E6%B5%81">促转发（分享回流）</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#kol%E5%BB%BA%E6%A8%A1">KOL建模</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E4%BF%83%E8%BD%AC%E5%8F%91%E7%9A%84%E7%AD%96%E7%95%A5">促转发的策略</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E8%AF%84%E8%AE%BA">评论</a>
<ul>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E8%AF%84%E8%AE%BA%E4%BF%83%E5%8F%91%E5%B8%83">评论促发布</a></li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E8%AF%84%E8%AE%BA%E7%9A%84%E5%85%B6%E4%BB%96%E4%BB%B7%E5%80%BC">评论的其他价值</a></li>
</ul>
</li>
<li><a href="%E5%B7%A5%E4%B8%9A%E7%95%8C%E7%9C%9F%E5%AE%9E%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/%E6%B6%A8%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%B3%95.html#%E6%80%BB%E7%BB%93%E5%88%A9%E7%94%A8%E4%BA%A4%E4%BA%92%E8%A1%8C%E4%B8%BA">总结：利用交互行为</a></li>
</ul>
</li>
</ul>
<h1 id="概述"><a class="header" href="#概述">概述</a></h1>
<p>这节课和后面的几节课的内容是推荐系统涨指标的方法。这节课先回顾推荐系统的评价指标，尤其是LT7和LT30。后面的课程会分为5部分：</p>
<ol>
<li>改进召回模型和添加新的召回模型。</li>
<li>改进粗排和精排模型。</li>
<li>提升召回、粗排、精排中的多样性。</li>
<li>特殊对待新用户、低活用户等特殊人群。</li>
<li>利用关注、转发、评论这三种交互行为来提升指标。</li>
</ol>
<p>课件链接： https://github.com/wangshusen/RecommenderSystem</p>
<p>参考文献： https://arxiv.org/abs/2308.01204</p>
<h2 id="推荐系统的评价指标"><a class="header" href="#推荐系统的评价指标">推荐系统的评价指标</a></h2>
<p>在推荐系统中，日活跃用户数（DAU）和用户留存率是最为关键的指标。目前，工业界普遍使用LT7（7天留存率）和LT30（30天留存率）来衡量用户留存情况。</p>
<p>例如，如果某用户在今天（t0）登录APP，并且在接下来的7天（t0～t6）中有4天再次登录，那么该用户的LT7为4。显然，LT7的范围是1≤LT7≤7，而LT30的范围是1≤LT30≤30。</p>
<p>LT的增长通常表明用户体验的提升，除非在LT增长的同时DAU下降。</p>
<p>如果APP禁止低活跃用户登录，可能会导致DAU下降，但LT却可能增长。</p>
<p>其他核心指标包括用户使用时长、总阅读量（即总点击数）和总曝光量。这些指标的重要性相对DAU和留存率较低。</p>
<p>此外，使用时长的增加通常会伴随LT的增长，但在某些情况下，时长的增加可能导致阅读量和曝光量的下降。</p>
<p>一些非核心指标如点击率和交互率等也可以提供辅助信息。</p>
<p>对于用户生成内容（UGC）平台而言，发布量和发布渗透率同样是核心指标。</p>
<h2 id="涨指标的方法有哪些"><a class="header" href="#涨指标的方法有哪些">涨指标的方法有哪些？</a></h2>
<ol>
<li>改进召回模型，添加新的召回模型</li>
<li>改进粗排和精排模型</li>
<li>提升召回、粗排、精排中的多样性</li>
<li>特殊对待新用户、低活用户等特殊人群</li>
<li>利用关注、转发、评论这三种交互行为</li>
</ol>
<h1 id="召回-1"><a class="header" href="#召回-1">召回</a></h1>
<p>这节课的内容是推荐系统涨指标的方法。具体讲解如何通过改进召回模型（retrieval models）来提升推荐系统的核心指标。这节课的内容分三部分：双塔模型、Item-to-Item (I2I)、还有小众的召回模型（比如PDN、Deep Retrieval、SINE、M2GRL）。</p>
<p>参考文献<br />
[1] Li et al. Path-based Deep Network for Candidate Item Matching in Recommenders. In SIGIR, 2021.<br />
[2] Gao et al. Learning an end-to-end structure for retrieval in large-scale recommendations. In CIKM, 2021.<br />
[3] Tan et al. Sparse-interest network for sequential recommendation. In WSDM, 2021.<br />
[4] Wang et al. M2GRL: A multitask multi-view graph representation learning framework for web-scale recommender systems. In KDD, 2020.</p>
<p>课件链接： https://github.com/wangshusen/RecommenderSystem</p>
<p>参考文献： https://arxiv.org/abs/2308.01204</p>
<h2 id="召回模型召回通道"><a class="header" href="#召回模型召回通道">召回模型&amp;召回通道</a></h2>
<p>推荐系统有几十条召回通道，它们的召回总量是固定的。</p>
<p>召回总量越大，指标越好，粗排计算量越大。</p>
<p>双塔模型（two-tower）和item-to-item（I2I）是最重要的两类召回模型，占据召回的大部分配额。</p>
<p>有很多小众的模型，占据的配额很少。在召回总量不变的前提下，添加某些召回模型可以提升核心指标。</p>
<p>有很多内容池，比如30天物品、1天物品、6小时物品、新用户优质内容池、分人群内容池。</p>
<p>同一个模型可以用于多个内容池，得到多条召回通道。</p>
<h2 id="双塔模型-2"><a class="header" href="#双塔模型-2">双塔模型</a></h2>
<p>方向1：优化正样本、负样本。</p>
<ul>
<li>简单正样本：有点击的（用户，物品）二元组</li>
<li>简单负样本：随机组合的（用户，物品）二元组</li>
<li>困难负样本：排序靠后的（用户，物品）二元组</li>
</ul>
<p>方向2：改进神经网络结构</p>
<ul>
<li>Baseline：用户塔、物品塔分别是全连接网络，各输出一个向量分别作为用户、物品的表征。</li>
<li>改进：用户塔、物品塔分别用DCN代替全连接网络</li>
<li>改进：在用户塔中使用用户行为序列（last-n）</li>
<li>改进：使用多向量模型代替单向量模型。（标准的双塔模型也叫单向量模型。）</li>
</ul>
<p>方向3：改进模型的训练方法</p>
<ul>
<li>Baseline：做二分类，让模型学会区分正样本和负样本</li>
<li>改进：结合二分类、batch 内负采样。（对于 batch 内负采样，需要做纠偏。)</li>
<li>改进：使用自监督学习方法；让冷门物品的embedding 学得更好。</li>
</ul>
<h2 id="item2item模型"><a class="header" href="#item2item模型">Item2Item模型</a></h2>
<p>I2I是一大类模型，基于相似物品做召回。最常见的用法是U2I2I(user →item →item）。</p>
<p>如何计算物品相似度？</p>
<p>方法1：ItemCF 及其变体</p>
<ul>
<li>一些用户同时喜欢物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>则认为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>相似。</li>
<li>ItemCF、Online ItemCF、Swing 、Online Swing 都是基于相同的思想。</li>
<li>线上同时使用上述4种I2I模型，各分配一定配额。</li>
</ul>
<p>方法2：基于物品向量表征，计算向量相似度。（双塔模型、图神经网络均可计算物品向量表征。)</p>
<h2 id="小众的召回模型"><a class="header" href="#小众的召回模型">小众的召回模型</a></h2>
<p>类似 I2I 的模型：</p>
<ul>
<li>U2U2I(user→user→item）：已知用户u1 与u2 相似且 u2 喜欢物品i，那么给用户 u 推荐物品i。</li>
<li>U2A2I(user →author →item）：已知用户 u 喜欢作者 a  且a发布物品i，那么给用户u推荐物品i。</li>
<li>U2A2A2I (user →author → author →item):已知用户 u 喜欢作者a1且a1 与a2 相似，a2 发布物品i，那么给用户u推荐物品i。</li>
</ul>
<p>更复杂的模型：</p>
<ul>
<li>Path-based Deep Network (PDN) [1]</li>
<li>Deep Retrieval [2]</li>
<li>Sparse-Interest Network (SINE) [3]</li>
<li>Multi-task Multi-view Graph Representation Learning (M2GRL) [4]</li>
</ul>
<p>参考文献</p>
<ol>
<li>Li et al. Path-based Deep Network for Candidate Item Matching in Recommenders. In SIGlR, 2021.</li>
<li>Gao et al. Learning an end-to-end structure for retrieval in large-scale recommendations. In ClKM,2021.</li>
<li>Tan et al. Sparse-interest network for sequential recommendation. In WSDM, 2021.</li>
<li>Wang et al. M2GRL: A multitask multi-view graph representation learning framework for web-scale recommender systems. In KDD, 2020.</li>
</ol>
<h2 id="总结改进召回模型"><a class="header" href="#总结改进召回模型">总结：改进召回模型</a></h2>
<p>双塔模型：优化正负样本、改进神经网络结构、改进训练的方法。</p>
<p>I2I 模型：同时使用 ItemCF及其变体、使用物品向量表征计算物品相似度。</p>
<p>添加小众的召回模型，比如PDN、Deep Retrieval、SINE、M2GRL等模型。</p>
<p>在召回总量不变的前提下，调整各召回通道的配额。（可以让各用户群体用不同的配额。）</p>
<h1 id="排序模型"><a class="header" href="#排序模型">排序模型</a></h1>
<p>这节课的内容是通过改进粗排和精排模型涨指标。这节课的内容分5部分：</p>
<ol>
<li>精排模型的改进</li>
<li>粗排模型的改进</li>
<li>用户行为序列建模</li>
<li>在线学习</li>
<li>老汤模型</li>
</ol>
<h2 id="精排模型的改进"><a class="header" href="#精排模型的改进">精排模型的改进</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250228102611.png" alt="" /></p>
<h3 id="精排模型基座"><a class="header" href="#精排模型基座">精排模型：基座</a></h3>
<p>基座的输入包括离散特征和连续特征，输出一个向量，作为多目标预估的输入。</p>
<p>改进1：基座加宽加深，计算量更大，预测更准确。</p>
<p>改进2：做自动的特征交叉，比如bilinear[1]和LHUC[2]</p>
<p>改进3：特征工程，比如添加统计特征、多模态内容特征。</p>
<p>参考文献</p>
<ol>
<li>Huang et al. FiBiNET: combining feature importance and bilinear feature interaction for click-through rate prediction. In RecSys, 2019.</li>
<li>Swietojanski et al. Learning hidden unit contributions for unsupervised acoustic model adaptation. In WSDM, 2016.</li>
</ol>
<h3 id="精排模型多目标预估"><a class="header" href="#精排模型多目标预估">精排模型：多目标预估</a></h3>
<p>基于基座输出的向量，同时预估点击率等多个目标。</p>
<p>改进1：增加新的预估目标，并把预估结果加入融合公式。</p>
<ul>
<li>最标准的目标包括点击率、点赞率、收藏率、转发率、评论率、关注率、完播率······</li>
<li>寻找更多目标，比如进入评论区、给他人写的评论点赞·······</li>
<li>把新的预估目标加入融合公式</li>
</ul>
<p>改进2：MMoE[1]、PLE[2] 等结构可能有效但往往无效。</p>
<p>改进3：纠正position bias[3]可能有效，也可能无效。</p>
<p>参考文献</p>
<ol>
<li>Ma et al. Modeling task relationships in multi-task learning with multi-gate mixture-of-experts. In KDD, 2018.</li>
<li>Tang et al. Progressive layered extraction (PLE): A novel multi-task learning (MTL) model for personalized recommendations. In RecSys, 2020.</li>
<li>Zhou et al. Recommending what video to watch next: a multitask ranking system. In RecSys, 2019.</li>
</ol>
<h2 id="粗排模型的改进"><a class="header" href="#粗排模型的改进">粗排模型的改进</a></h2>
<h3 id="粗排模型-1"><a class="header" href="#粗排模型-1">粗排模型</a></h3>
<p>粗排的打分量比精排大10倍，因此粗排模型必须够快。</p>
<p>简单模型：多向量双塔模型，同时预估点击率等多个目标。</p>
<p>复杂模型：三塔模型[1]效果好，但工程实现难度较大。</p>
<p>参考文献</p>
<ol>
<li>Wang et al. COLD: towards the next generation of pre-ranking system. arXiv, 2020.</li>
</ol>
<h3 id="粗精排一致性建模"><a class="header" href="#粗精排一致性建模">粗精排一致性建模</a></h3>
<p>蒸馏精排训练粗排，让粗排与精排更一致。</p>
<p>优点：粗精排一致性建模可以提升核心指标。</p>
<p>缺点：如果精排出bug，精排预估值p有偏，会污染粗排训练数据。</p>
<p>方法1：pointwise 蒸馏。</p>
<p>设y是用户真实行为，设p是精排的预估。用<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1994em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8544em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>作为粗排拟合的目标。例：对于点击率目标，用户有点击（y= 1），精排预估p=0.6。用<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1994em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8544em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.8</span></span></span></span>作为粗排拟合的点击率目标。</p>
<p>方法2：pairwise 或listwise 蒸馏。</p>
<p>给定k个候选物品，按照精排预估做排序。做learning to rank(LTR），让粗排拟合物品的序（而非值）。</p>
<p>例：对于物品i和j，精排预估点击率为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<p>LTR 鼓励粗排预估点击率满足<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>否则有惩罚。</p>
<p>LTR 通常使用 pairwise logistic loss。</p>
<h2 id="用户行为序列建模"><a class="header" href="#用户行为序列建模">用户行为序列建模</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250228104138.png" alt="" /></p>
<h3 id="用户行为序列建模方式"><a class="header" href="#用户行为序列建模方式">用户行为序列建模方式</a></h3>
<p>最简单的方法是对物品向量取平均，作为一种用户特征[1]。</p>
<p>DIN[2]使用注意力机制，对物品向量做加权平均。</p>
<p>工业界目前沿着SIM[3]的方向发展。先用类目等属性筛选物品，然后用DIN对物品向量做加权平均。</p>
<p>参考文献</p>
<ol>
<li>Covington, Adams, and Sargin. Deep neural networks for YouTube recommendations. In RecSys, 2016.</li>
<li>Zhou et al. Deep interest network for click-through rate prediction. In KDD, 2018.</li>
<li>Qi et al. Search-based User Interest Modeling with Lifelong Sequential Behavior Data for Click-Through Rate Prediction. In CIKM, 2020.</li>
</ol>
<h3 id="改进"><a class="header" href="#改进">改进</a></h3>
<p>改进1：增加序列长度，让预测更准确，但是会增加计算成本和推理时间。</p>
<p>改进2：筛选的方法，比如用类目、物品向量表征聚类。</p>
<ul>
<li>离线用多模态神经网络提取物品内容特征，将物品表征为向量。</li>
<li>离线将物品向量聚为1000类，每个物品有一个聚类序号。</li>
<li>线上排序时，用户行为序列中有n=1,000,000个物品。某候选物品的聚类序号是70，对n个物品做筛选，只保留聚类序号为70的物品。n个物品中只有数千个被保留下来。</li>
<li>同时有好几种筛选方法，取筛选结果的并集。</li>
</ul>
<p>改进3：对用户行为序列中的物品，使用ID以外的一些特征</p>
<p>概括：沿着SIM的方向发展，让原始的序列尽量长，然后做筛选降低序列长度，最后将筛选结果输入DIN。</p>
<h2 id="在线学习"><a class="header" href="#在线学习">在线学习</a></h2>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250228104814.png" alt="全量更新和在线更新" /></p>
<h3 id="在线学习的资源消耗"><a class="header" href="#在线学习的资源消耗">在线学习的资源消耗</a></h3>
<p>既需要在凌晨做全量更新，也需要全天不间断做增量更新。</p>
<p>设在线学习需要 10,000 CPU core 的算力增量更新一个精排模型。推荐系统一共需要多少额外的算力给在线学习？</p>
<p>为了做AB测试，线上同时运行多个不同的模型。如果线上有m个模型，则需要m套在线学习的机器。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250228105040.png" alt="" /></p>
<p>线上有 m个模型，其中1个是holdout，1个是推全的模型，m-2个测试的新模型。</p>
<p>每套在线学习的机器成本都很大，因此m数量很小，制约模型开发迭代的效率。</p>
<p>在线学习对指标的提升巨大，但是会制约模型开发迭代的效率。</p>
<h2 id="老汤模型"><a class="header" href="#老汤模型">老汤模型</a></h2>
<p>用每天新产生的数据对模型做 1 epoch 的训练。久而久之，老模型训练得非常好，很难被超过。对模型做改进，重新训练，很难追上老模型。</p>
<p>两大问题：</p>
<p>问题1：如何快速判断新模型结构是否优于老模型？（不需要追上线上的老模型，只需要判断新老模型谁的结构更优。）</p>
<p>问题2：如何更快追平、超过线上的老模型？（只有几十天的数据，新模型就能追上训练上百天的老模型。)</p>
<p>问题1：如何快速判断新模型结构是否优于老模型？</p>
<ul>
<li>对于新老模型结构，都随机初始化模型全连接层。</li>
<li>Embedding层可以是随机初始化，也可以是复用老模型训练好的参数。</li>
<li>用n天的数据训练新老模型。（从旧到新，训练 1 epoch）。</li>
<li>如果新模型显著优于老模型，新模型很可能更优。</li>
<li>只是比较新老模型结构谁更好，而非真正追平老模型。</li>
</ul>
<p>问题2：如何更快追平线上的老模型？</p>
<p>已经得出初步结论，认为新模型很可能优于老模型。用几十天的数据训练新模型，早日追平老模型。</p>
<ul>
<li>方法1：尽可能多地复用老模型训练好的embedding 层，避免随机初始化 embedding 层。（Embedding 层是对用户、物品特点的“记忆”，比全连接层学得慢。）</li>
<li>方法2：把老模型作为 teacher 蒸馏新模型。（用户真实行为为y，老模型的预测是p，用<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1994em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8544em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>作为训练新模型的目标。</li>
</ul>
<h2 id="总结改进排序模型"><a class="header" href="#总结改进排序模型">总结：改进排序模型</a></h2>
<p>精排模型：改进模型基座（加宽加深、特征交叉、特征工程），改进多目标预估（增加新目标、MMoE、position bias）。</p>
<p>粗排模型：三塔模型（取代多向量双塔模型），粗精排一致性建模。</p>
<p>用户行为序列建模：沿着SIM的方向迭代升级，加长序列长度，改进筛选物品的方法。</p>
<p>在线学习：对指标提升大，但是会降低模型迭代升级效率。</p>
<p>老汤模型制约模型迭代升级效率，需要特殊技巧。</p>
<h1 id="多样性-1"><a class="header" href="#多样性-1">多样性</a></h1>
<p>这节课的内容是通过提升推荐物品的多样性为推荐系统涨指标。在召回、粗排、精排三个阶段，均有提升多样性的方法。在召回阶段，可以通过添加噪声、随机选取用户行为序列等方式提升双塔模型、I2I的多样性。在排序阶段，结合兴趣分数与多样性分数共同给候选物品排序。</p>
<h2 id="精排多样性"><a class="header" href="#精排多样性">精排多样性</a></h2>
<p>精排阶段，结合兴趣分数和多样性分数对物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>排序。</p>
<ul>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>：兴趣分数，即融合点击率等多个预估目标。</li>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>：多样性分数，即物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>与已经选中的物品的差异。</li>
<li>用 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>对物品做排序。</li>
</ul>
<p>常用MMR、DPP等方法计算多样性分数，精排使用滑动窗口，粗排不使用滑动窗口。</p>
<ul>
<li>精排决定最终的曝光，曝光页面上邻近的物品相似度应该小。所以计算精排多样性要使用滑动窗口。</li>
<li>粗排要考虑整体的多样性，而非一个滑动窗口中的多样性。</li>
</ul>
<p>除了多样性分数，精排还使用打散策略增加多样性。</p>
<ul>
<li>类目：当前选中物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>，之后5个位置不允许跟<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>的二级类目相同。</li>
<li>多模态：事先计算物品多模态内容向量表征，将全库物品聚为1000类；在精排阶段，如果当前选中物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>，之后10个位置不允许跟i同属一个聚类。</li>
</ul>
<h2 id="粗排多样性"><a class="header" href="#粗排多样性">粗排多样性</a></h2>
<p>粗排给5000个物品打分，选出500个物品送入精排。</p>
<p>提升粗排和精排多样性都可以提升推荐系统核心指标。</p>
<p>根据<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>对5000个物品排序，分数最高的200个物品送入精排。</p>
<p>对于剩余的4800个物品，对每个物品i计算兴趣分数<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和多样性分数<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<p>根据<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>对剩余4800个物品排序，分数最高的300个物品送入精排。</p>
<h2 id="双塔模型-3"><a class="header" href="#双塔模型-3">双塔模型</a></h2>
<h3 id="双塔模型添加噪声"><a class="header" href="#双塔模型添加噪声">双塔模型：添加噪声</a></h3>
<p>用户塔将用户特征作为输入，输出用户的向量表征；然后做ANN检索，召回向量相似度高的物品。</p>
<p>线上做召回时（在计算出用户向量之后，在做ANN检索之前）往用户向量中添加随机噪声。</p>
<p>用户的兴趣越窄（比如用户最近交互的n个物品只覆盖少数几个类目），则添加的噪声越强。</p>
<p>添加噪声使得召回的物品更多样，可以提升推荐系统核心指标</p>
<h3 id="双塔模型抽样用户行为序列"><a class="header" href="#双塔模型抽样用户行为序列">双塔模型：抽样用户行为序列</a></h3>
<p>用户最近交互的n个物品（用户行为序列）是用户塔的输入。保留最近的r个物品（<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>）。从剩余的<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>个物品中随机抽样<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>个物品（<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6542em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>）。（可以是均匀抽样，也可以用非均匀抽样让类目平衡。）将得到的<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span>个物品作为用户行为序列，而不是用全部<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>个物品。</p>
<p>抽样用户行为序列为什么能涨指标？</p>
<p>一方面，注入随机性，召回结果更多样化。另一方面，<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>可以非常大，可以利用到用户很久之前的兴趣。</p>
<h2 id="u2i2i抽样用户行为序列"><a class="header" href="#u2i2i抽样用户行为序列">U2I2I：抽样用户行为序列</a></h2>
<p>U2I2I（user—&gt;item一&gt;item）中的第一个item 是指用户最近交互的n个物品之一，在U2I2I中叫作种子物品。</p>
<p>n个物品覆盖的类目数较少，且类目不平衡。</p>
<ul>
<li>系统共有 200个类目，某用户的n个物品只覆盖15个类目。</li>
<li>足球类目的物品有 0.4n个，电视剧类目的物品有 0.2n个；其余类目的物品数均少于 0.05n个。</li>
</ul>
<p>做非均匀随机抽样，从n个物品中选出t个，让类目平衡。(想法和效果与双塔中的用户行为序列抽样相似。)</p>
<p>用抽样得到的t个物品（代替原本的n个物品）作为U2I2I 的种子物品。一方面，类目更平衡，多样性更好。另一方面，n可以更大，覆盖的类目更多。</p>
<h2 id="探索流量"><a class="header" href="#探索流量">探索流量</a></h2>
<p>每个用户曝光的物品中有2%是非个性化的，用作兴趣探索。</p>
<p>维护一个精选内容池，其中物品均为交互率指标高的优质物品。（内容池可以分人群，比如30~40岁男性内容池。）</p>
<p>从精选内容池中随机抽样几个物品，跳过排序，直接插入最终排序结果。</p>
<p>兴趣探索在短期内对核心指标产生负向影响，但长期来看会产生正向影响。</p>
<h2 id="总结提升多样性"><a class="header" href="#总结提升多样性">总结：提升多样性</a></h2>
<p>精排：结合兴趣分数和多样性分数做排序；做规则打散。</p>
<p>粗排：只用兴趣分数选出部分物品；结合兴趣分数和多样性分数选出部分物品。</p>
<p>召回：往双塔模型的用户向量添加噪声；对用户行为序列做非均匀随机抽样（对双塔和U2I2I都适用）。</p>
<p>兴趣探索：保留少部分的流量给非个性化推荐。</p>
<h1 id="特殊用户人群"><a class="header" href="#特殊用户人群">特殊用户人群</a></h1>
<p>这节课的内容是特殊对待特殊的用户人群，比如新用户和低活用户。具体介绍3大类方法：</p>
<ol>
<li>构造特殊内容池，用于特殊用户人群的召回。</li>
<li>使用特殊排序策略，保护特殊用户。</li>
<li>使用特殊的排序模型，消除模型预估的偏差。</li>
</ol>
<h2 id="为什么要特殊对待特殊人群"><a class="header" href="#为什么要特殊对待特殊人群">为什么要特殊对待特殊人群？</a></h2>
<ol>
<li>新用户、低活用户的行为很少，个性化推荐不准确。</li>
<li>新用户、低活用户容易流失，要想办法促使他们留存。</li>
<li>特殊用户的行为（比如点击率、交互率）不同于主流用户，基于全体用户行为训练出的模型在特殊用户人群上有偏。</li>
</ol>
<h2 id="涨指标的方法-1"><a class="header" href="#涨指标的方法-1">涨指标的方法</a></h2>
<ol>
<li>构造特殊内容池，用于特殊用户人群的召回。</li>
<li>使用特殊排序策略，保护特殊用户。</li>
<li>使用特殊的排序模型，消除模型预估的偏差。</li>
</ol>
<h2 id="特殊内容池"><a class="header" href="#特殊内容池">特殊内容池</a></h2>
<h3 id="为什么需要特殊内容池"><a class="header" href="#为什么需要特殊内容池">为什么需要特殊内容池？</a></h3>
<ul>
<li>新用户、低活用户的行为很少，个性化召回不准确。（既然个性化不好，那么就保证内容质量好。）</li>
<li>针对特定人群的特点构造特殊内容池，提升用户满意度。（例如，对于喜欢留评论的中年女性，构造促评论内容池，满足这些用户的互动需求。）</li>
</ul>
<h3 id="如何构造特殊内容池"><a class="header" href="#如何构造特殊内容池">如何构造特殊内容池？</a></h3>
<p>方法1：根据物品获得的交互次数、交互率选择优质物品。</p>
<ul>
<li>圈定人群：只考虑特定人群，例如18~25岁一二线城市男性。</li>
<li>构造内容池：用该人群对物品的交互次数、交互率给物品打分，选出分数最高的物品进入内容池。</li>
<li>内容池有弱个性化的效果。</li>
<li>内容池定期更新，加入新物品，排除交互率低和失去时效性的老物品。</li>
<li>该内容池只对该人群生效。</li>
</ul>
<p>方法2：做因果推断，判断物品对人群留存率的贡献，根据贡献值选物品。</p>
<p>这种技术还不成熟。</p>
<h3 id="特殊内容池的召回"><a class="header" href="#特殊内容池的召回">特殊内容池的召回</a></h3>
<p>通常使用双塔模型从特殊内容池中做召回。</p>
<ul>
<li>双塔模型是个性化的。</li>
<li>对于新用户，双塔模型的个性化做不准。</li>
<li>靠高质量内容、弱个性化做弥补。</li>
</ul>
<p>额外的训练代价？</p>
<ul>
<li>对于正常用户，不论有多少内容池，只训练一个双塔模型。</li>
<li>对于新用户，由于历史交互记录很少，需要单独训练模型。</li>
</ul>
<p>额外的推理代价？</p>
<ul>
<li>内容池定期更新，然后要更新 ANN 索引。</li>
<li>线上做召回时，需要做 ANN 检索。</li>
<li>特殊内容池都很小（比全量内容池小10~100倍），所以需要的额外算力不大。</li>
</ul>
<h2 id="特殊的排序策略"><a class="header" href="#特殊的排序策略">特殊的排序策略</a></h2>
<h3 id="排除低质量物品"><a class="header" href="#排除低质量物品">排除低质量物品</a></h3>
<p>对于新用户、低活用户这样的特殊人群，业务上只关注留存，不在乎消费（总曝光量、广告收入、电商收入）。</p>
<p>对于新用户、低活用户，少出广告、甚至不出广告。</p>
<p>新发布的物品不在新用户、低活用户上做探索。</p>
<ul>
<li>物品新发布时，推荐做得不准，会损害用户体验。</li>
<li>只在活跃的老用户上做探索，对新物品提权（boost）。</li>
<li>不在新用户、低活用户上做探索，避免伤害用户体验。</li>
</ul>
<h3 id="差异化的融分公式"><a class="header" href="#差异化的融分公式">差异化的融分公式</a></h3>
<p>新用户、低活用户的点击和交互行为不同于正常用户。</p>
<p>低活用户的人均点击量很小；没有点击就不会有进一步的交互。</p>
<p>低活用户的融分公式中，提高预估点击率的权重（相较于普通用户）。</p>
<p>保留几个曝光坑位给预估点击率最高的几个物品。</p>
<ul>
<li>例：精排从500个物品中选50个作为推荐结果，其中3个坑位给点击率最高的物品，剩余47个坑位由融分公式决定。</li>
<li>甚至可以把点击率最高的物品排在第一，确保用户一定能看到。</li>
</ul>
<h2 id="特殊的排序模型"><a class="header" href="#特殊的排序模型">特殊的排序模型</a></h2>
<h3 id="差异化的排序模型"><a class="header" href="#差异化的排序模型">差异化的排序模型</a></h3>
<p>特殊用户人群的行为不同于普通用户。新用户、低活用户的点击率和交互率偏高或偏低。</p>
<p>排序模型被主流用户主导，对特殊用户做不准预估。</p>
<ul>
<li>用全体用户数据训练出的模型，给新用户做的预估有严重偏差。</li>
<li>如果一个APP的用户90%是女性，用全体用户数据训练出的模型对男性用户做的预估有偏差。</li>
</ul>
<p>问题：对于特殊用户，如何让排序模型预估做得准？</p>
<p>方法1：大模型+小模型</p>
<ul>
<li>用全体用户行为训练大模型，大模型的预估p拟合用户行为y。</li>
<li>·用特殊用户的行为训练小模型，小模型的预估q拟合大模型的残差y-p。</li>
<li>对主流用户只用大模型做预估p。</li>
<li>对特殊用户，结合大模型和小模型的预估p+q。</li>
</ul>
<p>方法2：融合多个experts，类似MMoE。</p>
<ul>
<li>只用一个模型，模型有多个experts，各输出一个向量。</li>
<li>对 experts 的输出做加权平均。</li>
<li>根据用户特征计算权重。</li>
<li>以新用户为例，模型将用户的新老、活跃度等特征作为输入，输出权重，用于对 experts 做加权平均。</li>
</ul>
<p>方法3：大模型预估之后，用小模型做校准。</p>
<ul>
<li>用大模型预估点击率、交互率。</li>
<li>将用户特征丶大模型预估点击率和交互率作为小模型（例如GBDT）的输入。</li>
<li>在特殊用户人群的数据上训练小模型，小模型的输出拟合用户真实行为。</li>
</ul>
<h2 id="错误的做法"><a class="header" href="#错误的做法">错误的做法</a></h2>
<p>每个用户人群使用一个排序模型，推荐系统同时维护多个大模型。</p>
<ul>
<li>系统有一个主模型；每个用户人群有自己的一个模型。</li>
<li>每天凌晨，用全体用户数据更新主模型。</li>
<li>基于训练好的主模型，在某特殊用户人群的数据上再训练 1 epoch，作为该用户人群的模型。</li>
</ul>
<p>特点：短期可以提升指标；维护代价大，长期有害。</p>
<p>例如：起初，低活男性用户模型比主模型的AUC 高0.2%。主模型迭代几个版本后，AUC累计提升0.5%°·特殊人群模型太多，长期没有人维护和更新。如果把低活男性用户模型下线，换成主模型，在低活男性用户 上的 AUC 反倒提升 0.3% ！</p>
<p>赢两次不可取！因为只是浪费了算力，对模型没有改变。</p>
<h2 id="总结特殊对待特殊用户人群"><a class="header" href="#总结特殊对待特殊用户人群">总结：特殊对待特殊用户人群</a></h2>
<ul>
<li>召回：针对特殊用户人群，构造特殊的内容池，增加相应的召回通道。</li>
<li>排序策略：排除低质量物品，保护新用户和低活用户；特殊用户人群使用特殊的融分公式。</li>
<li>排序模型：结合大模型和小模型，小模型拟合大模型的残差；只用一个模型，模型有多个experts；大模型预估之后，用小模型做校准。</li>
</ul>
<h1 id="交互行为关注转发评论"><a class="header" href="#交互行为关注转发评论">交互行为（关注、转发、评论）</a></h1>
<p>这节课的内容是利用关注、转发、评论这三种交互行为给推荐系统涨指标。</p>
<h2 id="用户的交互行为"><a class="header" href="#用户的交互行为">用户的交互行为</a></h2>
<p>交互行为：点赞、收藏、转发、关注、评论·····</p>
<p>推荐系统如何利用交互行为？</p>
<p>最简单的方法：将模型预估的交互率用于排序。</p>
<ul>
<li>模型将交互行为当做预估的目标。</li>
<li>将预估的点击率、交互率做融合，作为排序的依据。</li>
</ul>
<p>交互行为有没有其他用途？</p>
<h2 id="关注"><a class="header" href="#关注">关注</a></h2>
<h3 id="关注量对留存的价值"><a class="header" href="#关注量对留存的价值">关注量对留存的价值</a></h3>
<p>一位用户关注的作者越多，则平台对他的吸引力越强。</p>
<p>用户留存率（r）与他关注的作者数量（f）正相关。</p>
<p>如果某用户的f较小，则推荐系统要促使该用户关注更多作者。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost04/img20250301101156.png" alt="" /></p>
<h3 id="如何利用关注关系提升用户留存"><a class="header" href="#如何利用关注关系提升用户留存">如何利用关注关系提升用户留存？</a></h3>
<p>方法1：用排序策略提升关注量。</p>
<ul>
<li>对于用户u，模型预估候选物品i的关注率为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</li>
<li>设用户u已经关注了f个作者。</li>
<li>我们定义单调递减函数<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mclose">)</span></span></span></span>，用户已经关注的作者越多，则 <span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mclose">)</span></span></span></span> 越小。</li>
<li>在排序融分公式中添加<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>用于促关注。（如果 f 小且<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>大则<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>给物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>带来很大加分。）</li>
</ul>
<p>方法2：构造促关注内容池和召回通道。</p>
<ul>
<li>这个内容池中物品的关注率高，可以促关注。</li>
<li>如果用户关注的作者数f较小，则对该用户使用该内容池。</li>
<li>召回配额可以固定，也可以与f负相关。</li>
</ul>
<h3 id="粉丝数对促发布的价值"><a class="header" href="#粉丝数对促发布的价值">粉丝数对促发布的价值</a></h3>
<p>UGC平台将作者发布量、发布率作为核心指标，希望作者多发布。</p>
<p>作者发布的物品被平台推送给用户，会产生点赞、评论、关注等交互。</p>
<p>交互（尤其是关注、评论）可以提升作者发布积极性。</p>
<p>作者的粉丝数越少，则每增加一个粉丝对发布积极性的提升越大。</p>
<p>用排序策略帮助低粉新作者涨粉。</p>
<p>某作者a的粉丝数（被关注数）为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。作者a发布的物品i可能被推荐给用户u，模型预估关注率为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。我们定义单调递减函数<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>作为权重；作者a的粉丝越多，则<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>越小。
在排序融分公式中添加<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>帮助低粉作者涨粉。</p>
<h3 id="隐式关注关系"><a class="header" href="#隐式关注关系">隐式关注关系</a></h3>
<p>召回通道 U2A2I ：user → author →item。</p>
<p>显式关注关系：用户u关注了作者a，将a发布的物品推荐给u。（点击率、交互率指标通常高于其他召回通道。)</p>
<p>隐式关注关系：用户u喜欢看作者a发布的物品，但是u 没有关注a。</p>
<p>隐式关注的作者数量远大于显式关注。挖掘隐式关注关系，构造U2A2I召回通道，可以提升推荐系统核心指标。</p>
<h2 id="转发"><a class="header" href="#转发">转发</a></h2>
<h3 id="促转发分享回流"><a class="header" href="#促转发分享回流">促转发（分享回流）</a></h3>
<p>A平台用户将物品转发到B平台，可以为A吸引站外流量。</p>
<p>推荐系统做促转发（也叫分享回流）可以提升DAU和消费指标。</p>
<p>简单提升转发次数是否有效呢？</p>
<ul>
<li>模型预估转发率为<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>，融分公式中有一项<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>，让转发率大的物品更容易获得曝光机会。</li>
<li>增大权重<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span>可以促转发，吸引站外流量，但是会对点击率和其他交互率产生负面影响。</li>
</ul>
<h3 id="kol建模"><a class="header" href="#kol建模">KOL建模</a></h3>
<p>目标：在不损害点击和其他交互的前提下，尽量多吸引站外流量。</p>
<p>什么样的用户的转发可以吸引大量站外流量？其他平台的Key Opinion Leader (KOL)！</p>
<ul>
<li>答案：其他平台的 Key Opinion Leader（KOL）。</li>
<li>用户u是我们站内的KOL，但他不是其他平台的KOL，他的转发价值大吗？不大</li>
<li>用户在我们站内没有粉丝，但他是其他平台的KOL，他的转发价值大吗？大</li>
</ul>
<p>如何判断本平台的用户是不是其他平台的KOL？该用户历史上的转发能带来多少站外流量。</p>
<h3 id="促转发的策略"><a class="header" href="#促转发的策略">促转发的策略</a></h3>
<p>目标：在不损害点击和其他交互的前提下，尽量多吸引站外流量。</p>
<p>识别出的站外KOL之后，该如何用于排序和召回？</p>
<p>方法1：排序融分公式中添加额外的一项<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<ul>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>：如果用户u是站外KOL，则<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0315em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>大。</li>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>：为用户u推荐物品i，模型预估的转发率。</li>
<li>如果u是站外KOL，则多给他曝光他可能转发的物品。</li>
</ul>
<p>方法2：构造促转发内容池和召回通道，对站外KOL生效。</p>
<h2 id="评论"><a class="header" href="#评论">评论</a></h2>
<h3 id="评论促发布"><a class="header" href="#评论促发布">评论促发布</a></h3>
<p>UGC平台将作者发布量、发布率作为核心指标，希望作者多发布。</p>
<p>关注、评论等交互可以提升作者发布积极性。</p>
<p>如果新发布物品尚未获得很多评论，则给预估评论率提权，让物品尽快获得评论。</p>
<p>排序融分公式中添加额外一项<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5945em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<ul>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>：权重，与物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>已有的评论数量负相关。</li>
<li><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>：为用户推荐物品<span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>，模型预估的评论率。</li>
</ul>
<h3 id="评论的其他价值"><a class="header" href="#评论的其他价值">评论的其他价值</a></h3>
<p>有的用户喜欢留评论，喜欢跟作者、评论区用户互动。</p>
<ul>
<li>给这样的用户添加促评论的内容池，让他们更多机会参与讨论。</li>
<li>有利于提升这些用户的留存。</li>
</ul>
<p>有的用户常留高质量评论（评论的点赞量高）。</p>
<ul>
<li>高质量评论对作者、其他用户的留存有贡献。（作者、其他用户觉得这样的评论有趣或有帮助。）</li>
<li>用排序和召回策略鼓励这些用户多留评论。</li>
</ul>
<h2 id="总结利用交互行为"><a class="header" href="#总结利用交互行为">总结：利用交互行为</a></h2>
<p>关注：留存价值（让新用户关注更多作者，提升新用户留存）；发布价值（帮助新作者获得更多粉丝，提升作者发布积极性）；利用隐式关注关系做召回。</p>
<p>转发：判断哪些用户是站外的KOL，利用他们转发的价值，吸引站外的流量。</p>
<p>评论：发布价值（促使新物品获得评论，提升作者发布积极性）；留存价值（给喜欢讨论的用户创造更多留评机会）；鼓励高质量评论的用户多留评论。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
